<script language="JavaScript" src="lib/prototype.js"></script>
<script language="JavaScript" src="lib/json.js"></script>

<script language="JavaScript" src="common/uris.js"></script>
<script language="JavaScript" src="common/modules.js"></script>
<script language="JavaScript" src="persistenceEngine/PersistenceEngine.js"></script>

<script language="JavaScript" src="varManager/VariableGadget.js"></script>
<script language="JavaScript" src="varManager/VariablePlatform.js"></script>
<script language="JavaScript" src="varManager/varManager.js"></script>

<script language="JavaScript" src="opManager/OpManager.js"></script>
<script language="JavaScript" src="wiring/wiring.js"></script>
<script language="JavaScript" src="gadgetModel/Template.js"></script>
<script language="JavaScript" src="gadgetModel/XHtml.js"></script>
<script language="JavaScript" src="gadgetModel/Gadget.js"></script>
<script>

	// ******************
	//  CALLBACK METHODS 
	// ******************
	
	// Not like the remaining methods. This is a callback function to process AJAX requests, so must be public.
	
	loadGadget = function (transport) {
		var response = transport.responseText;
		gadget_json = eval ('(' + response + ')');
	}
		
	onError = function (transport) {
		alert("Error XHtml GET");
		// Process
	}
	
	// ******************
	//  PUBLIC FUNCTIONS
	// ******************
	
	getGadget = function () {
		return gadget_json;
	}
	
	// *********************************
	//  PRIVATE VARIABLES AND FUNCTIONS
	// *********************************
	
	var gadget_json;
	var persistenceEngine = PersistenceEngineFactory.getInstance();
	
	// Getting Variables from PersistenceEngine. Asyncrhonous call!
	persistenceEngine.send_get('gadget.json', this, loadGadget, onError);

	duh  = function(){
		var elemento = $('texto');
	
		var gadget = new Gadget(gadget_json, null);
		var elementos = gadget.getXHtml().getElements();
		for (i=0; i<elementos.length; i++)
		{
			alert(elementos[i].getId());
		}
		elemento.innerHTML = gadget.getTemplate().getUserPrefsId().toJSONString();
		elemento.style.color = 'blue';
	}

</script>
<button onclick='duh();' id='boton'>clic</button>
<div id='texto'>Juanjo</div>