var Constants={Logging:{ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3}};function Theme(a,c,f){this.loaded=false;this.name=a;this._themeURL="/ezweb/themes/"+a;this._callback=f;if(c){this._iconMapping=Object.clone(c._iconMapping)}else{this._iconMapping=new Object()}this._imagesToPreload=[];var d=function(m){var g=m.responseText;try{g=JSON.parse(g)}catch(k){var l=gettext('Theme description "%(themeName)s" could not be loaded.');l=interpolate(l,{themeName:this.name},true);if(this._callback){this._callback(this,l)}return}if(g.icons){var h=g.icons}else{var h={}}for(var j in h){this._iconMapping[j]=this.getResource("/images/"+h[j])}if(g.imagesToPreload){this._imagesToPreload=g.imagesToPreload}this.loaded=true;if(this._callback){this._callback(this,null)}}.bind(this);var b=function(g,j){var h=LogManagerFactory.getInstance();var k=h.formatError("%(errorMsg)s",g,j);if(this._callback){this._callback(this,k)}}.bind(this);new Ajax.Request(this.getResource("/theme.json"),{method:"get",onSuccess:d,onFailure:b})}Theme.prototype.getBaseURL=function(){return this._themeURL};Theme.prototype.getResource=function(a){return this._themeURL+a};Theme.prototype.iconExists=function(a){return this._iconMapping[a]!==undefined};Theme.prototype.getIconURL=function(a){if(this._iconMapping[a]===undefined){var b=gettext('There is not any icon identified by "%(iconId)s".');b=interpolate(b,{iconId:a},true);LogManagerFactory.getInstance().log(b,Constants.Logging.WARN_MSG)}return this._iconMapping[a]};Theme.prototype._appendStyle=function(a){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a);var b=document.getElementsByTagName("head").item(0);b.appendChild(c)};Theme.prototype._removeStyle=function(b){var a=$$('link[type="text/css"][href="'+b+'"]');if(a.length!==1){return}a=a[0];a.parentNode.removeChild(a)};Theme.prototype._countIcons=function(){if(this._iconCount!=undefined){return}this._iconCount=0;for(var a in this._iconMapping){this._iconCount++}};Theme.prototype.preloadImages=function(j){LayoutManagerFactory.getInstance().logSubTask(gettext("Loading theme images"));this._countIcons();var c=this._iconCount+this._imagesToPreload.length;var l=c;var h=new Array();var f=function(o,m){var n=this.target;c--;if((arguments.length==2)&&m){var p=gettext("%(current)s/%(total)s Error loading %(image)s");h.push(n.src)}else{var p=gettext("%(current)s/%(total)s %(image)s")}p=interpolate(p,{current:l-c,total:l,image:n.src},true);LayoutManagerFactory.getInstance().logStep(p,l);if(c==0){j(this.theme,h)}};var a=function(m){f.call(this,m,true)};for(var k in this._iconMapping){var g=document.createElement("img");Element.extend(g);var b={theme:this,target:g};g.observe("load",f.bind(b));g.observe("error",a.bind(b));g.observe("abort",a.bind(b));g.src=this._iconMapping[k]}for(var d=0;d<this._imagesToPreload.length;d++){var g=document.createElement("img");Element.extend(g);var b={theme:this,target:g};g.observe("load",f.bind(b));g.observe("error",a.bind(b));g.observe("abort",a.bind(b));g.src=this.getResource("/images/"+this._imagesToPreload[d])}};Theme.prototype.applyStyle=function(){if(_ONLY_ONE_CSS_FILE===false){this._appendStyle(this.getResource("/css/ezweb.css"));this._appendStyle(this.getResource("/css/wiring.css"));this._appendStyle(this.getResource("/css/catalogue.css"));this._appendStyle(this.getResource("/css/dragboard.css"));if(BrowserUtilsFactory.getInstance().isIE()){this._appendStyle(this.getResource("/css/ie.css"))}}else{this._appendStyle(this.getResource("/css/ezweb_theme_"+_EzWeb_RELEASE+".css"))}};Theme.prototype.deapplyStyle=function(){if(_ONLY_ONE_CSS_FILE===false){this._removeStyle(this.getResource("/css/ezweb.css"));this._removeStyle(this.getResource("/css/wiring.css"));this._removeStyle(this.getResource("/css/catalogue.css"));this._removeStyle(this.getResource("/css/dragboard.css"));if(BrowserUtilsFactory.getInstance().isIE()){this._removeStyle(this.getResource("/css/ie.css"))}}else{this._removeStyle(this.getResource("/css/ezweb_theme_"+_EzWeb_RELEASE+".css"))}};var BrowserUtilsFactory=function(){var a=null;function b(){b.prototype.getHeight=function(){var c=window.innerHeight;if(document.documentElement&&document.documentElement.clientHeight){c=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){c=document.body.clientHeight}}return c};b.prototype.getWidth=function(){var c=window.innerWidth;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){c=document.documentElement.clientWidth}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){c=document.body.clientWidth}}return c};b.prototype.isLeftButton=function(c){if((this.isIE()&&c==1)||c==0){return true}else{return false}};b.prototype.isRightButton=function(c){if(c==2){return true}else{return false}};b.prototype.getTarget=function(c){if(c.target){return c.target}else{if(c.srcElement){return c.srcElement}}};b.prototype.getBrowser=function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var c=new Number(RegExp.$1);if(c>=8){return"IE8"}else{if(c>=7){return"IE7"}else{if(c>=6){return"IE6"}else{if(c>=5){return"IE5"}}}}}else{if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var d=new Number(RegExp.$1);if(d>=3){return"FF3"}else{if(d>=2){return"FF2"}else{if(d>=1){return"FF1"}}}}else{return"OTHER"}}};b.prototype.isIE=function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){return true}else{return false}}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function Modules(){}Modules.prototype.THEME_MANAGER=3;Modules.prototype.PLATFORM_PREFERENCES=4;Modules.prototype.SHOWCASE=0;Modules.prototype.CATALOGUE=1;Modules.prototype.ACTIVE_WORKSPACE=2;var InputValidationError=new Object();InputValidationError.NO_ERROR=0;InputValidationError.REQUIRED_ERROR=1;InputValidationError.URL_ERROR=2;InputValidationError.EMAIL_ERROR=3;InputValidationError.ID_ERROR=4;InputValidationError.COLOR_ERROR=5;InputValidationError.BOOLEAN_ERROR=6;InputValidationError.VERSION_ERROR=7;function ValidationErrorManager(){this.fieldsWithErrorById=new Object()}ValidationErrorManager.prototype._addValidationError=function(a,b){if(this.fieldsWithErrorById[a]==undefined){this.fieldsWithErrorById[a]=new Array()}this.fieldsWithErrorById[a].push(b)};ValidationErrorManager.prototype.validate=function(b){var a=b.checkValue();if(a!=InputValidationError.NO_ERROR){this._addValidationError(a,b.getLabel())}};ValidationErrorManager.prototype._buildErrorMsg=function(c){var d;c=parseInt(c);switch(c){case InputValidationError.REQUIRED_ERROR:d=gettext("The following required fields are empty: %(fields)s.");break;case InputValidationError.URL_ERROR:d=gettext("The following fields do not contain a valid URL: %(fields)s.");break;case InputValidationError.EMAIL_ERROR:d=gettext("The following fields do not contain a valid E-Mail address: %(fields)s.");break;case InputValidationError.VERSION_ERROR:d=gettext("The following field do not contain a valid version number: %(fields)s.");break;case InputValidationError.ID_ERROR:d=gettext("The following fields contain invalid characters: %(fields)s.");break;case InputValidationError.COLOR_ERROR:d=gettext("The following fields do not contain a valid color value: %(fields)s.");break}var a="";for(var b=0;b<this.fieldsWithErrorById[c].length;b++){a+=", "+this.fieldsWithErrorById[c][b]}a=a.substring(2);return interpolate(d,{fields:a},true)};ValidationErrorManager.prototype.toHTML=function(){var a="";for(errorCode in this.fieldsWithErrorById){a+="<p>"+this._buildErrorMsg(errorCode)+"</p>"}return a};function InputInterface(a,b){if(arguments.length==0){return}this._fieldId=a;this._defaultValue=b.defaultValue;this._label=b.label;this._required=b.required?b.required:false;if(b.description){this._description=b.description}else{this._description=b.label}}InputInterface.prototype.getValue=function(){return this.inputElement.value};InputInterface.prototype.setValue=function(a){if(this.isValidValue(a)){this._setValue(a)}};InputInterface.prototype.getLabel=function(){return this._label};InputInterface.prototype.getDescription=function(){return this._description};InputInterface.prototype.getDefaultValue=function(){return this._defaultValue};InputInterface.prototype.isEmpty=function(){return this.getValue()==""};InputInterface.prototype._checkValue=function(a){return InputValidationError.NO_ERROR};InputInterface.prototype.checkValue=function(a){if(a===undefined){a=this.getValue()}if(this._required&&(a==undefined||this.isEmpty())){return InputValidationError.REQUIRED_ERROR}if(!this._required&&this.isEmpty()){return InputValidationError.NO_ERROR}return this._checkValue(a)};InputInterface.prototype.isValidValue=function(a){return this.checkValue(a)===InputValidationError.NO_ERROR};InputInterface.prototype._setValue=function(a){if(a==null){a=""}this.inputElement.value=a};InputInterface.prototype.reset=function(){this._setValue(this._defaultValue)};InputInterface.prototype.focus=function(){this.inputElement.focus()};InputInterface.prototype.setDisabled=function(a){if(a){this.inputElement.setAttribute("disabled","disabled")}else{this.inputElement.removeAttribute("disabled")}};InputInterface.prototype._insertInto=function(a){a.appendChild(this.inputElement)};InputInterface.prototype.parseFromPersistence=function(a){return a};function TextInputInterface(a,b){if(arguments.length==0){return}InputInterface.call(this,a,b);this.inputElement=document.createElement("input");Element.extend(this.inputElement);this.inputElement.setAttribute("type","text")}TextInputInterface.prototype=new InputInterface();function IntegerInputInterface(a,b){if(arguments.length==0){return}InputInterface.call(this,a,b);this.inputElement=document.createElement("input");Element.extend(this.inputElement);this.inputElement.setAttribute("type","text")}IntegerInputInterface.prototype=new InputInterface();IntegerInputInterface.prototype.getValue=function(){var a=this.inputElement.value;if(a==""){return 0}return parseInt(a)};IntegerInputInterface.prototype.parseFromPersistence=function(a){return parseInt(a)};function LongTextInputInterface(a,b){InputInterface.call(this,a,b);this.inputElement=document.createElement("textarea");Element.extend(this.inputElement);this.inputElement.setAttribute("cols","50");this.inputElement.setAttribute("rows","3")}LongTextInputInterface.prototype=new InputInterface();function URLInputInterface(a,b){TextInputInterface.call(this,a,b)}URLInputInterface.prototype=new TextInputInterface();URLInputInterface.prototype._URLChecker=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;URLInputInterface.prototype._checkValue=function(a){return this._URLChecker.test(a)?InputValidationError.NO_ERROR:InputValidationError.URL_ERROR};function EMailInputInterface(a,b){TextInputInterface.call(this,a,b)}EMailInputInterface.prototype=new TextInputInterface();EMailInputInterface.prototype._EMailChecker=/[\w\d][\w-]*@[\w\d-]+\.[\w\d]+/;EMailInputInterface.prototype._checkValue=function(a){return this._EMailChecker.test(a)?InputValidationError.NO_ERROR:InputValidationError.EMAIL_ERROR};function VersionInputInterface(a,b){TextInputInterface.call(this,a,b);this.sample=document.createElement("div");Element.extend(this.sample);this.sample.addClassName("explanation");this.sample.innerHTML=gettext("Format: X.X.X, where X is an integer.")+"<br/>"+gettext('Ex. "0.1", "1.11". NOTE: 1.01 should be 1.0.1')}VersionInputInterface.prototype=new TextInputInterface();VersionInputInterface.prototype._checkValue=function(c){var b=/^(\d+\.)*\d+$/;var a=/^(0\d+\.)|(\.0\d+)/;return(b.test(c)&&!a.test(c))?InputValidationError.NO_ERROR:InputValidationError.VERSION_ERROR};VersionInputInterface.prototype._insertInto=function(a){a.appendChild(this.inputElement);a.appendChild(this.sample)};function IdInputInterface(a,b){TextInputInterface.call(this,a,b)}IdInputInterface.prototype=new TextInputInterface();IdInputInterface.prototype._invalid_characters=["/","?","&",":"];IdInputInterface.prototype._checkValue=function(c){for(var a=0;a<this._invalid_characters.length;a++){var b=this._invalid_characters[a];if(this.inputElement.value.indexOf(b)>=0){return InputValidationError.ID_ERROR}}return InputValidationError.NO_ERROR};function ColorInputInterface(c,d){InputInterface.call(this,c,d);this.inputElement=document.createElement("input");Element.extend(this.inputElement);this.inputElement.setAttribute("maxlength",7);this.inputElement.setAttribute("type","text");this.inputElement.setAttribute("class","color_input");var b=this.fieldId+"_input";this.inputElement.setAttribute("id",b);this.button=document.createElement("button");Element.extend(this.button);this.button.addClassName("color_button");this.sample=document.createElement("input");Element.extend(this.sample);var a=this.fieldId+"_sample";this.sample.setAttribute("id",a);this.sample.setAttribute("size","1");this.sample.setAttribute("type","text");this.sample.setAttribute("disabled","disabled");this.button.observe("click",function(){showColorGrid3(b,a)})}ColorInputInterface.prototype=new InputInterface();ColorInputInterface.prototype._hexChecker=new RegExp("^#?[a-fA-F0-9]{6}$");ColorInputInterface.prototype._hexExtractor=new RegExp("^#?([0-9A-F]{6})$");ColorInputInterface.prototype._checkValue=function(a){return this._hexChecker.test(a)?InputValidationError.NO_ERROR:InputValidationError.COLOR_ERROR};ColorInputInterface.prototype.getValue=function(){var a=this.inputElement.value;if(a==""){return a}return this._hexExtractor.exec(a.toUpperCase())[1]};ColorInputInterface.prototype._insertInto=function(b){b.appendChild(this.inputElement);b.appendChild(this.button);b.appendChild(this.sample);var a=document.createElement("div");Element.extend(a);a.setAttribute("id","colorpicker301");a.addClassName("colorpicker301");b.appendChild(a,b.firstChild)};function BooleanInputInterface(a,b){InputInterface.call(this,a,b);this.inputElement=document.createElement("input");Element.extend(this.inputElement);this.inputElement.setAttribute("type","checkbox")}BooleanInputInterface.prototype=new InputInterface();BooleanInputInterface.prototype.isEmpty=function(){return false};BooleanInputInterface.prototype.getValue=function(){return this.inputElement.checked};BooleanInputInterface.prototype._setValue=function(a){if(a==null){a=false}this.inputElement.checked=a};BooleanInputInterface.prototype._checkValue=function(a){return(typeof a=="boolean")?InputValidationError.NO_ERROR:InputValidationError.BOOLEAN_ERROR};BooleanInputInterface.prototype.parseFromPersistence=function(a){return typeof a=="boolean"?a:a=="True"};function RadioButtonInputInterface(a,b){InputInterface.call(this,a,b);this.inputElement=document.createElement("input");Element.extend(this.inputElement);this.inputElement.setAttribute("type","radio");this.inputElement.setAttribute("name",b.name);if(this._defaultValue){this.inputElement.setAttribute("defaultChecked","defaultChecked")}if("onclick" in b){this.inputElement.observe("click",b.onclick,true,a)}}RadioButtonInputInterface.prototype=new InputInterface();RadioButtonInputInterface.prototype.getValue=function(){return this.inputElement.checked};RadioButtonInputInterface.prototype._setValue=function(a){if(a==null){a=false}this.inputElement.checked=a};function SelectInputInterface(a,d){InputInterface.call(this,a,d);this.inputElement=document.createElement("select");for(var b=0;b<d.options.length;b++){var c=new Option(d.options[b].label,d.options[b].value);try{this.inputElement.add(c,null)}catch(f){this.inputElement.add(c)}}}SelectInputInterface.prototype=new InputInterface();function MultipleInputInterface(a,d){InputInterface.call(this,a,d);this.inputElement=document.createElement("select");Element.extend(this.inputElement);this.inputElement.multiple=true;this.sample=document.createElement("div");Element.extend(this.sample);this.sample.addClassName("explanation");this.sample.setTextContent(gettext('Hold down "Control", or "Command" on a Mac, to select more than one item'));for(var b=0;b<d.options.length;b++){var c=new Option(d.options[b].label,d.options[b].value);try{this.inputElement.add(c,null)}catch(f){this.inputElement.add(c)}}}MultipleInputInterface.prototype=new InputInterface();MultipleInputInterface.prototype._insertInto=function(a){a.appendChild(this.inputElement);a.appendChild(this.sample)};MultipleInputInterface.prototype.getValue=function(){var d=[];if(!this.inputElement.checked){return d}var b=this.inputElement.options;var a=b.length;for(var c=0;c<a;c++){if(b[c].selected){d.push(b[c].value)}}return d};MultipleInputInterface.prototype._setValue=function(a){if(a==null){a=[]}this.inputElement.checked=a};var InterfaceFactory=new Object();InterfaceFactory.createInterface=function(a,b){switch(b.type){case"boolean":return new BooleanInputInterface(a,b);case"id":return new IdInputInterface(a,b);case"text":return new TextInputInterface(a,b);case"integer":return new IntegerInputInterface(a,b);case"longtext":return new LongTextInputInterface(a,b);case"color":return new ColorInputInterface(a,b);case"url":return new URLInputInterface(a,b);case"email":return new EMailInputInterface(a,b);case"version":return new VersionInputInterface(a,b);case"select":return new SelectInputInterface(a,b);case"multiple":return new MultipleInputInterface(a,b);case"radio":return new RadioButtonInputInterface(a,b);default:throw new Error(b.type)}};var PreferencesManagerFactory=function(){var a=null;function b(){this.preferencesDef=new Hash();this.preferences=null;this.languageModified=false;var n=function(o){var p=JSON.parse(o.responseText);this.preferences=this.preferencesDef.platform.buildPreferences(p);OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.PLATFORM_PREFERENCES)};var j=function(r,p){var o=LogManagerFactory.getInstance();var q=o.formatError(gettext("Error retrieving platform preferences data: %(errorMsg)s"),r,p);o.log(q);this.preferences=this.preferencesDef.platform.buildPreferences({});OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.PLATFORM_PREFERENCES)};b.prototype._processDefinitions=function(q){var u=new Object();for(var t in q){var r=q[t];var p=InterfaceFactory.createInterface(t,r);var o=new PreferenceDef(t,p,r.inheritable,r.inheritByDefault,r.hidden);u[t]=o}return u};b.prototype.show=function(){LayoutManagerFactory.getInstance().showPreferencesWindow("platform",this.preferences)};b.prototype.getPreferencesDef=function(o){return this.preferencesDef[o]};b.prototype.getPlatformPreferences=function(){return this.preferences};b.prototype.buildPreferences=function(r,o){var p=Array.prototype.slice.call(arguments,1);var q=this.preferencesDef[r];return q.buildPreferences.apply(q,p)};var m;var f={"initial-theme":{hidden:true,label:"",type:"text",description:""},theme:{label:gettext("Theme"),type:"select",options:[]},"tip-0":{defaultValue:true,label:gettext("Show catalogue help dialog"),type:"boolean",description:""},"tip-1":{defaultValue:true,label:gettext("Show wiring help dialog"),type:"boolean",description:""},"tip-2":{defaultValue:true,label:gettext("Show dragboard help dialog"),type:"boolean",description:""}};var l={theme:{inheritable:true,inheritByDefault:true,label:gettext("Theme"),type:"select",options:[],description:gettext("Theme to use as default. (default: inherit)")},layout:{defaultValue:"Fixed",label:gettext("Default grid layout"),type:"select",options:[{value:"Fixed",label:"Fixed to the grid"},{value:"Free",label:"Out of the grid"}],description:gettext("Default layout for the new gadgets.")},smart:{defaultValue:true,label:gettext("Smart grid for gadgets fixed to the grid"),type:"boolean",description:gettext("iGadgets will be automatically reordered if this option is enabled. (default: enabled)")},columns:{defaultValue:20,label:gettext("Grid columns"),type:"integer",description:gettext("Grid columns. (default: 20)")},"cell-height":{defaultValue:12,label:gettext("Cell Height (in pixels)"),type:"integer",description:gettext("Cell Height. Must be specified in pixel units. (default: 13)")},"horizontal-margin":{defaultValue:4,label:gettext("Horizontal Margin between iGadgets (in pixels)"),type:"integer",description:gettext("Horizontal Margin between iGadgets. Must be specified in pixel units. (default: 4)")},"vertical-margin":{defaultValue:3,label:gettext("Vertical Margin between iGadgets (in pixels)"),type:"integer",description:gettext("Vertical Margin between iGadgets. Must be specified in pixel units. (default: 3)")}};var d={locked:{defaultValue:false,label:gettext("Locked"),type:"boolean",description:gettext("If the Tab is locked, you will not be able to move, resize and do other task over its iGadgets.")},layout:{inheritable:true,inheritByDefault:true,defaultValue:"Fixed",label:gettext("Default grid layout"),type:"select",options:[{value:"Fixed",label:"Fixed to the grid"},{value:"Free",label:"Out of the grid"}],description:gettext("Default layout for the new gadgets.")},smart:{inheritable:true,inheritByDefault:true,defaultValue:true,label:gettext("Smart grid for gadgets fixed to the grid"),type:"boolean",description:gettext("iGadgets will be automatically reordered if this option is enabled. (default: enabled)")},columns:{inheritable:true,inheritByDefault:true,defaultValue:20,label:gettext("Grid columns"),type:"integer",description:gettext("Grid columns. (default: 20)")},"cell-height":{inheritable:true,inheritByDefault:true,defaultValue:12,label:gettext("Cell Height (in pixels)"),type:"integer",description:gettext("Cell Height. Must be specified in pixel units. (default: 13)")},"horizontal-margin":{inheritable:true,inheritByDefault:true,defaultValue:4,label:gettext("Horizontal Margin between iGadgets (in pixels)"),type:"integer",description:gettext("Horizontal Margin between iGadgets. Must be specified in pixel units. (default: 4)")},"vertical-margin":{inheritable:true,inheritByDefault:true,defaultValue:3,label:gettext("Vertical Margin between iGadgets (in pixels)"),type:"integer",description:gettext("Vertical Margin between iGadgets. Must be specified in pixel units. (default: 3)")}};f["initial-theme"]["defaultValue"]=_DEFAULT_THEME;f.theme["defaultValue"]=_DEFAULT_THEME;var h=gettext("Theme to use by default. (default: %(defaultValue)s)");f.theme["description"]=interpolate(h,{defaultValue:_DEFAULT_THEME},true);l.theme["defaultValue"]=_DEFAULT_THEME;var k=_THEMES;for(var c=0;c<k.length;c++){var g=k[c];l.theme["options"].push({value:g,label:g});f.theme["options"].push({value:g,label:g})}m=this._processDefinitions(f);this.preferencesDef.platform=new PlatformPreferencesDef(m);m=this._processDefinitions(l);this.preferencesDef.workspace=new WorkSpacePreferencesDef(m);m=this._processDefinitions(d);this.preferencesDef.tab=new TabPreferencesDef(m);PersistenceEngineFactory.getInstance().send_get(URIs.PLATFORM_PREFERENCES,this,n,j)}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function PreferenceDef(c,a,d,b,f){this.name=c;this.inputInterface=a;this.inheritable=d===true;this.inheritByDefault=d&&b;this.hidden=f===true;if(this.inheritable){this.inheritInterface=InterfaceFactory.createInterface("inherit-"+this.name,{type:"boolean"})}this.handlers=new Array()}PreferenceDef.prototype.getLabelInterface=function(){var a=document.createElement("label");a.appendChild(document.createTextNode(gettext(this.inputInterface.getLabel())));a.setAttribute("title",gettext(this.inputInterface.getDescription()));return a};PreferenceDef.prototype.getInterface=function(){return this.inputInterface};PreferenceDef.prototype.getInheritInterface=function(){return this.inheritInterface};PreferenceDef.prototype.isHidden=function(){return this.hidden};PreferenceDef.prototype.isInheritable=function(){return this.inheritable};function PlatformPref(c,a,b,d){this.definition=a;this.manager=c;this.inherit=b;this.value=d;this.handlers=new Array()}PlatformPref.prototype.getName=function(){return this.definition.name};PlatformPref.prototype.getLabel=function(){return this.definition.inputInterface.label};PlatformPref.prototype.getDescription=function(){return this.definition.inputInterface.description};PlatformPref.prototype.getDefaultValue=function(){return this.definition.inputInterface.getDefaultValue()};PlatformPref.prototype.getValue=function(){return this.value};PlatformPref.prototype._getParentValue=function(){return this.manager.getParentValue(this.definition.name)};PlatformPref.prototype.setInheritValue=function(a){this.inherit=a};PlatformPref.prototype.getEffectiveValue=function(){if(this.inherit){return this._getParentValue()}return this.value};PlatformPref.prototype.setValue=function(a){if(this.definition.inputInterface.isValidValue(a)){this.value=a}};PlatformPref.prototype.addHandler=function(a){this.handlers.push(a)};PlatformPref.prototype._setManager=function(a){this.manager=a};PlatformPref.prototype._propagate=function(){for(var a=0;a<this.handlers.length;a++){try{this.handlers[a](this.scope,this.name,this.value)}catch(b){}}};PlatformPref.prototype.setDefaultValue=function(){this.setValue(this.definition.inputInterface.getDefaultValue())};PlatformPref.prototype.getValueFromInterface=function(){return this.definition.inputInterface.getValue()};PlatformPref.prototype.setValueInInterface=function(a){this.definition.inputInterface.setValue(a)};PlatformPref.prototype.resetInterfaceValue=function(){this.definition.inputInterface._setValue(this.value);if(this.definition.inheritInterface){this.definition.inheritInterface._setValue(this.inherit);this.definition.inputInterface.setDisabled(this.inherit)}};function PreferencesDef(p){if(arguments.length==0){return}this._preferences=p;this._table=document.createElement("table");this._table.setAttribute("cellspacing","0");this._table.setAttribute("cellpadding","0");var f=document.createElement("tbody");this._table.appendChild(f);for(var n in this._preferences){var d=this._preferences[n];if(d.isHidden()){continue}if(!d.isInheritable()){var q=f.insertRow(-1);var k=q.insertCell(-1);k.className="label";var m=q.insertCell(-1);k.appendChild(d.getLabelInterface());d.getInterface()._insertInto(m)}else{var o=f.insertRow(-1);var a=o.insertCell(-1);a.colSpan="2";var j=$(document.createElement("table"));j.addClassName("complexTable");j.setAttribute("cellspacing","0");j.setAttribute("cellpadding","0");a.appendChild(j);var h=document.createElement("tbody");j.appendChild(h);var g=h.insertRow(-1);var k=g.insertCell(-1);k.className="label";k.colSpan="2";var c=h.insertRow(-1);var l=$(c.insertCell(-1));l.addClassName("inheritCell");var b=d.getInheritInterface();b._insertInto(l);l.appendChild(document.createTextNode(gettext("Inherit")));Event.observe(b.inputElement,"click",function(){this.getInterface().setDisabled(this.inheritInterface.getValue())}.bind(d));var m=c.insertCell(-1);k.appendChild(d.getLabelInterface());d.getInterface()._insertInto(m)}}}PreferencesDef.prototype.getInterface=function(){return this._table};function PlatformPreferencesDef(a){PreferencesDef.call(this,a)}PlatformPreferencesDef.prototype=new PreferencesDef();PlatformPreferencesDef.prototype.buildPreferences=function(a){return new PlatformPreferences(this._preferences,a)};function WorkSpacePreferencesDef(a){PreferencesDef.call(this,a)}WorkSpacePreferencesDef.prototype=new PreferencesDef();WorkSpacePreferencesDef.prototype.buildPreferences=function(b,a){return new WorkSpacePreferences(this._preferences,a,b)};function TabPreferencesDef(a){PreferencesDef.call(this,a)}TabPreferencesDef.prototype=new PreferencesDef();TabPreferencesDef.prototype.buildPreferences=function(a,b){return new TabPreferences(this._preferences,b,a)};function Preferences(f,a){if(arguments.length==0){return}this._preferences=new Object();var b,g,d;for(var c in f){d=f[c];if(c in a){b=a[d.name].inherit;g=d.inputInterface.parseFromPersistence(a[c].value)}else{g=d.inputInterface.getDefaultValue();b=d.inheritByDefault}this._preferences[d.name]=new PlatformPref(this,d,b,g)}this._handleParentChanges=this._handleParentChanges.bind(this);this.handlers=[]}Preferences.prototype.resetInterface=function(){for(var b in this._preferences){var a=this._preferences[b];a.resetInterfaceValue()}};Preferences.prototype.addCommitHandler=function(a){this.handlers.push(a)};Preferences.prototype.removeCommitHandler=function(b){var a=this.handlers.indexOf(b);if(a!=-1){this.handlers.splice(a,1)}};Preferences.prototype.get=function(a){return this._preferences[a].getEffectiveValue()};Preferences.prototype.set=function(c){var a={};var g={};for(var b in c){var d=this._preferences[b];var f=c[b];if("inherit" in f){d.setInheritValue(f.inherit)}if("value" in f){d.setValue(f.value)}g[b]=f;a[b]=d.getEffectiveValue()}this._notifyCommitHandlers(a);this._save(g)};Preferences.prototype._onSuccessSavePreferences=function(){};Preferences.prototype._onErrorSavePreferences=function(){};Preferences.prototype._handleParentChanges=function(d){var c={};var a=false;for(var b in d){if(b in this._preferences&&this._preferences[b].inherit){a=true;c[b]=d[b]}}if(a){this._notifyCommitHandlers(c)}};Preferences.prototype._notifyCommitHandlers=function(c){var a=this.handlers.length;for(var b=0;b<a;b++){this.handlers[b](c)}};Preferences.prototype.save=function(){var g=[];var c={};var b={};var m=false;for(var l in this._preferences){var d=this._preferences[l];var h=false;if(d.definition.inheritInterface){var o=d.definition.inheritInterface.getValue();h=o!=d.inherit}var a=d.getValueFromInterface();var f=d.getValue()!=a;if(!h&&!f){continue}g.push(d);var k=d.getEffectiveValue();var j={};if(h){j.inherit=o;d.setInheritValue(o)}if(f){j.value=a;d.setValue(a)}var n=d.getEffectiveValue();if(k!=n){m=true;b[l]=n}c[l]=j}if(m){this._notifyCommitHandlers(b)}if(g.length!=0){this._save(c)}};Preferences.prototype.destroy=function(){};function PlatformPreferences(b,a){Preferences.call(this,b,a)}PlatformPreferences.prototype=new Preferences();PlatformPreferences.prototype.buildTitle=function(){return gettext("Platform Preferences")};PlatformPreferences.prototype._save=function(a){PersistenceEngineFactory.getInstance().send_update(URIs.PLATFORM_PREFERENCES,{preferences:JSON.stringify(a)},this,this._onSuccessSavePreferences,this._onErrorSavePreferences)};function WorkSpacePreferences(c,b,a){Preferences.call(this,c,a);this._workspace=b;PreferencesManagerFactory.getInstance().getPlatformPreferences().addCommitHandler(this._handleParentChanges)}WorkSpacePreferences.prototype=new Preferences();WorkSpacePreferences.prototype.buildTitle=function(){var a=gettext("WorkSpace preferences (%(workspaceName)s)");return interpolate(a,{workspaceName:this._workspace.workSpaceState.name},true)};WorkSpacePreferences.prototype.getParentValue=function(a){return PreferencesManagerFactory.getInstance().getPlatformPreferences().get(a)};WorkSpacePreferences.prototype._save=function(b){var a=URIs.WORKSPACE_PREFERENCES.evaluate({workspace_id:this._workspace.workSpaceState.id});PersistenceEngineFactory.getInstance().send_update(a,{preferences:JSON.stringify(b)},this,this._onSuccessSavePreferences,this._onErrorSavePreferences)};WorkSpacePreferences.prototype.destroy=function(){PreferencesManagerFactory.getInstance().getPlatformPreferences().removeCommitHandler(this._handleParentChanges);Preferences.prototype.destroy.call(this);this._workspace=null};function TabPreferences(c,b,a){Preferences.call(this,c,a);this._tab=b;this._workspace=this._tab.workSpace;this._workspace.preferences.addCommitHandler(this._handleParentChanges)}TabPreferences.prototype=new Preferences();TabPreferences.prototype.buildTitle=function(){var a=gettext("Tab preferences (%(tabName)s)");return interpolate(a,{tabName:this._tab.tabInfo.name},true)};TabPreferences.prototype.getParentValue=function(a){return this._workspace.preferences.get(a)};TabPreferences.prototype._save=function(b){var a=URIs.TAB_PREFERENCES.evaluate({workspace_id:this._workspace.workSpaceState.id,tab_id:this._tab.tabInfo.id});PersistenceEngineFactory.getInstance().send_update(a,{preferences:JSON.stringify(b)},this,this._onSuccessSavePreferences,this._onErrorSavePreferences)};TabPreferences.prototype.destroy=function(){this._workspace.preferences.removeCommitHandler(this._handleParentChanges);Preferences.prototype.destroy.call(this);this._workspace=null;this._tab=null};var PersistenceEngineFactory=function(){var a=null;function b(){b.prototype.send_get=function(f,g,d,c,j,h){var k=f.split("?");var l=k[1];if(l){if(l!=""){f+="&"}}else{f+="?"}f+="stamp="+new Date().getTime();new Ajax.Request(f,{method:"get",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_post=function(f,j,g,d,c,h){new Ajax.Request(f,{method:"post",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_delete=function(f,g,d,c,h){new Ajax.Request(f,{method:"delete",onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_update=function(f,j,g,d,c,h){new Ajax.Request(f,{method:"put",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send=function(d,c){new Ajax.Request(d,c)}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function XHtml(b){var a=null;a=b.uri;this.getURICode=function(){return a}}function GadgetTemplate(f,c){var b=f;var d=c.width;var a=c.height;this.getWidth=function(){return d};this.getHeight=function(){return a};this.getVariables=function(n){var m=n.getId();var h=n.dragboard.workSpace.getVarManager();var j=[];var g=b;var k=null;for(var l=0;l<g.length;l++){k=g[l];switch(k.aspect){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:j[k.name]=new RWVariable(null,m,k.name,k.aspect,h,null);break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:j[k.name]=new RVariable(null,m,k.name,k.aspect,h,null);break;case Variable.prototype.USER_PREF:j[k.name]=new RVariable(null,m,k.name,k.aspect,h,k.default_value);break}}return j};this.getUserPrefs=function(){if(this.prefs==null){this.prefs=new Array();var g=null;for(var h=0;h<b.length;h++){g=b[h];if(g.aspect==Variable.prototype.USER_PREF){switch(g.type){case UserPref.prototype.TEXT:this.prefs.push(new TextUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.INTEGER:this.prefs.push(new IntUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.BOOLEAN:this.prefs.push(new BoolUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.DATE:this.prefs.push(new DateUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.PASSWORD:this.prefs.push(new PasswordUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.LIST:this.prefs.push(new ListUserPref(g.name,g.label,g.description,g.default_value,g.value_options));break}}}}return this.prefs};this.getExternalContextVars=function(m){var h=[];var g=b;var j=null;var l=null;for(var k=0;k<g.length;k++){j=g[k];switch(j.aspect){case Variable.prototype.EXTERNAL_CONTEXT:l=new ContextVar(m,j.name,j.concept);h.push(l);break;default:break}}return h};this.getGadgetContextVars=function(m){var h=[];var g=b;var j=null;var l=null;for(var k=0;k<g.length;k++){j=g[k];switch(j.aspect){case Variable.prototype.GADGET_CONTEXT:l=new ContextVar(m,j.name,j.concept);h.push(l);break;default:break}}return h};this.getUserPrefsId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.USER_PREF){h.push(j.name)}}return h};this.getEventsId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.EVENT){h.push(j.name)}}return h};this.getSlots=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.SLOT){h.push(j)}}return h};this.getEvents=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.EVENT){h.push(j)}}return h};this.getPropertiesId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.PROPERTY){h.push(j.name)}}return h}}function Gadget(d,b){var f=this;this.getVendor=function(){return c.getVendor()};this.getName=function(){return c.getName()};this.getDisplayName=function(){return c.getDisplayName()};this.getVersion=function(){return c.getVersion()};this.getTemplate=function(){return c.getTemplate()};this.getXHtml=function(){return c.getXHtml()};this.getInfoString=function(){return c.getInfoString()};this.getUriWiki=function(){return c.getUriWiki()};this.getImage=function(){return c.getImage()};this.setImage=function(g){c.setImage(g)};this.getIcon=function(){return c.getIcon()};this.getMenuColor=function(){return c.getMenuColor()};this.isUpToDate=function(){return c.isUpToDate()};this.setUpdatedState=function(h,g){return c.setUpdatedState(h,g)};this.getLastVersion=function(){return c.getLastVersion()};this.getLastVersionURL=function(){return c.getLastVersionURL()};this.isContratable=function(){var g=c.getCapabilities();for(var j=0;j<g.length;j++){var h=g[j];if(h.name=="Contratable"){return h.value.toLowerCase()=="true"}else{return false}}};var a=function(k){var j=function(p,n){var m=LogManagerFactory.getInstance();var o=m.formatError(gettext("The gadget could not be added to the showcase: %(errorMsg)s."),p,n);m.log(o)};var g=function(o){var m=o.responseText;var n=JSON.parse(m);c=new GadgetState(n);ShowcaseFactory.getInstance().gadgetToShowcaseGadgetModel(f)};var h=PersistenceEngineFactory.getInstance();var l={url:k};h.send_post(URIs.GET_GADGETS,l,this,g,j)};this.getId=function(){return this.getVendor()+"_"+this.getName()+"_"+this.getVersion()};var c=null;if(b!=null){a(b)}else{c=new GadgetState(d)}}function GadgetState(g){var p=null;var c=null;var j=null;var o=null;var q=null;var a=null;var f=null;var b=[];var d=null;var n=null;var l=null;var h=true;var m=null;var k=null;p=g.vendor;c=g.name;j=g.version;o=g.displayName;q=new GadgetTemplate(g.variables,g.size);a=new XHtml(g.xhtml);f=g.imageURI;l=g.iPhoneImageURI;b=g.capabilities;d=g.wikiURI;n=g.menuColor;m=j;this.getCapabilities=function(){return b};this.getVendor=function(){return p};this.getName=function(){return c};this.getDisplayName=function(){return o};this.getVersion=function(){return j};this.getTemplate=function(){return q};this.getXHtml=function(){return a};this.getInfoString=function(){var r={vendor:p,name:c,version:j};var t=gettext("[GadgetVendor: %(vendor)s, GadgetName: %(name)s, GadgetVersion: %(version)s]");return interpolate(t,r,true)};this.getUriWiki=function(){return d};this.getImage=function(){return f};this.setImage=function(r){f=r};this.getIcon=function(){return(l!="")?l:f};this.getMenuColor=function(){return n};this.isUpToDate=function(){return h};this.getLastVersion=function(){return m};this.getLastVersionURL=function(){return k};this.setUpdatedState=function(t,r){h=(j>=t);m=t;k=r}}var LogManagerFactory=function(){var a=null;function b(){this.logConsole=$("logs_console");this.logContainer=$("logs_container");this.messageContainer=$("message_section");this.messageBox=$("message_box");this.errorCount=0;b.prototype.log=function(g,j){labelContent=ngettext("%(errorCount)s error","%(errorCount)s errors",++this.errorCount);labelContent=interpolate(labelContent,{errorCount:this.errorCount},true);LayoutManagerFactory.getInstance().notifyError(labelContent);var c=document.createElement("p");switch(j){default:case Constants.Logging.ERROR_MSG:icon=document.createElement("img");Element.extend(icon);if(_currentTheme.iconExists("error")){icon.setAttribute("src",_currentTheme.getIconURL("error"))}icon.addClassName("icon");icon.setAttribute("alt","[Error] ");this.logConsole.appendChild(icon);try{console.error(g)}catch(f){}break;case Constants.Logging.WARN_MSG:icon=document.createElement("img");Element.extend(icon);if(_currentTheme.iconExists("warning")){icon.setAttribute("src",_currentTheme.getIconURL("warning"))}icon.addClassName("icon");icon.setAttribute("alt","[Warning] ");this.logConsole.appendChild(icon);try{if(console){console.warn(g)}}catch(f){}break;case Constants.Logging.INFO_MSG:icon=document.createElement("img");Element.extend(icon);if(_currentTheme.iconExists("info")){icon.setAttribute("src",_currentTheme.getIconURL("info"))}icon.addClassName("icon");icon.setAttribute("alt","[Info] ");this.logConsole.appendChild(icon);try{if(console){console.info(g)}}catch(f){}break}var d;while((d=g.indexOf("\n"))!=-1){c.appendChild(document.createTextNode(g.substring(0,d)));c.appendChild(document.createElement("br"));g=g.substring(d+1)}c.appendChild(document.createTextNode(g));this.logConsole.appendChild(c);var h=document.createElement("div");Element.extend(h);h.addClassName("floatclearer");this.logConsole.appendChild(h)};b.prototype.formatError=function(f,k,d){var h;if(d){var c;if(d.lineNumber!==undefined){c={errorFile:d.fileName,errorLine:d.lineNumber,errorDesc:d.message}}else{if(d.line!==undefined){c={errorFile:d.sourceURL,errorLine:d.line,errorDesc:d.message}}else{var g=gettext("unknown");c={errorFile:g,errorLine:g,errorDesc:d.message}}}h=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),c,true)}else{if(k.responseXML&&k.documentElement!=null){h=k.responseXML.documentElement.textContent}else{try{var j=JSON.parse(k.responseText);h=j.message}catch(d){h=gettext("HTTP Error %(errorCode)s - %(errorDesc)s");h=interpolate(h,{errorCode:k.status,errorDesc:k.statusText},true)}}}h=interpolate(f,{errorMsg:h},true);return h};b.prototype.show=function(){LayoutManagerFactory.getInstance().showLogs()};b.prototype.hide=function(){LayoutManagerFactory.getInstance().hideView(this.logContainer)};b.prototype.reset=function(){this.logConsole.innerHTML="";this.errorCount=0};b.prototype.showMessage=function(c){this.messageBox.update(c);this.messageContainer.setStyle({display:"block"});setTimeout(function(){LogManagerFactory.getInstance().removeMessage()},3000)};b.prototype.removeMessage=function(){this.messageContainer.setStyle({display:"none"});this.messageBox.update("")}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function WorkSpace(m){var n=function(x,v){this.valid=false;var u=LogManagerFactory.getInstance();w=u.formatError(gettext("Error loading workspace: %(errorMsg)s"),x,v);u.log(w);var r=LayoutManagerFactory.getInstance();var w=gettext("Error loading workspace. Please, change active workspace or create a new one.");r.showMessageMenu(w,Constants.Logging.ERROR_MSG);this.varmanager=null;this.contextManager=null;this.wiring=null;this.wiringInterface=null;r.currentViewType="dragboard";this.preferences=PreferencesManagerFactory.getInstance().buildPreferences("workspace",{},this);var t={id:0,locked:"true",igadgetList:[],name:gettext("Unusable Tab"),visible:1,preferences:{}};this.workSpaceGlobalInfo={workspace:{tabList:[t]}};this.tabInstances=new Hash();this.tabInstances[0]=new Tab(t,this);this.visibleTab=this.tabInstances[0];this.loaded=true;this._createWorkspaceMenu();this._hide_creator_options();r.logStep("");OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.ACTIVE_WORKSPACE)};var a=function(u){var x=LayoutManagerFactory.getInstance();x.logStep("");x.logSubTask(gettext("Processing workspace data"));try{var w=u.responseText;this.workSpaceGlobalInfo=JSON.parse(w);var D=this.workSpaceGlobalInfo.workspace["preferences"];this.preferences=PreferencesManagerFactory.getInstance().buildPreferences("workspace",D,this);this.preferences.addCommitHandler(this.preferencesChanged.bind(this));var C=this.workSpaceGlobalInfo.workspace["tabList"];var z=null;if(C.length>0){z=C[0].id;for(var y=0;y<C.length;y++){var t=C[y];var v=new Tab(t,this);this.tabInstances[t.id]=v;if(t.visible){z=t.id}}}this.varManager=new VarManager(this);this.contextManager=new ContextManager(this,this.workSpaceGlobalInfo);this.wiring=new Wiring(this,this.workSpaceGlobalInfo);this.wiringInterface=new WiringInterface(this.wiring,this,$("wiring"),$("wiring_link"));this.remoteChannelManager=new RemoteChannelManager(this.wiring);if(C.length>0){this.tabInstances[z].getDragboard().paint()}this.visibleTab=this.tabInstances[z];this.valid=true}catch(B){n.call(this,u,B);return}this.loaded=true;var r=this.preferences.get("theme");var A=ScriptManagerFactory.getInstance().get_theme();if(A){r=A}LayoutManagerFactory.getInstance().changeCurrentTheme(r);this._createWorkspaceMenu();if(this.isShared()){this._hide_creator_options()}else{this._show_creator_options()}x.logStep("");OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.ACTIVE_WORKSPACE)};var j=function(t,r){n.call(this,t,r)};var g=function(r){};var c=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error renaming workspace, changes will not be saved: %(errorMsg)s."),v,t);r.log(u)};var l=function(v){var r=this.tabInstances.keys();for(var t=0;t<r.length;t++){var u=this.tabInstances[r[t]];u.destroy()}LayoutManagerFactory.getInstance().hideCover()};var d=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error removing workspace, changes will not be saved: %(errorMsg)s."),v,t);r.log(u);LayoutManagerFactory.getInstance().hideCover()};var p=function(u){var t=u.responseText;var r=JSON.parse(t);UIUtils.addResource(URIs.GET_POST_RESOURCES,"template_uri",r.url)};var k=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error publishing workspace: %(errorMsg)s."),v,t);r.log(u);LayoutManagerFactory.getInstance().hideCover()};var o=function(u){var r=u.responseText;var t=JSON.parse(r);opManager=OpManagerFactory.getInstance();opManager.changeActiveWorkSpace(opManager.workSpaceInstances[t.merged_workspace_id]);LayoutManagerFactory.getInstance().hideCover()};var f=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error merging workspace: %(errorMsg)s."),v,t);r.log(u);LayoutManagerFactory.getInstance().hideCover()};var q=function(w){var t=w.responseText;var r=JSON.parse(t);r.igadgetList=[];r.preferences={};var v=new Tab(r,this);this.tabInstances[r.id]=v;this._checkLock();this.setTab(this.tabInstances[r.id]);for(var u=0;u<r.workspaceVariables.length;u++){this.varManager.parseWorkspaceVariable(r.workspaceVariables[u]);this.wiring.processVar(r.workspaceVariables[u])}v.getDragboard().paint()};var b=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error creating a tab: %(errorMsg)s."),v,t);r.log(u)};WorkSpace.prototype.subscribe_to_channels=function(){this.remoteChannelManager.subscribe_to_channels()};WorkSpace.prototype.igadgetLoaded=function(r){var t=this.getIgadget(r);t._notifyLoaded();this.wiring.iGadgetLoaded(t);this.contextManager.iGadgetLoaded(t);this.varManager.dispatchPendingVariables(r)};WorkSpace.prototype.getTabInstance=function(r){return this.tabInstances[r]};WorkSpace.prototype.run_script=function(){ScriptManagerFactory.getInstance().run_script(this)};WorkSpace.prototype.igadgetUnloaded=function(r){var t=this.getIgadget(r);if(t==null){return}this.wiring.iGadgetUnloaded(t);this.contextManager.iGadgetUnloaded(t);t._notifyUnloaded()};WorkSpace.prototype.sendBufferedVars=function(){if(this.varManager){this.varManager.sendBufferedVars()}};WorkSpace.prototype.fillWithLabel=function(){this.workSpaceNameHTMLElement=this.workSpaceHTMLElement.firstDescendant();if(this.workSpaceNameHTMLElement!=null){this.workSpaceNameHTMLElement.remove()}var r=(this.workSpaceState.name.length>15)?this.workSpaceState.name.substring(0,15)+"...":this.workSpaceState.name;var t="<span>"+r+"</span>";new Insertion.Top(this.workSpaceHTMLElement,t);this.workSpaceNameHTMLElement=this.workSpaceHTMLElement.firstDescendant();Event.observe(this.workSpaceNameHTMLElement,"click",function(u){if(LayoutManagerFactory.getInstance().getCurrentViewType()=="dragboard"){this.fillWithInput()}else{OpManagerFactory.getInstance().showActiveWorkSpace()}}.bind(this))};WorkSpace.prototype.fillWithInput=function(){if(!this.isShared()){this.workSpaceNameHTMLElement.remove();var r="<input class='ws_name' value='"+this.workSpaceState.name+"' size='"+this.workSpaceState.name.length+" maxlength=30' />";new Insertion.Top(this.workSpaceHTMLElement,r);this.workSpaceNameHTMLElement=this.workSpaceHTMLElement.firstDescendant();this.workSpaceNameHTMLElement.focus();this.workSpaceNameHTMLElement.select();Event.observe(this.workSpaceNameHTMLElement,"blur",function(t){Event.stop(t);this.fillWithLabel()}.bind(this));Event.observe(this.workSpaceNameHTMLElement,"keypress",function(u){if(u.keyCode==Event.KEY_RETURN){Event.stop(u);var t=BrowserUtilsFactory.getInstance().getTarget(u);t.blur()}}.bind(this));Event.observe(this.workSpaceNameHTMLElement,"change",function(u){var t=BrowserUtilsFactory.getInstance().getTarget(u);this.updateInfo(t.value)}.bind(this));Event.observe(this.workSpaceNameHTMLElement,"keyup",function(u){Event.stop(u);var t=BrowserUtilsFactory.getInstance().getTarget(u);t.size=(t.value.length==0)?1:t.value.length}.bind(this))}};WorkSpace.prototype.updateInfo=function(x){if(x==""||x.match(/^\s$/)){var w=interpolate(gettext("Error updating a workspace: invalid name"),true);LogManagerFactory.getInstance().log(w)}else{if(!OpManagerFactory.getInstance().workSpaceExists(x)){this.workSpaceState.name=x;var t=URIs.GET_POST_WORKSPACE.evaluate({id:this.workSpaceState.id,last_user:last_logged_user});var v=new Object();v.name=x;var r=Object.toJSON(v);var u={workspace:r};PersistenceEngineFactory.getInstance().send_update(t,u,this,g,c)}else{var w=interpolate(gettext("Error updating a workspace: the name %(workSpaceName)s is already in use."),{workSpaceName:x},true);LogManagerFactory.getInstance().log(w)}}};WorkSpace.prototype.deleteWorkSpace=function(){if(OpManagerFactory.getInstance().removeWorkSpace(this.workSpaceState.id)){var r=URIs.GET_POST_WORKSPACE.evaluate({id:this.workSpaceState.id,last_user:last_logged_user});PersistenceEngineFactory.getInstance().send_delete(r,this,l,d)}};WorkSpace.prototype.getName=function(){return this.workSpaceState.name};WorkSpace.prototype.getId=function(){return this.workSpaceState.id};WorkSpace.prototype.getWiring=function(){return this.wiring};WorkSpace.prototype.getWiringInterface=function(){return this.wiringInterface};WorkSpace.prototype.getVarManager=function(){return this.varManager};WorkSpace.prototype.getContextManager=function(){return this.contextManager};WorkSpace.prototype.downloadWorkSpaceInfo=function(){LayoutManagerFactory.getInstance().logSubTask(gettext("Downloading workspace data"),1);var r=URIs.GET_POST_WORKSPACE.evaluate({id:this.workSpaceState.id,last_user:last_logged_user});PersistenceEngineFactory.getInstance().send_get(r,this,a,j)};WorkSpace.prototype.showWiring=function(){if(!this.loaded){return}if(!this.isValid()){return}this.visibleTab.unmark();this.wiringInterface.show()};WorkSpace.prototype.getIgadget=function(v){var t=this.tabInstances.keys();for(var r=0;r<t.length;r++){var u=t[r];var w=this.tabInstances[u].getDragboard().getIGadget(v);if(w){return w}}};WorkSpace.prototype.show=function(){if(!this.loaded){return}this.fillWithLabel();var r=this.tabInstances.keys();for(var t=0;t<r.length;t++){var u=this.tabInstances[r[t]];if(u==this.visibleTab){u.show()}else{u.unmark()}}LayoutManagerFactory.getInstance().resizeTabBar();if(this.visibleTab){this.visibleTab.makeVisibleInTabBar();this.visibleTab.getDragboard()._notifyWindowResizeEvent()}};WorkSpace.prototype.isValid=function(){return this.valid};WorkSpace.prototype.getTab=function(r){return this.tabInstances[r]};WorkSpace.prototype.setTab=function(r){if(!this.loaded){return}if(this.visibleTab!=null){this.visibleTab.unmark()}this.visibleTab=r;this.visibleTab.show()};WorkSpace.prototype.getVisibleTab=function(){if(!this.loaded){return}return this.visibleTab};WorkSpace.prototype.tabExists=function(u){var t=this.tabInstances.values();for(var r=0;r<t.length;r++){if(t[r].tabInfo.name==u){return true}}return false};WorkSpace.prototype.addTab=function(){if(!this.isValid()){return}var r=this.tabInstances.keys().length+1;var u="MyTab "+r.toString();while(this.tabExists(u)){u="MyTab "+(r++).toString()}var t=URIs.GET_POST_TABS.evaluate({workspace_id:this.workSpaceState.id});var v=new Object;v.name=u;tabData=Object.toJSON(v);params="tab="+tabData;PersistenceEngineFactory.getInstance().send_post(t,params,this,q,b)};WorkSpace.prototype.removeTab=function(r){if(this.tabInstances.keys().length<=1){var t;t=gettext("there must be one tab at least");t=interpolate(gettext("Error removing tab: %(errorMsg)s."),{errorMsg:t},true);LogManagerFactory.getInstance().log(t);LayoutManagerFactory.getInstance().hideCover();return false}this.unloadTab(r);this.setTab(this.tabInstances.values()[0]);return true};WorkSpace.prototype.unloadTab=function(r){if(!this.valid){return}var t=this.tabInstances[r];this.tabInstances.remove(r);this.varManager.removeWorkspaceVariable(t.connectable.variable.id);t.connectable.destroy();t.destroy();this.visibleTab=null};WorkSpace.prototype.unload=function(){var r=LayoutManagerFactory.getInstance();r.logSubTask(gettext("Unloading current workspace"));if(this.wiringInterface!==null){this.wiringInterface.saveWiring();this.wiringInterface.unload();this.wiringInterface=null}r.unloadCurrentView();this.sendBufferedVars();var u=this.tabInstances.keys();for(var t=0;t<u.length;t++){this.unloadTab(u[t])}if(this.preferences){this.preferences.destroy();this.preferences=null}if(this.wiring!==null){this.wiring.unload()}if(this.contextManager!==null){this.contextManager.unload()}this.contextManager=null;this.menu.remove();if(this.mergeMenu){this.mergeMenu.remove()}if(this.FloatingGadgetsMenu){this.FloatingGadgetsMenu.remove()}Event.stopObserving($("floating_gadgets_launcher"),"click",this.showFloatingGadgetsMenu);r.logStep("")};WorkSpace.prototype.goTab=function(r){if(!this.loaded){return}this.visibleTab.unmark();this.visibleTab=r;this.visibleTab.go()};WorkSpace.prototype.addIGadget=function(r,u,t){this.varManager.addInstance(u,t,r);this.contextManager.addInstance(u,u.getGadget().getTemplate());this.wiring.addInstance(u,t.variables);u.paint();this.visibleTab.show()};WorkSpace.prototype.removeIGadgetData=function(r){this.varManager.removeInstance(r);this.wiring.removeInstance(r);this.contextManager.removeInstance(r)};WorkSpace.prototype.removeIGadget=function(r){this.visibleTab.getDragboard().removeInstance(r);this.removeIGadgetData(r)};WorkSpace.prototype.getIGadgets=function(){if(!this.loaded){return}var r=new Array();var u=this.tabInstances.keys();for(var t=0;t<u.length;t++){r=r.concat(this.tabInstances[u[t]].getDragboard().getIGadgets())}return r};WorkSpace.prototype.getActiveDragboard=function(){return this.visibleTab.getDragboard()};WorkSpace.prototype.shareWorkspace=function(w,r){var v=function(B){var A=B.responseText;var z=JSON.parse(A);if(z.result!="ok"){LayoutManagerFactory.getInstance().showSharingWorkspaceResults(gettext("The Workspace has NOT been successfully shared."),"")}else{LayoutManagerFactory.getInstance().showSharingWorkspaceResults(gettext("The Workspace has been successfully shared."),z)}};var x=function(B){var A=B.responseText;var z=JSON.parse(A);LayoutManagerFactory.getInstance().showSharingWorkspaceResults(gettext("The Workspace has NOT been successfully shared."),"")};var t=URIs.PUT_SHARE_WORKSPACE.evaluate({workspace_id:this.workSpaceState.id,share_boolean:w});var u=Object.toJSON(r);var y=(r.length>0)?{groups:u}:{};PersistenceEngineFactory.getInstance().send_update(t,y,this,v,x)};WorkSpace.prototype.publish=function(t){var r=URIs.POST_PUBLISH_WORKSPACE.evaluate({workspace_id:this.workSpaceState.id});publicationData=Object.toJSON(t);params="data="+publicationData;PersistenceEngineFactory.getInstance().send_post(r,params,this,p,k)};WorkSpace.prototype.mergeWith=function(t){var r=URIs.GET_MERGE_WORKSPACE.evaluate({from_ws_id:t,to_ws_id:this.workSpaceState.id});PersistenceEngineFactory.getInstance().send_get(r,this,o,f)};WorkSpace.prototype.isShared=function(){return this.workSpaceState.shared||this.forceRestrictedSharing()};WorkSpace.prototype.forceRestrictedSharing=function(){return(BrowserUtilsFactory.getInstance().getBrowser()=="IE6")};WorkSpace.prototype._createWorkspaceMenu=function(){var x="menu_"+this.workSpaceState.id;var r=$(x);if(r){r.remove()}var u=0;r='<div id="'+x+'" class="drop_down_menu"><div id="submenu_'+x+'" class="submenu"></div></div>';new Insertion.After($("menu_layer"),r);this.menu=new DropDownMenu(x);var w="mergeMenu_"+this.workSpaceState.id;var v='<div id="'+w+'" class="drop_down_menu"></div></div>';new Insertion.After($("menu_layer"),v);this.mergeMenu=new DropDownMenu(w,this.menu);if(this.valid&&!this.workSpaceGlobalInfo.workspace.active){this.activeEntryId=this.menu.addOption(_currentTheme.getIconURL("workspace_active"),gettext("Mark as Active"),function(){LayoutManagerFactory.getInstance().hideCover();this.markAsActive()}.bind(this),u++)}if(!this.isShared()){if(this.valid){this.menu.addOption(_currentTheme.getIconURL("rename"),gettext("Rename"),function(){OpManagerFactory.getInstance().activeWorkSpace.fillWithInput();LayoutManagerFactory.getInstance().hideCover()},u++);this.menu.addOption(_currentTheme.getIconURL("workspace_preferences"),gettext("Preferences"),function(){LayoutManagerFactory.getInstance().showPreferencesWindow("workspace",this.preferences)}.bind(this),u++);this.unlockEntryPos=u;this.unlockEntryId=this.menu.addOption(_currentTheme.getIconURL("unlock"),gettext("Unlock"),function(){LayoutManagerFactory.getInstance().hideCover();this._lockFunc(false)}.bind(this),u++);this.lockEntryId=this.menu.addOption(_currentTheme.getIconURL("lock"),gettext("Lock"),function(){LayoutManagerFactory.getInstance().hideCover();this._lockFunc(true)}.bind(this),u++);var t=this._checkLock();u-=t;this.menu.addOption(_currentTheme.getIconURL("workspace_publish"),gettext("Share workspace"),function(){LayoutManagerFactory.getInstance().showWindowMenu("shareWorkSpace")}.bind(this),u++,null,"share_workspace");this.menu.addOption(_currentTheme.getIconURL("remove"),gettext("Remove"),function(){var y=gettext('Do you really want to remove the "%(workspaceName)s" workspace?');y=interpolate(y,{workspaceName:this.workSpaceState.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(y,function(){OpManagerFactory.getInstance().activeWorkSpace.deleteWorkSpace()})}.bind(this),u++);this.menu.addOption(_currentTheme.getIconURL("workspace_publish"),gettext("Publish workspace"),function(){LayoutManagerFactory.getInstance().showWindowMenu("publishWorkSpace")}.bind(this),u++,null,"publish_workspace");if(OpManagerFactory.getInstance().workSpaceInstances.keys().length>1){this.menu.addOption(_currentTheme.getIconURL("workspace_merge"),gettext("Merge with workspace..."),function(y){LayoutManagerFactory.getInstance().showDropDownMenu("workSpaceOpsSubMenu",this.mergeMenu,Event.pointerX(y),Event.pointerY(y))}.bind(this),u++)}}else{this.menu.addOption(_currentTheme.getIconURL("remove"),gettext("Remove"),function(){var y=gettext('Do you really want to remove the "%(workspaceName)s" workspace?');y=interpolate(y,{workspaceName:this.workSpaceState.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(y,function(){OpManagerFactory.getInstance().activeWorkSpace.deleteWorkSpace()})}.bind(this),u++)}}else{if(OpManagerFactory.getInstance().workSpaceInstances.keys().length==1){this.menu.addOption(null,gettext("No WorkSpaces availables"),function(){},0)}}if(!this.forceRestrictedSharing()){this.menu.addOption(_currentTheme.getIconURL("add"),gettext("New workspace"),function(){LayoutManagerFactory.getInstance().showWindowMenu("createWorkSpace")},u++)}var r='<div id="floating_gadgets_list" class="drop_down_menu"></div>';new Insertion.After($("menu_layer"),r);this.FloatingGadgetsMenu=new DropDownMenu("floating_gadgets_list");Event.observe($("floating_gadgets_launcher"),"click",this.showFloatingGadgetsMenu)};this.workSpaceState=m;this.workSpaceGlobal=null;this.wiringInterface=null;this.varManager=null;this.tabInstances=new Hash();this.wiring=null;this.varManager=null;this.remoteChannelManager=null;this.contextManager=null;this.loaded=false;this.wiringLayer=null;this.visibleTab=null;this.workSpaceHTMLElement=$("workspace_name");this.menu=null;this.mergeMenu=null;this.FloatingGadgetsMenu=null;this.unlockEntryPos;this.valid=false;var h="ws_operations_link";this.showFloatingGadgetsMenu=function(r){this.FloatingGadgetsMenu.clearOptions();this.visibleTab.getDragboard().fillFloatingGadgetsMenu(this.FloatingGadgetsMenu);LayoutManagerFactory.getInstance().showDropDownMenu("floatingGadgets",this.FloatingGadgetsMenu,Event.pointerX(r),Event.pointerY(r))}.bind(this);this._lockFunc=function(r){var u=this.tabInstances.keys();for(var t=0;t<u.length;t++){this.tabInstances[u[t]].setLock(r)}}.bind(this);this._checkLock=function(){var w=this.tabInstances.keys();var v=true;var t=null;var x=0;var r=this.unlockEntryPos;for(var u=0;u<w.length;u++){if(u==0){t=this.tabInstances[w[u]].dragboard.isLocked()}else{if(t!=this.tabInstances[w[u]].dragboard.isLocked()){v=false}}}if(v){if(t&&this.lockEntryId!=null){this.menu.removeOption(this.lockEntryId);this.lockEntryId=null;x++}else{if(!t&&this.unlockEntryId!=null){this.menu.removeOption(this.unlockEntryId);this.unlockEntryId=null;x++}}}if((!v||t)&&this.unlockEntryId==null){this.unlockEntryId=this.menu.addOption(_currentTheme.getIconURL("unlock"),gettext("Unlock"),function(){LayoutManagerFactory.getInstance().hideCover();this._lockFunc(false)}.bind(this),this.unlockEntryPos)}if((!v||!t)&&this.lockEntryId==null){if(this.unlockEntryId){r=this.unlockEntryPos+1}this.lockEntryId=this.menu.addOption(_currentTheme.getIconURL("lock"),gettext("Lock"),function(){LayoutManagerFactory.getInstance().hideCover();this._lockFunc(true)}.bind(this),r)}return x}.bind(this);this.markAsActive=function(){var t=URIs.GET_POST_WORKSPACE.evaluate({id:this.workSpaceState.id,last_user:last_logged_user});var v=new Object;v.active="true";var r=Object.toJSON(v);var u={workspace:r};PersistenceEngineFactory.getInstance().send_update(t,u,this,this.markAsActiveSuccess,this.markAsActiveError)}.bind(this);this.markAsActiveSuccess=function(){this.workSpaceGlobalInfo.workspace.active=true;this.workSpaceState.active=true;if(this.activeEntryId!=null){this.menu.removeOption(this.activeEntryId);this.activeEntryId=null}PreferencesManagerFactory.getInstance().getPlatformPreferences().set({"initial-theme":{value:this.preferences.get("theme")}})}.bind(this);this.markAsActiveError=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error marking as first active workspace, changes will not be saved: %(errorMsg)s."),v,t);r.log(u)}.bind(this);this._hide_element=function(r){$(r).style.display="none"};this._show_element=function(r){$(r).style.display="block"};this._hide_creator_options=function(){this._hide_element("add_tab_link");this._hide_element("catalogue_link");this._hide_element("wiring_link");document.body.className="shared"};this._show_creator_options=function(){this._show_element("add_tab_link");this._show_element("catalogue_link");this._show_element("wiring_link");this.workSpaceHTMLElement.removeClassName("shared");document.body.className=""}}WorkSpace.prototype.preferencesChanged=function(c){for(preferenceName in c){var a=false;switch(preferenceName){case"theme":var b=c[preferenceName];LayoutManagerFactory.getInstance().changeCurrentTheme(b);if(this.workSpaceGlobalInfo.workspace.active){PreferencesManagerFactory.getInstance().getPlatformPreferences().set({"initial-theme":{value:b}})}break;default:continue}}};WorkSpace.prototype._themeLoaded=function(f){this._createWorkspaceMenu();var b=this.tabInstances.keys();for(var a=0;a<b.length;a++){var c=b[a];var d=this.tabInstances[c]._themeLoaded()}};function Tab(k,a){var g=function(n){};var d=function(q,o){var n=LogManagerFactory.getInstance();var p=n.formatError(gettext("Error renaming a tab, changes will not be saved: %(errorMsg)s."),q,o);n.log(p)};var j=function(n){LayoutManagerFactory.getInstance().hideCover()};var f=function(q,o){var n=LogManagerFactory.getInstance();var p=n.formatError(gettext("Error removing a tab: %(errorMsg)s."),q,o);n.log(p);LayoutManagerFactory.getInstance().hideCover()};Tab.prototype.destroy=function(){LayoutManagerFactory.getInstance().removeFromTabBar(this);this.preferences.destroy();this.preferences=null;this.menu.remove();this.moveMenu.remove();this.dragboard.destroy()};Tab.prototype.updateInfo=function(p){if(p==""||p.match(/^\s$/)){var u=interpolate(gettext("Error updating a tab: invalid name"),true);LogManagerFactory.getInstance().log(u)}else{if(!this.workSpace.tabExists(p)){this.tabInfo.name=p;var q=URIs.TAB.evaluate({workspace_id:this.workSpace.workSpaceState.id,tab_id:this.tabInfo.id});var t=new Object;t.name=p;var n=Object.toJSON(t);var r={tab:n};PersistenceEngineFactory.getInstance().send_update(q,r,this,g,d)}else{var u=interpolate(gettext("Error updating a tab: the name %(tabName)s is already in use in workspace %(wsName)s."),{tabName:p,wsName:this.workSpace.workSpaceState.name},true);LogManagerFactory.getInstance().log(u)}}};Tab.prototype.deleteTab=function(){if(this.workSpace.removeTab(this.tabInfo.id)==true){var n=URIs.TAB.evaluate({workspace_id:this.workSpace.workSpaceState.id,tab_id:this.tabInfo.id});PersistenceEngineFactory.getInstance().send_delete(n,this,j,f)}};Tab.prototype.fillWithLabel=function(){if(this.tabNameHTMLElement!=null){this.tabNameHTMLElement.remove()}var n=(this.tabInfo.name.length>15)?this.tabInfo.name.substring(0,15)+"...":this.tabInfo.name;var p="<span>"+n+"</span>";new Insertion.After($(this.dragger),p);var o=this.tabHTMLElement.getWidth()-this.tabWidth;if(o!=0){LayoutManagerFactory.getInstance().changeTabBarSize(o)}this.tabNameHTMLElement=Element.extend($(this.dragger).nextSibling);this.tabWidth=this.tabHTMLElement.getWidth()};Tab.prototype.fillWithInput=function(){var o=this.tabHTMLElement.getWidth();this.tabNameHTMLElement.remove();var n="<input class='tab_name' value='"+this.tabInfo.name+"' size='"+(this.tabInfo.name.length)+"' maxlength=30 />";new Insertion.After($(this.dragger),n);this.tabNameHTMLElement=Element.extend($(this.dragger).nextSibling);var p=this.tabHTMLElement.getWidth();var q=p-o;if(q!=0){LayoutManagerFactory.getInstance().changeTabBarSize(q)}this.tabWidth=p;this.tabNameHTMLElement.focus();this.tabNameHTMLElement.select();Event.observe(this.tabNameHTMLElement,"blur",function(r){Event.stop(r);this.fillWithLabel()}.bind(this));Event.observe(this.tabNameHTMLElement,"keypress",function(t){var r=BrowserUtilsFactory.getInstance().getTarget(t);if(t.keyCode==Event.KEY_RETURN){Event.stop(t);r.blur()}else{this.makeVisibleInTabBar()}}.bind(this));Event.observe(this.tabNameHTMLElement,"change",function(t){var r=BrowserUtilsFactory.getInstance().getTarget(t);this.updateInfo(r.value)}.bind(this));Event.observe(this.tabNameHTMLElement,"keyup",function(u){Event.stop(u);var t=BrowserUtilsFactory.getInstance().getTarget(u);t.size=(t.value.length==0)?1:t.value.length;var r=t.parentNode.getWidth();var v=r-this.tabWidth;if(v!=0){LayoutManagerFactory.getInstance().changeTabBarSize(v)}this.tabWidth=r}.bind(this));Event.observe(this.tabNameHTMLElement,"click",function(r){Event.stop(r)})};Tab.prototype.unmark=function(){LayoutManagerFactory.getInstance().unmarkTab(this)};Tab.prototype.is_painted=function(){return this.painted};Tab.prototype.paint=function(){this.getDragboard().paint()};Tab.prototype.makeVisibleInTabBar=function(){var n=Position.cumulativeOffset(this.tabHTMLElement)[0];var o=LayoutManagerFactory.getInstance().getFixedBarLeftPosition();var r=n-o;if(r<0){LayoutManagerFactory.getInstance().changeScrollBarRightPosition(r)}else{var p=o+LayoutManagerFactory.getInstance().getFixedBarWidth();var q=p-n;r=q-this.tabHTMLElement.getWidth();if(r<0){LayoutManagerFactory.getInstance().changeScrollBarRightPosition(-1*r)}}};Tab.prototype.markAsCurrent=function(){LayoutManagerFactory.getInstance().markTab(this)};Tab.prototype.go=function(){this.show();LayoutManagerFactory.getInstance().goTab(this);this.makeVisibleInTabBar()};Tab.prototype.getDragboard=function(){return this.dragboard};Tab.prototype.mark_as_painted=function(){this.painted=true};this.workSpace=a;this.tabInfo=k;this.dragboardLayerName="dragboard_"+this.workSpace.workSpaceState.id+"_"+this.tabInfo.id;this.tabName="tab_"+this.workSpace.workSpaceState.id+"_"+this.tabInfo.id;this.tabHTMLElement;this.tabNameHTMLElement=null;this.tabWidth=0;this.preferences=PreferencesManagerFactory.getInstance().buildPreferences("tab",this.tabInfo.preferences,this);this.preferences.addCommitHandler(this.preferencesChanged.bind(this));this.painted=false;this.renameTabHandler=function(n){this.makeVisibleInTabBar();this.fillWithInput()}.bind(this);this.changeTabHandler=function(n){this.workSpace.setTab(this);this.makeVisibleInTabBar()}.bind(this);this.xDelta=0;this.xStart=0;this.xOffset=0;this.x;this.y;this.referenceTab;Tab.prototype._findTabElement=function(p,o){if(o==0){return null}if(isElement(p)&&Element.extend(p).hasClassName("tab")){return p}else{var n=p.parentNode;if(n!=null){return this._findTabElement(n,o-1)}else{return null}}};this.startDrag=function(r){r=r||window.event;if(!BrowserUtilsFactory.getInstance().isLeftButton(r.button)){return false}Event.stop(r);document.oncontextmenu=function(){return false};document.onmousedown=function(){return false};document.onselectstart=function(){return false};Event.stopObserving($(this.dragger),"mousedown",this.startDrag);this.x=this.tabHTMLElement.offsetLeft;this.y=Position.cumulativeOffset(this.tabHTMLElement)[1];var t=this.tabHTMLElement.offsetTop;this.tabHTMLElement.style.position="absolute";this.tabHTMLElement.style.zIndex="999999";this.xStart=parseInt(Event.pointerX(r));this.tabHTMLElement.style.left=this.x+"px";this.tabHTMLElement.style.top=t+"px";this.tabMarker=document.createElement("div");Element.extend(this.tabMarker);this.tabMarker.id="tab_space";this.tabMarker.addClassName("tab");var o=document.defaultView.getComputedStyle(this.tabHTMLElement,null);var n=o.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX)*2;var q=o.getPropertyCSSValue("padding-left").getFloatValue(CSSPrimitiveValue.CSS_PX)+o.getPropertyCSSValue("padding-right").getFloatValue(CSSPrimitiveValue.CSS_PX);var p=this.tabHTMLElement.getWidth()-n-q;this.tabMarker.style.width=p+"px";LayoutManagerFactory.getInstance().insertMarker(this.tabMarker,this);Event.observe(document,"mouseup",this.endDrag);Event.observe(document,"mousemove",this.drag);return false}.bind(this);this.drag=function(r){r=r||window.event;var p=parseInt(Event.pointerX(r));this.xDelta=this.xStart-p;this.xStart=p;this.x=this.x-this.xDelta;if(this.x<0){this.x=0}if(this.x>LayoutManagerFactory.getInstance().getScrollTabBarWidth()){this.referenceTab=null;LayoutManagerFactory.getInstance().moveIndicator(this.referenceTab);return false}this.tabHTMLElement.style.left=this.x+"px";this.tabHTMLElement.hide();var o=document.elementFromPoint(Event.pointerX(r),this.y+2);this.tabHTMLElement.show();if(o!=null){o=this._findTabElement(o,4)}var t=null;if(o){t=o.getAttribute("id");if(t!=null){if(t=="tab_space"){this.referenceTab=this}var q=this.workSpace.tabInstances.keys();for(var n=0;n<q.length;n++){if(this.workSpace.tabInstances[q[n]].tabName==t){this.referenceTab=this.workSpace.tabInstances[q[n]];break}}if(this.referenceTab.tabHTMLElement.nextSibling==this.tabHTMLElement){this.referenceTab=this}LayoutManagerFactory.getInstance().moveIndicator(this.referenceTab)}}return false}.bind(this);this.endDrag=function(n){n=n||window.event;Event.stop(n);if(!BrowserUtilsFactory.getInstance().isLeftButton(n.button)){return false}Event.stopObserving(document,"mouseup",this.endDrag);Event.stopObserving(document,"mousemove",this.drag);LayoutManagerFactory.getInstance().moveTab(this,this.referenceTab);this.tabHTMLElement.style.position="relative";this.tabHTMLElement.style.zIndex="";this.tabHTMLElement.style.left="";this.tabHTMLElement.style.top="";Element.remove(this.tabMarker);$("tab_marker").style.display="none";Event.observe($(this.dragger),"mousedown",this.startDrag);document.onmousedown=null;document.onselectstart=null;document.oncontextmenu=null;return false}.bind(this);var b=$("wrapper");this.dragboardElement=document.createElement("div");Element.extend(this.dragboardElement);this.dragboardElement.className="container dragboard";b.insertBefore(this.dragboardElement,b.firstChild);this.dragboardElement.setAttribute("id",this.dragboardLayerName);this.dragboard=new Dragboard(this,this.workSpace,this.dragboardElement);this.tabHTMLElement=LayoutManagerFactory.getInstance().addToTabBar(this.tabName);this.dragger=this.tabName+"_dragger";var h='<div id="'+this.dragger+'" class="tab_dragger"></div>';new Insertion.Top(this.tabHTMLElement,h);var m=$(this.dragger);Event.observe(m,"mousedown",this.startDrag);Event.observe(m,"click",function(n){Event.stop(n)});m.setStyle({display:"none"});this.fillWithLabel();this.tabOpsLauncher=this.tabName+"_launcher";var l='<input id="'+this.tabOpsLauncher+'" type="button" title="'+gettext("Options")+'" class="tabOps_launcher tabOps_launcher_show"/>';new Insertion.Bottom(this.tabHTMLElement,l);var c=$(this.tabOpsLauncher);Event.observe(c,"click",function(o){var n=BrowserUtilsFactory.getInstance().getTarget(o);n.blur();Event.stop(o);LayoutManagerFactory.getInstance().showDropDownMenu("tabOps",this.menu,Event.pointerX(o),Event.pointerY(o))}.bind(this),true);c.setStyle({display:"none"});this._setLock=function(){LayoutManagerFactory.getInstance().hideCover();this.setLock(true)}.bind(this);this._unsetLock=function(){LayoutManagerFactory.getInstance().hideCover();this.setLock(false)}.bind(this);this.markAsVisibleSuccess=function(){var p=this.workSpace.tabInstances.keys();for(var n=0;n<p.length;n++){var o=this.workSpace.tabInstances[p[n]];if((o.tabInfo.id!=this.tabInfo.id)&&o.firstVisible){o.firstVisible=false;o.visibleEntryId=o.menu.addOption(_currentTheme.getIconURL("mark_tab_visible"),gettext("First Visible"),function(){LayoutManagerFactory.getInstance().hideCover();o.markAsVisible()}.bind(o),1)}}this.firstVisible=true;if(this.visibleEntryId!=null){this.menu.removeOption(this.visibleEntryId);this.visibleEntryId=null}}.bind(this);this.markAsVisible=function(){var p=URIs.TAB.evaluate({workspace_id:this.workSpace.workSpaceState.id,tab_id:this.tabInfo.id});var r=new Object;r.visible="true";var n=Object.toJSON(r);var q={tab:n};PersistenceEngineFactory.getInstance().send_update(p,q,this,this.markAsVisibleSuccess,this.markAsVisibleError)}.bind(this);this.markAsVisibleSuccess=function(){var p=this.workSpace.tabInstances.keys();for(var n=0;n<p.length;n++){var o=this.workSpace.tabInstances[p[n]];if((o.tabInfo.id!=this.tabInfo.id)&&o.firstVisible){o.addMarkAsVisible()}}this.firstVisible=true;if(this.visibleEntryId!=null){this.menu.removeOption(this.visibleEntryId);this.visibleEntryId=null}}.bind(this);this.markAsVisibleError=function(q,o){var n=LogManagerFactory.getInstance();var p=n.formatError(gettext("Error marking as first visible tab, changes will not be saved: %(errorMsg)s."),q,o);n.log(p)}.bind(this);this.addMarkAsVisible=function(){this.firstVisible=false;this.visibleEntryId=this.menu.addOption(_currentTheme.getIconURL("mark_tab_visible"),gettext("Mark as Visible"),function(){LayoutManagerFactory.getInstance().hideCover();this.markAsVisible()}.bind(this),1)}.bind(this);this._createTabMenu()}Tab.prototype._createTabMenu=function(){var d="menu_"+this.tabName;var b=$(d);if(b){b.remove()}b='<div id="'+d+'" class="drop_down_menu"></div>';new Insertion.After($("menu_layer"),b);this.menu=new DropDownMenu(d);this.menu.addOption(_currentTheme.getIconURL("rename"),gettext("Rename"),function(){OpManagerFactory.getInstance().activeWorkSpace.getVisibleTab().fillWithInput();LayoutManagerFactory.getInstance().hideCover()},0);if(this.tabInfo.visible!="true"){this.addMarkAsVisible()}else{this.firstVisible=true;this.visibleEntryId=null}if(this.preferences.get("locked")){this.lockEntryId=this.menu.addOption(_currentTheme.getIconURL("unlock"),gettext("Unlock"),this._unsetLock,1)}else{this.lockEntryId=this.menu.addOption(_currentTheme.getIconURL("lock"),gettext("Lock"),this._setLock,1)}var c="moveMenu_"+this.tabName;var a='<div id="'+c+'" class="drop_down_menu"></div></div>';new Insertion.After($("menu_layer"),a);this.moveMenu=new DropDownMenu(c,this.menu);this._addMoveOptions=function(){var h;var k=this.workSpace.tabInstances.keys();if(k.length==1){this.moveMenu.menu.update(gettext("no more tabs"));return}var f=this.tabHTMLElement.previousSibling;var j=0;for(var g=0;g<k.length;g++){if(this.tabInfo.id!=k[g]&&this.workSpace.tabInstances[k[g]].tabHTMLElement!=f){h={thisTab:this,targetTab:this.workSpace.tabInstances[k[g]]};this.moveMenu.addOption(null,this.workSpace.tabInstances[k[g]].tabInfo.name,function(){LayoutManagerFactory.getInstance().hideCover();LayoutManagerFactory.getInstance().moveTab(this.thisTab,this.targetTab)}.bind(h),j);j++}}if(f){this.moveMenu.addOption(null,gettext("move to end"),function(){LayoutManagerFactory.getInstance().hideCover();LayoutManagerFactory.getInstance().moveTab(this,null)}.bind(this),j)}};this.menu.addOption(_currentTheme.getIconURL("move"),gettext("Move before..."),function(f){this.moveMenu.clearOptions();this._addMoveOptions();LayoutManagerFactory.getInstance().showDropDownMenu("TabOpsSubMenu",this.moveMenu,Event.pointerX(f),Event.pointerY(f))}.bind(this),2);this.menu.addOption(_currentTheme.getIconURL("remove"),gettext("Remove"),function(){var f=gettext('Do you really want to remove the "%(tabName)s" tab?');f=interpolate(f,{tabName:this.tabInfo.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(f,function(){OpManagerFactory.getInstance().activeWorkSpace.getVisibleTab().deleteTab()})}.bind(this),3);this.menu.addOption(_currentTheme.getIconURL("tab_preferences"),gettext("Preferences"),function(){LayoutManagerFactory.getInstance().showPreferencesWindow("tab",this.preferences)}.bind(this),3)};Tab.prototype.show=function(){if(!this.painted){this.getDragboard().paint()}LayoutManagerFactory.getInstance().showDragboard(this.dragboard);this.dragboard._notifyVisibilityChange(true);this.markAsCurrent()};Tab.prototype.hide=function(){this.dragboard._notifyVisibilityChange(false)};Tab.prototype.preferencesChanged=function(c){for(preferenceName in c){var b=false;switch(preferenceName){case"smart":case"columns":case"cell-height":case"vertical-margin":case"horizontal-margin":b=true;break;case"locked":var a=c[preferenceName];if(c[preferenceName]){this.menu.updateOption(this.lockEntryId,_currentTheme.getIconURL("unlock"),gettext("Unlock"),this._unsetLock)}else{this.menu.updateOption(this.lockEntryId,_currentTheme.getIconURL("lock"),gettext("Lock"),this._setLock)}this.dragboard.setLock(a);this.workSpace._checkLock();default:continue}break}if(b){this.dragboard._updateBaseLayout()}};Tab.prototype.setLock=function(a){this.preferences.set({locked:{value:a}})};Tab.prototype._themeLoaded=function(){this._createTabMenu();this.dragboard._themeLoaded()};var ScriptManagerFactory=function(){var a=null;function b(){b.prototype.parse_script=function(){if(this.initial_script==null){return}for(var d=0;d<this.initial_script.length;d++){var c=this.initial_script[d];if(c.command=="load_workspace"){var g=c.ws_id;this.ws_id=g}if(c.command=="change_theme"){var f=c.theme;this.theme=f}}};b.prototype.get_ws_id=function(){return this.ws_id};b.prototype.get_theme=function(){return this.theme};b.prototype.run_script=function(f){if(this.initial_script==null){return}for(var h=0;h<this.initial_script.length;h++){var d=this.initial_script[h];if(d.command=="instantiate_resource"){var k=d.vendor_name;var g=d.name;var c=d.version;var j=d.template;if(k&&g&&c&&j){ShowcaseFactory.getInstance().addGadget(k,g,c,j)}}}};this.initial_script=null;this.ws_id=null;this.theme=null;if(!(post_load_script&&post_load_script!="")){return}this.initial_script=JSON.parse(post_load_script);this.parse_script()}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function RemoteChannelManager(f){RemoteChannelManager.prototype.MILLISECONDS_TO_WAIT=1000;RemoteChannelManager.prototype.MAX_SECONDS_TO_WAIT=1800;RemoteChannelManager.prototype.ENABLED=remote_channels_enabled;this.nested_delayed_updates=0;this.waiting_for_response=false;this.subscribed_channels=null;this.uncommited_channel_values=new Hash();this.error_delay=0;this.persistence_engine=PersistenceEngineFactory.getInstance();this.wiring=f;RemoteChannelManager.prototype.subscribe_to_channels=function(){if(!RemoteChannelManager.prototype.ENABLED){return}var h=this.wiring.get_remote_channels_for_reading_ids();this.subscribed_channels=new Hash();for(var g=0;g<h.length;g++){var j=h[g];var k=j.getRemoteSubscription().getID();this.subscribed_channels[k]=j}this.subscribe_remote_channels()};RemoteChannelManager.prototype.publish_channel_value=function(g,l){if(!RemoteChannelManager.prototype.ENABLED){return}if(!this.uncommited_channel_values[g]){this.uncommited_channel_values[g]=new Array()}var h=this.uncommited_channel_values[g];var k=new RemoteChannelValue(g,l);h.push(k);var j=this.check_delayed_updates_number(h);this.schedule_update_operation(j)};var d=function(j){var g=j.responseText;var h=JSON.parse(g);if(h.length>0){this.propagate_channels(h);this.subscribe_remote_channels()}this.error_delay=0};var c=function(h){var g=h.responseText;this.schedule_subscribe_operation()};var b=function(h){var g=h.responseText;this.remove_sent_values();this.schedule_delay_between_requests()};var a=function(h){var g=h.responseText;this.schedule_delay_between_requests()};this.check_delayed_updates_number=function(g){if(g.length>this.nested_delayed_updates){this.nested_delayed_updates=g.length;return true}return false};this.get_values_to_send=function(){var m=this.uncommited_channel_values.keys();var g=new Array();for(var k=0;k<m.length;k++){var h=m[k];var l=this.uncommited_channel_values[h];if(l.length>0){var j=l[0];g.push(j.get_json())}}return g.toJSON()};this.remove_sent_values=function(){var l=this.uncommited_channel_values.keys();var g=new Array();for(var j=0;j<l.length;j++){var h=l[j];var k=this.uncommited_channel_values[h];if(k.length>0){k.shift()}}this.nested_delayed_updates--};this.get_subscribed_channels_json=function(){var j=this.subscribed_channels.keys();var h=new Array();for(var g=0;g<j.length;g++){h.push(parseInt(j[g]))}return h.toJSON()};this.propagate_channels=function(g){for(var h=0;h<g.length;h++){var k=g[h]["id"];var j=g[h]["value"];this.subscribed_channels[k].propagate(j)}};this.subscribe_remote_channels=function(){var h=this.get_subscribed_channels_json();var g=URIs.GET_SUBSCRIBE_USER_TO_REMOTE_CHANNELS.evaluate({channels:h});this.persistence_engine.send_get(g,this,d,c)};this.update_remote_channels=function(){this.waiting_for_response=true;var g=this.get_values_to_send();var h=URIs.POST_PUBLISH_REMOTE_CHANNELS.evaluate({channels:g});this.persistence_engine.send_get(h,this,b,a)};this.delayed_update=function(){if(this.waiting_for_response){setTimeout(this.delayed_update.bind(this),RemoteChannelManager.prototype.MILLISECONDS_TO_WAIT);return}this.update_remote_channels()};this.schedule_subscribe_operation=function(){setTimeout(this.subscribe_remote_channels.bind(this),this.get_error_delay_milliseconds())};this.get_error_delay_milliseconds=function(){if(this.error_delay==0){this.error_delay=1}else{if(this.error_delay>RemoteChannelManager.prototype.MAX_SECONDS_TO_WAIT){this.error_delay=RemoteChannelManager.prototype.MAX_SECONDS_TO_WAIT}else{this.error_delay*=4}}return this.error_delay*1000};this.schedule_update_operation=function(g){if(g){setTimeout(this.delayed_update.bind(this),RemoteChannelManager.prototype.MILLISECONDS_TO_WAIT);return}};this.schedule_delay_between_requests=function(){setTimeout(this.ready_for_new_request.bind(this),RemoteChannelManager.prototype.MILLISECONDS_TO_WAIT)};this.ready_for_new_request=function(){this.waiting_for_response=false};this.subscribe_to_channels()}function RemoteChannelValue(b,a){this.id=b;this.value=a;this.token=new Date().getTime();RemoteChannelValue.prototype.compare_token=function(c){return this.token==c};RemoteChannelValue.prototype.get_json=function(){return{id:this.id,value:this.value,token:this.token}}}var OpManagerFactory=function(){var a=null;function b(){var d=function(m){var o=m.responseText;var n=JSON.parse(o);var j=n.isDefault;var l=n.workspaces;var k=null;for(var p=0;p<l.length;p++){var h=l[p];this.workSpaceInstances[h.id]=new WorkSpace(h);if(public_workspace&&public_workspace!=""){if(h.id==public_workspace){k=this.workSpaceInstances[h.id];continue}}else{if(h.active){k=this.workSpaceInstances[h.id]}}}var q=ScriptManagerFactory.getInstance().get_ws_id();if(q&&this.workSpaceInstances[q]){k=this.workSpaceInstances[q]}Event.observe($("ws_operations_link"),"click",function(t){if(LayoutManagerFactory.getInstance().getCurrentViewType()=="dragboard"){var r=BrowserUtilsFactory.getInstance().getTarget(t);r.blur();LayoutManagerFactory.getInstance().showDropDownMenu("workSpaceOps",this.activeWorkSpace.menu,Event.pointerX(t),Event.pointerY(t))}else{OpManagerFactory.getInstance().showActiveWorkSpace()}}.bind(this));if(j=="true"){ShowcaseFactory.getInstance().reload(h.id)}else{this.activeWorkSpace=k;if(this.activeWorkSpace==null&&l.length>0){this.activeWorkSpace=this.workSpaceInstances[l[0].id]}this.activeWorkSpace.downloadWorkSpaceInfo()}};var f=function(l,j){var k;try{var h=LogManagerFactory.getInstance();k=h.formatError(gettext("Error loading EzWeb Platform: %(errorMsg)s."),l,j);LayoutManagerFactory.getInstance().showMessageMenu(k,Constants.Logging.ERROR_MSG);h.log(k)}catch(j){if(k!=null){alert(k)}else{alert(gettext("Error loading EzWeb Platform"))}}};var g=function(k){var h=k.responseText;var j=JSON.parse(h);this.workSpaceInstances[j.workspace.id]=new WorkSpace(j.workspace);this.changeActiveWorkSpace(this.workSpaceInstances[j.workspace.id]);LayoutManagerFactory.getInstance().hideCover()};var c=function(l,j){var h=LogManagerFactory.getInstance();var k=h.formatError(gettext("Error creating a workspace: %(errorMsg)s."),l,j);h.log(k)};this.showcaseModule=null;this.contextManagerModule=null;this.catalogue=null;this.logs=null;this.platformPreferences=null;this.persistenceEngine=PersistenceEngineFactory.getInstance();this.loadCompleted=false;this.firstAccessToTheCatalogue=true;this.catalogueIsCurrentTab=false;this.workSpaceInstances=new Hash();this.activeWorkSpace=null;b.prototype._refreshWorkspaceMenu=function(){var l=this.workSpaceInstances.keys();var h=[];for(var j=0;j<l.length;j++){var k=this.workSpaceInstances[l[j]];if(k!=this.activeWorkSpace){h.push(k)}}LayoutManagerFactory.getInstance().refreshChangeWorkSpaceMenu(this.activeWorkSpace,h);LayoutManagerFactory.getInstance().refreshMergeWorkSpaceMenu(this.activeWorkSpace,h)};b.prototype._themeLoaded=function(){var h=LayoutManagerFactory.getInstance();this.activeWorkSpace._themeLoaded();this._refreshWorkspaceMenu();OpManagerFactory.getInstance().refreshEzWebFly();h.resizeWrapper()};b.prototype.showCatalogue=function(){if(!this.activeWorkSpace.isValid()){return}UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();if(LayoutManagerFactory.getInstance().getCurrentViewType()=="catalogue"){this.catalogueIsCurrentTab=true}this.catalogue.show();this.activeWorkSpace.getVisibleTab().markAsCurrent();if(this.firstAccessToTheCatalogue||this.catalogueIsCurrentTab){this.catalogue.initCatalogue();this.firstAccessToTheCatalogue=false;this.catalogueIsCurrentTab=false}else{UIUtils.repaintCatalogue=false}UIUtils.resizeResourcesContainer()};b.prototype.showLogs=function(){if(this.activeWorkSpace&&this.activeWorkSpace.getVisibleTab()){this.activeWorkSpace.getVisibleTab().unmark()}LogManagerFactory.getInstance().show()};b.prototype.clearLogs=function(){LogManagerFactory.getInstance().reset();LayoutManagerFactory.getInstance().clearErrors();LayoutManagerFactory.getInstance().resizeTabBar();this.showActiveWorkSpace()};b.prototype.showPlatformPreferences=function(){PreferencesManagerFactory.getInstance().show()};b.prototype.changeActiveWorkSpace=function(j){var h=this.activeWorkSpace!=null?2:1;LayoutManagerFactory.getInstance()._startComplexTask(gettext("Changing current workspace"),h);if(this.activeWorkSpace!=null){this.activeWorkSpace.unload()}this.activeWorkSpace=j;this.activeWorkSpace.downloadWorkSpaceInfo()};b.prototype.logout=function(){window.open("/logout","_self")};b.prototype.addInstance=function(h){if(!this.loadCompleted){return}var j=this.showcaseModule.getGadget(h);this.activeWorkSpace.getVisibleTab().getDragboard().addInstance(j)};b.prototype.unsubscribeServices=function(h){var l=function(m){};var j=function(m){};unsubscribe_url+="?igadget=";unsubscribe_url+=h;unsubscribe_url+="&user=";unsubscribe_url+=ezweb_user_name;var k={method:"GET",url:unsubscribe_url};this.persistenceEngine.send_post("/proxy",k,this,l,j)};b.prototype.cancelServices=function(j){var l=function(n){};var h=function(n){};var k=URIs.HOME_GATEWAY_DISPATCHER_CANCEL_URL;k+="?igadget=";k+=j;k+="&user=";k+=ezweb_user_name;var m={method:"GET",url:k};this.persistenceEngine.send_post("/proxy",m,this,l,h)};b.prototype.removeInstance=function(h){if(!this.loadCompleted){return}this.activeWorkSpace.removeIGadget(h)};b.prototype.getActiveWorkspaceId=function(){return this.activeWorkSpace.getId()};b.prototype.sendEvent=function(k,h,j){this.activeWorkSpace.getWiring().sendEvent(k,h,j)};b.prototype.loadEnviroment=function(){var j=LayoutManagerFactory.getInstance();j.resizeWrapper();j._startComplexTask(gettext("Loading EzWeb Platform"),3);j.logSubTask(gettext("Retreiving EzWeb code"));j.logStep("");this.logs=LogManagerFactory.getInstance();Event.observe(window,"beforeunload",this.unloadEnvironment.bind(this),true);function l(o,h){OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.THEME_MANAGER)}function k(p,h){if(h!==null){var q=gettext('Error loading "%(theme)s" theme. Trying with "default" theme.');q=interpolate(q,{theme:p.name},true);LayoutManagerFactory.getInstance().showMessageMenu(q,Constants.Logging.WARN_MSG);var o=LogManagerFactory.getInstance();o.log(q);p.deapplyStyle();_currentTheme.applyStyle()}else{_currentTheme=p}_currentTheme.preloadImages(l)}function n(o,h){if(h!==null){var p=gettext("Error loading base theme. Expect problems.");LayoutManagerFactory.getInstance().showMessageMenu(p,Constants.Logging.WARN_MSG);LogManagerFactory.getInstance().log(p);OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.THEME_MANAGER);return}_defaultTheme=o;if(window._INITIAL_THEME!=undefined&&_INITIAL_THEME!="default"){new Theme(_INITIAL_THEME,_defaultTheme,k)}else{k(_defaultTheme,null)}}if(BrowserUtilsFactory.getInstance().isIE()){this.flyStyleSheet=document.createStyleSheet()}else{s=document.createElement("style");s.type="text/css";var m=document.getElementsByTagName("head")[0];m.appendChild(s);this.flyStyleSheet=document.styleSheets[document.styleSheets.length-1]}_currentTheme=new Theme("default",null,n)};b.prototype.refreshEzWebFly=function(){var h="background-image: url("+_currentTheme.getIconURL("init-dat")+");background-repeat: no-repeat;background-attachment:scroll;background-position: center bottom;";if(BrowserUtilsFactory.getInstance().isIE()){while(this.flyStyleSheet.rules.length>0){this.flyStyleSheet.removeRule(0)}this.flyStyleSheet.addRule("#wrapper",h)}else{while(this.flyStyleSheet.cssRules.length>0){this.flyStyleSheet.deleteRule(0)}this.flyStyleSheet.insertRule("#wrapper {"+h+"}",this.flyStyleSheet.cssRules.length)}};b.prototype.unloadEnvironment=function(){var h=LayoutManagerFactory.getInstance();h.hideCover();h._startComplexTask(gettext("Unloading Ezweb Platform"));if(this.activeWorkSpace){this.activeWorkSpace.unload()}UIUtils.sendPendingTags()};b.prototype.igadgetLoaded=function(h){this.activeWorkSpace.igadgetLoaded(h)};b.prototype.igadgetUnloaded=function(h){this.activeWorkSpace.igadgetUnloaded(h)};b.prototype.showActiveWorkSpace=function(){this.activeWorkSpace.show();this._refreshWorkspaceMenu()};b.prototype.continueLoadingGlobalModules=function(j){switch(j){case Modules.prototype.THEME_MANAGER:this.refreshEzWebFly();this.platformPreferences=PreferencesManagerFactory.getInstance();break;case Modules.prototype.PLATFORM_PREFERENCES:this.showcaseModule=ShowcaseFactory.getInstance();this.showcaseModule.init();break;case Modules.prototype.SHOWCASE:this.catalogue=CatalogueFactory.getInstance();break;case Modules.prototype.CATALOGUE:this.loadActiveWorkSpace();break;case Modules.prototype.ACTIVE_WORKSPACE:var h=LayoutManagerFactory.getInstance();h.logSubTask(gettext("Activating current Workspace"));this.showActiveWorkSpace();if(BrowserUtilsFactory.getInstance().getBrowser()=="IE6"){IE7.recalc()}h.logStep("");h._notifyPlatformReady(!this.loadComplete);this.loadCompleted=true;this.activeWorkSpace.run_script()}};b.prototype.loadActiveWorkSpace=function(){this.persistenceEngine.send_get(URIs.GET_POST_WORKSPACES,this,d,f)};b.prototype.logIGadgetError=function(l,m,n){var k=this.activeWorkSpace.getIgadget(l);if(k==null){var j=gettext("Some pice of code tried to notify an error in the iGadget %(iGadgetId)s when it did not exist or it was not loaded yet. This is an error in EzWeb Platform, please notify it.\nError Message: %(errorMsg)s");j=interpolate(j,{iGadgetId:l,errorMsg:m},true);this.logs.log(j);return}var h=k.getGadget().getInfoString();m=m+"\n"+h;this.logs.log(m,n);k.notifyError()};b.prototype.workSpaceExists=function(h){var j=this.workSpaceInstances.values();for(var k=0;k<j.length;k++){if(j[k].workSpaceState.name==h){return true}}return false};b.prototype.addWorkSpace=function(h){var k=new Object();k.name=h;var j={workspace:Object.toJSON(k)};PersistenceEngineFactory.getInstance().send_post(URIs.GET_POST_WORKSPACES,j,this,g,c)};b.prototype.unloadWorkSpace=function(h){this.workSpaceInstances[h].unload()};b.prototype.removeWorkSpace=function(h){if(this.workSpaceInstances.keys().length<=1){var j="there must be one workspace at least";j=interpolate(gettext("Error removing workspace: %(errorMsg)s."),{errorMsg:j},true);LogManagerFactory.getInstance().log(j);LayoutManagerFactory.getInstance().hideCover();return false}this.workSpaceInstances.remove(h);this.changeActiveWorkSpace(this.workSpaceInstances.values()[0]);return true}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function GadgetVariable(b,a){this.varManager=null;this.iGadgetId=null;this.name=null}GadgetVariable.prototype.GadgetVariable=function(a,b){this.varManager=OpManagerFactory.getInstance().activeWorkSpace.getVarManager();this.iGadgetId=a;this.name=b};GadgetVariable.prototype.get=function(){return this.varManager.getVariable(this.iGadgetId,this.name)};GadgetVariable.prototype.set=function(a){};GadgetVariable.prototype.register=function(a){};function RGadgetVariable(b,c,a){GadgetVariable.prototype.GadgetVariable.call(this,b,c);this.handler=a;this.register(a)}RGadgetVariable.prototype=new GadgetVariable;RGadgetVariable.prototype.register=function(a){this.varManager.registerVariable(this.iGadgetId,this.name,a)};function RWGadgetVariable(a,b){GadgetVariable.prototype.GadgetVariable.call(this,a,b)}RWGadgetVariable.prototype=new GadgetVariable;RWGadgetVariable.prototype.set=function(a){this.varManager.setVariable(this.iGadgetId,this.name,a)};function Variable(d,c,b,a){this.annotated=false;this.varManager=null;this.id=null;this.iGadget=null;this.name=null;this.label=null;this.aspect=null;this.value=null;this.tab=null}Variable.prototype.Variable=function(j,b,g,f,d,a,h,c){this.varManager=d;this.id=j;this.iGadget=b;this.name=g;this.label=h;this.aspect=f;this.value=a;this.tab=c};Variable.prototype.get=function(){return this.value};Variable.prototype.setHandler=function(){};Variable.prototype.set=function(a){};Variable.prototype.annotate=function(a){this.annotated=true;this.value=a};Variable.prototype.assignConnectable=function(a){this.connectable=a};Variable.prototype.getConnectable=function(){return this.connectable};Variable.prototype.getWorkspace=function(){return this.varManager.getWorkspace()};Variable.prototype.EVENT="EVEN";Variable.prototype.SLOT="SLOT";Variable.prototype.USER_PREF="PREF";Variable.prototype.PROPERTY="PROP";Variable.prototype.EXTERNAL_CONTEXT="ECTX";Variable.prototype.GADGET_CONTEXT="GCTX";Variable.prototype.INOUT="CHANNEL";Variable.prototype.TAB="TAB";function RVariable(j,b,g,f,d,a,h,c){Variable.prototype.Variable.call(this,j,b,g,f,d,a,h,c);this.handler=null}RVariable.prototype=new Variable;RVariable.prototype.setHandler=function(a){this.handler=a};RVariable.prototype.set=function(g){if(this.annotated){var b=[{id:this.id,value:g,aspect:this.aspect}];switch(this.aspect){case Variable.prototype.SLOT:if(!this.tab.is_painted()){this.varManager.addPendingVariable(this.iGadget,this.name,g);this.tab.paint();return}var a=OpManagerFactory.getInstance();var c=a.activeWorkSpace.getIgadget(this.iGadget);if(!c.loaded){this.varManager.addPendingVariable(this.iGadget,this.name,g);return}c.notifyEvent();case Variable.prototype.USER_PREF:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:this.varManager.markVariablesAsModified(b);this.value=g;if(this.handler){try{this.handler(g)}catch(f){var d={iGadgetId:this.iGadget,varName:this.name,exceptionMsg:f};var h=interpolate(gettext('Error in the handler of the "%(varName)s" RVariable in iGadget %(iGadgetId)s: %(exceptionMsg)s.'),d,true);OpManagerFactory.getInstance().logIGadgetError(this.iGadget,h,Constants.Logging.ERROR_MSG)}}else{var a=OpManagerFactory.getInstance();var c=a.activeWorkSpace.getIgadget(this.iGadget);if(c.loaded){var d={iGadgetId:this.iGadget,varName:this.name};var h=interpolate(gettext('IGadget %(iGadgetId)s does not provide a handler for the "%(varName)s" RVariable.'),d,true);a.logIGadgetError(this.iGadget,h,Constants.Logging.WARN_MSG)}}break;case Variable.prototype.TAB:this.varManager.markVariablesAsModified(b);OpManagerFactory.getInstance().activeWorkSpace.goTab(this.connectable.tab);break;default:break}this.annotated=false}};RVariable.prototype.refresh=function(){switch(this.aspect){case Variable.prototype.USER_PREF:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:if(this.handler){try{this.handler(this.value)}catch(d){var c={iGadgetId:this.iGadget,varName:this.name,exceptionMsg:d};var f=interpolate(gettext('Error in the handler of the "%(varName)s" RVariable in iGadget %(iGadgetId)s: %(exceptionMsg)s.'),c,true);OpManagerFactory.getInstance().logIGadgetError(this.iGadget,f,Constants.Logging.ERROR_MSG)}}else{var a=OpManagerFactory.getInstance();var b=a.activeWorkSpace.getIgadget(this.iGadget);if(b.loaded){var c={iGadgetId:this.iGadget,varName:this.name};var f=interpolate(gettext('IGadget %(iGadgetId)s does not provide a handler for the "%(varName)s" RVariable.'),c,true);a.logIGadgetError(this.iGadget,f,Constants.Logging.WARN_MSG)}}break;case Variable.prototype.TAB:default:break}};function RWVariable(j,b,g,f,d,a,h,c){Variable.prototype.Variable.call(this,j,b,g,f,d,a,h,c)}RWVariable.prototype=new Variable;RWVariable.prototype.set=function(a){this.varManager.incNestingLevel();if(this.value!=a){this.value=a;this.varManager.markVariablesAsModified([this])}switch(this.aspect){case Variable.prototype.EVENT:if(this.connectable!=null){this.connectable.propagate(this.value,false);break}default:break}this.varManager.decNestingLevel()};function VarManager(a){VarManager.prototype.MAX_BUFFERED_REQUESTS=10;VarManager.prototype.parseVariables=function(f){var d=f.workspace["tabList"];for(var c=0;c<d.length;c++){var g=d[c]["igadgetList"];for(var b=0;b<g.length;b++){this.parseIGadgetVariables(g[b],this.workSpace.getTabInstance(d[c].id))}}var h=f.workspace["workSpaceVariableList"];this.parseWorkspaceVariables(h)};VarManager.prototype.parseWorkspaceVariables=function(c){for(var b=0;b<c.length;b++){this.parseWorkspaceVariable(c[b])}};VarManager.prototype.sendBufferedVars=function(){function f(h){}function c(l,j){var h=LogManagerFactory.getInstance();var k=h.formatError(gettext("Error saving variables to persistence: %(errorMsg)s."),l,j);h.log(k)}if(this.igadgetModifiedVars.length>0||this.workspaceModifiedVars.length>0){var g={};g.igadgetVars=this.igadgetModifiedVars;g.workspaceVars=this.workspaceModifiedVars;var d={variables:Object.toJSON(g)};var b=URIs.PUT_VARIABLES.evaluate({workspaceId:this.workSpace.getId()});PersistenceEngineFactory.getInstance().send_update(b,d,this,f,c);this.resetModifiedVariables()}};VarManager.prototype.parseWorkspaceVariable=function(d){var g=d.id;var c=d.name;var b=d.aspect;var f=d.value;switch(b){case Variable.prototype.INOUT:this.workspaceVariables[g]=new RWVariable(g,null,c,b,this,f);break;case Variable.prototype.TAB:this.workspaceVariables[g]=new RVariable(g,null,c,b,this,f);break}};VarManager.prototype.removeWorkspaceVariable=function(b){delete this.workspaceVariables[b];this.workspaceModifiedVars.removeById(b)};VarManager.prototype.parseIGadgetVariables=function(g,h){var l=g.variables;var f=[];for(var k=0;k<l.length;k++){var d=l[k].id;var j=l[k].igadgetId;var c=l[k].name;var m=l[k].label;var b=l[k].aspect;var n=l[k].value;switch(b){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:f[c]=new RWVariable(d,j,c,b,this,n,m,h);this.variables[d]=f[c];break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:case Variable.prototype.USER_PREF:f[c]=new RVariable(d,j,c,b,this,n,m,h);this.variables[d]=f[c];break}}this.iGadgets[g.id]=f};VarManager.prototype.registerVariable=function(d,g,c){var b=this.findVariable(d,g);if(b){b.setHandler(c)}else{var f={iGadgetId:d,varName:g};var h=interpolate(gettext('IGadget %(iGadgetId)s does not have any variable named "%(varName)s".\nIf you need it, please insert it into the gadget\'s template.'),f,true);OpManagerFactory.getInstance().logIGadgetError(d,h,Constants.Logging.ERROR_MSG)}};VarManager.prototype.assignEventConnectable=function(d,f,c){var b=this.findVariable(d,f);b.assignEvent(c)};VarManager.prototype.getVariable=function(c,d){var b=this.findVariable(c,d);return b.get()};VarManager.prototype.setVariable=function(c,f,d){var b=this.findVariable(c,f);b.set(d)};VarManager.prototype.addPendingVariable=function(b,d,c){var f=this.pendingVariables[b];if(!f){this.pendingVariables[b]=new Array();f=this.pendingVariables[b]}f.push({name:d,value:c})};VarManager.prototype.dispatchPendingVariables=function(c){var d=this.pendingVariables.remove(c);if(d){for(var b=0;b<d.length;b++){this.setVariable(c,d[b]["name"],d[b]["value"])}}};VarManager.prototype.addInstance=function(d,b,c){this.parseIGadgetVariables(b,c)};VarManager.prototype.removeInstance=function(b){delete this.iGadgets[b];this.removeIGadgetVariables(b)};VarManager.prototype.removeIGadgetVariables=function(d){var c=this.variables.keys();for(var b=0;b<c.length;b++){if(this.variables[c[b]].iGadget==d){this.igadgetModifiedVars.removeById(c[b]);delete this.variables[c[b]]}}};VarManager.prototype.unload=function(){};VarManager.prototype.commitModifiedVariables=function(){if(this.buffered_requests<VarManager.prototype.MAX_BUFFERED_REQUESTS){this.buffered_requests++;return}this.sendBufferedVars()};VarManager.prototype.createWorkspaceVariable=function(b){var c=new Date().getTime();return new RWVariable(c,null,b,Variable.prototype.INOUT,this,"")};VarManager.prototype.addWorkspaceVariable=function(c,b){this.workspaceVariables[c]=b};VarManager.prototype.getWorkspaceVariableById=function(b){return this.workspaceVariables[b]};VarManager.prototype.initializeInterface=function(){var c;var g;var d;var b;for(b in this.iGadgets){g=this.iGadgets[b];for(d in g){c=g[d];if(c.aspect=="SLOT"&&c.handler){try{c.handler(c.value)}catch(f){}}}}};VarManager.prototype.markVariablesAsModified=function(k){var g;for(var c=0;c<k.length;c++){var b=k[c];if(b.aspect==Variable.prototype.INOUT||b.aspect==Variable.prototype.TAB){g=this.workspaceModifiedVars}else{g=this.igadgetModifiedVars}for(var f=0;f<g.length;f++){var h=g[f];if(h.id==b.id){h.value=b.value;return}}var d={};d.id=b.id;d.value=b.value;g.push(d)}};VarManager.prototype.incNestingLevel=function(){this.nestingLevel++};VarManager.prototype.decNestingLevel=function(){this.nestingLevel--;if(this.nestingLevel==0){this.commitModifiedVariables()}};VarManager.prototype.resetModifiedVariables=function(){this.nestingLevel=0;this.buffered_requests=0;this.igadgetModifiedVars=[];this.workspaceModifiedVars=[]};VarManager.prototype.getVariableById=function(b){return this.variables[b]};VarManager.prototype.getVariableByName=function(b,c){return this.findVariable(b,c)};VarManager.prototype.getWorkspace=function(){return this.workSpace};VarManager.prototype.findVariable=function(d,c){var f=this.iGadgets[d];var b=f[c];return b};this.workSpace=a;this.iGadgets=new Hash();this.variables=new Hash();this.workspaceVariables=new Hash();this.igadgetModifiedVars=[];this.workspaceModifiedVars=[];this.nestingLevel=0;this.buffered_requests=0;this.pendingVariables=new Hash();this.parseVariables(this.workSpace.workSpaceGlobalInfo)}var ShowcaseFactory=function(){var a=null;function b(){b.prototype.MODULE_HTML_ID="showcase";b.prototype.NUM_CELLS=4;this.parseGadgets=function(j){var d=j.responseText;var g=JSON.parse(d);var l=this.gadgets;this.gadgets=new Hash();for(var f=0;f<g.length;f++){var k=g[f];var h=new Gadget(k,null);var c=h.getVendor()+"_"+h.getName()+"_"+h.getVersion();if(l&&l[c]){h.setUpdatedState(l[c].getLastVersion(),l[c].getLastVersionURL())}this.gadgets[c]=h}};b.prototype.reload=function(g){var f=g;var d=function(h){this.parseGadgets(h);opManager=OpManagerFactory.getInstance();opManager.changeActiveWorkSpace(opManager.workSpaceInstances[f])};var c=function(h){alert("error en showcase")};this.persistenceEngine.send_get(URIs.GET_GADGETS,this,d,c)};b.prototype.init=function(){var d=function(f){this.parseGadgets(f);this.loaded=true;this.opManager.continueLoadingGlobalModules(Modules.prototype.SHOWCASE)};var c=function(f){this.loaded=true;this.opManager.continueLoadingGlobalModules(Modules.prototype.SHOWCASE)};this.persistenceEngine.send_get(URIs.GET_GADGETS,this,d,c)};Event.observe($("submit_link"),"click",function(){UIUtils.addResource(URIs.GET_POST_RESOURCES,"template_uri",$("template_uri").value)},false,"add_resource");this.gadgets=new Hash();this.loaded=false;this.opManager=OpManagerFactory.getInstance();this.persistenceEngine=PersistenceEngineFactory.getInstance();b.prototype.addGadget=function(h,f,j,d){var c=h+"_"+f+"_"+j;var g=this.gadgets[c];if(g==null){g=new Gadget(null,d)}else{this.opManager.addInstance(c)}};b.prototype.gadgetToShowcaseGadgetModel=function(d){var c=d.getId();this.gadgets[c]=d;this.opManager.addInstance(c)};b.prototype.deleteGadget=function(c){var d=this.gadgets.remove(c)};b.prototype.updateGadget=function(c,d){this.remove(c);this.addGadget(d)};b.prototype.getGadget=function(c){return this.gadgets[c]};b.prototype.getGadgetsData=function(){var h=[];var f=this.gadgets.keys();for(var c=0;c<f.length;c++){var d=this.gadgets[f[c]];h.push({name:d.getName(),vendor:d.getVendor(),version:d.getVersion()})}return h};b.prototype.setGadgetsState=function(f){for(var d=0;d<f.length;d++){var c=f[d]["vendor"]+"_"+f[d]["name"]+"_"+f[d]["version"];this.gadgets[c].setUpdatedState(f[d]["lastVersion"],f[d]["lastVersionURL"])}};b.prototype.setGadgetProperties=function(c,g,d){var f=this.gadgets[c];f.setImage(g);f.setTags(d)};b.prototype.tagGadget=function(d,g){for(var f=0;f<g.length;f++){var c=g[f];this.gadgets[d].addTag(c)}};b.prototype.addInstance=function(c){var d=this.gadgets[c];this.opManager.addInstance(d)}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function append(a){this.buffer.push(a);return this};StringBuffer.prototype.toString=function toString(){return this.buffer.join("")};function ContextManager(b,a){this._addContextVarsFromTemplate=function(h,g,l){var m=this._workspace.getVarManager();for(var j=0;j<g.size();j++){var d=g[j];d.setVarManager(m);var c=d.getConceptName();var k=this._name2Concept[c];if(k!=null&&k._type!=l){k=null}if(k==null){var f=gettext('There is not any concept of type "%(type)s" called "%(concept)s", the value of the iGadget variable "%(varName)s" will be empty.');f=interpolate(f,{concept:c,type:l,varName:d.getName()},true);OpManagerFactory.getInstance().logIGadgetError(h.getId(),f,Constants.Logging.ERROR_MSG);continue}k.addIGadgetVar(d)}};this._loadConceptsFromWorkspace=function(d){this._concepts=new Hash();this._name2Concept=new Hash();var c=d.workspace["concepts"];for(var l=0;l<c.length;l++){var n=c[l];var g=new Concept(n.concept,n.type,n.adaptor);this._concepts[n.concept]=g;if(n.value!=undefined){g._setInitialValue(n.value)}for(var k=0;k<n.names.length;k++){var m=n.names[k];var h=this._name2Concept[m];if(h!=null){var f=gettext("WARNING: concept name '%(cname)s' is already related to '%(concept)s'. New related concept is '%(newConcept)s'.");f=interpolate(f,{cname:m,concept:h,newConcept:n.concept},true);LogManagerFactory.getInstance().log(f)}this._name2Concept[m]=g}}};this._loadIGadgetContextVarsFromWorkspace=function(o){var p=o.workspace["tabList"];for(var l=0;l<p.length;l++){var c=p[l];var t=c.igadgetList;for(var h=0;h<t.length;h++){var n=t[h];var r=n.variables;for(var g=0;g<r.length;g++){var q=r[g];switch(q.aspect){case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:var f=new ContextVar(n.id,q.name,q.concept);f.setVarManager(this._workspace.getVarManager());var m=this._name2Concept[q.concept];if(m){if(q.aspect!==m._type){var d=gettext('There is not any concept of type "%(type)s" called "%(concept)s", the value of the iGadget variable "%(varName)s" will be empty.');d=interpolate(d,{concept:q.concept,type:m._type,varName:q.name},true);OpManagerFactory.getInstance().logIGadgetError(n.id,d,Constants.Logging.ERROR_MSG)}else{m.addIGadgetVar(f)}}break;default:break}}}}this._loaded=true};ContextManager.prototype.addInstance=function(d,c){if(!this._loaded){return}if(c==null){return}this._addContextVarsFromTemplate(d,c.getExternalContextVars(d.getId()),Concept.prototype.EXTERNAL);this._addContextVarsFromTemplate(d,c.getGadgetContextVars(d.getId()),Concept.prototype.IGADGET)};ContextManager.prototype.iGadgetLoaded=function(h){if(!this._loaded){return}var g=h.getId();var f=this._concepts.keys();for(var c=0;c<f.length;c++){var d=this._concepts[f[c]];d.propagateIGadgetVarValues(h)}};ContextManager.prototype.iGadgetUnloaded=function(g){if(!this._loaded){return}var f=this._concepts.keys();for(var c=0;c<f.length;c++){var d=this._concepts[f[c]];if(d._type!==Concept.prototype.IGADGET){continue}var h=d.getIGadgetVar(g.getId());if(h!=null){h._clearHandler()}}};ContextManager.prototype.removeInstance=function(c){if(!this._loaded){return}var g=this._concepts.keys();for(var f=0;f<g.length;f++){var d=g[f];this._concepts[d].deleteIGadgetVars(c)}};ContextManager.prototype.notifyModifiedConcept=function(c,d){if(!this._loaded){return}if(!this._concepts[c]){return}this._concepts[c].setValue(d)};ContextManager.prototype.notifyModifiedGadgetConcept=function(d,c,g){if(!this._loaded){return}if(this._concepts[c]==null){return}var f=this._concepts[c].getIGadgetVar(d.getId());if(f==null){return}f.setValue(g)};ContextManager.prototype.getWorkspace=function(){return this._workspace};ContextManager.prototype.unload=function(){var c=this._name2Concept.keys();for(var f=0;f<c.length;f++){delete this._name2Concept[c[f]]}delete this._name2Concept;var g=this._concepts.keys();for(var d=0;f<g.length;d++){this._concepts[g[d]].unload();delete this._concepts[g[d]]}delete this._concepts;delete this._loaded;delete this._workspace};this._loaded=false;this._concepts=new Hash();this._name2Concept=new Hash();this._workspace=b;this._loadConceptsFromWorkspace(a);this._loadIGadgetContextVarsFromWorkspace(a)}function ContextVar(a,c,b){this._igadgetId=a;this._varName=c;this._conceptName=b;this._varManager=null;this._value=null}ContextVar.prototype.getName=function(){return this._varName};ContextVar.prototype.getIGadgetId=function(){return this._igadgetId};ContextVar.prototype.getConceptName=function(){return this._conceptName};ContextVar.prototype.getValue=function(){return this._value};ContextVar.prototype.propagateValue=function(){this.setValue(this._value)};ContextVar.prototype.setValue=function(a){this._value=a;if(this._varManager!=null){var b=this._varManager.getVariableByName(this._igadgetId,this._varName);b.annotate(a);b.set(a)}};ContextVar.prototype._clearHandler=function(){if(this._varManager!=null){var a=this._varManager.getVariableByName(this._igadgetId,this._varName);a.setHandler(null)}};ContextVar.prototype.setVarManager=function(a){this._varManager=a};ContextVar.prototype.unload=function(){delete this._igadgetId;delete this._varName;delete this._conceptName;delete this._varManager;delete this._value};function Concept(a,b,c){this._semanticConcept=a;this._type=b;this._adaptor=c;this._value=null;this._initialValue=null;this._igadgetVars=new Object()}Concept.prototype.EXTERNAL="ECTX";Concept.prototype.IGADGET="GCTX";Concept.prototype.USERNAME="username";Concept.prototype.LANGUAGE="language";Concept.prototype.WIDTH="width";Concept.prototype.WIDTHINPIXELS="widthInPixels";Concept.prototype.HEIGHT="height";Concept.prototype.HEIGHTINPIXELS="heightInPixels";Concept.prototype.XPOSITION="xPosition";Concept.prototype.YPOSITION="yPosition";Concept.prototype.LOCKSTATUS="lockStatus";Concept.prototype.ORIENTATION="orientation";Concept.prototype._initAdaptor=function(ivar_){if(ivar_==null){eval("new "+this._adaptor+"()")}else{eval("new "+this._adaptor+"("+ivar_.getIGadgetId()+")")}};Concept.prototype.getSemanticConcept=function(){return this._semanticConcept};Concept.prototype.getAdaptor=function(){return this._adaptor};Concept.prototype.getValue=function(){if(this._type==Concept.prototype.EXTERNAL){return this._value}throw gettext("Concept does not have value, this is a Gadget Concept.")};Concept.prototype.setValue=function(a){switch(this._type){case Concept.prototype.IGADGET:throw gettext("Concept does not have value, this is a Gadget Concept.");break;default:this._value=a;for(var b=0;b<this._igadgetVars.length;b++){var c=this._igadgetVars[b];c.setValue(a)}break}};Concept.prototype._setInitialValue=function(a){this._value=a};Concept.prototype.propagateIGadgetVarValues=function(a){var b=this._igadgetVars[a.getId()];if(b!=null){b.propagateValue()}};Concept.prototype.addIGadgetVar=function(b){switch(this._type){case Concept.prototype.EXTERNAL:var a=b.getIGadgetId();this._igadgetVars[a]=b;if(this._value!=null){b.setValue(this._value)}else{if(this._adaptor){this._initAdaptor(null)}}break;case Concept.prototype.IGADGET:var a=b.getIGadgetId();this._igadgetVars[a]=b;if(this._adaptor){this._initAdaptor(b)}break;default:throw gettext("Unexpected igadget variables. Concept does not have type yet.");break}};Concept.prototype.deleteIGadgetVars=function(a){delete this._igadgetVars[a]};Concept.prototype.getIGadgetVar=function(a){switch(this._type){case Concept.prototype.EXTERNAL:case Concept.prototype.IGADGET:var b=this._igadgetVars[a];return b;default:throw gettext("Concept does not have type yet.")}};Concept.prototype.unload=function(){for(var a in this._igadgetVars){this._igadgetVars[keys[i]].unload()}};function UserAdaptor(){function a(g){var f=JSON.parse(g.responseText);var d=f.value;OpManagerFactory.getInstance().activeWorkSpace.getContextManager().notifyModifiedConcept(UserAdaptor.prototype.CONCEPT,d)}function b(h,f){var d=LogManagerFactory.getInstance();var g=interpolate(gettext("Error getting concept %(concept)s: %(errorMsg)s."),{concept:UserAdaptor.prototype.CONCEPT},true);g=d.formatError(gettext("Error getting concept %(concept)s: %(errorMsg)s."),h,f);d.log(g)}var c=URIs.GET_CONTEXT_VALUE.evaluate({concept:UserAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(c,this,a,b)}UserAdaptor.prototype.CONCEPT="username";function LanguageAdaptor(){function a(g){var d=JSON.parse(g.responseText);var f=d.value;OpManagerFactory.getInstance().activeWorkSpace.getContextManager().notifyModifiedConcept(LanguageAdaptor.prototype.CONCEPT,f)}function b(h,f){var d=LogManagerFactory.getInstance();var g=interpolate(gettext("Error getting concept %(concept)s: %(errorMsg)s."),{concept:UserAdaptor.prototype.CONCEPT},true);g=d.formatError(g,h,f);d.log(g)}var c=URIs.GET_CONTEXT_VALUE.evaluate({concept:LanguageAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(c,this,a,b)}LanguageAdaptor.prototype.CONCEPT="language";function DragboardLayout(a){if(arguments.length==0){return}this.dragboard=a;this.iGadgets=new Hash()}DragboardLayout.prototype._notifyWindowResizeEvent=function(f,b){var d;var a=this.iGadgets.keys();for(var c=0;c<a.length;c++){d=this.iGadgets[a[c]];d._notifyWindowResizeEvent()}};DragboardLayout.prototype._notifyResizeEvent=function(f,b,h,d,a,c,g){};DragboardLayout.prototype._notifyDragboardVisibilityChange=function(a){};DragboardLayout.prototype.getMenubarSize=function(){var a=18;var b=Math.ceil(this.fromPixelsToVCells(a));return new MultiValuedSize(a,b)};DragboardLayout.prototype.getStatusbarSize=function(){var a=16;var b=Math.ceil(this.fromPixelsToVCells(a));return new MultiValuedSize(a,b)};DragboardLayout.prototype.getExtraSize=function(){var a=this.getMenubarSize().inPixels+this.getStatusbarSize().inPixels;var b=Math.ceil(this.fromPixelsToVCells(a));return new MultiValuedSize(a,b)};DragboardLayout.prototype.adaptColumnOffset=function(b){var a=gettext('method "%(method)s" must be implemented.');a=interpolate(a,{method:"adaptColumnOffset"},true);throw new Exception(a)};DragboardLayout.prototype.adaptRowOffset=function(b){var a=gettext('method "%(method)s" must be implemented.');a=interpolate(a,{method:"adaptRowOffset"},true);throw new Exception(a)};DragboardLayout.prototype.adaptHeight=function(a,c){var b=gettext('method "%(method)s" must be implemented.');b=interpolate(b,{method:"adaptHeight"},true);throw new Exception(b)};DragboardLayout.prototype.adaptWidth=function(a,c){var b=gettext('method "%(method)s" must be implemented.');b=interpolate(b,{method:"adaptWidth"},true);throw new Exception(b)};DragboardLayout.prototype.isInside=function(a,b){return(a>=0)&&(a<this.getWidth())&&(b>=0)};DragboardLayout.prototype.getWidth=function(){return this.dragboard.getWidth()};DragboardLayout.prototype.getHeight=function(){return this.dragboard.getHeight()};DragboardLayout.prototype.addIGadget=function(a,b){if(a.layout!=null){var c=gettext("the iGadget could not be associated with this layout as it already has an associated layout.");throw new Error(c)}a.layout=this;if(b){this.dragboard._registerIGadget(a);if(a.isVisible()){this.dragboard.dragboardElement.appendChild(a.element);this.dragboard.dragboardElement.appendChild(a.iconElement)}}this.iGadgets[a.code]=a;if(a.isVisible()){a._recomputeSize()}};DragboardLayout.prototype._adaptIGadget=function(a){if(a.element!=null){this._ensureMinimalSize(a,false)}};DragboardLayout.prototype._ensureMinimalSize=function(f,h){var c=Math.ceil(this.fromPixelsToHCells(80));var g=Math.ceil(this.fromPixelsToVCells(24));var b=false;var d=f.getContentWidth();var a=f.getContentHeight();if(d<c){b=true;d=c}if(a<g){b=true;a=g}if(b){f.setContentSize(d,a,false,h)}};DragboardLayout.prototype.removeIGadget=function(a,b){delete this.iGadgets[a.code];if(b){this.dragboard._deregisterIGadget(a);if(a.element!=null){this.dragboard.dragboardElement.removeChild(a.element)}if(a.iconElement!=null){this.dragboard.dragboardElement.removeChild(a.iconElement)}}a.layout=null};DragboardLayout.prototype.moveTo=function(c){var a=this.iGadgets.keys();for(var b=0;b<a.length;b++){iGadget=this.iGadgets[a[b]];iGadget.moveToLayout(c)}};DragboardLayout.prototype.destroy=function(){var b=this.iGadgets.keys();for(var a=0;a<b.length;a++){this.iGadgets[b[a]].destroy()}this.iGadgets=null;this.dragboard=null};DragboardLayout.prototype.initializeMove=function(b,a){};DragboardLayout.prototype.moveTemporally=function(a,b){};DragboardLayout.prototype.acceptMove=function(){};DragboardLayout.prototype.cancelMove=function(){};DragboardLayout.prototype.disableCursor=function(){};DragboardLayout.prototype.measure=function(c,a){c.style.visibility="hidden";this.dragboard.dragboardElement.appendChild(c);var b=new Array();var d=document.defaultView.getComputedStyle(c,null);b[0]=d.getPropertyCSSValue("width").getFloatValue(a);b[1]=d.getPropertyCSSValue("height").getFloatValue(a);c.parentNode.removeChild(c);return b};DragboardLayout.prototype.unitConvert=function(c,a){var b=document.createElement("div");b.style.height=c;b.style.width=c;return this.measure(b,a)};function MultiValuedSize(b,a){this.inPixels=b;this.inLU=a}function ColumnLayout(c,f,b,a,d,g){if(arguments.length==0){return}this.initialized=false;this.shadowMatrix=null;this.shadowPositions=null;this.columns=f;this.cellHeight=b;if((a%2)==0){this.topMargin=a/2;this.bottomMargin=a/2}else{this.topMargin=Math.floor(a/2);this.bottomMargin=Math.floor(a/2)+1}if((d%2)==0){this.leftMargin=d/2;this.rightMargin=d/2}else{this.leftMargin=Math.floor(d/2);this.rightMargin=Math.floor(d/2)+1}this._clearMatrix();this.dragboardCursor=null;this.gadgetToMove=null;DragboardLayout.call(this,c,g)}ColumnLayout.prototype=new DragboardLayout();ColumnLayout.prototype.getColumns=function(){return this.columns};ColumnLayout.prototype.getCellHeight=function(){return this.cellHeight};ColumnLayout.prototype.fromPixelsToVCells=function(a){return(a/this.cellHeight)};ColumnLayout.prototype.fromVCellsToPixels=function(a){return(a*this.cellHeight)};ColumnLayout.prototype.getWidthInPixels=function(a){return this.fromHCellsToPixels(a)-this.leftMargin-this.rightMargin};ColumnLayout.prototype.getHeightInPixels=function(a){return this.fromVCellsToPixels(a)-this.topMargin-this.bottomMargin};ColumnLayout.prototype.fromPixelsToHCells=function(c){var b=c/this.fromHCellsToPixels(1);var a=Math.floor(b);if(Math.ceil(this.fromHCellsToPixels(a))==c){return a}else{return b}};ColumnLayout.prototype.fromHCellsToPixels=function(a){return(this.getWidth()*this.fromHCellsToPercentage(a))/100};ColumnLayout.prototype.fromHCellsToPercentage=function(a){return a*(100/this.columns)};ColumnLayout.prototype.adaptColumnOffset=function(d){var a=Math.floor(this.fromHCellsToPixels(1)/2);var b=Math.floor(this.fromPixelsToHCells(d-this.leftMargin+a));var c=this.fromHCellsToPixels(b)+this.leftMargin;return new MultiValuedSize(c,b)};ColumnLayout.prototype.adaptRowOffset=function(d){var c=Math.floor(this.fromVCellsToPixels(1)/2);var a=Math.floor(this.fromPixelsToVCells(d-this.topMargin+c));var b=this.fromVCellsToPixels(a)+this.topMargin;return new MultiValuedSize(b,a)};ColumnLayout.prototype.adaptHeight=function(c,d){d+=this.topMargin+this.bottomMargin;var a=Math.ceil(this.fromPixelsToVCells(d));var b=this.fromVCellsToPixels(a);return new MultiValuedSize(c+(b-d),a)};ColumnLayout.prototype.adaptWidth=function(b,d){d+=this.leftMargin+this.rightMargin;var a=Math.ceil(this.fromPixelsToHCells(d));var c=this.fromHCellsToPixels(a);return new MultiValuedSize(b+(c-d),a)};ColumnLayout.prototype.getColumnOffset=function(b){var a=Math.floor((this.getWidth()*this.fromHCellsToPercentage(b))/100);a+=this.leftMargin;return a};ColumnLayout.prototype.getRowOffset=function(a){return this.fromVCellsToPixels(a)+this.topMargin};ColumnLayout.prototype._getPositionOn=function(a,b){if(a==this.matrix){return b.getPosition()}else{return this.shadowPositions[b.code]}};ColumnLayout.prototype._setPositionOn=function(b,c,a){if(b==this.matrix){c.setPosition(a)}else{this.shadowPositions[c.code]=a}};ColumnLayout.prototype._clearMatrix=function(){this.matrix=new Array();for(var a=0;a<this.getColumns();a++){this.matrix[a]=new Array()}};ColumnLayout.prototype._hasSpaceFor=function(g,f,d,c,b){var a,h;for(a=0;a<c;a++){for(h=0;h<b;h++){if(g[f+a][d+h]!=null){return false}}}return true};ColumnLayout.prototype._reserveSpace=function(g,f){var c,h;var b=this._getPositionOn(g,f);var d=f.getWidth();var a=f.getHeight();for(c=0;c<d;c++){for(h=0;h<a;h++){g[b.x+c][b.y+h]=f}}};ColumnLayout.prototype._clearSpace=function(g,f){var c,h;var b=this._getPositionOn(g,f);var d=f.getWidth();var a=f.getHeight();for(c=0;c<d;c++){for(h=0;h<a;h++){delete g[b.x+c][b.y+h]}}};ColumnLayout.prototype._searchInsertPoint=function(d,b,f,c,a){return f};ColumnLayout.prototype._moveSpaceDown=function(b,f,d){var j=new Hash();var g=this._getPositionOn(b,f);var o=g.clone();o.y+=d;var h=g.y+f.getHeight();var a,l,k;for(l=0;l<f.getWidth();l++){for(k=0;k<d;k++){a=b[g.x+l][h+k];if(a!=null){j[a.code]=d-k;break}}}var n=j.keys();var a,c,m;for(c=0;c<n.length;c++){m=n[c];a=this.iGadgets[m];this._moveSpaceDown(b,a,j[m])}this._clearSpace(b,f);this._setPositionOn(b,f,o);this._reserveSpace(b,f)};ColumnLayout.prototype._moveSpaceUp=function(b,f){var g=this._getPositionOn(b,f);var h=g.y+f.getHeight();var d;for(d=1;((g.y-d)>=0)&&this._hasSpaceFor(b,g.x,g.y-d,f.getWidth(),1);d++){}--d;if(d>0){var j=new Hash();var o=g.clone();o.y-=d;var a,m,k,l;for(m=0;m<f.getWidth();m++){l=b[g.x+m].length;for(k=h;k<l;k++){a=b[g.x+m][k];if(a!=null){j[a.code]=a;break}}}this._clearSpace(b,f);this._setPositionOn(b,f,o);this._reserveSpace(b,f);var n=j.keys();var c;for(c=0;c<n.length;c++){this._moveSpaceUp(b,j[n[c]])}return true}return false};ColumnLayout.prototype._removeFromMatrix=function(b,a){this._clearSpace(b,a)};ColumnLayout.prototype._reserveSpace2=function(h,g,f,d,c,b){var a,j;for(a=0;a<c;a++){for(j=0;j<b;j++){h[f+a][d+j]=g}}};ColumnLayout.prototype._clearSpace2=function(g,f,d,c,b){var a,h;for(a=0;a<c;a++){for(h=0;h<b;h++){delete g[f+a][d+h]}}};ColumnLayout.prototype._notifyResizeEvent=function(g,f,p,h,a,l,m){var o,n;var c=f;var k=g.getPosition();var t;t=k.x;if(h>f){c=f;var r=k.y+a;if(l){var j=h-f;for(o=k.x-j;o<k.x;++o){for(n=0;n<a;++n){var q=this.matrix[o][k.y+n];if(q!=null){this._moveSpaceDown(this.matrix,q,r-q.position.y);break}}}k.x-=j;if(m){g.setPosition(k)}this._reserveSpace2(this.matrix,g,k.x,k.y,j,a)}else{for(o=k.x+f;o<k.x+h;++o){for(n=0;n<a;++n){var q=this.matrix[o][k.y+n];if(q!=null){this._moveSpaceDown(this.matrix,q,r-q.position.y);break}}}this._reserveSpace2(this.matrix,g,k.x+f,k.y,h-f,a)}}else{if(h<f){c=h;var j=f-h;if(l){this._clearSpace2(this.matrix,k.x,k.y,j,p);k.x+=j;if(m){g.setPosition(k)}t=k.x}else{this._clearSpace2(this.matrix,k.x+h,k.y,j,p)}}}if(a>p){var b=k.y+a;var d=t+c;for(n=k.y+p;n<b;n++){for(o=t;o<d;o++){if(this.matrix[o][n]!=null){this._moveSpaceDown(this.matrix,this.matrix[o][n],b-n)}}}this._reserveSpace2(this.matrix,g,t,k.y+p,c,a-p)}else{if(a<p){this._clearSpace2(this.matrix,t,k.y+a,c,p-a)}}this._notifyWindowResizeEvent(true,true);if(m){this.dragboard._commitChanges()}};ColumnLayout.prototype._insertAt=function(h,k,j){var d=new DragboardPosition(k,j);var c,g,f;var b=d.x+h.getWidth();var a=d.y+h.getHeight();for(k=d.x;k<b;k++){for(j=d.y;j<a;j++){c=this.matrix[k][j];if(c!=null){f=c.getPosition().y;g=a-f;this._moveSpaceDown(this.matrix,c,g);break}}}h.setPosition(d);this._reserveSpace(this.matrix,h)};ColumnLayout.prototype._searchFreeSpace=function(d,a){var f=0,c=0;var b=this.getColumns()-d+1;for(c=0;true;c++){for(f=0;f<b;f++){if(this._hasSpaceFor(this.matrix,f,c,d,a)){return new DragboardPosition(f,c)}}}};ColumnLayout.prototype.initialize=function(){var h,g,f,c,b=new Array();this._clearMatrix();var a=this.iGadgets.keys();for(g=0;g<a.length;g++){f=a[g];h=this.iGadgets[f];c=h.getPosition();h.paint(true);this._ensureMinimalSize(h);if(h.getWidth()>this.getColumns()){h.contentWidth=this.getColumns()}if(h.getWidth()+c.x>this.getColumns()){b.push(h)}else{if(this._hasSpaceFor(this.matrix,c.x,c.y,h.getWidth(),h.getHeight())){this._reserveSpace(this.matrix,h)}else{b.push(h)}}}var d=false;if(b.length>0){for(g=0;g<b.length;g++){c=this._searchFreeSpace(b[g].getWidth(),b[g].getHeight());b[g].setPosition(c);this._reserveSpace(this.matrix,b[g])}d=true}this.initialized=true;return d};ColumnLayout.prototype.getCellAt=function(a,c){var b=this.getWidth()/this.getColumns();return new DragboardPosition(Math.floor(a/b),Math.floor(c/this.getCellHeight()))};ColumnLayout.prototype.addIGadget=function(b,d){DragboardLayout.prototype.addIGadget.call(this,b,d);if(!this.initialized){return}if(b.getWidth()>this.getColumns()){b.contentWidth=this.getColumns();b._recomputeSize(true)}var a=b.getPosition();if(a){var c=b.getWidth()+a.x-this.getColumns();if(c>0){a.x-=c}this._insertAt(b,a.x,a.y)}else{a=this._searchFreeSpace(b.getWidth(),b.getHeight());b.setPosition(a);this._reserveSpace(this.matrix,b)}this._adaptIGadget(b)};ColumnLayout.prototype.removeIGadget=function(a,b){this._removeFromMatrix(this.matrix,a);DragboardLayout.prototype.removeIGadget.call(this,a,b)};ColumnLayout.prototype.initializeMove=function(g,a){a=a||null;if(this.igadgetToMove!=null){var h=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");LogManagerFactory.getInstance().log(h,Constants.WARN_MSG);this.cancelMove()}this.igadgetToMove=g;this.shadowPositions=new Array();var f=this.iGadgets.keys();for(var c=0;c<f.length;c++){this.shadowPositions[f[c]]=this.iGadgets[f[c]].getPosition().clone()}var c,b,d=0;this.shadowMatrix=new Array();this.searchInsertPointCache=new Array();for(c=0;c<this.columns;c++){this.searchInsertPointCache[c]=new Array();this.shadowMatrix[c]=this.matrix[c].clone()}this._removeFromMatrix(this.shadowMatrix,g);for(c=0;c<this.columns;c++){b=this.matrix[c].compact().last();if(!b){continue}tmp=b.getPosition().y+b.getHeight();if(tmp>d){d=tmp}}this.searchInsertPointYLimit=d+1;this.dragboardCursor=new DragboardCursor(g);this.dragboardCursor.paint(this.dragboard.dragboardElement);this._reserveSpace(this.matrix,this.dragboardCursor);if(a){a.setXOffset(this.fromHCellsToPixels(1)/2);a.setYOffset(this.getCellHeight())}};ColumnLayout.prototype._destroyCursor=function(a){if(this.dragboardCursor!=null){if(a){this._removeFromMatrix(this.matrix,this.dragboardCursor)}this.dragboardCursor.destroy();this.dragboardCursor=null}};ColumnLayout.prototype.disableCursor=function(){this._destroyCursor(true)};ColumnLayout.prototype._restorePositions=function(){this._clearMatrix();var c=this.iGadgets.keys();for(var a=0;a<c.length;a++){var b=this.iGadgets[c[a]];if(b!=this.igadgetToMove){b.setPosition(this._getPositionOn(this._matrix,b));this._reserveSpace(this.matrix,b)}}};ColumnLayout.prototype.moveTemporally=function(a,f){if(this.igadgetToMove==null){var d=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");LogManagerFactory.getInstance().log(d,Constants.WARN_MSG);return}var c=this.getColumns()-this.igadgetToMove.getWidth();if(a>c){a=c}if(this.dragboardCursor!=null){var b=this.dragboardCursor.getPosition();if((b.y!=f)||(b.x!=a)){this._restorePositions();this._insertAt(this.dragboardCursor,a,f)}}else{this.dragboardCursor=new DragboardCursor(this.igadgetToMove);this.dragboardCursor.paint(this.dragboard.dragboardElement);this._insertAt(this.dragboardCursor,a,f)}};ColumnLayout.prototype.cancelMove=function(){if(this.igadgetToMove==null){var b=gettext("Trying to cancel an inexistant temporal move.");LogManagerFactory.getInstance().log(b,Constants.WARN_MSG);return}this._destroyCursor(true);var a=this.igadgetToMove.getPosition();this._insertAt(this.igadgetToMove,a.x,a.y);this.shadowMatrix=null;this.igadgetToMove=null;this.dragboardCursor=null};ColumnLayout.prototype.acceptMove=function(){if(this.igadgetToMove==null){var c=gettext("Function acceptMove called when there is not an started igadget move.");LogManagerFactory.getInstance().log(c,Constants.WARN_MSG);return}var b=this.igadgetToMove.getPosition();var a=this.dragboardCursor.getPosition();this._destroyCursor(false);this.igadgetToMove.setPosition(a);this._reserveSpace(this.matrix,this.igadgetToMove);if(b.y!=a.y||b.x!=a.x){this.dragboard._commitChanges()}this.dragboard._notifyWindowResizeEvent();this.shadowMatrix=null;this.igadgetToMove=null;this.dragboardCursor=null};function SmartColumnLayout(c,f,b,a,d,g){ColumnLayout.call(this,c,f,b,a,d,g)}SmartColumnLayout.prototype=new ColumnLayout();SmartColumnLayout.prototype._realSearchInsertPoint=function(h,c,j,f,b){var g;if(j==0){return 0}else{if((h[c][j-1]!=null)&&(h[c][j-1]!=h[c][j])){return j}else{if(h[c][j]){var d=h[c][j].getWidth()-f;d-=c-this._getPositionOn(h,h[c][j]).x;if(d>0){j=this._getPositionOn(h,h[c][j]).y-1;while((j>=0)&&(this._hasSpaceFor(h,c,j,f,1))){j--}return ++j}if(d!=0){var a;for(;j>1;j--){for(a=0;a<f;a++){if(h[c+a][j]!=h[c+a][j-1]){if(h[c+a][j-1]){return j}}}}return 0}else{return this._getPositionOn(h,h[c][j]).y}}}}g=j;while((j>=0)&&(this._hasSpaceFor(h,c,j,f,1))){j--}if(j!=g){j++}else{var a;for(;j>1;j--){for(a=0;a<f;a++){if(h[c+a][j]!=h[c+a][j-1]){if(h[c+a][j-1]){return j}}}}return 0}return j};SmartColumnLayout.prototype._searchInsertPoint=function(d,b,f,c,a){if(f>this.searchInsertPointYLimit){f=this.searchInsertPointYLimit}if(!this.searchInsertPointCache[b][f]){this.searchInsertPointCache[b][f]=this._realSearchInsertPoint(d,b,f,c,a)}return this.searchInsertPointCache[b][f]};SmartColumnLayout.prototype.moveTemporally=function(a,f){if(this.igadgetToMove==null){var d=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");LogManagerFactory.getInstance().log(d,Constants.WARN_MSG);return}var c=this.getColumns()-this.igadgetToMove.getWidth();if(a>c){a=c}f=this._searchInsertPoint(this.shadowMatrix,a,f,this.igadgetToMove.getWidth(),this.igadgetToMove.getHeight());if(this.dragboardCursor!=null){var b=this.dragboardCursor.getPosition();if((b.y!=f)||(b.x!=a)){this._removeFromMatrix(this.matrix,this.dragboardCursor);this._insertAt(this.dragboardCursor,a,f)}}else{this.dragboardCursor=new DragboardCursor(this.igadgetToMove);this.dragboardCursor.paint(this.dragboard.dragboardElement);this._insertAt(this.dragboardCursor,a,f)}};SmartColumnLayout.prototype.initialize=function(){var a=ColumnLayout.prototype.initialize.call(this);var d;var c=this.iGadgets.keys();for(var b=0;b<c.length;b++){d=this.iGadgets[c[b]];a=a||this._moveSpaceUp(this.matrix,d)}if(a){this.dragboard._commitChanges(c)}};SmartColumnLayout.prototype._notifyWindowResizeEvent=function(b,a){if(b){DragboardLayout.prototype._notifyWindowResizeEvent.call(this,b,a)}};SmartColumnLayout.prototype._notifyResizeEvent=function(g,f,p,h,a,l,m){var o,n;var c=f;var k=g.getPosition();var t;t=k.x;if(h>f){c=f;var r=k.y+a;if(l){var j=h-f;for(o=k.x-j;o<k.x;++o){for(n=0;n<a;++n){var q=this.matrix[o][k.y+n];if(q!=null){this._moveSpaceDown(this.matrix,q,r-q.position.y);break}}}k.x-=j;if(m){g.setPosition(k)}this._reserveSpace2(this.matrix,g,k.x,k.y,j,a)}else{for(o=k.x+f;o<k.x+h;++o){for(n=0;n<a;++n){var q=this.matrix[o][k.y+n];if(q!=null){this._moveSpaceDown(this.matrix,q,r-q.position.y);break}}}this._reserveSpace2(this.matrix,g,k.x+f,k.y,h-f,a)}}else{if(h<f){c=h;var j=f-h;if(l){this._clearSpace2(this.matrix,k.x,k.y,j,p);n=k.y+p;var d=k.x+j;for(o=k.x;o<d;++o){if(this.matrix[o][n]!=null){this._moveSpaceUp(this.matrix,this.matrix[o][n])}}k.x+=j;if(m){g.setPosition(k)}t=k.x}else{this._clearSpace2(this.matrix,k.x+h,k.y,j,p);n=k.y+p;var d=k.x+f;for(o=k.x+h;o<d;++o){if(this.matrix[o][n]!=null){this._moveSpaceUp(this.matrix,this.matrix[o][n])}}}}}if(a>p){var b=k.y+a;var d=t+c;for(n=k.y+p;n<b;n++){for(o=t;o<d;o++){if(this.matrix[o][n]!=null){this._moveSpaceDown(this.matrix,this.matrix[o][n],b-n)}}}this._reserveSpace2(this.matrix,g,t,k.y+p,c,a-p)}else{if(a<p){this._clearSpace2(this.matrix,t,k.y+a,c,p-a);n=k.y+p;var d=t+c;for(o=t;o<d;o++){if(this.matrix[o][n]!=null){this._moveSpaceUp(this.matrix,this.matrix[o][n])}}}}this._notifyWindowResizeEvent(true,true);if(m){this._moveSpaceUp(this.matrix,g);this.dragboard._commitChanges()}};SmartColumnLayout.prototype._insertAt=function(b,a,c){ColumnLayout.prototype._insertAt.call(this,b,a,c);this._moveSpaceUp(this.matrix,b)};SmartColumnLayout.prototype._removeFromMatrix=function(b,c){this._clearSpace(b,c);var g=new Hash();var a,k,h,j;var d=this._getPositionOn(b,c);var f=d.y+c.getHeight();for(k=0;k<c.getWidth();k++){j=b[d.x+k].length;for(h=f;h<j;h++){a=b[d.x+k][h];if((a!=null)&&(g[a.code]==undefined)){g[a.code]=1;this._moveSpaceUp(b,a);break}}}};function FreeLayout(a,b){if(arguments.length==0){return}this.initialized=false;DragboardLayout.call(this,a,b)}FreeLayout.prototype=new DragboardLayout();FreeLayout.prototype.MAX_HLU=1000000;FreeLayout.prototype.fromPixelsToVCells=function(a){return a};FreeLayout.prototype.fromVCellsToPixels=function(a){return a};FreeLayout.prototype.getWidthInPixels=function(a){return this.fromHCellsToPixels(a)};FreeLayout.prototype.getHeightInPixels=function(a){return this.fromVCellsToPixels(a)};FreeLayout.prototype.fromPixelsToHCells=function(a){return(a*this.MAX_HLU/this.getWidth())};FreeLayout.prototype.fromHCellsToPixels=function(a){return Math.ceil((this.getWidth()*a)/this.MAX_HLU)};FreeLayout.prototype.fromHCellsToPercentage=function(a){return a/(this.MAX_HLU/100)};FreeLayout.prototype.getColumnOffset=function(a){return Math.ceil((this.getWidth()*a)/this.MAX_HLU)};FreeLayout.prototype.getRowOffset=function(a){return a};FreeLayout.prototype.adaptColumnOffset=function(b){var a=Math.ceil(this.fromPixelsToHCells(b));return new MultiValuedSize(this.fromHCellsToPixels(a),a)};FreeLayout.prototype.adaptRowOffset=function(a){return new MultiValuedSize(a,a)};FreeLayout.prototype.adaptHeight=function(a,b){return new MultiValuedSize(a,b)};FreeLayout.prototype.adaptWidth=function(b,c){var a=Math.floor(this.fromPixelsToHCells(c));return new MultiValuedSize(this.fromHCellsToPixels(a),a)};FreeLayout.prototype._notifyWindowResizeEvent=function(b,a){if(b){DragboardLayout.prototype._notifyWindowResizeEvent.call(this,b,a)}};FreeLayout.prototype._notifyResizeEvent=function(c,b,k,d,a,h,j){if(h){var g=d-b;var f=c.getPosition();f.x-=g;if(j){c.setPosition(f)}else{c._notifyWindowResizeEvent()}}if(j){this.dragboard._commitChanges([c.code])}};FreeLayout.prototype.initialize=function(){var d,c,b;var a=this.iGadgets.keys();for(c=0;c<a.length;c++){b=a[c];d=this.iGadgets[b];d.paint(true)}this.initialized=true};FreeLayout.prototype.getCellAt=function(a,b){return new DragboardPosition((a*this.MAX_HLU)/this.getWidth(),b)};FreeLayout.prototype.addIGadget=function(b,c){DragboardLayout.prototype.addIGadget.call(this,b,c);if(!this.initialized){return}var a=b.getPosition();if(a==null){a=new DragboardPosition(0,0)}b.setPosition(a);this._adaptIGadget(b)};FreeLayout.prototype.initializeMove=function(b,a){a=a||null;if(this.igadgetToMove!=null){var c=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");LogManagerFactory.getInstance().log(c,Constants.WARN_MSG);this.cancelMove()}this.igadgetToMove=b;this.newPosition=b.getPosition().clone();if(a){a.setXOffset(0);a.setYOffset(0)}};FreeLayout.prototype.moveTemporally=function(a,c){if(this.igadgetToMove==null){var b=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");LogManagerFactory.getInstance().log(b,Constants.WARN_MSG);return}this.newPosition.x=a;this.newPosition.y=c};FreeLayout.prototype.acceptMove=function(){if(this.igadgetToMove==null){var a=gettext("Function acceptMove called when there is not an started igadget move.");LogManagerFactory.getInstance().log(a,Constants.WARN_MSG);return}if(this.newPosition.x>(this.MAX_HLU-1)){this.newPosition.x=(this.MAX_HLU-1)}if(this.newPosition.y<0){this.newPosition.y=0}this.igadgetToMove.setPosition(this.newPosition);this.dragboard._notifyWindowResizeEvent();this.igadgetToMove._notifyWindowResizeEvent();this.dragboard._commitChanges([this.igadgetToMove.code]);this.igadgetToMove=null;this.newPosition=null};FreeLayout.prototype.cancelMove=function(){if(this.igadgetToMove==null){var a=gettext("Trying to cancel an inexistant temporal move.");LogManagerFactory.getInstance().log(a,Constants.WARN_MSG);return}this.igadgetToMove._notifyWindowResizeEvent();this.igadgetToMove=null;this.newPosition=null};FreeLayout.prototype.fillFloatingGadgetsMenu=function(c){var a=this.iGadgets.keys();if(a.length>0){for(i=0;i<a.length;i++){key=a[i];curIGadget=this.iGadgets[key];var b={igadget:curIGadget};c.addOption(null,curIGadget.name,function(){this.igadget.setMinimizeStatus(false);this.igadget.layout.dragboard.raiseToTop(this.igadget);LayoutManagerFactory.getInstance().hideCover()}.bind(b),i)}}else{c.addOption(null,gettext("No Floating Gadgets"),function(){},0)}};function FullDragboardLayout(a,b){if(arguments.length==0){return}this.initialized=false;DragboardLayout.call(this,a,b)}FullDragboardLayout.prototype=new DragboardLayout();FullDragboardLayout.prototype.fromPixelsToVCells=function(a){return 1};FullDragboardLayout.prototype.fromVCellsToPixels=function(a){return this.getHeight()};FullDragboardLayout.prototype.getWidthInPixels=function(a){return this.getWidth()};FullDragboardLayout.prototype.getHeightInPixels=function(a){return this.getHeight()};FullDragboardLayout.prototype.fromPixelsToHCells=function(a){return 1};FullDragboardLayout.prototype.fromHCellsToPixels=function(a){return this.getWidth()};FullDragboardLayout.prototype.fromHCellsToPercentage=function(a){return this.getHeight()};FullDragboardLayout.prototype.getColumnOffset=function(a){return this.dragboard.dragboardElement.getBoundingClientRect().left};FullDragboardLayout.prototype.getRowOffset=function(a){return this.dragboard.dragboardElement.getBoundingClientRect().top};FullDragboardLayout.prototype.adaptColumnOffset=function(a){return new MultiValuedSize(this.dragboard.dragboardElement.getBoundingClientRect().left,0)};FullDragboardLayout.prototype.adaptRowOffset=function(a){return new MultiValuedSize(this.dragboard.dragboardElement.getBoundingClientRect().top,0)};FullDragboardLayout.prototype.adaptHeight=function(a,c){var b=c-a;return new MultiValuedSize(a-b,1)};FullDragboardLayout.prototype.adaptWidth=function(a,b){return new MultiValuedSize(this.getWidth(),1)};FullDragboardLayout.prototype.initialize=function(){var d,c,b;var a=this.iGadgets.keys();for(c=0;c<a.length;c++){b=a[c];d=this.iGadgets[b];d.paint(true)}this.initialized=true};FullDragboardLayout.prototype.getCellAt=function(a,b){return new DragboardPosition(0,0)};FullDragboardLayout.prototype.addIGadget=function(a,b){a.element.addClassName("fulldragboard");DragboardLayout.prototype.addIGadget.call(this,a,b);if(!this.initialized){return}a.setPosition(new DragboardPosition(0,0))};FullDragboardLayout.prototype.removeIGadget=function(a,b){a.element.removeClassName("fulldragboard");DragboardLayout.prototype.removeIGadget.call(this,a,b)};FullDragboardLayout.prototype.initializeMove=function(b,a){if(this.igadgetToMove!=null){var c=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");LogManagerFactory.getInstance().log(c,Constants.WARN_MSG);this.cancelMove()}this.igadgetToMove=b};FullDragboardLayout.prototype.moveTemporally=function(a,c){if(this.igadgetToMove==null){var b=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");LogManagerFactory.getInstance().log(b,Constants.WARN_MSG);return}};FullDragboardLayout.prototype.acceptMove=function(){if(this.igadgetToMove==null){var a=gettext("Function acceptMove called when there is not an started igadget move.");LogManagerFactory.getInstance().log(a,Constants.WARN_MSG);return}this.igadgetToMove=null};FullDragboardLayout.prototype.cancelMove=function(){if(this.igadgetToMove==null){var a=gettext("Trying to cancel an inexistant temporal move.");LogManagerFactory.getInstance().log(a,Constants.WARN_MSG);return}this.igadgetToMove._notifyWindowResizeEvent();this.igadgetToMove=null;this.newPosition=null};FullDragboardLayout.prototype._notifyDragboardVisibilityChange=function(b){var d;var a=this.iGadgets.keys();if(b){for(var c=0;c<a.length;c++){d=this.iGadgets[a[c]];d.element.style.position=""}}else{for(var c=0;c<a.length;c++){d=this.iGadgets[a[c]];d.element.style.position="absolute"}}};function IGadget(d,a,q,k,h,j,p,b,o,g,f,c,l,n,m){this.id=a;this.code=null;this.name=q;this.gadget=d;this.position=h;this.contentWidth=b;this.contentHeight=o;this.loaded=false;this.zPos=p;this.transparency=c;this.draggable=null;this.visible=false;this.minimized=f;this.configurationVisible=false;if(g){this.minimized=false;this.previousContentWidth=this.contentWidth;this.previousHeight=this.contentHeight+k.getMenubarSize().inLU;this.previousLayout=k;this.previousPosition=this.position.clone();this.height=1;this.width=1;this.position.x=0;this.position.y=0;k=k.dragboard.fulldragboardLayout}else{if(!f){this.height=this.contentHeight}else{this.height=k.getMenubarSize().inLU}}this.refusedVersion=n;this.freeLayoutAfterLoading=m;this.element=null;this.gadgetMenu=null;this.contentWrapper=null;this.content=null;this.configurationElement=null;this.settingsButtonElement=null;this.minimizeButtonElement=null;this.errorButtonElement=null;this.igadgetNameHTMLElement=null;this.igadgetInputHTMLElement=null;this.statusBar=null;this.extractButton=null;this.iconElement=null;this.iconImg=null;this.igadgetIconNameHTMLElement=null;this.iconPosition=j;this.iconDraggable=null;this.extractOptionId=null;this.extractOptionOrder=0;this.lowerOpId=null;this.raiseOpId=null;this.lowerToBottomOpId=null;this.raiseToTopOpId=null;this.menu=null;this.errorCount=0;this.build();k.addIGadget(this,true);this.menu_color=l?l:"FFFFFF"}IGadget.prototype.getGadget=function(){return this.gadget};IGadget.prototype.setPosition=function(a){if(!this.iconPosition||this.iconPosition==this.position){this.setIconPosition(a)}this.position=a;if(this.element!=null){this.element.style.left=this.layout.getColumnOffset(a.x)+"px";this.element.style.top=this.layout.getRowOffset(a.y)+"px";var b=this.layout.dragboard.getWorkspace().getContextManager();b.notifyModifiedGadgetConcept(this,Concept.prototype.XPOSITION,this.position.x);b.notifyModifiedGadgetConcept(this,Concept.prototype.YPOSITION,this.position.y)}};IGadget.prototype.setIconPosition=function(a){this.iconPosition=a;if(this.iconElement){this.iconElement.style.left=this.layout.getColumnOffset(a.x)+"px";this.iconElement.style.top=this.layout.getRowOffset(a.y)+"px"}};IGadget.prototype.setZPosition=function(a){this.zPos=a;a=a!==null?a+1:"";if(this.element){this.element.style.zIndex=a}if(this.iconElement){this.iconElement.style.zIndex=a}};IGadget.prototype.getPosition=function(){return this.position};IGadget.prototype.getIconPosition=function(){return this.iconPosition};IGadget.prototype.getZPosition=function(a){return this.zPos};IGadget.prototype.getContentWidth=function(){return this.contentWidth};IGadget.prototype.getContentHeight=function(){return this.contentHeight};IGadget.prototype.getTab=function(){return this.layout.dragboard.tab};IGadget.prototype.getWidth=function(){return this.contentWidth};IGadget.prototype.getHeight=function(){return this.height};IGadget.prototype.getId=function(){return this.id};IGadget.prototype.getElement=function(){return this.element};IGadget.prototype.isVisible=function(){return this.visible};IGadget.prototype.onFreeLayout=function(){return this.layout.dragboard.freeLayout==this.layout};IGadget.prototype.toggleTransparency=function(){function g(){}function c(l,j){var h=LogManagerFactory.getInstance();var k=h.formatError(gettext("Error renaming igadget from persistence: %(errorMsg)s."),l,j);h.log(k)}this.element.toggleClassName("gadget_window_transparent");this.transparency=!this.transparency;var f=new Object();f.transparency=this.transparency;f.id=this.id;var b=Object.toJSON(f);var d={igadget:b};var a=URIs.GET_IGADGET.evaluate({workspaceId:this.layout.dragboard.workSpaceId,tabId:this.layout.dragboard.tabId,iGadgetId:this.id});PersistenceEngineFactory.getInstance().send_update(a,d,this,g,c)};IGadget.prototype._updateExtractOption=function(){if(this.extractOptionId==null){return}if(this.onFreeLayout()){this.menu.updateOption(this.extractOptionId,_currentTheme.getIconURL("igadget-snap"),gettext("Snap to grid"),function(){this.toggleLayout();LayoutManagerFactory.getInstance().hideCover()}.bind(this),"hide_on_lock hide_on_fulldragboard");this.extractButton.removeClassName("extractButton");this.extractButton.addClassName("snapButton");this.extractButton.setAttribute("title",gettext("This iGadget is outside the grid."))}else{this.menu.updateOption(this.extractOptionId,_currentTheme.getIconURL("igadget-extract"),gettext("Extract from grid"),function(){this.toggleLayout();LayoutManagerFactory.getInstance().hideCover()}.bind(this),"hide_on_lock hide_on_fulldragboard");this.extractButton.removeClassName("snapButton");this.extractButton.addClassName("extractButton");this.extractButton.setAttribute("title",gettext("This iGadget is aligned to the grid."))}};IGadget.prototype._updateFulldragboardOption=function(){if(this.fulldragboardOpId==null){return}if(this.isInFullDragboardMode()){this.menu.updateOption(this.fulldragboardOpId,_currentTheme.getIconURL("igadget-exit_fulldragboard"),gettext("Exit Full Dragboard"),function(){LayoutManagerFactory.getInstance().hideCover();this.setFullDragboardMode(!this.isInFullDragboardMode())}.bind(this),"hide_on_lock hide_on_minimize")}else{this.menu.updateOption(this.fulldragboardOpId,_currentTheme.getIconURL("igadget-fulldragboard"),gettext("Full Dragboard"),function(){LayoutManagerFactory.getInstance().hideCover();this.setFullDragboardMode(!this.isInFullDragboardMode())}.bind(this),"hide_on_lock hide_on_minimize")}};IGadget.prototype.build=function(){this.element=document.createElement("div");Element.extend(this.element);this.element.addClassName("gadget_window");this.gadgetMenu=document.createElement("div");Element.extend(this.gadgetMenu);this.gadgetMenu.addClassName("gadget_menu");this.gadgetMenu.observe("contextmenu",function(h){Event.stop(h)},true);this.gadgetMenu.setAttribute("title",this.name);var b;b=document.createElement("input");Element.extend(b);b.setAttribute("type","button");b.addClassName("closebutton");if(this.gadget.isContratable()){var f=function(){OpManagerFactory.getInstance().removeInstance(this.id);OpManagerFactory.getInstance().cancelServices(this.id);LayoutManagerFactory.getInstance().hideCover()}.bind(this);var a=function(){OpManagerFactory.getInstance().removeInstance(this.id);OpManagerFactory.getInstance().unsubscribeServices(this.id);LayoutManagerFactory.getInstance().hideCover()}.bind(this);b.observe("click",function(){LayoutManagerFactory.getInstance().showWindowMenu("cancelService",f,a)},false)}else{b.observe("click",function(){OpManagerFactory.getInstance().removeInstance(this.id)}.bind(this),false)}b.setAttribute("title",gettext("Close"));b.setAttribute("alt",gettext("Close"));this.gadgetMenu.appendChild(b);b=document.createElement("input");Element.extend(b);b.setAttribute("type","button");b.addClassName("settingsbutton");b.setAttribute("id","settingsbutton");b.observe("click",function(h){LayoutManagerFactory.getInstance().showDropDownMenu("igadgetOps",this.menu,Event.pointerX(h),Event.pointerY(h))}.bind(this),false);b.setAttribute("title",gettext("Menu"));b.setAttribute("alt",gettext("Menu"));this.gadgetMenu.appendChild(b);this.settingsButtonElement=b;b=document.createElement("input");Element.extend(b);b.setAttribute("type","button");b.observe("click",function(){this.toggleMinimizeStatus()}.bind(this),false);if(this.minimized){b.setAttribute("title",gettext("Maximize"));b.setAttribute("alt",gettext("Maximize"));b.addClassName("maximizebutton")}else{b.setAttribute("title",gettext("Minimize"));b.setAttribute("alt",gettext("Minimize"));b.addClassName("minimizebutton")}this.gadgetMenu.appendChild(b);this.minimizeButtonElement=b;b=document.createElement("input");Element.extend(b);b.setAttribute("type","button");b.addClassName("button errorbutton disabled");Event.observe(b,"click",function(){OpManagerFactory.getInstance().showLogs()},false);this.gadgetMenu.appendChild(b);this.errorButtonElement=b;if(!this.gadget.isUpToDate()&&!this.isRefusedUpgrade()){b=document.createElement("input");Element.extend(b);b.setAttribute("type","button");var g=gettext("There is a new version of this gadget available. Current version: %(currentVersion)s - Last version: %(lastVersion)s");g=interpolate(g,{currentVersion:this.gadget.getVersion(),lastVersion:this.gadget.getLastVersion()},true);b.setAttribute("title",g);b.setAttribute("id","version_button_"+this.id);b.addClassName("button versionbutton");Event.observe(b,"click",function(){var h=gettext('<p><b>Do you really want to update "%(igadgetName)s" to its latest version?</b><br />The gadget state and connections will be kept, if possible.<p>Note: It will reload your workspace</p>');h=interpolate(h,{igadgetName:this.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(h,this.upgradeIGadget.bind(this),this.askForIconVersion.bind(this))}.bind(this),false);this.gadgetMenu.appendChild(b)}this.fillWithLabel();this.element.appendChild(this.gadgetMenu);this.contentWrapper=document.createElement("div");Element.extend(this.contentWrapper);this.contentWrapper.addClassName("gadget_wrapper");this.element.appendChild(this.contentWrapper);this.configurationElement=document.createElement("div");Element.extend(this.configurationElement);this.configurationElement.addClassName("config_interface");this.contentWrapper.appendChild(this.configurationElement);var d=this.gadget.getXHtml().getURICode()+"?id="+this.id;if(BrowserUtilsFactory.getInstance().isIE()){this.content=document.createElement("iframe");Element.extend(this.content);this.content.addClassName("gadget_object");this.content.setAttribute("type","text/html");this.content.setAttribute("standby","Loading...");this.content.setAttribute("src",d);this.content.setAttribute("width","100%");this.content.setAttribute("frameBorder","0")}else{this.content=document.createElement("object");Element.extend(this.content);this.content.addClassName("gadget_object");this.content.setAttribute("type","text/html");this.content.setAttribute("standby","Loading...");this.content.setAttribute("data",d)}Element.extend(this.content);this.content.observe("load",function(){this.layout.dragboard.workSpace.igadgetLoaded(this.id)}.bind(this),true);this.contentWrapper.appendChild(this.content);this.statusBar=document.createElement("div");Element.extend(this.statusBar);this.statusBar.addClassName("statusBar");this.element.appendChild(this.statusBar);this.statusBar.observe("click",function(){this.layout.dragboard.raiseToTop(this)}.bind(this),false);var c;c=document.createElement("div");Element.extend(c);c.addClassName("leftResizeHandle");this.statusBar.appendChild(c);this.leftResizeHandle=new IGadgetResizeHandle(c,this,true);c=document.createElement("div");Element.extend(c);c.addClassName("rightResizeHandle");this.statusBar.appendChild(c);this.rightResizeHandle=new IGadgetResizeHandle(c,this,false);this.extractButton=document.createElement("div");Element.extend(this.extractButton);this.extractButton.className="button";this.extractButton.observe("click",function(){this.toggleLayout()}.bind(this),false);this.statusBar.appendChild(this.extractButton);this.wikilink=document.createElement("a");Element.extend(this.wikilink);this.wikilink.addClassName("dragboardwiki button");this.wikilink.href=this.gadget.getUriWiki();this.wikilink.setAttribute("target","_blank");this.wikilink.setAttribute("title",gettext("Access to Information"));this.statusBar.appendChild(this.wikilink);this.iconElement=document.createElement("div");Element.extend(this.iconElement);this.iconElement.addClassName("floating_gadget_icon");this.iconImg=document.createElement("img");Element.extend(this.iconImg);this.iconImg.addClassName("floating_gadget_img");this.iconImg.setAttribute("src",this.gadget.getIcon());this.iconElement.appendChild(this.iconImg);this.iconImg.ondrag=function(){return false};this.igadgetIconNameHTMLElement=document.createElement("a");Element.extend(this.igadgetIconNameHTMLElement);this.igadgetIconNameHTMLElement.update(this.name);this.igadgetIconNameHTMLElement.addClassName("floating_gadget_title");this.iconElement.appendChild(this.igadgetIconNameHTMLElement);this.igadgetIconNameHTMLElement.observe("click",function(){this.toggleMinimizeStatus(false);this.layout.dragboard.raiseToTop(this)}.bind(this),false)};IGadget.prototype.paint=function(f){if(this.visible){return}this.visible=true;this._createIGadgetMenu();this.element.style.visibility="hidden";this.layout.dragboard.dragboardElement.appendChild(this.element);var d=this.gadget.getXHtml().getURICode()+"?id="+this.id;if(BrowserUtilsFactory.getInstance().isIE()){this.content.setAttribute("src",d)}else{this.content.setAttribute("data",d)}this.element.style.left=this.layout.getColumnOffset(this.position.x)+"px";this.element.style.top=this.layout.getRowOffset(this.position.y)+"px";this.setZPosition(this.zPos);var c=this.minimized;this.minimized=false;this._recomputeSize(true);this.setMinimizeStatus(c,false,false);var b=this.layout.dragboard.isLocked();if(b){this._notifyLockEvent(true,false)}if(this.transparency){this.element.addClassName("gadget_window_transparent")}if(!this.onFreeLayout()||!c){this.element.style.visibility="visible"}this.draggable=new IGadgetDraggable(this);var a=this.layout.dragboard.getWorkspace().getContextManager();a.notifyModifiedGadgetConcept(this,Concept.prototype.XPOSITION,this.position.x);a.notifyModifiedGadgetConcept(this,Concept.prototype.YPOSITION,this.position.y);a.notifyModifiedGadgetConcept(this,Concept.prototype.HEIGHT,this.contentHeight);a.notifyModifiedGadgetConcept(this,Concept.prototype.WIDTH,this.contentWidth);a.notifyModifiedGadgetConcept(this,Concept.prototype.LOCKSTATUS,this.layout.dragboard.isLocked());this.setMenuColor(undefined,true);this.layout.dragboard.dragboardElement.appendChild(this.iconElement);this.iconDraggable=new IGadgetIconDraggable(this);this.iconElement.style.left=this.layout.getColumnOffset(this.iconPosition.x)+"px";this.iconElement.style.top=this.layout.getRowOffset(this.iconPosition.y)+"px";Event.observe(this.iconImg,"click",function(){if(this.layout.dragboard.isLocked()){this.setMinimizeStatus(false);this.layout.dragboard.raiseToTop(this)}}.bind(this),true)};IGadget.prototype._createIGadgetMenu=function(){var c="igadget_menu_"+this.id;var a=$(c);if(a){a.remove()}this.lowerOpId=null;a='<div id="'+c+'" class="drop_down_menu"></div>';new Insertion.After($("menu_layer"),a);this.menu=new DropDownMenu(c);var b="igadget_color_menu_"+this.id;this.colorMenu=IGadgetColorManager.genDropDownMenu(b,this.menu,this);this.menu.addOption(_currentTheme.getIconURL("igadget-settings"),gettext("Preferences"),function(){this.toggleConfigurationVisible();LayoutManagerFactory.getInstance().hideCover()}.bind(this),0);if(!this.is_shared_workspace()){this.menuColorEntryId=this.menu.addOption(_currentTheme.getIconURL("igadget-menu_colors"),gettext("Menu Bar Color..."),function(f){var d=$(this.menuColorEntryId);if(d.getBoundingClientRect!=undefined){var g=d.getBoundingClientRect().top}else{var g=document.getBoxObjectFor(d).screenY-document.getBoxObjectFor(document.documentElement).screenY}LayoutManagerFactory.getInstance().showDropDownMenu("igadgetOps",this.colorMenu,Event.pointerX(f),g+(d.offsetHeight/2))}.bind(this),1);this.transparencyEntryId=this.menu.addOption(_currentTheme.getIconURL("igadget-transparency"),gettext("Transparency"),function(){this.toggleTransparency();LayoutManagerFactory.getInstance().hideCover()}.bind(this),2);this.extractOptionOrder=2;this.extractOptionId=this.menu.addOption("","",function(){},this.extractOptionOrder,"hide_on_lock");this._updateExtractOption();this.lowerOpId=this.menu.addOption(_currentTheme.getIconURL("igadget-lower"),gettext("Lower"),function(){this.layout.dragboard.lower(this);LayoutManagerFactory.getInstance().hideCover()}.bind(this),this.extractOptionOrder+1,"hide_on_lock");this.raiseOpId=this.menu.addOption(_currentTheme.getIconURL("igadget-raise"),gettext("Raise"),function(){this.layout.dragboard.raise(this);LayoutManagerFactory.getInstance().hideCover()}.bind(this),this.extractOptionOrder+2,"hide_on_lock");this.lowerToBottomOpId=this.menu.addOption(_currentTheme.getIconURL("igadget-lower_to_bottom"),gettext("Lower To Bottom"),function(){this.layout.dragboard.lowerToBottom(this);LayoutManagerFactory.getInstance().hideCover()}.bind(this),this.extractOptionOrder+3,"hide_on_lock");this.raiseToTopOpId=this.menu.addOption(_currentTheme.getIconURL("igadget-raise_to_top"),gettext("Raise To Top"),function(){this.layout.dragboard.raiseToTop(this);LayoutManagerFactory.getInstance().hideCover()}.bind(this),this.extractOptionOrder+4,"hide_on_lock");this.fulldragboardOpOrder=this.extractOptionOrder+5;this.fulldragboardOpId=this.menu.addOption("","",function(){},this.fulldragboardOpOrder,"hide_on_lock");this._updateFulldragboardOption();if(this.isInFullDragboardMode()){this.menu.menu.addClassName("gadget_menu_fulldragboard")}}};IGadget.prototype.fillWithLabel=function(){if(this.igadgetInputHTMLElement!=null){this.igadgetInputHTMLElement.hide()}var a=this.name;if(a.length>30){a=a.substring(0,30)+"..."}if(this.igadgetNameHTMLElement!=null){this.igadgetNameHTMLElement.update(a);this.igadgetNameHTMLElement.show()}else{this.igadgetNameHTMLElement=document.createElement("span");Element.extend(this.igadgetNameHTMLElement);this.igadgetNameHTMLElement.innerHTML=a;this.gadgetMenu.appendChild(this.igadgetNameHTMLElement);this.igadgetNameHTMLElement.observe("click",function(b){Event.stop(b);this.layout.dragboard.raiseToTop(this);this.fillWithInput()}.bind(this))}};IGadget.prototype.fillWithInput=function(){if(!this.layout.dragboard.isLocked()){this.igadgetNameHTMLElement.hide();if(this.igadgetInputHTMLElement){this.igadgetInputHTMLElement.show();this.igadgetInputHTMLElement.setAttribute("value",this.name);this.igadgetInputHTMLElement.setAttribute("size",this.name.length+5)}else{this.igadgetInputHTMLElement=document.createElement("input");Element.extend(this.igadgetInputHTMLElement);this.igadgetInputHTMLElement.addClassName("igadget_name");this.igadgetInputHTMLElement.setAttribute("type","text");this.igadgetInputHTMLElement.setAttribute("value",this.name);this.igadgetInputHTMLElement.setAttribute("size",this.name.length+5);this.igadgetInputHTMLElement.setAttribute("maxlength",30);this.gadgetMenu.appendChild(this.igadgetInputHTMLElement);this.igadgetInputHTMLElement.observe("blur",function(a){Event.stop(a);this.fillWithLabel()}.bind(this));this.igadgetInputHTMLElement.observe("keypress",function(b){if(b.keyCode==Event.KEY_RETURN){Event.stop(b);var a=BrowserUtilsFactory.getInstance().getTarget(b);a.blur()}}.bind(this));this.igadgetInputHTMLElement.observe("change",function(b){var a=BrowserUtilsFactory.getInstance().getTarget(b);this.setName(a.value)}.bind(this));this.igadgetInputHTMLElement.observe("keyup",function(b){Event.stop(b);var a=BrowserUtilsFactory.getInstance().getTarget(b);a.size=(a.value.length==0)?1:a.value.length+5}.bind(this))}this.igadgetInputHTMLElement.focus()}};IGadget.prototype.setName=function(d){function h(){}function c(m,k){var j=LogManagerFactory.getInstance();var l=j.formatError(gettext("Error renaming igadget from persistence: %(errorMsg)s."),m,k);j.log(l)}if(d!=null&&d.length>0){this.name=d;this.gadgetMenu.setAttribute("title",d);this.igadgetNameHTMLElement.update(this.name);this.igadgetIconNameHTMLElement.update(this.name);var g=new Object();g.name=d;g.id=this.id;var b=Object.toJSON(g);var f={igadget:b};var a=URIs.GET_IGADGET.evaluate({workspaceId:this.layout.dragboard.workSpaceId,tabId:this.layout.dragboard.tabId,iGadgetId:this.id});PersistenceEngineFactory.getInstance().send_update(a,f,this,h,c)}};IGadget.prototype.notifyEvent=function(){if(this.isIconified()){this.layout.dragboard.raiseToTop(this);this.toggleMinimizeStatus(false)}};IGadget.prototype.isIconified=function(){return(this.layout instanceof FreeLayout&&this.minimized)};IGadget.prototype.askForIconVersion=function(){var a=gettext("Do you want to remove the notice of the new version available?");a=interpolate(a,{igadgetName:this.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(a,function(){this.setRefusedVersion(this.gadget.getLastVersion())}.bind(this))};IGadget.prototype.setRefusedVersion=function(c){function h(){}function d(m,k){var j=LogManagerFactory.getInstance();var l=j.formatError(gettext("Error setting the refused version of the igadget to persistence: %(errorMsg)s."),m,k);j.log(l)}this.refusedVersion=c;$("version_button_"+this.id).hide();var g=new Object;g.refused_version=this.refusedVersion;g.id=this.id;var b=Object.toJSON(g);var f={igadget:b};var a=URIs.GET_IGADGET.evaluate({workspaceId:this.layout.dragboard.workSpaceId,tabId:this.layout.dragboard.tabId,iGadgetId:this.id});PersistenceEngineFactory.getInstance().send_update(a,f,this,h,d)};IGadget.prototype.isRefusedUpgrade=function(){return this.refusedVersion&&this.refusedVersion==this.gadget.getLastVersion()};IGadget.prototype.upgradeIGadget=function(){function d(h){ShowcaseFactory.getInstance().reload(this.layout.dragboard.workSpaceId)}function b(k,h){var j=gettext('<p>Sorry but the "%(igadgetName)s" gadget <b>cannot be automatically updated</b> because its version is not compatible with the last version.<br/>If you want to update the gadget you must replace <b>by hand</b> the existing one with the gadget available in the catalogue.</p><b>Do you want to remove the notice of the new version available?</b>');j=interpolate(j,{igadgetName:this.name},true);LayoutManagerFactory.getInstance().showYesNoDialog(j,function(){this.setRefusedVersion(this.gadget.getLastVersion())}.bind(this))}var g=new Object;g.id=this.id;g.newResourceURL=this.gadget.getLastVersionURL();var c=Object.toJSON(g);var f={igadget:c};var a=URIs.PUT_IGADGET_VERSION.evaluate({workspaceId:this.layout.dragboard.workSpaceId,tabId:this.layout.dragboard.tabId,iGadgetId:this.id});PersistenceEngineFactory.getInstance().send_update(a,f,this,d,b)};IGadget.prototype.setMenuColor=function(b,c){c=c!=undefined?c:false;if(b==undefined){b=this.menu_color;c=true}this.gadgetMenu.style.backgroundColor=IGadgetColorManager.color2css(b);if(c){return}function j(){}function f(n,l){var k=LogManagerFactory.getInstance();var m=k.formatError(gettext("Error updating igadget's menu color into persistence: %(errorMsg)s."),n,l);k.log(m)}this.menu_color=b;var d=PersistenceEngineFactory.getInstance();var g=new Hash();g.id=this.id;g.menu_color=IGadgetColorManager.color2hex(this.menu_color);var h={igadget:g.toJSON()};var a=URIs.GET_IGADGET.evaluate({workspaceId:this.layout.dragboard.workSpaceId,tabId:this.layout.dragboard.tabId,iGadgetId:this.id});d.send_update(a,h,this,j,f)};IGadget.prototype.destroy=function(){if(this.draggable!==null){this.draggable.destroy();this.draggable=null}if(this.leftResizeHandle!==null){this.leftResizeHandle.destroy();this.leftResizeHandle=null}if(this.rightResizeHandle!==null){this.rightResizeHandle.destroy();this.rightResizeHandle=null}if(this.menu){this.menu.remove();this.menu=null}this.gadget=null;this.layout=null;this.position=null};IGadget.prototype.remove=function(){if(this.element!=null&&!this.layout.dragboard.isLocked()){function f(){}function d(k,h){var g=LogManagerFactory.getInstance();var j=g.formatError(gettext("Error removing igadget from persistence: %(errorMsg)s."),k,h);g.log(j)}var a=this.layout.dragboard;if(this.element.parentNode!=null){this.layout.removeIGadget(this,true)}this.element=null;var b=PersistenceEngineFactory.getInstance();var c=URIs.GET_IGADGET.evaluate({workspaceId:a.workSpaceId,tabId:a.tabId,iGadgetId:this.id});b.send_delete(c,this,f,d)}};IGadget.prototype._setDefaultPrefsInInterface=function(){var a=this.gadget.getTemplate().getUserPrefs();var c;for(var b=0;b<a.length;b++){c=a[b];c.setDefaultValueInInterface(this.prefElements[c.getVarName()])}};IGadget.prototype.setDefaultPrefs=function(){var b=this.gadget.getTemplate().getUserPrefs();var a=this.layout.dragboard.getWorkspace().getVarManager();for(var c=0;c<b.length;c++){b[c].setToDefault(a,this.id)}if(this.configurationVisible){this._setDefaultPrefsInInterface()}};IGadget.prototype._makeConfigureInterface=function(){var m=this.layout.dragboard.getWorkspace().getVarManager();var l=this.gadget.getTemplate().getUserPrefs();var a=document.createElement("div");if(l.length==0){a.innerHTML=gettext("This IGadget does not have any user prefs");return a}this.prefElements=new Array();var k,g,f,j=document.createElement("table");tbody=document.createElement("tbody");j.appendChild(tbody);for(var b=0;b<l.length;b++){k=document.createElement("tr");g=document.createElement("td");g.setAttribute("width","40%");f=l[b].getLabel();g.appendChild(f);k.appendChild(g);g=document.createElement("td");g.setAttribute("width","60%");curPrefInterface=l[b].makeInterface(m,this.id);this.prefElements[curPrefInterface.name]=curPrefInterface;Element.extend(this.prefElements[curPrefInterface.name]);g.appendChild(curPrefInterface);k.appendChild(g);tbody.appendChild(k)}a.appendChild(j);var d=document.createElement("div");Element.extend(d);d.addClassName("buttons");var c;c=document.createElement("input");Element.extend(c);c.setAttribute("type","button");c.setAttribute("value",gettext("Set Defaults"));Event.observe(c,"click",this._setDefaultPrefsInInterface.bind(this),true);d.appendChild(c);c=document.createElement("input");Element.extend(c);c.setAttribute("type","button");c.setAttribute("value",gettext("Save"));c.observe("click",function(){this.layout.dragboard.saveConfig(this.id)}.bind(this),true);d.appendChild(c);c=document.createElement("input");Element.extend(c);c.setAttribute("type","button");c.setAttribute("value",gettext("Cancel"));c.observe("click",function(){this.setConfigurationVisible(false)}.bind(this),true);d.appendChild(c);a.appendChild(d);var h=document.createElement("div");Element.extend(h);h.addClassName("floatclearer");a.appendChild(h);return a};IGadget.prototype.setContentSize=function(c,b,d){d=d!=undefined?d:true;if(!this.element){this.contentWidth=c;this.contentHeight=b;return}var f=this.getHeight();var a=this.getWidth();this.contentWidth=c;this.contentHeight=b;this._recomputeSize(true);this.layout._notifyResizeEvent(this,a,f,this.getWidth(),this.getHeight(),false,d)};IGadget.prototype._notifyWindowResizeEvent=function(){if(!this.element){return}var d=this.getHeight();var b=this.getWidth();this.element.style.left=this.layout.getColumnOffset(this.position.x)+"px";this.element.style.top=this.layout.getRowOffset(this.position.y)+"px";this._recomputeSize(true);var a=this.getHeight();var c=this.getWidth();if((d!=a)||(b!=c)){this.layout._notifyResizeEvent(this,b,d,c,a,false,false)}};IGadget.prototype._notifyLockEvent=function(d,b){if(!this.element){return}var a=this.getWidth();var f=this.getHeight();if(d){this.element.addClassName("gadget_window_locked");this.menu.menu.addClassName("gadget_menu_locked")}else{this.element.removeClassName("gadget_window_locked");this.menu.menu.removeClassName("gadget_menu_locked")}this._recomputeHeight(false);var c=this.layout.dragboard.getWorkspace().getContextManager();c.notifyModifiedGadgetConcept(this,Concept.prototype.LOCKSTATUS,d);b=b!=null?b:true;if(b){this.layout._notifyResizeEvent(this,a,f,this.getWidth(),this.getHeight(),false)}};IGadget.prototype._notifyLoaded=function(){if(window.IE7){IE7.recalc()}if(this.loaded){return}this.loaded=true;if(this.errorCount>0){var b=ngettext('%(errorCount)s error for the iGadget "%(name)s" was notified before it was loaded','%(errorCount)s errors for the iGadget "%(name)s" were notified before it was loaded',this.errorCount);b=interpolate(b,{errorCount:this.errorCount,name:this.name},true);LogManagerFactory.getInstance().log(b);this.errorButtonElement.removeClassName("disabled");this._updateErrorInfo()}var a;if(BrowserUtilsFactory.getInstance().isIE()){a=this.content}else{a=this.content.contentDocument.defaultView}Event.observe(a,"unload",function(){OpManagerFactory.getInstance().igadgetUnloaded(this.id)}.bind(this),true);if(this.freeLayoutAfterLoading){this.toggleLayout()}};IGadget.prototype._notifyUnloaded=function(){if(!this.loaded){return}this.loaded=false};IGadget.prototype._recomputeWidth=function(){var b=this.layout.getWidthInPixels(this.contentWidth);b-=this._computeExtraWidthPixels();if(b<0){b=0}this.element.style.width=b+"px";var a=this.layout.dragboard.getWorkspace().getContextManager();a.notifyModifiedGadgetConcept(this,Concept.prototype.WIDTHINPIXELS,b)};IGadget.prototype._recomputeWrapper=function(a){var b;if(!this.minimized){a=a?a:parseInt(this.content.offsetHeight);b=a+this.configurationElement.offsetHeight}else{b=0}this.contentWrapper.setStyle({height:b+"px"})};IGadget.prototype._computeExtraWidthPixels=function(){var a=document.defaultView.getComputedStyle(this.element,null);var b=a.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX);b+=a.getPropertyCSSValue("border-right-width").getFloatValue(CSSPrimitiveValue.CSS_PX);return b};IGadget.prototype._computeExtraHeightPixels=function(){var b=document.defaultView.getComputedStyle(this.element,null);var d=b.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);d+=b.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);var c=document.defaultView.getComputedStyle(this.gadgetMenu,null);d+=c.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);d+=c.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);var a=document.defaultView.getComputedStyle(this.statusBar,null);d+=a.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);d+=a.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);return d};IGadget.prototype._recomputeHeight=function(d){var c;var b=this.layout.dragboard.getWorkspace().getContextManager();var g=this.height;if(!this.minimized){if(d){c=this.layout.fromVCellsToPixels(this.contentHeight);var f=c;f+=this.gadgetMenu.offsetHeight+this.statusBar.offsetHeight+this.configurationElement.offsetHeight;f+=this._computeExtraHeightPixels();var a=this.layout.adaptHeight(c,f);c=a.inPixels;this.height=a.inLU;this.content.setStyle({height:c+"px"})}else{c=this.layout.getHeightInPixels(this.height);c-=this.configurationElement.offsetHeight+this.gadgetMenu.offsetHeight+this.statusBar.offsetHeight;c-=this._computeExtraHeightPixels();if(c<0){c=0}this.content.setStyle({height:c+"px"});this.contentHeight=Math.floor(this.layout.fromPixelsToVCells(c))}this._recomputeWrapper(c);b.notifyModifiedGadgetConcept(this,Concept.prototype.HEIGHTINPIXELS,c)}else{this._recomputeWrapper();c=this.element.offsetHeight;this.content.setStyle({height:"0px"});this.height=Math.ceil(this.layout.fromPixelsToVCells(c))}if(g!==this.height){b.notifyModifiedGadgetConcept(this,Concept.prototype.HEIGHT,this.height)}};IGadget.prototype._recomputeSize=function(a){this._recomputeWidth();this._recomputeHeight(a)};IGadget.prototype.setSize=function(f,b,d,g){d=d!=undefined?d:false;g=g!=undefined?g:true;if(!this.element){this.contentWidth=f;this.height=b;return}var a=this.getWidth();var h=this.getHeight();this.contentWidth=f;this.height=b;this._recomputeSize(false);if(g){var c=this.layout.dragboard.getWorkspace().getContextManager();c.notifyModifiedGadgetConcept(this,Concept.prototype.HEIGHT,this.contentHeight);c.notifyModifiedGadgetConcept(this,Concept.prototype.WIDTH,this.contentWidth);c.notifyModifiedGadgetConcept(this,Concept.prototype.HEIGHTINPIXELS,this.content.offsetHeight);c.notifyModifiedGadgetConcept(this,Concept.prototype.WIDTHINPIXELS,this.content.offsetWidth)}this.layout._notifyResizeEvent(this,a,h,this.contentWidth,this.height,d,g)};IGadget.prototype.isMinimized=function(){return this.minimized};IGadget.prototype.setMinimizeStatus=function(b,c,a){if(this.minimized==b){return}this.minimized=b;if(this.minimized){this.menu.menu.addClassName("gadget_menu_minimized");this.configurationElement.setStyle({display:"none"});if(this.onFreeLayout()){this.element.setStyle({visibility:"hidden"});this.iconElement.setStyle({display:"block"})}else{this.contentWrapper.setStyle({visibility:"hidden",border:"0px"});this.statusBar.setStyle({display:"none"});this.minimizeButtonElement.setAttribute("title",gettext("Maximize"));this.minimizeButtonElement.setAttribute("alt",gettext("Maximize"));this.minimizeButtonElement.removeClassName("minimizebutton");this.minimizeButtonElement.addClassName("maximizebutton")}}else{this.menu.menu.removeClassName("gadget_menu_minimized");if(this.configurationVisible==true){this.configurationElement.setStyle({display:"block"})}this.minimizeButtonElement.setAttribute("title",gettext("Minimize"));this.minimizeButtonElement.setAttribute("alt",gettext("Minimize"));this.minimizeButtonElement.removeClassName("maximizebutton");this.minimizeButtonElement.addClassName("minimizebutton");this.contentWrapper.setStyle({visibility:"visible",border:""});if(this.onFreeLayout()){this.element.setStyle({visibility:"visible"});this.iconElement.setStyle({display:"none"})}else{this.statusBar.setStyle({display:""})}}var f=this.getHeight();this._recomputeHeight(true);a=a!=null?a:true;if(a){var d=c;if(d==null){d=true}this.layout._notifyResizeEvent(this,this.contentWidth,f,this.contentWidth,this.getHeight(),false,d,a)}};IGadget.prototype.isInFullDragboardMode=function(){return this.layout instanceof FullDragboardLayout};IGadget.prototype.setFullDragboardMode=function(b){if(this.isInFullDragboardMode()==b){return}var a=this.layout.dragboard;if(b){this.previousContentWidth=this.contentWidth;this.previousHeight=this.height;this.previousLayout=this.layout;this.previousPosition=this.position.clone();this.moveToLayout(a.fulldragboardLayout);a.raiseToTop(this);this.menu.menu.addClassName("gadget_menu_fulldragboard")}else{this.moveToLayout(this.previousLayout);this.menu.menu.removeClassName("gadget_menu_fulldragboard")}};IGadget.prototype.toggleMinimizeStatus=function(a){this.setMinimizeStatus(!this.minimized,a)};IGadget.prototype._updateErrorInfo=function(){label=ngettext("%(errorCount)s error","%(errorCount)s errors",this.errorCount);label=interpolate(label,{errorCount:this.errorCount},true);this.errorButtonElement.setAttribute("title",label)};IGadget.prototype.notifyError=function(){this.errorCount++;if(this.isVisible()){if(this.errorCount==1){this.errorButtonElement.removeClassName("disabled")}this._updateErrorInfo()}};IGadget.prototype.toggleLayout=function(){if(this.onFreeLayout()){this.moveToLayout(this.layout.dragboard.baseLayout)}else{this.moveToLayout(this.layout.dragboard.freeLayout)}};IGadget.prototype.isConfigurationVisible=function(){return this.configurationVisible};IGadget.prototype.setConfigurationVisible=function(a){if(this.configurationVisible==a){return}this.configurationVisible=a;if(a==true){this.configurationElement.appendChild(this._makeConfigureInterface());if(this.isMinimized()){this.configurationElement.setStyle({display:"none"})}else{this.configurationElement.setStyle({display:"block"})}this.settingsButtonElement.removeClassName("settingsbutton");this.settingsButtonElement.addClassName("settings2button")}else{this.configurationElement.innerHTML="";this.configurationElement.hide();this.settingsButtonElement.removeClassName("settings2button");this.settingsButtonElement.addClassName("settingsbutton")}var b=this.getHeight();this._recomputeHeight(true);this.layout._notifyResizeEvent(this,this.contentWidth,b,this.contentWidth,this.getHeight(),true)};IGadget.prototype.toggleConfigurationVisible=function(){this.setConfigurationVisible(!this.configurationVisible)};IGadget.prototype.saveConfig=function(){if(this.configurationVisible==false){throw new Error("")}var k=this.layout.dragboard.getWorkspace().getVarManager();var f,a,h,g=true;var j=this.gadget.getTemplate().getUserPrefs();var d=null;for(f=0;f<j.length;f++){a=j[f];d=a.getVarName();h=this.prefElements[d];if(!a.validate(a.getValueFromInterface(h))){g=false;h.addClassName("invalid")}else{h.removeClassName("invalid")}}if(!g){throw new Error("Invalid data found")}k.incNestingLevel();var b,c;for(f=0;f<j.length;f++){a=j[f];d=a.getVarName();h=this.prefElements[d];var b=a.getCurrentValue(k,this.id);var c=a.getValueFromInterface(h);if(c!=b){a.annotate(k,this.id,c)}}for(f=0;f<j.length;f++){a=j[f];d=a.getVarName();h=this.prefElements[d];var b=a.getCurrentValue(k,this.id);var c=a.getValueFromInterface(h);a.setValue(k,this.id,c)}k.decNestingLevel();this.setConfigurationVisible(false)};IGadget.prototype.is_shared_workspace=function(){return this.layout.dragboard.getWorkspace().isShared()};IGadget.prototype.save=function(){function f(h){var g=JSON.parse(h.responseText);this.id=g.id;this.layout.dragboard.addIGadget(this,g)}function c(k,h){var g=LogManagerFactory.getInstance();var j=g.formatError(gettext("Error adding igadget to persistence: %(errorMsg)s."),k,h);g.log(j);this.layout.removeIGadget(this,true);this.destroy()}var a=PersistenceEngineFactory.getInstance();var d=new Hash();d.left=this.position.x;d.top=this.position.y;d.icon_left=this.iconPosition.x;d.icon_top=this.iconPosition.y;d.zIndex=this.zPos;d.width=this.contentWidth;d.height=this.contentHeight;d.name=this.name;d.menu_color=IGadgetColorManager.color2css(this.menu_color).substring(1,7);if(this.onFreeLayout()){d.layout=1}else{d.layout=0}var b=URIs.POST_IGADGET.evaluate({tabId:this.layout.dragboard.tabId,workspaceId:this.layout.dragboard.workSpaceId});d.uri=b;d.gadget=URIs.GET_GADGET.evaluate({vendor:this.gadget.getVendor(),name:this.gadget.getName(),version:this.gadget.getVersion()});d={igadget:d.toJSON()};a.send_post(b,d,this,f,c)};IGadget.prototype.moveToLayout=function(m){if(this.layout==m){return}var q=false;if(this.minimized){q=true;this.toggleMinimizeStatus()}var c=this.element.offsetWidth;var o=c;c-=this._computeExtraWidthPixels();var p=this.content.offsetHeight;var n=p;n+=this.gadgetMenu.offsetHeight+this.statusBar.offsetHeight+this.configurationElement.offsetHeight;n+=this._computeExtraHeightPixels();var l=this.layout.dragboard!=m.dragboard;var j=this.layout;if(l){OpManagerFactory.getInstance().igadgetUnloaded(this.id)}j.removeIGadget(this,l);if(l&&!(m instanceof FreeLayout)){this.position=null}else{if(j instanceof FullDragboardLayout){this.position=this.previousPosition}else{this.position.x=j.getColumnOffset(this.position.x);this.position.x=m.adaptColumnOffset(this.position.x).inLU;this.position.y=j.getRowOffset(this.position.y);this.position.y=m.adaptRowOffset(this.position.y).inLU}}if(j instanceof FullDragboardLayout){this.contentWidth=this.previousContentWidth;this.height=this.previousHeight}else{var g=m.adaptWidth(c,o);this.contentWidth=g.inLU;var b=m.adaptHeight(p,n);this.height=b.inLU}m.addIGadget(this,l);this._updateExtractOption();if(j instanceof FullDragboardLayout||m instanceof FullDragboardLayout){this._updateFulldragboardOption()}if(q){this.toggleMinimizeStatus()}if(!this.loaded&&BrowserUtilsFactory.getInstance().isIE()){this.content.src=this.content.src}if(!l){m.dragboard._notifyWindowResizeEvent()}var k=function(r){};var h=function(v,t){var r=LogManagerFactory.getInstance();var u=r.formatError(gettext("Error saving changes to persistence: %(errorMsg)s."),v,t);r.log(u)};var f=new Hash();f.iGadgets=new Array();var d=new Hash();d.id=this.id;if(!(m instanceof FullDragboardLayout)){d.top=this.position.y;d.left=this.position.x;d.width=this.contentWidth;d.height=this.contentHeight;if(this.onFreeLayout()){d.layout=1}else{d.layout=0}d.fulldragboard=false}else{d.fulldragboard=true}d.icon_top=this.iconPosition.y;d.icon_left=this.iconPosition.x;d.zIndex=this.zPos;d.tab=this.layout.dragboard.tabId;f.iGadgets.push(d);f={igadgets:f.toJSON()};var a=PersistenceEngineFactory.getInstance();uri=URIs.GET_IGADGETS.evaluate({workspaceId:j.dragboard.workSpaceId,tabId:j.dragboard.tabId});a.send_update(uri,f,this,k,h)};function IGadgetColorManager(){this.colors=["FFFFFF","EFEFEF","DDDDDD","97A0A8","FF9999","FF3333","FFD4AA","FFD42A","FFFFCC","FFFF66","CCFFCC","A8D914","D4E6FC","CCCCFF","349EE8","FFCCFF","FF99FF"]}IGadgetColorManager.prototype.autogenColor=function(b,a){if(b===undefined||b===null){return this.colors[a%this.colors.length]}else{return b}};IGadgetColorManager.prototype.genDropDownMenu=function(h,b,g){var d=function(j){g.setMenuColor(j,true)};var a=function(j){g.setMenuColor(j,false)};var f=new ColorDropDownMenu(h,b,a,{onMouseOver:d,onMouseOut:d});for(var c=0;c<this.colors.length;c++){f.appendColor(this.colors[c])}return f};IGadgetColorManager.prototype.color2css=function(a){if(typeof a==="string"){return"#"+a}else{return"rgb("+a.red.cssText+", "+a.green.cssText+", "+a.blue.cssText+")"}};IGadgetColorManager.prototype.color2hex=function(b){if(typeof b==="string"){return b}else{function a(c){return"0123456789ABCDEF".charAt(Math.floor(c/16))+"0123456789ABCDEF".charAt(c%16)}return a(b.red.cssText)+a(b.green.cssText)+a(b.blue.cssText)}};IGadgetColorManager=new IGadgetColorManager();function Dragboard(b,c,a){this.loaded=false;this.currentCode=1;this.scrollbarSpace=17;this.dragboardElement;this.dragboardWidth=800;this.dragboardHeight=600;this.baseLayout=null;this.freeLayout=null;this.gadgetToMove=null;this.iGadgets=new Hash();this.iGadgetsByCode=new Hash();this.tab=b;this.tabId=b.tabInfo.id;this.workSpace=c;this.workSpaceId=c.workSpaceState.id;this.fixed=false;Dragboard.prototype.paint=function(){this.dragboardElement.innerHTML="";if(BrowserUtilsFactory.getInstance().getBrowser()=="IE6"){IE7.recalc()}this._recomputeSize();this.baseLayout.initialize();this.freeLayout.initialize();this.fulldragboardLayout.initialize();var d=this.orderList.length;this.orderList=this.orderList.compact();if(d!=this.orderList.length){for(i=0;i<this.orderList.length;i++){this.orderList[i].setZPosition(i)}}this.tab.mark_as_painted()};this._commitChanges=function(p){p=p||this.iGadgetsByCode.keys();var n=function(q){};var l=function(u,r){var q=LogManagerFactory.getInstance();var t=q.formatError(gettext("Error committing dragboard changes to persistence: %(errorMsg)s."),u,r);q.log(t)};var k,f,g,m;var j=new Hash();j.iGadgets=new Array();for(var h=0;h<p.length;h++){k=this.iGadgetsByCode[p[h]];f=new Hash();m=k.getPosition();f.id=k.id;f.tab=this.tabId;if(!this.workSpace.isShared()){f.minimized=k.isMinimized()}if(!k.isInFullDragboardMode()){f.top=k.position.y;f.left=k.position.x;f.width=k.contentWidth;f.height=k.contentHeight;f.fulldragboard=false}else{f.fulldragboard=true}var o=k.getIconPosition();f.icon_top=o.y;f.icon_left=o.x;j.iGadgets.push(f)}j={igadgets:j.toJSON()};var d=PersistenceEngineFactory.getInstance();g=URIs.GET_IGADGETS.evaluate({workspaceId:this.workSpaceId,tabId:this.tabId});d.send_update(g,j,this,n,l)};Dragboard.prototype._buildLayoutFromPreferences=function(h){var f=this.tab.preferences.get("columns");var g=this.tab.preferences.get("cell-height");var j=this.tab.preferences.get("vertical-margin");var d=this.tab.preferences.get("horizontal-margin");if(this.tab.preferences.get("smart")){return new SmartColumnLayout(this,f,g,j,d)}else{return new ColumnLayout(this,f,g,j,d)}};Dragboard.prototype._updateBaseLayout=function(){var d=this._buildLayoutFromPreferences();d._notifyWindowResizeEvent(true,true);d.initialize();this.baseLayout.moveTo(d);this.baseLayout.destroy();this.baseLayout=d};Dragboard.prototype._themeLoaded=function(){var d=this.iGadgets.keys();for(var f=0;f<d.length;f++){iGadget=this.iGadgets[d[f]];iGadget._createIGadgetMenu()}};Dragboard.prototype._notifyVisibilityChange=function(d){if(this.baseLayout){this.baseLayout._notifyDragboardVisibilityChange(d)}if(this.freeLayout){this.freeLayout._notifyDragboardVisibilityChange(d)}if(this.fulldragboardLayout){this.fulldragboardLayout._notifyDragboardVisibilityChange(d)}if(!d){LayoutManagerFactory.getInstance().hideView(this.dragboardElement)}else{this._notifyWindowResizeEvent()}};Dragboard.prototype.getWidth=function(){return this.dragboardWidth};Dragboard.prototype.getHeight=function(){return this.dragboardHeight};Dragboard.prototype.destroy=function(){this.baseLayout.destroy();this.freeLayout.destroy();this.baseLayout=null;this.freeLayout=null;var f=this.iGadgets.keys();for(var d=0;d<f.length;d++){this.workSpace.removeIGadgetData(f[d])}this.iGadgets=null;this.iGadgetsByCode=null;Element.remove(this.dragboardElement)};Dragboard.prototype.isLocked=function(){return this.fixed};Dragboard.prototype.setLock=function(h){if(this.fixed==h){return}this.fixed=h;if(this.fixed){this.dragboardElement.addClassName("fixed")}else{this.dragboardElement.removeClassName("fixed")}var g;var d=this.iGadgets.keys();for(var f=0;f<d.length;f++){g=this.iGadgets[d[f]];g._notifyLockEvent(this.fixed)}};Dragboard.prototype.toggleLock=function(){this.setFixed(!this.fixed)};Dragboard.prototype.parseTab=function(n){var u,k,q,v,d,r,f,g,t,h,l,m,p;var o=OpManagerFactory.getInstance();this.currentCode=1;this.iGadgets=new Hash();this.iGadgetsByCode=new Hash();if(b.preferences.get("locked")||this.workSpace.isShared()){this.fixed=true;this.dragboardElement.addClassName("fixed")}for(var j=0;j<n.igadgetList.length;j++){u=n.igadgetList[j];t=u.gadget.split("/");t=t[2]+"_"+t[3]+"_"+t[4];g=ShowcaseFactory.getInstance().getGadget(t);d=parseInt(u.width);r=parseInt(u.height);k=new DragboardPosition(parseInt(u.left),parseInt(u.top));q=new DragboardPosition(parseInt(u.icon_left),parseInt(u.icon_top));v=parseInt(u.zIndex);if(u.layout==0){l=this.baseLayout}else{l=this.freeLayout}f=new IGadget(g,u.id,u.name,l,k,q,v,d,r,u.fulldragboard,u.minimized,u.transparency,u.menu_color,u.refused_version,false)}this.loaded=true};Dragboard.prototype.addInstance=function(h){if((h==null)||!(h instanceof Gadget)){return}if(this.isLocked()){var g=gettext("The destination tab (%(tabName)s) is locked. Try to unlock it or select an unlocked tab.");g=interpolate(g,{tabName:this.tab.tabInfo.name},true);LayoutManagerFactory.getInstance().showMessageMenu(g,Constants.Logging.WARN_MSG);return}var n=h.getTemplate();var f=n.getWidth();var o=n.getHeight();var j=false;var m=false;var l=this.baseLayout;if(this.tab.preferences.get("layout")=="Free"){j=false;m=true}if(l instanceof ColumnLayout){var p=l.getColumns();if(f>p){f=p}}var d=h.getDisplayName()+" ("+this.currentCode+")";var k=new IGadget(h,null,d,l,null,null,null,f,o,false,j,false,h.getMenuColor(),null,m);k.save()};Dragboard.prototype.getNumberOfIGadgets=function(){return this.iGadgets.keys().length};Dragboard.prototype.removeInstance=function(d){var f=this.iGadgets[d];f.remove();f.destroy()};Dragboard.prototype.saveConfig=function(d){var f=this.iGadgets[d];try{f.saveConfig();f.setConfigurationVisible(false)}catch(g){}};Dragboard.prototype.setDefaultPrefs=function(d){var f=this.iGadgets[d];f.setDefaultPrefs()};Dragboard.prototype.notifyErrorOnIGadget=function(d){var f=this.iGadgets[d];f.notifyError()};Dragboard.prototype.getIGadgets=function(){return this.iGadgets.values()};Dragboard.prototype.getIGadget=function(d){return this.iGadgets[d]};Dragboard.prototype.getWorkspace=function(){return this.workSpace};Dragboard.prototype._registerIGadget=function(f){if(f.id){this.iGadgets[f.id]=f}f.code=this.currentCode++;this.iGadgetsByCode[f.code]=f;var g=f.getZPosition();if(g!=null){if(this.orderList[g]!=undefined){this.orderList.splice(g,1,this.orderList[g],f);for(var d=g+1;d<this.orderList.length;d++){if(this.orderList[d]!=undefined){this.orderList[d].setZPosition(d)}}}else{this.orderList[g]=f}}else{g=this.orderList.length;f.setZPosition(g);this.orderList[g]=f}};Dragboard.prototype._deregisterIGadget=function(f){delete this.iGadgets[f.id];delete this.iGadgetsByCode[f.code];var g=f.getZPosition();this.orderList.splice(g,1);f.setZPosition(null);for(var d=g;d<this.orderList.length;d++){this.orderList[d].setZPosition(d)}f.code=null};Dragboard.prototype.addIGadget=function(g,f){if(!this.iGadgetsByCode[g.code]){throw new Exception()}this.iGadgets[g.id]=g;var h=g.getHeight();var d=g.getWidth();this.workSpace.addIGadget(this.tab,g,f);g.layout._notifyResizeEvent(g,d,h,g.getWidth(),g.getHeight(),false,true)};Dragboard.prototype.fillFloatingGadgetsMenu=function(d){this.freeLayout.fillFloatingGadgetsMenu(d)};Dragboard.prototype.lowerToBottom=function(g){var d=g.getZPosition();delete this.orderList[d];this.orderList=[g].concat(this.orderList).compact();for(var f=0;f<this.orderList.length;f++){this.orderList[f].setZPosition(f)}this._commitChanges()};Dragboard.prototype.lower=function(g){var f=g.getZPosition();if(f==0){return}var d=this.orderList[f-1];this.orderList[f-1]=g;this.orderList[f]=d;g.setZPosition(f-1);d.setZPosition(f);this._commitChanges([g.code,d.code])};Dragboard.prototype.raiseToTop=function(h){var g=h.getZPosition();var d=this.orderList.length-1;if(g==d){return}delete this.orderList[g];this.orderList.push(h);this.orderList=this.orderList.compact();var f=0;for(;f<this.orderList.length;f++){this.orderList[f].setZPosition(f)}this._commitChanges()};Dragboard.prototype.raise=function(f){var d=f.getZPosition();if(d==(this.orderList.length-1)){return}var g=this.orderList[d+1];this.orderList[d+1]=f;this.orderList[d]=g;f.setZPosition(d+1);g.setZPosition(d);this._commitChanges([f.code,g.code])};this.dragboardElement=a;this.orderList=new Array();this._notifyWindowResizeEvent=function(){var g=this.dragboardWidth;var k=this.dragboardHeight;this._recomputeSize();var h=this.dragboardWidth;var f=this.dragboardHeight;var j=g!==h;var d=k!==f;if(j||d){this._updateIGadgetSizes(j,d)}}.bind(this);this.baseLayout=this._buildLayoutFromPreferences();this.freeLayout=new FreeLayout(this);this.fulldragboardLayout=new FullDragboardLayout(this);this.parseTab(b.tabInfo)}Dragboard.prototype._recomputeSize=function(){var a=document.defaultView.getComputedStyle(this.dragboardElement,null);if(a.getPropertyValue("display")=="none"){return}if(BrowserUtilsFactory.getInstance().isIE()){this.dragboardWidth=parseInt(this.dragboardElement.offsetWidth)}else{this.dragboardWidth=parseInt(this.dragboardElement.clientWidth)}this.dragboardHeight=parseInt($("wrapper").clientHeight)};Dragboard.prototype._updateIGadgetSizes=function(b,a){this.baseLayout._notifyWindowResizeEvent(b,a);this.freeLayout._notifyWindowResizeEvent(b,a);this.fulldragboardLayout._notifyWindowResizeEvent(b,a)};function DragboardPosition(a,b){this.x=a;this.y=b}DragboardPosition.prototype.clone=function(){return new DragboardPosition(this.x,this.y)};function DragboardCursor(a){this.refIGadget=a;var b=a.getPosition();this.position=b.clone();this.layout=a.layout;this.width=a.getWidth();this.height=a.getHeight();this.heightInPixels=a.element.offsetHeight;this.widthInPixels=a.element.offsetWidth}DragboardCursor.prototype.getWidth=function(){return this.width};DragboardCursor.prototype.getHeight=function(){return this.height};DragboardCursor.prototype.paint=function(a){var b=document.createElement("div");b.setAttribute("id","dragboardcursor");b.style.height=this.heightInPixels+"px";b.style.width=this.widthInPixels+"px";b.style.left=(this.layout.getColumnOffset(this.position.x)-2)+"px";b.style.top=(this.layout.getRowOffset(this.position.y)-2)+"px";b.style.zIndex=this.refIGadget.getZPosition();a.insertBefore(b,this.refIGadget.element);this.element=b};DragboardCursor.prototype.destroy=function(){if(this.element!=null){this.element.parentNode.removeChild(this.element);this.element=null}};DragboardCursor.prototype.getWidth=function(){return this.width};DragboardCursor.prototype.getPosition=IGadget.prototype.getPosition;DragboardCursor.prototype.setPosition=function(a){this.position=a;if(this.element!=null){this.element.style.left=(this.layout.getColumnOffset(a.x)-2)+"px";this.element.style.top=(this.layout.getRowOffset(a.y)-2)+"px"}};var EzWebEffectBase=new Object();EzWebEffectBase.findDragboardElement=function(c){var b=c.parentNode;while(b){var a=document.defaultView.getComputedStyle(b,null).getPropertyValue("position");switch(a){case"relative":case"absolute":case"fixed":return b}b=b.parentNode}return null};function Draggable(q,c,C,u,o,z,D){var A=0,b=0;var h=0,j=0;var d=0;var B=0,k=0;var n,l;var v;var f=this;D=D?D:function(){return true};function m(x){x=x||window.event;if(!BrowserUtilsFactory.getInstance().isLeftButton(x.button)){return}Event.stopObserving(document,"mouseup",m);Event.stopObserving(document,"mousemove",r);v.parentNode.stopObserving("scroll",a);v.parentNode.removeChild(v);v=null;z(f,C);Event.observe(c,"mousedown",t);document.onmousedown=null;document.onselectstart=null;document.oncontextmenu=null}function r(E){E=E||window.event;var y=parseInt(E.screenX);var x=parseInt(E.screenY);A=h-y;b=j-x;h=y;j=x;l=l-b;n=n-A;q.style.top=l+"px";q.style.left=n+"px";o(E,f,C,n+B,l+k)}function t(E){E=E||window.event;if(!BrowserUtilsFactory.getInstance().isLeftButton(E.button)){return false}if(!D(f,C)){return false}var y=BrowserUtilsFactory.getInstance().getTarget(E);if(y!=c){return false}document.oncontextmenu=function(){return false};document.onmousedown=function(){return false};document.onselectstart=function(){return false};Event.stopObserving(c,"mousedown",t);h=parseInt(E.screenX);j=parseInt(E.screenY);l=q.offsetTop;n=q.offsetLeft;q.style.top=l+"px";q.style.left=n+"px";Event.observe(document,"mouseup",m);Event.observe(document,"mousemove",r);u(f,C);var x=EzWebEffectBase.findDragboardElement(q);v=document.createElement("div");Element.extend(v);v.addClassName("cover");v.observe("mouseup",m,true);v.observe("mousemove",r,true);v.style.zIndex="1000000";v.style.position="absolute";v.style.top="0";v.style.left="0";v.style.width="100%";v.style.height=x.scrollHeight+"px";d=parseInt(x.scrollTop);x.observe("scroll",a);x.insertBefore(v,x.firstChild);return false}function a(F){F=F||window.event;var x=v.parentNode;v.style.height=x.scrollHeight+"px";var E=parseInt(x.scrollTop);var y=d-E;l-=y;d=E;q.style.top=l+"px";q.style.left=n+"px";o(F,f,C,n+B,l+k)}function w(x){x=x||window.event;Event.stop(x)}Event.observe(c,"mousedown",t);var g=c.childElements();for(var p=0;p<g.length;p++){Event.observe(g[p],"mousedown",w)}this.setXOffset=function(x){B=x};this.setYOffset=function(x){k=x};this.destroy=function(){Event.stopObserving(c,"mousedown",t);t=null;m=null;r=null;a=null;w=null;f=null;C=null;c=null}}function IGadgetDraggable(b){var a=new Object();a.iGadget=b;Draggable.call(this,b.element,b.gadgetMenu,a,IGadgetDraggable.prototype.startFunc,IGadgetDraggable.prototype.updateFunc,IGadgetDraggable.prototype.finishFunc,IGadgetDraggable.prototype.canBeDraggedFunc)}IGadgetDraggable.prototype.canBeDraggedFunc=function(a,b){return !b.iGadget.layout.dragboard.isLocked()&&!(b.iGadget.layout instanceof FullDragboardLayout)};IGadgetDraggable.prototype.startFunc=function(a,b){b.layout=b.iGadget.layout;b.dragboard=b.layout.dragboard;b.currentTab=b.dragboard.tabId;b.dragboard.raiseToTop(b.iGadget);b.layout.initializeMove(b.iGadget,a)};IGadgetDraggable.prototype._findTabElement=function(c,b){if(b==0){return null}if(isElement(c)&&Element.extend(c).hasClassName("tab")){return c}else{var a=c.parentNode;if(a!=null){return this._findTabElement(a,b-1)}else{return null}}};IGadgetDraggable.prototype.updateFunc=function(a,j,c,h,g){var d=null;if(g<0){d=document.elementFromPoint(a.clientX,a.clientY);if(d!=null){d=j._findTabElement(d,4)}}var b=null;if(d!=null){b=d.getAttribute("id");if(b!=null){var k=b.match(/tab_(\d+)_(\d+)/);if(k!=null&&k[2]!=c.currentTab){if(c.selectedTab==k[2]){return}if(c.selectedTabElement!=null){c.selectedTabElement.removeClassName("selected")}c.selectedTab=k[2];c.selectedTabElement=d;c.selectedTabElement.addClassName("selected");c.layout.disableCursor();return}}}var f=c.layout.getCellAt(h,g);if(f.y<0){f.y=0}if(f.x<0){f.x=0}if(c.selectedTabElement!=null){c.selectedTabElement.removeClassName("selected")}c.selectedTab=null;c.selectedTabElement=null;c.layout.moveTemporally(f.x,f.y);return};IGadgetDraggable.prototype.finishFunc=function(b,d){if(d.selectedTab!=null){d.layout.cancelMove();var g=d.dragboard.workSpace.getTab(d.selectedTab);if(!g.is_painted()){g.paint()}var a=g.getDragboard();var f;if(d.iGadget.onFreeLayout()){f=a.freeLayout}else{f=a.baseLayout}d.iGadget.moveToLayout(f);var c=d.selectedTabElement;setTimeout(function(){c.removeClassName("selected")},500);d.selectedTab=null;d.selectedTabElement=null}else{d.layout.acceptMove()}d.dragboard=null};function IGadgetIconDraggable(b){var a=new Object();a.iGadget=b;a.x=null;a.y=null;Draggable.call(this,b.iconElement,b.iconImg,a,IGadgetIconDraggable.prototype.startFunc,IGadgetIconDraggable.prototype.updateFunc,IGadgetIconDraggable.prototype.finishFunc,IGadgetIconDraggable.prototype.canBeDraggedFunc)}IGadgetIconDraggable.prototype.canBeDraggedFunc=function(a,b){return !b.iGadget.layout.dragboard.isLocked()};IGadgetIconDraggable.prototype.startFunc=function(a,b){b.x=null;b.y=null;b.oldZIndex=b.iGadget.getZPosition();b.iGadget.setZPosition("999999");b.dragboard=b.iGadget.layout.dragboard};IGadgetIconDraggable.prototype.updateFunc=function(d,b,c,a,f){c.x=a;c.y=f;return};IGadgetIconDraggable.prototype.finishFunc=function(b,c){c.iGadget.setZPosition(c.oldZIndex);if(c.x){var a=c.iGadget.layout.getCellAt(c.x,c.y);if(a.y<0){a.y=0}if(a.x<0){a.x=0}c.iGadget.setIconPosition(a);c.iGadget.layout.dragboard._commitChanges([c.iGadget.code])}else{c.iGadget.setMinimizeStatus(false);c.iGadget.layout.dragboard.raiseToTop(c.iGadget)}c.dragboard._notifyWindowResizeEvent()};function ResizeHandle(l,q,f,r,a,h){var d=0,n=0;var k=0,t=0;var j;var p,m;function g(u){u=u||window.event;if(!BrowserUtilsFactory.getInstance().isLeftButton(u.button)){return false}Event.stopObserving(document,"mouseup",g);Event.stopObserving(document,"mousemove",c);j.parentNode.stopObserving("scroll",o);j.parentNode.removeChild(j);j=null;q.stopObserving("mouseup",g,true);q.stopObserving("mousemove",c,true);h(l,q,f);q.observe("mousedown",b);document.onmousedown=null;document.onselectstart=null;document.oncontextmenu=null;return false}function c(u){u=u||window.event;d=k-parseInt(u.screenX);n=t-parseInt(u.screenY);k=parseInt(u.screenX);t=parseInt(u.screenY);m=m-n;p=p-d;a(l,q,f,p,m)}function o(){var u=j.parentNode;j.style.height=u.scrollHeight+"px";var w=parseInt(u.scrollTop);var v=yScroll-w;m-=v;yScroll=w;a(l,q,f,p,m)}function b(v){v=v||window.event;if(!BrowserUtilsFactory.getInstance().isLeftButton(v.button)){return false}document.oncontextmenu=function(){return false};document.onmousedown=function(){return false};document.onselectstart=function(){return false};q.stopObserving("mousedown",b);k=parseInt(v.screenX);t=parseInt(v.screenY);p=l.offsetLeft+q.offsetLeft+(q.offsetWidth/2);m=l.offsetTop+q.offsetTop+(q.offsetHeight/2);Event.observe(document,"mouseup",g);Event.observe(document,"mousemove",c);var u=EzWebEffectBase.findDragboardElement(l);j=document.createElement("div");Element.extend(j);j.addClassName("cover");j.observe("mouseup",g,true);j.observe("mousemove",c,true);j.style.zIndex="1000000";j.style.position="absolute";j.style.top="0";j.style.left="0";j.style.width="100%";j.style.height=u.scrollHeight+"px";yScroll=parseInt(u.scrollTop);u.observe("scroll",o);u.insertBefore(j,u.firstChild);q.observe("mouseup",g,true);q.observe("mousemove",c,true);r(l,q,f);return false}Event.observe(q,"mousedown",b);this.destroy=function(){Event.stopObserving(q,"mousedown",b);b=null;c=null;o=null;g=null;f=null;q=null}}function IGadgetResizeHandle(c,b,a){ResizeHandle.call(this,b.element,c,{iGadget:b,resizeLeftSide:a},IGadgetResizeHandle.prototype.startFunc,IGadgetResizeHandle.prototype.updateFunc,IGadgetResizeHandle.prototype.finishFunc)}IGadgetResizeHandle.prototype.startFunc=function(a,b,c){b.addClassName("inUse");c.minWidth=Math.ceil(c.iGadget.layout.fromPixelsToHCells(80));c.minHeight=Math.ceil(c.iGadget.layout.fromPixelsToVCells(50));c.innitialWidth=c.iGadget.getWidth();c.innitialHeight=c.iGadget.getHeight();c.iGadget.igadgetNameHTMLElement.blur();c.oldZIndex=c.iGadget.getZPosition();c.iGadget.setZPosition("999999");c.dragboard=c.iGadget.layout.dragboard};IGadgetResizeHandle.prototype.updateFunc=function(g,j,c,k,h){var d=c.iGadget;if(d.layout.isInside(k,h)){var f=d.layout.getCellAt(k,h);var b=d.getPosition();var a;if(c.resizeLeftSide){a=b.x+d.getWidth()-f.x}else{a=f.x-b.x+1}var l=f.y-b.y+1;if(a<c.minWidth){a=c.minWidth}if(l<c.minHeight){l=c.minHeight}if(a!=d.getWidth()||l!=d.getHeight()){d.setSize(a,l,c.resizeLeftSide,false)}}};IGadgetResizeHandle.prototype.finishFunc=function(a,c,d){var b=d.iGadget;d.iGadget.setZPosition(d.oldZIndex);if(d.innitialWidth!=d.iGadget.getWidth()||d.innitialHeight!=d.iGadget.getHeight()){b.setSize(b.getWidth(),b.getHeight(),d.resizeLeftSide,true)}c.removeClassName("inUse");d.dragboard._notifyWindowResizeEvent()};function UserPref(d,c,a,b){this.varName=null;this.label=null;this.desc=null;this.defaultValue=null}UserPref.prototype.UserPref=function(d,c,a,b){this.varName=d;this.label=c;this.desc=a;if((b==null)||(b==undefined)){this.defaultValue=""}else{this.defaultValue=b}};UserPref.prototype.getVarName=function(){return this.varName};UserPref.prototype.validate=function(a){return true};UserPref.prototype.getCurrentValue=function(a,c){var b=a.getVariableByName(c,this.varName);return b.get()};UserPref.prototype.setValue=function(a,c,d){if(this.validate(d)){var b=a.getVariableByName(c,this.varName);b.set(d)}};UserPref.prototype.annotate=function(a,c,d){if(this.validate(d)){var b=a.getVariableByName(c,this.varName);b.annotate(d)}};UserPref.prototype.setToDefault=function(a,b){this.setValue(a,this.defaultValue)};UserPref.prototype.getValueFromInterface=function(a){return a.value};UserPref.prototype.setDefaultValueInInterface=function(a){a.value=this.defaultValue};UserPref.prototype.getLabel=function(){var a=document.createElement("label");a.appendChild(document.createTextNode(this.label));a.setAttribute("title",this.desc);a.setAttribute("for",this.varName);return a};UserPref.prototype.TEXT="S";UserPref.prototype.INTEGER="N";UserPref.prototype.DATE="D";UserPref.prototype.LIST="L";UserPref.prototype.BOOLEAN="B";UserPref.prototype.PASSWORD="P";function ListUserPref(b,d,a,c,f){UserPref.prototype.UserPref.call(this,b,d,a,c);this.options=f;this.optionHash=null}ListUserPref.prototype=new UserPref();ListUserPref.prototype.makeInterface=function(b,g){var a;a=document.createElement("select");Element.extend(a);a.setAttribute("name",this.varName);var f=this.getCurrentValue(b,g);for(var c=0;c<this.options.length;c++){var d=document.createElement("option");d.setAttribute("value",this.options[c][0]);if(f==this.options[c][0]){d.selected="selected"}d.innerHTML=this.options[c][1];a.appendChild(d)}return a};ListUserPref.prototype.validate=function(b){if(this.optionHash==null){this.optionHash=new Hash();for(var a=0;a<this.options.length;a++){this.optionHash[this.options[a][0]]=true}}return this.optionHash[b]!=undefined};function IntUserPref(b,d,a,c){UserPref.prototype.UserPref.call(this,b,d,a,c)}IntUserPref.prototype=new UserPref();IntUserPref.prototype.makeInterface=function(a,d){var b;b=document.createElement("input");b.setAttribute("name",this.varName);b.setAttribute("type","text");var c=this.getCurrentValue(a,d);if(c!=null){b.setAttribute("value",c)}return b};IntUserPref.prototype.validate=function(a){return !isNaN(Number(a))};function TextUserPref(b,d,a,c){UserPref.prototype.UserPref.call(this,b,d,a,c)}TextUserPref.prototype=new UserPref();TextUserPref.prototype.makeInterface=function(a,d){var b;b=document.createElement("input");b.setAttribute("name",this.varName);b.setAttribute("type","text");var c=this.getCurrentValue(a,d);if(c!=null){b.setAttribute("value",c)}return b};function DateUserPref(b,d,a,c){UserPref.prototype.UserPref.call(this,b,d,a,c)}DateUserPref.prototype=new UserPref();DateUserPref.prototype.makeInterface=function(a,d){var b;b=document.createElement("input");b.setAttribute("name",this.varName);b.setAttribute("type","text");var c=this.getCurrentValue(d);if(c!=null){b.setAttribute("value",c)}return b};function BoolUserPref(b,d,a,c){UserPref.prototype.UserPref.call(this,b,d,a,c)}BoolUserPref.prototype=new UserPref();BoolUserPref.prototype.makeInterface=function(a,d){var b;b=document.createElement("input");b.setAttribute("name",this.varName);b.setAttribute("type","checkbox");var c=this.getCurrentValue(a,d);if(c.strip().toLowerCase()=="true"){b.setAttribute("checked","true")}return b};BoolUserPref.prototype.getValueFromInterface=function(a){return a.checked?"true":"false"};function PasswordUserPref(b,d,a,c){UserPref.prototype.UserPref.call(this,b,d,a,c)}PasswordUserPref.prototype=new UserPref();PasswordUserPref.prototype.makeInterface=function(a,d){var b;b=document.createElement("input");b.setAttribute("name",this.varName);b.setAttribute("type","password");var c=this.getCurrentValue(a,d);if(c!=null){b.setAttribute("value",c)}return b};if(!("elementFromPoint" in document)){var elementPositions=function(){this.elements=[];this.getElementByPoint=function(a,f){for(var c=0;c<this.elements.length;c++){var b=this.elements[c];var d=b.ownerDocument.getBoxObjectFor(b);if(d.x<=a&&a<=(d.x+d.width)&&d.y<=f&&f<=(d.y+d.height)){return b}}return null};this.addElement=function(a){this.elements.push(a)};this.removeElement=function(a){this.elements=this.elements.without(a)}};elementPositions=new elementPositions();document.elementFromPoint=function(a,b){return elementPositions.getElementByPoint(a,b)};var css=document.styleSheets[1];css.insertRule('#tab_section .tab {-moz-binding: url("elementfrompoint.xbl#default")}',css.cssRules.length)}function DontPropagateException(b){var a=new Error();a.message=b;a.name="DONT_PROPAGATE";return a}function Param(c,g,b,f,a,d){this._name=c;this._label=g;this._type=b;this._index=f;this._required=a;this._defaultValue=d}Param.prototype.Param=function(c,g,b,f,a,d){this._name=c;this._label=g;this._type=b;this._index=f;this._required=a;this._defaultValue=d};Param.prototype.getName=function(){return this._name};Param.prototype.getType=function(){return this._type};Param.prototype.getLabel=function(){return this._label};Param.prototype.getIndex=function(){return this._index};Param.prototype.getRequired=function(){return this._required};Param.prototype.getDefaultValue=function(){return this._defaultValue};Param.prototype.createHtmlLabel=function(){var c=document.createElement("div");Element.extend(c);c.addClassName("paramName");var b=document.createElement("img");b.setAttribute("src",_currentTheme.getIconURL("wiring-filter_param"));c.appendChild(b);var a=document.createElement("label");a.innerHTML=this._label+":";c.appendChild(a);return c};Param.prototype.createHtmlValue=function(f,d,h){var c={wiringGUI:f,channel:d,filter:d.getFilter(),param:this,valueElement:h};var g=document.createElement("div");Element.extend(g);var b=document.createElement("input");Element.extend(b);b.addClassName("paramValueInput");b.setAttribute("value",d.getFilterParams()[this._index]["value"]);Event.observe(b,"click",function(j){Event.stop(j)});var a=function(k){var l;var j=BrowserUtilsFactory.getInstance().getTarget(k);this.channel.setFilterParam(this.param._index,j.value);this.valueElement.update(d.getValue());if(this.channel.getFilter().getlastExecError()!=null){LayoutManagerFactory.getInstance().showMessageMenu(this.channel.getFilter().getlastExecError(),Constants.Logging.WARN_MSG);this.valueElement.nodeValue=gettext("undefined")}};Event.observe(b,"change",a.bind(c));g.appendChild(b);return g};function Filter(id_,name_,label_,nature_,code_,category_,params_,helpText_){this._id=id_;this._name=name_;this._label=label_;this._nature=nature_;this._params=new Array();this._lastExecError=null;this._category=category_;this._helpText=helpText_;this.processParams(params_);try{eval("this._code = "+code_);if((typeof this._code)!="function"){this._code=null}}catch(e){this._code=null;var msg=interpolate(gettext("Error loading code of the filter '%(filterName)s'."),{filterName:this._label},true);LogManagerFactory.getInstance().log(msg,Constants.ERROR_MSG)}}Filter.prototype.getNature=function(){return this._nature};Filter.prototype.getId=function(){return this._id};Filter.prototype.getName=function(){return this._name};Filter.prototype.getLabel=function(){return this._label};Filter.prototype.getParams=function(){return this._params};Filter.prototype.getlastExecError=function(){return this._lastExecError};Filter.prototype.setParam=function(a){this._params[a.getIndex()]=a};Filter.prototype.hasParams=function(){return this._params.length!=0};Filter.prototype.getCategory=function(){return this._category};Filter.prototype.getHelpText=function(){return this._helpText};Filter.prototype.processParams=function(c){this._params=new Array();if(c!=null&&c!=""){var a,d;var f=c.evalJSON();for(var b=0;b<f.length;b++){a=f[b];if(a.type=="jpath"){d=new JPathParam(a.name,a.label,a.index,a.required,a.defaultValue)}else{d=new Param(a.name,a.label,a.type,a.index,a.required,a.defaultValue)}this.setParam(d)}}};Filter.prototype.getInitialValues=function(){var b=[];for(var a=0;a<this._params.length;a++){b.push({index:this._params[a]._index,value:this._params[a]._defaultValue})}return b};Filter.prototype.fillFilterParamValues=function(a,f){var b=f.childElements();for(var d=0;d<b.length;d++){var c=b[d].childElements()[0];if(a[d]["value"]){c.value=a[d]["value"]}else{c.value=null}}};Filter.prototype.run=function(o,a,n){var h,b,g={};this._lastExecError=null;try{for(h=0;h<this._params.length;++h){var d=a[h]["value"];if(!d){if(this._params[h].getRequired()){b=interpolate(gettext("Look out! '%(paramName)s' of '%(filterName)s' is required"),{paramName:this._params[h].getLabel(),filterName:this._label},true);this._lastExecError=b;return gettext("undefined")}else{g[this._params[h].getName()]=null;continue}}switch(this._params[h].getType()){case"N":var m=parseInt(d);if(isNaN(m)){b=interpolate(gettext("Error loading parameter '%(paramName)s' of the filter '%(filterName)s'. It must be a number"),{paramName:this._params[h].getLabel(),filterName:this._label},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);this._lastExecError=b;return gettext("undefined")}g[this._params[h].getName()]=d;break;case"regexp":if((d.indexOf("/")==0)&&(d.lastIndexOf("/")>0)){var l=d.substring(1,d.lastIndexOf("/"));var c=d.substring(d.lastIndexOf("/")+1,d.length);g[this._params[h].getName()]=new RegExp(l,c)}else{g[this._params[h].getName()]=new RegExp(d)}break;case"jpath":var j=this._params[h].parse(d);g[this._params[h].getName()]=this._params[h].parse(d);break;default:g[this._params[h].getName()]=d.replace(/"/g,"'");break}}}catch(k){b=interpolate(gettext("Error loading param '%(paramName)s' of the filter '%(filterName)s': %(error)s."),{paramName:this._params[h].getLabel(),filterName:this._label,error:k},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);this._lastExecError=b;return gettext("undefined")}try{return this._code(o,n,g)}catch(f){if(f.name=="DONT_PROPAGATE"){throw new DontPropagateException(f)}else{var b=interpolate(gettext("Error executing code of the filter '%(filterName)s'."),{filterName:this._Label},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);if(this._params.length==0){this._lastExecError=b}else{this._lastExecError=interpolate(gettext("Error executing code of the filter '%(filterName)s'. Check the parametres."),{filterName:this._label},true)}return gettext("undefined")}}};function RemoteSubscription(){this._op_code=null;this._id=null;this._url=null;this._has_changed=false;this._channel_GUI=null;this._initializing=false}function RemoteSubscription(a){if(a){this._op_code=a.op_code;this._url=a.url;this._id=a.remote_channel_id}else{this._op_code=RemoteSubscription.prototype.DISABLED;this._url=null;this._id=null}this._has_changed=false;this._channel_GUI=null;this._initializing=false}RemoteSubscription.prototype.DISABLED=0;RemoteSubscription.prototype.READ=1;RemoteSubscription.prototype.WRITE=2;RemoteSubscription.prototype.setChannelGUI=function(a){this._channel_GUI=a};RemoteSubscription.prototype.is_reading=function(){return this._op_code==RemoteSubscription.prototype.READ};RemoteSubscription.prototype.is_writing=function(){return this._op_code==RemoteSubscription.prototype.WRITE};RemoteSubscription.prototype.setID=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._id=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.setURL=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._url=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.setOpCode=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._op_code=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.hasChanged=function(){return this._has_changed};RemoteSubscription.prototype.markAsChanged=function(){return this._has_changed=true};RemoteSubscription.prototype.getOpCode=function(){return this._op_code};RemoteSubscription.prototype.getURL=function(){return this._url};RemoteSubscription.prototype.getID=function(){return this._id};RemoteSubscription.prototype.getData=function(){var a=new Hash();this._url=this._channel_GUI.remote_url_input.value;a.url=this._url;a.op_code=this._op_code;a.id=this._id;return a};RemoteSubscription.prototype.createURL=function(){var b=function(f){var d=JSON.parse(f.responseText);this.setURL(d.url);this.setID(d.id);this._channel_GUI.updateRemoteSubscription()};var c=function(d){alert("error en create_url")};var a=URIs.POST_CREATE_EXTERNAL_CHANNEL;PersistenceEngineFactory.getInstance().send_post(a,null,this,b,c)};function wConnectable(a,b,d,c){this.id=c;this._name=a;this._type=b;this._friendCode=d}wConnectable.prototype._annotate=function(){var a="_annotate";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.getType=function(){return this.type};wConnectable.prototype.getValue=function(){var a="getValue";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.getName=function(){return this._name};wConnectable.prototype.getId=function(){return this.id};wConnectable.prototype.getFriendCode=function(){return this._friendCode};wConnectable.prototype.fullDisconnect=function(){var a="fullDisconnect";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.destroy=function(){this.fullDisconnect()};function wOut(a,b,d,c){wConnectable.call(this,a,b,d,c);this.inouts=new Array()}wOut.prototype=new wConnectable();wOut.prototype._annotate=function(a){this.variable.annotate(a)};wOut.prototype._addInput=function(a){this.inouts.push(a)};wOut.prototype._removeInput=function(a){a._removeOutput(this);this.inouts.remove(a)};wOut.prototype.fullDisconnect=function(){var b=this.inouts.clone();for(var a=0;a<b.length;++a){b[a].disconnect(this)}};wOut.prototype.refresh=function(){};function wIn(a,b,d,c){wConnectable.call(this,a,b,d,c);this.outputs=new Array();this.changed=false}wIn.prototype=new wConnectable();wIn.prototype.connect=function(a){this.outputs.push(a);a._addInput(this)};wIn.prototype.disconnect=function(a){if(this.outputs.getElementById(a.getId())==a){if(a instanceof wInOut){a._removeInput(this)}this.outputs.remove(a)}};wIn.prototype.fullDisconnect=function(){var b=this.outputs.clone();for(var a=0;a<b.length;++a){this.disconnect(b[a])}};wIn.prototype.propagate=function(c,a){for(var b=0;b<this.outputs.length;++b){this.outputs[b]._annotate(c)}for(var b=0;b<this.outputs.length;++b){this.outputs[b].propagate(c,a,this)}};wIn.prototype.refresh=function(){};function wInOut(a,b,d,c){wIn.call(this,a,b,d,c);this.inputs=new Array();this.modified_inputs_state=new Array()}wInOut.prototype=new wIn();wInOut.prototype.isConnectable=function(a){return a!=this&&!a._checkLoop(this,100)};wInOut.prototype._checkLoop=function(c,d){if(d<=0){return false}if(this.outputs.indexOf(c)==-1){for(var b=0;b<this.outputs.length;b++){var a=this.outputs[b];if(!(a instanceof wInOut)){continue}if(a._checkLoop(c,d-1)){return true}}return false}else{return true}};wInOut.prototype._annotate=function(b){for(var a=0;a<this.outputs.length;++a){this.outputs[a]._annotate(b)}};wInOut.prototype.connect=function(a){wIn.prototype.connect.call(this,a)};wInOut.prototype._addInput=function(a){this.inputs.push(a);this.modified_inputs_state.push(false)};wInOut.prototype._removeInput=function(b){if(this.inputs.getElementById(b.getId())==b){var a=this.inputs.indexOf(b);this.inputs.remove(b);this.modified_inputs_state.splice(a,1)}};wInOut.prototype._removeOutput=function(a){if(this.outputs.getElementById(a.getId())==a){this.outputs.remove(a)}};wInOut.prototype.fullDisconnect=function(){var a=this.inputs.clone();for(var b=0;b<a.length;++b){a[b].disconnect(this)}var c=this.outputs.clone();for(var b=0;b<c.length;++b){this.disconnect(c[b])}};function wEvent(a,b,d,c){this.variable=a;wIn.call(this,this.variable.name,b,d,c);this.variable.assignConnectable(this)}wEvent.prototype=new wIn();wEvent.prototype.getQualifiedName=function(){return"event_"+this.variable.id};wEvent.prototype.getLabel=function(){return this.variable.label};wEvent.prototype.getValue=function(){return this.variable.get()};function wChannel(b,a,d,c){this.variable=b;this.provisional_id=c;wInOut.call(this,a,null,null,d);this.variable.assignConnectable(this);this.filter=null;this.filterParams=new Array();this.remoteSubscription=null}wChannel.prototype=new wInOut();wChannel.prototype.getValue=function(c){if(this.filter==null){return this.variable.get()}else{try{var a=this.filter.run(this.variable.get(),this.filterParams,this);if(!c&&(this.getFilter().getlastExecError()!=null)){LayoutManagerFactory.getInstance().showMessageMenu(this.getFilter().getlastExecError(),Constants.Logging.WARN_MSG)}return a}catch(b){if(b.name=="DONT_PROPAGATE"){if(c){throw new DontPropagateException(b)}else{return gettext(b.message.message)}}}}};wChannel.prototype.getValueWithoutFilter=function(){return this.variable.get()};wChannel.prototype.getFilter=function(){return this.filter};wChannel.prototype.getRemoteSubscription=function(){return this.remoteSubscription};wChannel.prototype.setRemoteSubscription=function(a){this.remoteSubscription=a};wChannel.prototype.is_remote_reading_channel=function(){return this.remoteSubscription.is_reading()};wChannel.prototype.is_remote_writing_channel=function(){return this.remoteSubscription.is_writing()};wChannel.prototype.is_remote_channel=function(){return this.is_remote_writing_channel()||this.is_remote_reading_channel()};wChannel.prototype.setFilter=function(a){this.filter=a;this.filterParams=new Array()};wChannel.prototype.setFilterParams=function(a){this.filterParams=a};wChannel.prototype.setFilterParam=function(a,b){this.filterParams[a]["value"]=b};wChannel.prototype.getFilterParams=function(){return this.filterParams};wChannel.prototype._getJSONInput=function(){var b=new Hash();for(var a=0;a<this.inputs.length;a++){b[this.inputs[a].getName()]=this.inputs[a].getValue()}return b};wChannel.prototype.notifyRemoteChannel=function(c){if(!this.remoteSubscription.is_writing()){return}var a=this.variable.getWorkspace();var b=this.remoteSubscription.getID();a.remoteChannelManager.publish_channel_value(b,c)};wChannel.prototype.propagate=function(f,b,d){if(!b){this._markInputAsModified(d)}else{this._markAllInputsAsModified(d)}this.variable.set(f);try{var a=this.getValue(propagating=true);this.notifyRemoteChannel(a)}catch(c){if(c.name=="DONT_PROPAGATE"){return}var g=interpolate(gettext("Error committing dragboard changes to persistence: %(errorMsg)s."),{errorMsg:c.msg},true);LogManagerFactory.getInstance().log(g);return}wInOut.prototype.propagate.call(this,a,b)};wChannel.prototype.getQualifiedName=function(){return"channel_"+this.id};wChannel.prototype._markInputAsModified=function(a){var b=this.inputs.indexOf(a);this.modified_inputs_state[b]=true};wChannel.prototype._unmarkAllInputsAsModified=function(){for(var a=0;a<this.modified_inputs_state.length;a++){this.modified_inputs_state[a]=false}};wChannel.prototype._markAllInputsAsModified=function(){for(var a=0;a<this.modified_inputs_state.length;a++){this.modified_inputs_state[a]=true}};wChannel.prototype._allInputsModified=function(){if(this.modified_inputs_state.length==0){return false}for(var a=0;a<this.modified_inputs_state.length;a++){if(!this.modified_inputs_state[a]){return false}}return true};function wTab(b,a,c,d){this.variable=b;this.tab=c;this.variable.assignConnectable(this);wOut.call(this,a,null,null,d)}wTab.prototype=new wOut();wTab.prototype.propagate=function(b,a){if(!a){this.variable.set(b)}};wTab.prototype.getQualifiedName=function(){return"tab_"+this.id};function wSlot(a,b,d,c){this.variable=a;this.variable.assignConnectable(this);wOut.call(this,this.variable.name,b,d,c)}wSlot.prototype=new wOut();wSlot.prototype.propagate=function(b,a){this.variable.set(b)};wSlot.prototype.getQualifiedName=function(){return"slot_"+this.variable.id};wSlot.prototype.getLabel=function(){return this.variable.label};wSlot.prototype.refresh=function(){this.variable.refresh()};function Wiring(a,b){Wiring.prototype.processFilter=function(d){var c=new Filter(d.id,d.name,d.label,d.nature,d.code,d.category,d.params,d.help_text);this.filters[d.id]=c};Wiring.prototype.processTab=function(d){var g=d.igadgetList;var c=this.workspace.getTab(d.id).getDragboard();for(var f=0;f<g.length;f++){this.addInstance(c.getIGadget(g[f].id),g[f].variables)}};Wiring.prototype.processVar=function(h){var n=this.workspace.getVarManager();var p=n.getWorkspaceVariableById(h.id);if(h.aspect=="TAB"&&h.connectable){var r=h.connectable.id;var w=h.tab_id;var d=this.workspace.getTab(w);var u=new wTab(p,h.name,d,r);d.connectable=u}if(h.aspect=="CHANNEL"&&h.connectable){var r=h.connectable.id;var y=new wChannel(p,h.name,r,false);y.setFilter(this.filters[h.connectable.filter]);var l=new RemoteSubscription(h.connectable.remote_subscription);y.setRemoteSubscription(l);var g=h.connectable.filter_params;if(g){g=JSON.parse(g)}else{g=[]}y.setFilterParams(g);var c=h.connectable.ins;for(var t=0;t<c.length;t++){var f=c[t];var x=null;if(f.connectable_type=="in"){var o=f.ig_var_id;x=n.getVariableById(o).getConnectable()}else{var k=gettext("Error in processVar: Channel input connectables can only be events.");LogManagerFactory.getInstance().log(k)}x.connect(y)}var v=h.connectable.outs;for(var t=0;t<v.length;t++){var q=v[t];var m=null;if(q.connectable_type=="out"){if(q.ig_var_id){var o=q.ig_var_id;m=n.getVariableById(o).getConnectable()}else{var o=q.ws_var_id;m=n.getWorkspaceVariableById(o).getConnectable()}}else{var k=gettext("Error in processVar: Channel output connectables can only be slots or tabs.");LogManagerFactory.getInstance().log(k)}y.connect(m)}this.channels.push(y);this.channelsById[y.getId()]=y}};Wiring.prototype._connectInouts=function(g){var h=this.channelsById[g.connectable.id];var c=this.workspace.getVarManager();var f=g.connectable.out_inouts;for(var d=0;d<f.length;d++){var l=this.channelsById[f[d]];if(!h.isConnectable(l)){var k=gettext('Wiring: Loop detected while recovering wiring status from persistence.\nOutput connection to channel "%(targetChannel)s" from channel "%(sourceChannel)s" will be ignored.');k=interpolate(k,{sourceChannel:h.getName(),targetChannel:l.getName()},true);LogManagerFactory.getInstance().log(k,Constants.Logging.WARN_MSG);continue}h.connect(l)}};Wiring.prototype._loadWiring=function(c){var j=c.workspace;var g=j.workSpaceVariableList;var f=j.tabList;var h=j.filters;for(var d=0;d<f.length;d++){this.processTab(f[d])}for(var d=0;d<h.length;d++){this.processFilter(h[d])}for(var d=0;d<g.length;d++){this.processVar(g[d])}for(var d=0;d<g.length;d++){if(g[d].aspect=="CHANNEL"){this._connectInouts(g[d])}}this.loaded=true};Wiring.prototype._newProvisionalChannelId=function(){return this.currentProvisionalId++};Wiring.prototype.get_remote_channels_for_reading_ids=function(){var c=new Array();for(var d=0;d<this.channels.length;d++){if(this.channels[d].is_remote_reading_channel()){c.push(this.channels[d])}}return c};Wiring.prototype.getConnectableId=function(h,d,g){for(var f=0;f<h.length;f++){var c=h[f];if((c.name==d)&&(c.igadgetId==g)){return c.connectable.id}}};Wiring.prototype.iGadgetLoaded=function(d){var c=this.iGadgets[d.getId()]};Wiring.prototype.iGadgetUnloaded=function(f){var d=this.iGadgets[f.getId()];for(var c=0;c<d.slots.length;c++){d.slots[c].variable.setHandler(null)}};Wiring.prototype.addInstance=function(f,n){var o=this.workspace.getVarManager();var m=new Object();var c=f.getId();if(this.iGadgets[c]){var g=gettext("Error adding iGadget into the wiring module of the workspace: Gadget instance already exists.");LogManagerFactory.getInstance().log(g)}m.events=new Array();m.slots=new Array();m.connectables=new Array();for(var j=0;j<n.length;j++){var d=n[j];var h=o.getVariableByName(d.igadgetId,d.name);if(h.aspect=="EVEN"&&d.connectable){var l=d.connectable.id;var k=new wEvent(h,d.type,d.friend_code,l);m.events.push(k);m.connectables.push(k)}if(h.aspect=="SLOT"&&d.connectable){var l=d.connectable.id;var k=new wSlot(h,d.type,d.friend_code,l);m.slots.push(k);m.connectables.push(k)}}this.iGadgets[c]=m};Wiring.prototype.removeInstance=function(f){var d=this.iGadgets[f];if(!d){var g=gettext("Wiring error: Trying to remove an inexistent igadget.");LogManagerFactory.getInstance().log(g);return}for(var c=0;c<d.events.length;c++){d.events[c].destroy()}d.events.clear();for(var c=0;c<d.slots.length;c++){d.slots[c].destroy()}d.slots.clear();this.iGadgets.remove(f)};Wiring.prototype.getIGadgetConnectables=function(c){var f=this.iGadgets[c.id];if(f==null){var d=gettext("Wiring error: Trying to retreive the connectables of an inexistent igadget.");LogManagerFactory.getInstance().log(d);return}return f.connectables};Wiring.prototype.getChannels=function(){return this.channels};Wiring.prototype.getFiltersSort=function(){var c=function(g,f){var d=g.getName();var h=f.getName();return((d<h)?-1:((d>h)?1:0))};return this.filters.values().sort(c)};Wiring.prototype.channelExists=function(c){return this.channels.getElementByName(c)?true:false};Wiring.prototype.createChannel=function(c){if(this.channelExists(c)){var h=gettext("Error creating channel %(channelName)s: Channel already exists");h=interpolate(h,{channelName:c},true);LogManagerFactory.getInstance().log(h);return}var g=this.workspace.getVarManager().createWorkspaceVariable(c);var f=this._newProvisionalChannelId();var d=new wChannel(g,c,f,true);this.channels.push(d);this.provisionalChannels[f]=d;return d};Wiring.prototype.removeChannel=function(c){this.workspace.getVarManager().removeWorkspaceVariable(c.variable.id);this.channelsForRemoving.push(c.getId());this.channels.remove(c);c.destroy()};Wiring.prototype.unload=function(){var c=this.workspace.getVarManager();for(var d=0;d<this.channels.length;d++){var f=this.channels[d];c.removeWorkspaceVariable(f.variable.id);f.destroy()}loaded=false};Wiring.prototype.serializationSuccess=function(f){var g=f.responseText;var m=JSON.parse(g);var j=m.ids;for(var l in j){var c=j[l];var d=this.provisionalChannels[l];delete this.provisionalChannels[l];d.id=c.new_id;d.provisional_id=false;d.variable.id=c.new_wv_id;this.workspace.getVarManager().addWorkspaceVariable(c.new_wv_id,d.variable)}var j=m.urls;for(var h=0;h<j.length;h++){var c=j[h];for(var h=0;h<this.channels.length;h++){var k=this.channels[h];if(k.is_remote_channel()&&k.getRemoteSubscription().getURL()==c.url){k.getRemoteSubscription().setID(c.id)}}}this.workspace.subscribe_to_channels();this.channelsForRemoving=[]};Wiring.prototype.serializationError=function(g,d){var c=LogManagerFactory.getInstance();var f=c.formatError(gettext("Error saving wiring status: %(errorMsg)s."),g,d);c.log(f)};Wiring.prototype.serialize=function(){var l=this.iGadgets.keys();var c=[];for(var k=0;k<this.channels.length;k++){var n=this.channels[k];var o=new Object();o.id=n.id;o.name=n._name;o.type=n._type;o.friend_code=n._friendCode;o.var_id=n.variable.id;o.provisional_id=n.provisional_id;if(n.getFilter()==null){o.filter=null}else{o.filter=n.getFilter().getId()}o.filter_params=n.getFilterParams();if(n.getRemoteSubscription().hasChanged()){o.remote_subscription=n.getRemoteSubscription().getData()}else{o.remote_subscription=null}o.ins=[];for(var h=0;h<n.inputs.length;h++){var q=n.inputs[h];if(q instanceof wInOut){continue}o.ins.push(q.id)}o.outs=[];var p=[];for(var h=0;h<n.outputs.length;h++){var f=n.outputs[h];if(f instanceof wInOut){p.push(f);continue}o.outs.push(f.id)}o.inouts=[];for(var h=0;h<p.length;h++){var m=p[h];o.inouts.push({id:m.id,provisional_id:m.provisional_id})}c.push(o)}var r={inOutList:c,channelsForRemoving:this.channelsForRemoving};var g={json:Object.toJSON(r)};var d=URIs.GET_POST_WIRING.evaluate({id:this.workspace.workSpaceState.id});PersistenceEngineFactory.getInstance().send_post(d,g,this,this.serializationSuccess,this.serializationError)};this.workspace=a;this.loaded=false;this.persistenceEngine=PersistenceEngineFactory.getInstance();this.iGadgets=new Hash();this.channels=new Array();this.channelsById=new Hash();this.filters=new Hash();this.channelsForRemoving=[];this.provisionalChannels=[];this.currentProvisionalId=1;this._loadWiring(b);delete this["channelsById"]}function WiringInterface(f,b,c,a){this.workspace=b;this.wiring=f;this.wiringContainer=c;this.wiringLink=a;this.opmanager=OpManagerFactory.getInstance();this.currentChannel=null;this.connectablesByQName={};this.inputs=new Array();this.outputs=new Array();this.channels=new Array();this.channelsByName={};this.channelsToRemove=[];this.friend_codes={};this.friend_codes_counter=0;this.channelBaseName=gettext("Channel");this.visible=false;this.unfold_on_entering=false;Event.observe($("wiring_link"),"click",function(){OpManagerFactory.getInstance().activeWorkSpace.showWiring()},false,"show_wiring");this.eventColumn=$("eventColumn");this.slotColumn=$("slotColumn");this.event_list=$("events_list");this.slot_list=$("slots_list");this.channels_list=$("channels_list");this.newChannel=$("newChannel");this.wiringTable=$("wiring_table");this.canvas=new Canvas();this.canvas.addClassName("canvas");this.canvasElement=this.canvas.getHTMLElement();$("wiring_wrapper").appendChild(this.canvasElement);var d;this.eventTabs=new ConnectableColumnInterface(this.event_list);d=this.eventColumn.getElementsByClassName("title")[0];this._toggleEventColumnEvent=function(g){this.toggleEventColumn()}.bind(this);Event.observe(d,"click",this._toggleEventColumnEvent);this.slotTabs=new ConnectableColumnInterface(this.slot_list);d=this.slotColumn.getElementsByClassName("title")[0];this._toggleSlotColumnEvent=function(g){this.toggleSlotColumn()}.bind(this);Event.observe(d,"click",this._toggleSlotColumnEvent);Event.observe($("unfold_all_link"),"click",function(){this.toggleEventColumn(true);this.toggleSlotColumn(true)}.bind(this));Event.observe($("unfold_chkItem"),"click",function(h){var g=Element.extend(BrowserUtilsFactory.getInstance().getTarget(h));g.toggleClassName("chkItem");this.unfold_on_entering=g.hasClassName("chkItem")}.bind(this));this._eventCreateChannel=function(g){Event.stop(g);this._createChannel();this.toggleEventColumn(true);this.toggleSlotColumn(true)}.bind(this);Event.observe(this.newChannel,"click",this._eventCreateChannel);this._createFilterMenu();this._createRemoteChannelOperationsMenu()}WiringInterface.prototype.show=function(){if(this.visible){return}this.visible=true;this.renewInterface();LayoutManagerFactory.getInstance().showWiring(this)};WiringInterface.prototype.hide=function(){if(!this.visible){return}this.visible=false;if(this.currentChannel){this.uncheckChannel(this.currentChannel);this.currentChannel=null}this.saveWiring();LayoutManagerFactory.getInstance().hideView(this.wiringContainer)};WiringInterface.prototype.unload=function(){this._clear();Event.stopObserving(this.newChannel,"click",this._eventCreateChannel);this.canvas.clear();$("wiring_wrapper").removeChild(this.canvasElement);this.canvas=null;this.canvasElement=null;var a=$("wiring_filter_menu");this.filterMenu.remove();this.filterMenu=null;this.remote_operations_menu.remove()};WiringInterface.prototype.setFilterParam=function(){this.changed=true};WiringInterface.prototype.notifyRemoteSubscriptionChange=function(){this.changed=true};WiringInterface.prototype.saveWiring=function(){if(!this.changed){return}for(var a=0;a<this.channels.length;a++){this.channels[a].commitChanges(this.wiring,1)}for(var a=0;a<this.channelsToRemove.length;a++){this.wiring.removeChannel(this.channelsToRemove[a].getConnectable());this.channelsToRemove[a].destroy()}for(var a=0;a<this.channels.length;a++){this.channels[a].commitChanges(this.wiring,3)}for(var a=0;a<this.channels.length;a++){this.channels[a].commitChanges(this.wiring,4)}this.channelsToRemove={};this.wiring.serialize();this.changed=false};WiringInterface.prototype._addTab=function(c){var f=new EventTabInterface(c,this);this.eventTabs.add(f);var a=new SlotTabInterface(c,this);this.slotTabs.add(a);var d=c.dragboard.getIGadgets();for(var b=0;b<d.length;b++){this._addIGadget(d[b],f,a)}if(!this.unfold_on_entering){f.toggle(false);a.toggle(false)}};WiringInterface.prototype._addIGadget=function(d,f,a){var c=new IGadgetEventsInterface(d,this,f);var b=new IGadgetSlotsInterface(d,this,a)};WiringInterface.prototype._registerConnectable=function(a){this.connectablesByQName[a.getConnectable().getQualifiedName()]=a;var b=a.getFriendCode();if(b===null){return}if(this.friend_codes[b]==undefined){this.friend_codes[b]={};this.friend_codes[b].list=[];this.friend_codes[b].color=this.color_scheme[this.friend_codes_counter++]}this.friend_codes[b].list.push(a)};WiringInterface.prototype.getConnectableByQName=function(a){return this.connectablesByQName[a]};WiringInterface.prototype._notifyNameChange=function(b,a,c){if(this.channelsByName[b]==c){this.channelsByName[a]=c;delete this.channelsByName[b];this.changed=true}else{}};WiringInterface.prototype._registerChannel=function(a){if(a.exists()){this._registerConnectable(a)}this.channels.push(a);this.channelsByName[a.getName()]=a};WiringInterface.prototype._registerEvent=function(a){this._registerConnectable(a);this.inputs.push(a)};WiringInterface.prototype._registerSlot=function(a){this._registerConnectable(a);this.outputs.push(a)};WiringInterface.prototype.toggleEventColumn=function(a){if(a!==undefined){if(a){this.eventTabs.massiveExpand(false)}else{this.eventTabs.massiveFold(false)}}else{this.eventTabs.massiveToggle(false)}if(this.currentChannel){this.redrawChannelInputs(this.currentChannel)}};WiringInterface.prototype.toggleSlotColumn=function(a){if(a!==undefined){if(a){this.slotTabs.massiveExpand()}else{this.slotTabs.massiveFold()}}else{this.slotTabs.massiveToggle()}if(this.currentChannel){this.redrawChannelOutputs(this.currentChannel)}};WiringInterface.prototype._clear=function(){this.event_list.innerHTML="";this.slot_list.innerHTML="";this.channels_list.innerHTML="";this.canvas.clear();this.friend_codes_counter=0;this.friend_codes={};this.inputs.clear();this.outputs.clear();this.channelsByName={};this.channelsToRemove=[];this.currentChannel=null;this.changed=false;for(var a=0;a<this.channels.length;a++){this.channels[a].destroy()}this.channels=new Array()};WiringInterface.prototype.renewInterface=function(){this._clear();var c=this.workspace.tabInstances.keys();for(var b=0;b<c.length;b++){this._addTab(this.workspace.tabInstances[c[b]])}var a=this.wiring.getChannels();for(var b=0;b<a.length;b++){var d=new ChannelInterface(a[b],this);this._registerChannel(d);this.channels_list.appendChild(d.getHTMLElement())}for(var b=0;b<this.channels.length;b++){this.channels[b].initialize()}};WiringInterface.prototype.showMessage=function(b,a){if(a!=undefined){LayoutManagerFactory.getInstance().showInfoMessage(b,a,gettext("Warning"))}else{LayoutManagerFactory.getInstance().showAlertMessage(b)}};WiringInterface.prototype._changeConnectionStatus=function(f){if(this.currentChannel==null){if(this.channels.length==0){this.showMessage(gettext("Please, create a new channel before creating connections."),10)}else{this.showMessage(gettext("Please, select a channel before creating connections."),11)}return}var h=f.getConnectableInterface();if(h==this.currentChannel){return}if(f instanceof InConnectionAnchor){var g="connectInput";var d="connectOutput";var n="disconnectInput";var j="disconnectOutput";var l=f;var b=this.currentChannel.getInputAnchor()}else{var g="connectOutput";var d="connectInput";var n="disconnectOutput";var j="disconnectInput";var l=this.currentChannel.getOutputAnchor();var b=f}if(f.isConnected()){var m=f.getConnectionArrows()[0];m.disconnect();this.canvasElement.removeChild(m.arrow);this.currentChannel[n](h);if(h instanceof ChannelInterface){h[j](this.currentChannel)}}else{if(h instanceof ChannelInterface){var k=l.getConnectableInterface();var a=b.getConnectableInterface();if(!k.isConnectable(a)){var c=gettext("You can not make that connection because if you do it, a loop will be created.");LayoutManagerFactory.getInstance().showMessageMenu(c,Constants.Logging.WARN_MSG);return}}var m=this._drawArrow(l,b);this.currentChannel[g](h);if(h instanceof ChannelInterface){h[d](this.currentChannel)}}this.changed=true};WiringInterface.prototype.channelExists=function(a){return this.channelsByName[a]!=null};WiringInterface.prototype._getChannelInterfaceByName=function(a){return this.channelsByName[a]};WiringInterface.prototype._createChannel=function(){var a=null;var d=this.channels.length+1;var b=this.channelBaseName+"_"+d++;while(this.channelExists(b)){b=this.channelBaseName+"_"+d++}var c=new ChannelInterface(b,this);this._registerChannel(c);this.channels_list.appendChild(c.getHTMLElement());this.changed=true;this._changeChannel(c)};WiringInterface.prototype._removeChannel=function(a){if(!this.channels.elementExists(a)){return}if(this.currentChannel==a){this._changeChannel(a)}this.channels_list.removeChild(a.getHTMLElement());a.remove();if(this.currentChannel){this.uncheckChannel(this.currentChannel);this.highlightChannel(this.currentChannel)}if(a.exists()){this.channelsToRemove.push(a)}else{a.destroy()}this.channels.remove(a);delete this.channelsByName[a.getName()];this.changed=true};WiringInterface.prototype._changeChannel=function(a){var b=this.currentChannel;this.currentChannel=a;if(b){this.uncheckChannel(b)}if(b!=a){this.highlightChannel(a)}else{this.currentChannel=null}};WiringInterface.prototype._highlight=function(b,h){if(!this.friend_codes[friend_code]){return}var d=this.friend_codes[h].list;var a=this.friend_codes[friend_code].color;if(b.checked){for(var f=0;f<d.length;f++){var c=d[f];c.style.backgroundColor=a}}else{var g=true;for(var f=0;f<d.length;f++){var c=d[f];g&=!c.checked}if(g){for(var f=0;f<d.length;f++){var c=d[f];c.style.backgroundColor=null}}}};WiringInterface.prototype._highlight_friend_code=function(a,c){if(!this.friend_codes[a]){return}var d=this.friend_codes[a].list;var b=this.friend_codes[a].color;var j="#F7F7F7";var g=null;if(this.friend_codes[a].fadder!==undefined){this.friend_codes[a].fadder.reset()}if(c){for(var f=0;f<d.length;f++){d[f].getHTMLElement().style.backgroundColor=b}}else{var h=d.length>1?1700:0;if(!this.friend_codes[a].fadder){this.friend_codes[a].fadder=new BackgroundFadder(d,b,j,h,300)}this.friend_codes[a].fadder.fade()}};WiringInterface.prototype.redrawChannelInputs=function(f){var d=f.getInputAnchor();var c=d.getConnectionArrows().clone();for(var b=0;b<c.length;b++){var g=c[b];var a=g.getSourceAnchor();g.disconnect();this.canvasElement.removeChild(g.arrow);this._drawArrow(a,d)}};WiringInterface.prototype.redrawChannelOutputs=function(f){var d=f.getOutputAnchor();var c=d.getConnectionArrows().clone();for(var b=0;b<c.length;b++){var g=c[b];var a=g.getTargetAnchor();g.disconnect();this.canvasElement.removeChild(g.arrow);this._drawArrow(d,a)}};WiringInterface.prototype._uncheckChannelInputs=function(d){var b=d.getInputAnchor();var a=b.getConnectionArrows().clone();for(var c=0;c<a.length;c++){var f=a[c];f.disconnect();this.canvasElement.removeChild(f.arrow)}};WiringInterface.prototype._uncheckChannelOutputs=function(d){var a=d.getOutputAnchor();var c=a.getConnectionArrows().clone();for(var b=0;b<c.length;b++){var f=c[b];f.disconnect();this.canvasElement.removeChild(f.arrow)}};WiringInterface.prototype.uncheckChannel=function(a){a.uncheck();this.wiringTable.removeClassName("selected_channel");this._uncheckChannelInputs(a);this._uncheckChannelOutputs(a)};WiringInterface.prototype._highlightChannelInputs=function(f){var d=f.getInputAnchor();var b=f.getInputs();for(var c=0;c<b.length;c++){var a=b[c];if(a instanceof ChannelInterface){this._drawArrow(a.getOutputAnchor(),d)}else{this._drawArrow(a.getAnchor(),d)}}};WiringInterface.prototype._highlightChannelOutputs=function(f){var d=f.getOutputAnchor();var b=f.getOutputs();for(var c=0;c<b.length;c++){var a=b[c];if(a instanceof ChannelInterface){this._drawArrow(d,a.getInputAnchor())}else{this._drawArrow(d,a.getAnchor())}}};WiringInterface.prototype.highlightChannel=function(a){a.check();this.wiringTable.addClassName("selected_channel");this._highlightChannelInputs(a);this._highlightChannelOutputs(a)};WiringInterface.prototype.color_scheme=[];WiringInterface.prototype.color_scheme.push("#ffb0a1");WiringInterface.prototype.color_scheme.push("#a6ffbf");WiringInterface.prototype.color_scheme.push("#7a5e85");WiringInterface.prototype.color_scheme.push("#b3f0ff");WiringInterface.prototype.color_scheme.push("#cf36ff");WiringInterface.prototype.color_scheme.push("#5496ff");WiringInterface.prototype.color_scheme.push("#e854ff");WiringInterface.prototype.color_scheme.push("#662500");WiringInterface.prototype.color_scheme.push("#5a9e68");WiringInterface.prototype.color_scheme.push("#bf6900");WiringInterface.prototype.color_scheme.push("#a17800");WiringInterface.prototype.color_scheme.push("#72cc85");WiringInterface.prototype.color_scheme.push("#e6ff42");WiringInterface.prototype.color_scheme.push("#becfbc");WiringInterface.prototype.color_scheme.push("#005710");WiringInterface.prototype.color_scheme.push("#00193f");WiringInterface.prototype.color_scheme.push("#e0fffa");WiringInterface.prototype.color_scheme.push("#f0ff3d");WiringInterface.prototype.color_scheme.push("#f0d8d3");WiringInterface.prototype.color_scheme.push("#ab5c00");WiringInterface.prototype.color_scheme.push("#3c008f");WiringInterface.prototype.color_scheme.push("#d6ff8a");WiringInterface.prototype.color_scheme.push("#fac0e1");WiringInterface.prototype.color_scheme.push("#4700ad");WiringInterface.prototype.color_scheme.push("#ccc6ad");WiringInterface.prototype.color_scheme.push("#261e06");WiringInterface.prototype.color_scheme.push("#4fedff");WiringInterface.prototype.color_scheme.push("#e6bebc");WiringInterface.prototype.color_scheme.push("#f0ed73");WiringInterface.prototype.color_scheme.push("#4f1800");WiringInterface.prototype.color_scheme.push("#020073");WiringInterface.prototype.color_scheme.push("#0fff00");WiringInterface.prototype.color_scheme.push("#686b00");WiringInterface.prototype.color_scheme.push("#804dff");WiringInterface.prototype.color_scheme.push("#b100bd");WiringInterface.prototype.color_scheme.push("#69ffab");WiringInterface.prototype.color_scheme.push("#e6acb8");WiringInterface.prototype.color_scheme.push("#8c7a77");WiringInterface.prototype.color_scheme.push("#006bfa");WiringInterface.prototype.color_scheme.push("#8cffab");WiringInterface.prototype.color_scheme.push("#d1d190");WiringInterface.prototype.color_scheme.push("#0d4000");WiringInterface.prototype.color_scheme.push("#f0e8c4");WiringInterface.prototype.color_scheme.push("#0048e8");WiringInterface.prototype.color_scheme.push("#b8ffe0");WiringInterface.prototype.color_scheme.push("#5effe0");WiringInterface.prototype.color_scheme.push("#770000");WiringInterface.prototype.color_scheme.push("#913dff");WiringInterface.prototype.color_scheme.push("#5357cf");function ConnectionAnchor(a){if(arguments.length==0){return}this._interface=a;this.connectionArrows=[];this.channelType=null;this.htmlElement=document.createElement("div");Element.extend(this.htmlElement);this.htmlElement.addClassName("anchor")}ConnectionAnchor.prototype.getConnectableInterface=function(){return this._interface};ConnectionAnchor.prototype.getHTMLElement=function(){return this.htmlElement};ConnectionAnchor.prototype._addConnectionArrow=function(a){if(!this.isConnected()){this.htmlElement.addClassName("checked")}if(this._interface._increaseConnections){this._interface._increaseConnections()}this.connectionArrows.push(a)};ConnectionAnchor.prototype._removeConnectionArrow=function(a){this.connectionArrows.remove(a);if(this._interface._decreaseConnections){this._interface._decreaseConnections()}if(!this.isConnected()){this.htmlElement.removeClassName("checked")}};function Coordinates(c,b,a){this.topLeftSquare=c;this.width=b;this.height=a}Coordinates.prototype.getCenter=function(){return{posX:Math.round(this.topLeftSquare.posX+(this.width/2)),posY:Math.round(this.topLeftSquare.posY+(this.height/2))}};Coordinates.prototype.getAngle=function(a){switch(a){case 0:return{posX:this.topLeftSquare.posX+this.width,posY:this.topLeftSquare.posY+Math.round(this.height/2)};case 180:return{posX:this.topLeftSquare.posX,posY:this.topLeftSquare.posY+Math.round(this.height/2)};default:throw new Error()}};ConnectionAnchor.prototype.getCoordinates=function(b){var d={posX:this.htmlElement.offsetLeft,posY:this.htmlElement.offsetTop};var a=this.htmlElement.parentNode;while(a!=b){var f=document.defaultView.getComputedStyle(a,null);var c=f.getPropertyValue("position");if(c!="static"){d.posY+=a.offsetTop+f.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);d.posX+=a.offsetLeft+f.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX)}a=a.parentNode}return new Coordinates(d,this.htmlElement.offsetWidth,this.htmlElement.offsetHeight)};ConnectionAnchor.prototype.isConnected=function(){return this.connectionArrows.length>0};ConnectionAnchor.prototype.getConnectionArrows=function(){return this.connectionArrows};function InConnectionAnchor(a){if(arguments.length==0){return}ConnectionAnchor.call(this,a)}InConnectionAnchor.prototype=new ConnectionAnchor();function OutConnectionAnchor(a){if(arguments.length==0){return}ConnectionAnchor.call(this,a)}OutConnectionAnchor.prototype=new ConnectionAnchor();function EventConnectionAnchor(a){InConnectionAnchor.call(this,a)}EventConnectionAnchor.prototype=new InConnectionAnchor();function SlotConnectionAnchor(a){OutConnectionAnchor.call(this,a)}SlotConnectionAnchor.prototype=new OutConnectionAnchor();function TabConnectionAnchor(a){OutConnectionAnchor.call(this,a)}TabConnectionAnchor.prototype=new OutConnectionAnchor();EventConnectionAnchor.prototype.setConnectionStatus=function(a){ConnectionAnchor.prototype.setConnectionStatus.call(this,a);if(a){this._interface._increaseConnections()}else{this._interface._decreaseConnections()}};SlotConnectionAnchor.prototype.setConnectionStatus=EventConnectionAnchor.prototype.setConnectionStatus;TabConnectionAnchor.prototype.setConnectionStatus=EventConnectionAnchor.prototype.setConnectionStatus;WiringInterface.prototype._buildArrowPointList=function(l,a){var h=l.getCoordinates(this.wiringContainer);var f=a.getCoordinates(this.wiringContainer);var b=[];var d=h.getCenter();var n=h.getCenter();if(d.posX<n.posX){h=h.getAngle(180);f=f.getAngle(0)}else{h=h.getAngle(0);f=f.getAngle(180)}b.push(h);if(l instanceof EventConnectionAnchor||a instanceof SlotConnectionAnchor||a instanceof TabConnectionAnchor){}else{var j;var g=a.getConnectableInterface().getHTMLElement();var k=Element.getRelativeBoundingClientRect(g,this.wiringContainer);if(l.getConnectableInterface()==this.currentChannel){var c=f.posX-50;var m=h.posX+30;if(h.posY<f.posY){j=k.top-15}else{j=k.bottom+15}}else{var c=f.posX-30;var m=h.posX+50;if(h.posY<f.posY){j=k.top-15}else{j=k.bottom+15}}b.push({posX:m,posY:h.posY});b.push({posX:m,posY:j});b.push({posX:c,posY:j});b.push({posX:c,posY:f.posY})}b.push(f);return b};WiringInterface.prototype._drawArrow=function(h,b){var c="arrow";var f=h.getConnectableInterface();var g=b.getConnectableInterface();if(f==this.currentChannel){c="outToChannel"}else{c="inFromChannel"}if(f.makeVisible){f.makeVisible(false)}if(g.makeVisible){g.makeVisible(false)}var a=this._buildArrowPointList(h,b);if(a.length==2){var d=this.canvas.drawArrow(a[0],a[1],{})}else{var d=this.canvas.drawPolyLine(a,{})}d.addClassName(c);return new ConnectionArrow(h,b,d)};WiringInterface.prototype._createFilterMenu=function(){var g='<div id="wiring_filter_menu" class="drop_down_menu"><div id="wiring_filter_submenu" class="submenu"></div></div>';new Insertion.After($("menu_layer"),g);var f=new FilterDropDownMenu("wiring_filter_menu");var d=function(){this.wiringGUI._updateFilterFunc(this.wiringGUI.currentChannel,this.filter)};f.addOptionWithHelp(_currentTheme.getIconURL("filter"),gettext("None"),gettext("Returns the value of the channel unfiltered."),d.bind({wiringGUI:this,filter:null}),0);var c=this.wiring.getFiltersSort();for(var b=0;b<c.length;b++){var a={wiringGUI:this,filter:c[b]};f.addOptionWithHelp(_currentTheme.getIconURL("filter"),c[b].getLabel(),c[b].getHelpText(),d.bind(a),b+1)}this.filterMenu=f};WiringInterface.prototype._createRemoteChannelOperationsMenu=function(){this.remote_operations_menu=new RemoteChannelOperationsDropDownMenu("remote_channel_operations",null);var b=gettext("Disabled");var c=gettext("Read");var a=gettext("Write");var d=function(g){var f=BrowserUtilsFactory.getInstance().getTarget(g);f.blur();Event.stop(g);var j=null;if(f.id){j=f.id}else{j=f.parentNode.id}var k=parseInt(j.charAt(j.length-1));var h=f.innerHTML;this.currentChannel.remote_subscription.setOpCode(k);this.currentChannel.updateRemoteSubscription()}.bind(this);this.remote_operations_menu.addOption(null,b,d,0,null,null);this.remote_operations_menu.addOption(null,c,d,1,null,null);this.remote_operations_menu.addOption(null,a,d,2,null,null)};WiringInterface.prototype._updateFilterFunc=function(b,a){LayoutManagerFactory.getInstance().hideCover();if(b.getFilter()==a){return}this.changed=true;b.setFilter(a,this.wiring);this.uncheckChannel(b);this.highlightChannel(b)};WiringInterface.prototype._displayHelpWiringHeader=function(a,c){Event.stop(c);var b=document.createElement("div");Element.extend(b);b.setAttribute("id","help_background");b.style.cssText="top:0;bottom:0;right:0;left:0;position:absolute;z-index:3001;";b.observe("click",function(g){Event.stop(g);var f=BrowserUtilsFactory.getInstance().getTarget(g);f.parentNode.removeChild(f)});var d=document.createElement("div");Element.extend(d);d.addClassName("helpwiringheader");d.style.padding="5px";d.style.position="absolute";d.style.top=Event.pointerY(c)+"px";b.appendChild(d);document.body.appendChild(b);switch(a.name){case"event":d.style.left=Event.pointerX(c)+"px";d.innerHTML=gettext("Lists of gadgets with events.\nThis events produces a value\nwhich will be received by\nother gadgets as slots.");break;case"channels":d.style.left=Event.pointerX(c)+"px";d.innerHTML=gettext("Channels allows you to manage\nthe connections between different\ninstantiated gadgets.");break;case"slot":d.innerHTML=gettext("Lists of gadgets with slots.\nThis slots receives values\nwhich are produced by\nother gadgets as events.");d.style.left=(Event.pointerX(c)-d.offsetWidth)+"px";break}};function ConnectionArrow(c,a,b){this.sourceAnchor=c;this.targetAnchor=a;this.arrow=b;c._addConnectionArrow(this);a._addConnectionArrow(this)}ConnectionArrow.prototype.getSourceAnchor=function(){return this.sourceAnchor};ConnectionArrow.prototype.getTargetAnchor=function(){return this.targetAnchor};ConnectionArrow.prototype.disconnect=function(){this.sourceAnchor._removeConnectionArrow(this);this.targetAnchor._removeConnectionArrow(this);this.sourceAnchor=null;this.targetAnchor=null};if(BrowserUtilsFactory.getInstance().isIE()){document.namespaces.add("vml","urn:schemas-microsoft-com:vml","#default#VML");var s=document.createStyleSheet();s.addRule("vml\\: polyline","behavior:url(#default#VML);display:inline-block;");s.addRule("vml\\: shape","behavior:url(#default#VML);display:inline-block;");var Canvas=function(){this.canvasElement=document.createElement("div");Element.extend(this.canvasElement);this.context={stroke:"#00F",fill:"none","stroke-width":"2px"}};Canvas.prototype.addClassName=function(a){this.canvasElement.addClassName(a)};Canvas.prototype._elementAddClassName=function(a){switch(a){case"inFromChannel":this.strokecolor="green";this.filled=false;this.strokeweight=2;break;case"outToChannel":this.strokecolor="#F00000";this.filled=false;this.strokeweight=2;break}};Canvas.prototype._propMapping={fill:"fillcolor",stroke:"strokecolor","stroke-width":"strokeweight"};Canvas.prototype._applyStyle=function(c,b){var a;for(a in c){var d=c[a];if(this._propMapping[a]!=undefined){a=this._propMapping[a]}if(a=="fillcolor"&&d=="none"){b.filled=false}else{b[a]=d}}};Canvas.prototype.drawPolyLine=function(f,d){var b="";for(var c=0;c<f.length;c++){b+=","+f[c].posX+","+f[c].posY}b=b.substr(1);var a=this.canvasElement.ownerDocument.createElement('<vml:polyline points="'+b+'" />');this._applyStyle(d?d:this.context,a);this.canvasElement.appendChild(a);a.outerHTML=a.outerHTML;a=this.canvasElement.childNodes[this.canvasElement.childNodes.length-1];a.addClassName=Canvas.prototype._elementAddClassName;return a};Canvas.prototype.drawArrow=function(g,f,a){var d=Math.floor((g.posX+f.posX)/2);var c="m "+g.posX+","+(g.posY-1)+" c "+d+","+(g.posY-1)+" "+d+","+(f.posY-1)+" "+f.posX+","+(f.posY-1)+" e";var b=this.canvasElement.ownerDocument.createElement('<vml:shape path="'+c+'" />');this.canvasElement.appendChild(b);b.style.width="10000px";b.style.height="10000px";b.style.top="0px";b.style.left="0px";b.style.position="absolute";b.coordorigin="0 0";b.coordsize="10000 10000";this._applyStyle(a?a:this.context,b);b.outerHTML=b.outerHTML;b=this.canvasElement.childNodes[this.canvasElement.childNodes.length-1];b.addClassName=Canvas.prototype._elementAddClassName;return b}}else{var Canvas=function(){this.canvasElement=document.createElementNS(this.SVG_NAMESPACE,"svg:svg");this.context={stroke:"#00F",fill:"transparent","stroke-width":"2"}};Canvas.prototype.SVG_NAMESPACE="http://www.w3.org/2000/svg";Canvas.prototype.addClassName=function(a){this.canvasElement.setAttribute("class",a)};Canvas.prototype._elementAddClassName=function(a){this.setAttribute("class",a)};Canvas.prototype._applyStyle=function(d,c){var a=c.getAttribute("style");if(a==null){a=""}for(var b in d){a+=b+":"+d[b]+";"}c.setAttribute("style",a)};Canvas.prototype.drawPolyLine=function(f,d){var b=this.canvasElement.ownerDocument.createElementNS(this.SVG_NAMESPACE,"svg:polyline");var a="";for(var c=0;c<f.length;c++){a+=" "+f[c].posX+","+f[c].posY}b.setAttribute("points",a);this._applyStyle(d?d:this.context,b);this.canvasElement.appendChild(b);b.addClassName=Canvas.prototype._elementAddClassName;return b};Canvas.prototype.drawArrow=function(f,d,a){var b=this.canvasElement.ownerDocument.createElementNS(this.SVG_NAMESPACE,"svg:path");var c=(f.posX+d.posX)/2;b.setAttribute("d","M "+f.posX+","+f.posY+" C "+c+","+f.posY+" "+c+","+d.posY+" "+d.posX+","+d.posY);this._applyStyle(a?a:this.context,b);this.canvasElement.appendChild(b);b.addClassName=Canvas.prototype._elementAddClassName;return b}}Canvas.prototype.clear=function(){while(this.canvasElement.childNodes.length>0){this.canvasElement.removeChild(this.canvasElement.childNodes[0])}};Canvas.prototype.getHTMLElement=function(){return this.canvasElement};function ConnectableGroupInterface(b,c,a){if(arguments.length==0){return}this.empty=true;this.wiringGUI=b;this.folded=false;this.connections=0;this.parentInterface=c;this.openedByUser=false;this.childConnectableGroups=new Array();this.htmlElement=document.createElement("div");Element.extend(this.htmlElement);this.headerElement=document.createElement("div");Element.extend(this.headerElement);this.headerElement.addClassName("header");this.headerElement.appendChild(document.createTextNode(a));this.htmlElement.appendChild(this.headerElement);Event.observe(this.headerElement,"click",function(d){Event.stop(d);this.toggle(true)}.bind(this));this.contentElement=document.createElement("div");Element.extend(this.contentElement);this.contentElement.addClassName("content");this.htmlElement.appendChild(this.contentElement);if(this.parentInterface){this.parentInterface._addConnectableGroup(this)}this.htmlElement.addClassName("empty")}ConnectableGroupInterface.prototype._increaseConnections=function(){this.connections++;if(this.parentInterface){this.parentInterface._increaseConnections()}};ConnectableGroupInterface.prototype._decreaseConnections=function(){if(this.connections>=1){this.connections--;if(this.parentInterface){this.parentInterface._decreaseConnections()}}};ConnectableGroupInterface.prototype.getHTMLElement=function(){return this.htmlElement};ConnectableGroupInterface.prototype.toggle=function(a){if(this.openedByUser&&!a){return}if(!this.folded&&this.connections>0){this.massiveToggle(a);return}this.forceToggle();this.openedByUser=!this.fold&&a};ConnectableGroupInterface.prototype.forceToggle=function(){this.folded=!this.folded;if(this.folded){this.htmlElement.addClassName("folded");this.openedByUser=false}else{this.htmlElement.removeClassName("folded")}this.repaintSiblings()};ConnectableGroupInterface.prototype.isAnyFolded=function(){for(var b=0;b<this.childConnectableGroups.length;b++){var a=this.childConnectableGroups[b];if(a.folded||a.isAnyFolded()){return true}}return false};ConnectableGroupInterface.prototype.makeVisible=function(a){if(this.folded){this.toggle(a)}else{this.openedByUser=a}if(this.parentInterface){this.parentInterface.makeVisible(false)}};ConnectableGroupInterface.prototype.massiveToggle=function(a){if(this.isAnyFolded()){this.massiveExpand(a)}else{this.massiveFold(a)}};ConnectableGroupInterface.prototype.massiveExpand=function(b){if(this.folded){this.forceToggle();this.openedByUser=!this.fold&&b}for(var a=0;a<this.childConnectableGroups.length;a++){this.childConnectableGroups[a].massiveExpand(b)}};ConnectableGroupInterface.prototype.massiveFold=function(b){if(!this.folded&&(!this.openedByUser||b)&&this.connections==0){this.forceToggle();this.openedByUser=false}for(var a=0;a<this.childConnectableGroups.length;a++){this.childConnectableGroups[a].massiveFold(b)}};ConnectableGroupInterface.prototype._addConnectableGroup=function(a){this.childConnectableGroups.push(a);this.contentElement.appendChild(a.getHTMLElement());this._notifyNewEmptyStatus(a,a.isEmpty())};ConnectableGroupInterface.prototype._notifyNewEmptyStatus=function(b,a){if(this.empty&&!a){this.empty=false;this.htmlElement.removeClassName("empty")}};ConnectableGroupInterface.prototype.isEmpty=function(){return this.empty};function ConnectableTabInterface(b,a){if(arguments.length==0){return}ConnectableGroupInterface.call(this,b,null,a);this.htmlElement.addClassName("tab")}ConnectableTabInterface.prototype=new ConnectableGroupInterface();function SlotTabInterface(a,b){ConnectableTabInterface.call(this,b,a.tabInfo.name);this.tabConnectable=a.connectable;b._registerConnectable(this);this.tabAnchor=new TabConnectionAnchor(this);var c=this.tabAnchor.getHTMLElement();this.headerElement.appendChild(c);Event.observe(c,"click",function(d){this.wiringGUI._changeConnectionStatus(this.tabAnchor);Event.stop(d)}.bind(this),false);this.wiringGUI.outputs.push(this)}SlotTabInterface.prototype=new ConnectableTabInterface();SlotTabInterface.prototype.getConnectable=function(){return this.tabConnectable};SlotTabInterface.prototype.getAnchor=function(){return this.tabAnchor};SlotTabInterface.prototype.getFriendCode=function(){return"go_tab_event"};SlotTabInterface.prototype.repaintSiblings=function(){if(this.wiringGUI.currentChannel==null){return}this.wiringGUI.redrawChannelOutputs(this.wiringGUI.currentChannel)};function EventTabInterface(a,b){ConnectableTabInterface.call(this,b,a.tabInfo.name)}EventTabInterface.prototype=new ConnectableTabInterface();EventTabInterface.prototype.repaintSiblings=function(){if(this.wiringGUI.currentChannel==null){return}this.wiringGUI.redrawChannelInputs(this.wiringGUI.currentChannel)};function ConnectableInterface(a,b){this.connectable=a;this.anchor=b}ConnectableInterface.prototype.getConnectable=function(){return this.connectable};ConnectableInterface.prototype.getAnchor=function(){return this.anchor};function ChannelInterface(y,a){this.wiringGUI=a;if(y instanceof wChannel){this.connectable=y;this.name=y.getName();this.inputs=y.inputs.clone();this.outputs=y.outputs.clone();this.filter=y.getFilter();this.remote_subscription=y.getRemoteSubscription()}else{this.connectable=null;this.name=y;this.inputs=new Array();this.outputs=new Array();this.filter=null;this.remote_subscription=new RemoteSubscription()}this.remote_subscription.setChannelGUI(this);this.inputsForAdding=new Array();this.inputsForRemoving=new Array();this.outputsForAdding=new Array();this.outputsForRemoving=new Array();this.inAnchor=new OutConnectionAnchor(this);this.outAnchor=new InConnectionAnchor(this);this.filter_link=null;this.filter_table=null;this.remote_channel_link=null;this.remote_channel_table=null;this.operations_menu_label=null;this.last_clicked_option_link=null;this.opened_optional_table=false;this.htmlElement=document.createElement("div");Element.extend(this.htmlElement);this.htmlElement.addClassName("channel");var n=document.createElement("div");Element.extend(n);n.className="channelPipe";this.htmlElement.appendChild(n);Event.observe(n,"click",function(z){Event.stop(z);this.wiringGUI._changeChannel(this)}.bind(this));var f=document.createElement("img");Element.extend(f);n.appendChild(f);f.setAttribute("alt",gettext("Remove"));f.setAttribute("src",_currentTheme.getIconURL("channel-remove"));Event.observe(f,"click",function(z){Event.stop(z);this.wiringGUI._removeChannel(this)}.bind(this));this.channelNameInput=document.createElement("input");Element.extend(this.channelNameInput);n.appendChild(this.channelNameInput);this.channelNameInput.setAttribute("value",this.name);this.channelNameInput.addClassName("channelNameInput");this.channelNameInput.observe("click",function(z){if(this.wiringGUI.currentChannel==this){Event.stop(z)}}.bind(this));var j=function(A){var z=BrowserUtilsFactory.getInstance().getTarget(A);if(z.value==""||z.value.match(/^\s$/)){var B=gettext("Channel name cannot be empty.");LayoutManagerFactory.getInstance().showMessageMenu(B,Constants.Logging.WARN_MSG);z.value=this.getName()}else{if(this.wiringGUI.channelExists(z.value)){var B=gettext('A channel named "%(channelName)s" already exists.');B=interpolate(B,{channelName:z.value},true);LayoutManagerFactory.getInstance().showMessageMenu(B,Constants.Logging.WARN_MSG);z.value=this.getName()}else{this.setName(z.value)}}};this.channelNameInput.observe("change",j.bind(this));var g=document.createElement("div");Element.extend(g);this.htmlElement.appendChild(g);g.addClassName("channelContent");Event.observe(g,"click",function(z){Event.stop(z)});var w=document.createElement("table");Element.extend(w);var u=document.createElement("tbody");w.appendChild(u);Element.extend(u);g.appendChild(w);var m=document.createElement("tr");Element.extend(m);u.appendChild(m);o=document.createElement("td");o.setAttribute("width","20%");m.appendChild(o);c=document.createElement("label");c.innerHTML=gettext("Value")+":";o.appendChild(c);q=document.createElement("td");m.appendChild(q);this.valueElement=document.createElement("div");Element.extend(this.valueElement);q.appendChild(this.valueElement);var m=document.createElement("tr");Element.extend(m);u.appendChild(m);var o=document.createElement("td");m.appendChild(o);var x=document.createElement("div");Element.extend(x);x.addClassName("option_link");x.innerHTML=gettext("Filters");g.appendChild(x);this.filter_link=x;Event.observe(x,"click",function(z){Event.stop(z);this._toggle_table_status(this.filter_table,this.filter_link)}.bind(this));var d=document.createElement("div");Element.extend(d);d.addClassName("option_link_separator");d.innerHTML=gettext("|");g.appendChild(d);var v=document.createElement("div");Element.extend(v);v.addClassName("option_link");v.innerHTML=gettext("Remote channel");g.appendChild(v);this.remote_channel_link=v;Event.observe(v,"click",function(z){Event.stop(z);this.wiringGUI.notifyRemoteSubscriptionChange();this.remote_subscription.markAsChanged();this._toggle_table_status(this.remote_channel_table,this.remote_channel_link)}.bind(this));var w=document.createElement("table");Element.extend(w);var u=document.createElement("tbody");Element.extend(u);w.appendChild(u);w.addClassName("contentTable");w.addClassName("fold_table");g.appendChild(w);this.filter_table=w;var m=document.createElement("tr");Element.extend(m);u.appendChild(m);var o=document.createElement("td");m.appendChild(o);var c=document.createElement("label");c.innerHTML=gettext("Filter")+":";o.appendChild(c);var q=document.createElement("td");m.appendChild(q);this.filterLabelDiv=document.createElement("div");Element.extend(this.filterLabelDiv);this.filterLabelDiv.addClassName("filterValue");q.appendChild(this.filterLabelDiv);this.filterInput=document.createTextNode("");this.filterLabelDiv.appendChild(this.filterInput);if(BrowserUtilsFactory.getInstance().isIE()){var r=document.createElement('<input type="button" />');Element.extend(r)}else{var r=document.createElement("input");r.type="button"}this.filterLabelDiv.appendChild(r);r.addClassName("filterMenuLauncher");r.observe("click",function(A){var z=BrowserUtilsFactory.getInstance().getTarget(A);z.blur();Event.stop(A);LayoutManagerFactory.getInstance().showDropDownMenu("filterMenu",this.wiringGUI.filterMenu,Event.pointerX(A),Event.pointerY(A))}.bind(this));m=document.createElement("tr");u.appendChild(m);o=document.createElement("td");m.appendChild(o);this.paramLabelLayer=document.createElement("div");Element.extend(this.paramLabelLayer);o.appendChild(this.paramLabelLayer);q=document.createElement("td");m.appendChild(q);this.paramValueLayer=document.createElement("div");Element.extend(this.paramValueLayer);q.appendChild(this.paramValueLayer);var u=document.createElement("table");Element.extend(u);u.addClassName("contentTable");g.appendChild(u);u.addClassName("fold_table");this.remote_channel_table=u;var m=document.createElement("tr");Element.extend(m);u.appendChild(m);var o=document.createElement("td");o.setAttribute("width","20%");m.appendChild(o);var c=document.createElement("label");c.innerHTML=gettext("Operation")+":";o.appendChild(c);u.appendChild(m);var k=document.createElement("td");m.appendChild(k);var t=document.createElement("div");Element.extend(t);t.addClassName("filterValue");k.appendChild(t);this.operations_menu_label=document.createElement("div");Element.extend(this.operations_menu_label);this.operations_menu_label.addClassName("inline");t.appendChild(this.operations_menu_label);if(BrowserUtilsFactory.getInstance().isIE()){var h=document.createElement('<input type="button" />');Element.extend(h)}else{var h=document.createElement("input");h.type="button"}t.appendChild(h);h.addClassName("filterMenuLauncher");h.observe("click",function(A){var z=BrowserUtilsFactory.getInstance().getTarget(A);z.blur();Event.stop(A);LayoutManagerFactory.getInstance().showDropDownMenu("remoteChannelOperationsMenu",this.wiringGUI.remote_operations_menu,Event.pointerX(A),Event.pointerY(A))}.bind(this));this.remote_url_row=document.createElement("tr");Element.extend(this.remote_url_row);u.appendChild(this.remote_url_row);var o=document.createElement("td");o.setAttribute("width","20%");this.remote_url_row.appendChild(o);var c=document.createElement("label");c.innerHTML=gettext("URL")+":";o.appendChild(c);var k=document.createElement("td");this.remote_url_row.appendChild(k);this.remote_url_input=document.createElement("input");Element.extend(this.remote_url_input);this.remote_url_input.addClassName("paramValueInput");k.appendChild(this.remote_url_input);this.url_input_label=document.createElement("label");Element.extend(this.url_input_label);this.url_input_label.setAttribute("id","remote_operation_tip");k.appendChild(this.url_input_label);var b=document.createElement("div");Element.extend(b);b.addClassName("create_url_link");b.innerHTML=gettext("create a new URL");k.appendChild(b);Event.observe(b,"click",function(z){this.remote_subscription.createURL(this)}.bind(this));this._updateFilterInterface();this.channelNameInput.focus();var l=this.inAnchor.getHTMLElement();l.addClassName("inAnchor");Event.observe(l,"click",function(z){this.wiringGUI._changeConnectionStatus(this.inAnchor);Event.stop(z)}.bind(this),false);this.htmlElement.appendChild(l);var p=this.outAnchor.getHTMLElement();p.addClassName("outAnchor");Event.observe(p,"click",function(z){this.wiringGUI._changeConnectionStatus(this.outAnchor);Event.stop(z)}.bind(this),false);this.htmlElement.appendChild(p)}ChannelInterface.prototype=new ConnectableInterface();ChannelInterface.prototype.initialize=function(){for(var a=0;a<this.inputs.length;a++){this.inputs[a]=this.wiringGUI.getConnectableByQName(this.inputs[a].getQualifiedName())}for(var a=0;a<this.outputs.length;a++){this.outputs[a]=this.wiringGUI.getConnectableByQName(this.outputs[a].getQualifiedName())}};ChannelInterface.prototype.isConnectable=function(a){return !a._checkLoop(this,100)};ChannelInterface.prototype._checkLoop=function(c,d){if(d<=0){return false}if(this.outputs.indexOf(c)==-1){for(var a=0;a<this.outputs.length;a++){var b=this.outputs[a];if(!(b instanceof ChannelInterface)){continue}if(b._checkLoop(c,d-1)){return true}}return false}else{return true}};ChannelInterface.prototype.getInputAnchor=function(){return this.inAnchor};ChannelInterface.prototype.getOutputAnchor=function(){return this.outAnchor};ChannelInterface.prototype.getFriendCode=function(){return""};ChannelInterface.prototype.setName=function(a){this.wiringGUI._notifyNameChange(this.name,a,this);this.name=a};ChannelInterface.prototype.getInputs=function(){return this.inputs};ChannelInterface.prototype.getOutputs=function(){return this.outputs};ChannelInterface.prototype.getName=function(){return this.name};ChannelInterface.prototype.getFilter=function(){return this.filter};ChannelInterface.prototype.updateRemoteSubscription=function(){var c=this.remote_subscription.getOpCode();var b=this.wiringGUI.remote_operations_menu.getTextFromOp(c);var a=this.remote_subscription.getURL();this.remote_url_input.value=a;this.operations_menu_label.innerHTML=b;switch(c){case 0:this.remote_url_row.addClassName("hide");break;case 1:this.url_input_label.innerHTML=gettext("Enter URL to read from or ");this.remote_url_row.removeClassName("hide");break;case 2:this.url_input_label.innerHTML=gettext("Enter URL to write to or ");this.remote_url_row.removeClassName("hide");break}this.wiringGUI.remote_operations_menu.hide();LayoutManagerFactory.getInstance().hideCover()};ChannelInterface.prototype._getFilterParams=function(){if(this.filter==null){return}var d={};var c=this.filter.getParams();var b=this.paramValueLayer.childNodes;for(var a=0;a<b.length;a++){d[c[a].getIndex()]=b[a].getTextContent()}return d};ChannelInterface.prototype._showFilterParams=function(){if(this.filter==null){return}var b=this.filter.getParams();for(var a=0;a<b.length;a++){this.paramLabelLayer.appendChild(b[a].createHtmlLabel());this.paramValueLayer.appendChild(b[a].createHtmlValue(this.wiringGUI,this,this.valueElement))}};ChannelInterface.prototype._fillFilterParams=function(){if(this.filter==null){return}this.filter.fillFilterParamValues(this.connectable.filterParams,this.paramValueLayer)};ChannelInterface.prototype._updateFilterInterface=function(){this.paramLabelLayer.setTextContent("");this.paramValueLayer.setTextContent("");var a;if(this.filter==null){a=gettext("None")}else{a=this.filter.getLabel()}this.filterLabelDiv.removeChild(this.filterInput);this.filterInput=document.createTextNode(a);this.filterLabelDiv.insertBefore(this.filterInput,this.filterLabelDiv.childNodes[0]);this.valueElement.setTextContent(this.getValueWithFilter());this._showFilterParams();this.updateRemoteSubscription()};ChannelInterface.prototype.setFilter=function(a,c){this.filter=a;var b=[];if(a!=null){b=this.filter.getInitialValues()}this._changeFilterToConnectable(c,b);this._updateFilterInterface()};ChannelInterface.prototype.getFilterParams=function(){return this.connectable.filterParams};ChannelInterface.prototype.getValue=function(){if(this.connectable){return this.connectable.getValue()}else{return gettext("undefined")}};ChannelInterface.prototype.getValueWithoutFilter=function(){if(this.connectable){return this.connectable.getValueWithoutFilter()}else{return gettext("undefined")}};ChannelInterface.prototype.getValueWithFilter=function(){if(this.connectable){return this.connectable.getValue()}else{return gettext("undefined")}};ChannelInterface.prototype.commitChanges=function(c,a){var b;switch(a){case 1:if(this.connectable==null){return}for(b=0;b<this.inputsForRemoving.length;b++){this.inputsForRemoving[b].getConnectable().disconnect(this.connectable)}this.inputsForRemoving.clear();for(b=0;b<this.outputsForRemoving.length;b++){this.connectable.disconnect(this.outputsForRemoving[b].getConnectable())}this.outputsForRemoving.clear();break;case 3:if(this.connectable==null){this.connectable=c.createChannel(this.name)}this.connectable.setRemoteSubscription(this.remote_subscription);this.connectable._name=this.name;break;case 4:for(b=0;b<this.outputsForAdding.length;b++){this.connectable.connect(this.outputsForAdding[b].getConnectable())}this.outputsForAdding.clear();for(b=0;b<this.inputsForAdding.length;b++){this.inputsForAdding[b].getConnectable().connect(this.connectable)}this.inputsForAdding.clear();break}};ChannelInterface.prototype.exists=function(){return this.connectable!=null};ChannelInterface.prototype.check=function(){this._fillFilterParams();this.valueElement.setTextContent(this.getValueWithFilter());this.htmlElement.addClassName("selected");this.channelNameInput.focus()};ChannelInterface.prototype.uncheck=function(){this.htmlElement.removeClassName("selected");this.channelNameInput.blur()};ChannelInterface.prototype.getHTMLElement=function(){return this.htmlElement};ChannelInterface.prototype.setFilterParam=function(a,b){if(this.connectable){this.connectable.setFilterParam(a,b);this.wiringGUI.setFilterParam()}};ChannelInterface.prototype.remove=function(){var a=this.inputs.clone();for(var d=0;d<a.length;d++){var c=a[d];this.disconnectInput(c);if(c instanceof ChannelInterface){c.disconnectOutput(this)}}var f=this.outputs.clone();for(var d=0;d<f.length;d++){var b=f[d];this.disconnectOutput(b);if(b instanceof ChannelInterface){b.disconnectInput(this)}}};ChannelInterface.prototype.connectInput=function(a){if(a instanceof ChannelInterface){this.inputs.push(a);return}if(this.connectable!=null&&this.connectable.inputs.elementExists(a.getConnectable())){this.inputsForRemoving.remove(a)}else{this.inputsForAdding.push(a)}this.inputs.push(a)};ChannelInterface.prototype.disconnectInput=function(a){if(a instanceof ChannelInterface){this.inputs.remove(a);return}if(this.connectable!=null&&this.connectable.inputs.elementExists(a.getConnectable())){this.inputsForRemoving.push(a)}else{this.inputsForAdding.remove(a)}this.inputs.remove(a)};ChannelInterface.prototype.connectOutput=function(a){if(this.connectable!=null&&this.connectable.outputs.elementExists(a.getConnectable())){this.outputsForRemoving.remove(a)}else{this.outputsForAdding.push(a)}this.outputs.push(a)};ChannelInterface.prototype.disconnectOutput=function(a){if(this.connectable!=null&&this.connectable.outputs.elementExists(a.getConnectable())){this.outputsForRemoving.push(a)}else{this.outputsForAdding.remove(a)}this.outputs.remove(a)};ChannelInterface.prototype.destroy=function(){this.wiringGUI=null};ChannelInterface.prototype._changeFilterToConnectable=function(b,a){if(this.connectable==null){this.connectable=b.createChannel(this.name)}this.connectable.setFilter(this.filter);this.connectable.setFilterParams(a)};ChannelInterface.prototype._toggle_table_status=function(b,a){if(a==this.last_clicked_option_link&&this.opened_optional_table){b.addClassName("fold_table");a.removeClassName("selected_option_link");this.opened_optional_table=false}else{this._fold_all_tables();b.removeClassName("fold_table");a.toggleClassName("selected_option_link");this.opened_optional_table=true}this.last_clicked_option_link=a;this.wiringGUI.redrawChannelOutputs(this.wiringGUI.currentChannel);this.wiringGUI.redrawChannelInputs(this.wiringGUI.currentChannel)};ChannelInterface.prototype._fold_all_tables=function(){var b=$$(".contentTable");for(var a=0;a<b.length;a++){b[a].addClassName("fold_table")}var c=$$(".option_link");for(var a=0;a<c.length;a++){c[a].removeClassName("selected_option_link")}};function SimpleConnectableInterface(a,b,g){if(arguments.length==0){return}this.connected=false;ConnectableInterface.call(this,a,b);this.parentInterface=g;this.htmlElement=document.createElement("div");Element.extend(this.htmlElement);this.htmlElement.addClassName("connectable_row");var f=document.createElement("span");Element.extend(f);f.update(a.getLabel());this.htmlElement.appendChild(f);var h=b.getHTMLElement();this.htmlElement.appendChild(h);var d={chkItemAnchor:b,wiringGUI:this.wiringGUI};Event.observe(h,"click",function(){this.wiringGUI._changeConnectionStatus(this.chkItemAnchor)}.bind(d));var j=a.getFriendCode();if(j!=null){var d={friendCode:j,wiringGUI:this.wiringGUI};this.htmlElement.observe("mouseover",function(){this.wiringGUI._highlight_friend_code(this.friendCode,true)}.bind(d),false);this.htmlElement.observe("mouseout",function(){this.wiringGUI._highlight_friend_code(this.friendCode,false)}.bind(d),false)}function c(k){Event.stop(k)}this.htmlElement.observe("click",c,false)}SimpleConnectableInterface.prototype=new ConnectableInterface();SimpleConnectableInterface.prototype.getFriendCode=function(){return this.connectable.getFriendCode()};SimpleConnectableInterface.prototype.getHTMLElement=function(){return this.htmlElement};SimpleConnectableInterface.prototype._increaseConnections=function(){if(this.connected==true){return}this.connected=true;this.parentInterface._increaseConnections()};SimpleConnectableInterface.prototype._decreaseConnections=function(){if(this.connected==false){return}this.connected=false;this.parentInterface._decreaseConnections()};SimpleConnectableInterface.prototype.makeVisible=function(){this.parentInterface.makeVisible()};function SlotInterface(c,a,b){this.chkItemAnchor=new SlotConnectionAnchor(this);this.wiringGUI=c;SimpleConnectableInterface.call(this,a,this.chkItemAnchor,b);this.wiringGUI._registerSlot(this)}SlotInterface.prototype=new SimpleConnectableInterface();function EventInterface(c,a,b){this.chkItemAnchor=new EventConnectionAnchor(this);this.wiringGUI=c;SimpleConnectableInterface.call(this,a,this.chkItemAnchor,b);this.wiringGUI._registerEvent(this)}EventInterface.prototype=new SimpleConnectableInterface();function IGadgetSlotsInterface(f,g,h){ConnectableGroupInterface.call(this,g,h,f.name);this.htmlElement.addClassName("igadget");var b=g.wiring.getIGadgetConnectables(f);for(var d=0;d<b.length;d++){var a=b[d];if(!(a instanceof wSlot)){continue}var c=new SlotInterface(g,a,this);this.contentElement.appendChild(c.getHTMLElement());this.empty=false}if(this.empty==false){this.parentInterface._notifyNewEmptyStatus(this,false);this.htmlElement.removeClassName("empty")}}IGadgetSlotsInterface.prototype=new ConnectableGroupInterface();IGadgetSlotsInterface.prototype.repaintSiblings=function(){if(this.wiringGUI.currentChannel==null){return}this.wiringGUI.redrawChannelOutputs(this.wiringGUI.currentChannel)};IGadgetSlotsInterface.prototype._increaseConnections=function(){if(this.connections==0){this.htmlElement.addClassName("unfoldable")}ConnectableGroupInterface.prototype._increaseConnections.call(this)};IGadgetSlotsInterface.prototype._decreaseConnections=function(){ConnectableGroupInterface.prototype._decreaseConnections.call(this);if(this.connections==0){this.htmlElement.removeClassName("unfoldable")}};function IGadgetEventsInterface(f,g,h){ConnectableGroupInterface.call(this,g,h,f.name);this.htmlElement.addClassName("igadget");var b=g.wiring.getIGadgetConnectables(f);for(var d=0;d<b.length;d++){var a=b[d];if(!(a instanceof wEvent)){continue}var c=new EventInterface(g,a,this);this.contentElement.appendChild(c.getHTMLElement());this.empty=false}if(this.empty==false){this.parentInterface._notifyNewEmptyStatus(this,false);this.htmlElement.removeClassName("empty")}}IGadgetEventsInterface.prototype=new ConnectableGroupInterface();IGadgetEventsInterface.prototype.repaintSiblings=function(){if(this.wiringGUI.currentChannel==null){return}this.wiringGUI.redrawChannelInputs(this.wiringGUI.currentChannel)};IGadgetEventsInterface.prototype._increaseConnections=function(){if(this.connections==0){this.htmlElement.addClassName("unfoldable")}ConnectableGroupInterface.prototype._increaseConnections.call(this)};IGadgetEventsInterface.prototype._decreaseConnections=function(){ConnectableGroupInterface.prototype._decreaseConnections.call(this);if(this.connections==0){this.htmlElement.removeClassName("unfoldable")}};function ConnectableColumnInterface(a){this.childConnectableGroups=[];this.htmlElement=a}ConnectableColumnInterface.prototype.isAnyFolded=ConnectableGroupInterface.prototype.isAnyFolded;ConnectableColumnInterface.prototype.massiveToggle=ConnectableGroupInterface.prototype.massiveToggle;ConnectableColumnInterface.prototype.massiveExpand=function(b){for(var a=0;a<this.childConnectableGroups.length;a++){this.childConnectableGroups[a].massiveExpand(b)}};ConnectableColumnInterface.prototype.massiveFold=function(b){for(var a=0;a<this.childConnectableGroups.length;a++){this.childConnectableGroups[a].massiveFold(b)}};ConnectableColumnInterface.prototype.add=function(a){this.htmlElement.appendChild(a.getHTMLElement());this.childConnectableGroups.push(a)};function JPathToken(b,a){this._type=b;this._value=a}function JPathParam(b,f,d,a,c){Param.prototype.Param.call(this,b,f,"jpath",d,a,c)}JPathParam.prototype=new Param;JPathParam.prototype.isChar=function(a){switch(a){case"[":case"]":case".":case":":case"\\":case"=":case'"':return false;break;default:return true;break}};JPathParam.prototype.parse=function(c){var f=new Array();var a=c.length;var b=0;var d=1;do{if((c.charAt(b)=="")&&(d!=1)){throw"Unexpected end of expression"}switch(d){case 1:switch(c.charAt(b)){case"\\":c=c.substring(0,b)+c.substring(b+1);d=2;break;case"[":if(b!=0){f.push(new JPathToken("text",c.substring(0,b)))}c=c.substring(b+1);b=0;d=3;break;case"":if(b!=0){f.push(new JPathToken("text",c.substring(0,b)))}return f;break;default:b++;d=1}break;case 2:b++;d=1;break;case 3:case 5:if(this.isChar(c.charAt(b))){b++;d=4}else{throw"Unexpected character "+d}break;case 4:switch(c.charAt(b)){case"]":f.push(new JPathToken("element",c.substring(0,b)));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1;break;case".":f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=5;break;case":":f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=6;break;case"[":case"\\":case"=":throw"Unexpected character "+d;break;default:b++;d=4}break;case 6:if(c.indexOf("index=")==0){f.push(new JPathToken("index_cond",""));c=c.substring(b+6);b=0;d=7}else{if(c.indexOf("first:")==0){f.push(new JPathToken("first_cond",""));c=c.substring(b+6);b=0;d=16}else{if(c.indexOf("last:")==0){f.push(new JPathToken("last_cond",""));c=c.substring(b+5);b=0;d=16}else{if(this.isChar(c.charAt(b))){b++;d=9}else{throw"Unexpected character "+d}}}}break;case 7:if(c.indexOf("first")==0){f.push(new JPathToken("first_index",""));c=c.substring(b+5);b=0;d=18}else{if(c.indexOf("last")==0){f.push(new JPathToken("last_index",""));c=c.substring(b+4);b=0;d=18}else{if(!isNaN(parseInt(c.charAt(b)))){b++;d=8}else{throw"Unexpected character "+d}}}break;case 8:if(!isNaN(parseInt(c.charAt(b)))){b++;d=8}else{if(c.charAt(b)==":"){f.push(new JPathToken("value",parseInt(c.substring(0,b))));c=c.substring(b+1);b=0;d=12}else{if(c.charAt(b)=="]"){f.push(new JPathToken("value",parseInt(c.substring(0,b))));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1}else{throw"Unexpected character "+d}}}break;case 9:switch(c.charAt(b)){case".":f.push(new JPathToken("condition",c.substring(0,b)));c=c.substring(b+1);b=0;d=15;break;case"=":f.push(new JPathToken("condition",c.substring(0,b)));f.push(new JPathToken("op","="));c=c.substring(b+1);b=0;d=10;break;case":":case"[":case"]":case"\\":throw"Unexpected character "+d;break;default:b++;d=9}break;case 10:if(c.charAt(b)=='"'){c=c.substring(b+1);b=0;d=17}else{if(this.isChar(c.charAt(b))){b++;d=11}else{throw"Unexpected character "+d}}break;case 11:if(c.charAt(b)==":"){f.push(new JPathToken("value",c.substring(0,b)));c=c.substring(b+1);b=0;d=12}else{if(this.isChar(c.charAt(b))){b++;d=11}else{throw"Unexpected character "+d}}break;case 12:if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}break;case 13:if(c.charAt(b)=="]"){f.push(new JPathToken("element",c.substring(0,b)));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1}else{if(c.charAt(b)=="."){f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=14}else{if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}}}break;case 14:if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}break;case 15:case 16:if(this.isChar(c.charAt(b))){b++;d=9}else{throw"Unexpected character "+d}break;case 17:switch(c.charAt(b)){case'"':f.push(new JPathToken("value",c.substring(0,b)));c=c.substring(b+1);b=0;d=18;break;default:b++;d=17;break}break;case 18:switch(c.charAt(b)){case"]":f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1;break;case":":c=c.substring(b+1);b=0;d=12;break;default:throw"Unexpected character "+d}break;default:throw"Lex parser error. Unexpected state "+d}a--}while(a>=0);if(a<0){throw"Lex parser error. Too many iterations"}};JSONParser=new Object();JSONParser.findConditionalElement=function(n,f,a,d){if((typeof n!="object")||(n.length==undefined)){throw"JSON must be a list"}var g=new Array();var h,k;var l,m;for(var c=0;c<n.length;c++){k=d;l=f[k];do{h=this.findJSONElement(l._value,n[c]);l=f[++k]}while(l._type!="op");m=f[++k];for(var b=0;b<n.length;b++){switch(l._value){case"=":if(h[b]==m._value){if(a=="first"){return n[c]}else{g.push(n[c]);break}}break;default:throw"Unexpected operator";break}}}if(g.length==0){return undefined}if(a=="last"){return g[g.length-1]}return g};JSONParser.findJSONElement=function(d,c){if(typeof c!="object"){return undefined}if(c[d]!=undefined){return c[d]}if(c.length!=undefined){var b=new Array();for(var a=0;a<c.length;a++){var g=this.findJSONElement(d,c[a]);if(g!=undefined){b.push(g)}}if(b.length==0){b=undefined}return b}for(var f in c){var b=this.findJSONElement(d,c[f]);if(b!=undefined){return b}}return undefined};JSONParser.parse=function(l,m){var n=new Array();var h=null;var o=null;var f=null;if(l==""){h={}}else{var g=0;while(g<l.length){switch(l[g]){case"\n":l=l.substring(0,g)+l.substring(g+1);break;default:g++;break}}h=JSON.parse(l)}for(var j=0;j<m.length;j++){var d=m[j];switch(d._type){case"text":n.push(d._value);break;case"element":h=this.findJSONElement(d._value,h);break;case"index_cond":var c=m[++j];var b=null;switch(c._type){case"first_index":b=0;break;case"last_index":b=h.length-1;break;default:b=c._value;break}h=h[b];break;case"first_cond":f="first";break;case"last_cond":f="last";break;case"condition":h=this.findConditionalElement(h,m,f,j);while(m[j]._type!="value"){j++}break;case"separator":switch(typeof h){case"object":n.push(Object.toJSON(h));break;case"string":var a=h.indexOf('"');var p=h.lastIndexOf('"');if((a==0)&&(p>0)&&(p==(h.length-1))){h=h.substring(1,p)}default:n.push(h);break}h=JSON.parse(l);break;default:throw"Unexpected token"}}return n.join("")};function UIUtils(){}UIUtils.tagmode=false;UIUtils.repaintCatalogue=false;UIUtils.sendingPendingTags=false;UIUtils.selectedResource=null;UIUtils.selectedVersion=null;UIUtils.imageBottom="";UIUtils.imageContent="";UIUtils.infoResourcesWidth=400;UIUtils.isInfoResourcesOpen=false;UIUtils.page=1;UIUtils.off=10;UIUtils.orderby="-popularity";UIUtils.num_items=0;UIUtils.search=false;UIUtils.searchValue=[];UIUtils.searchCriteria="";UIUtils.counter=0;UIUtils.globalTags="all";UIUtils.addResourceToApplication=function(f,c){var d=function(h){UIUtils.repaintOrderedByCreationDate()};var b=function(h){alert("Error en addingToApp")};var g=new Hash();var a=URIs.ADD_RESOURCE_TO_APP.evaluate({application_id:c,resource_id:f});PersistenceEngineFactory.getInstance().send_post(a,g,this,d,b)};UIUtils.addResource=function(b,f,h){UIUtils.repaintCatalogue=true;UIUtils.search=false;var c=function(l){var o=l.responseText;var k=JSON.parse(o);var n=function(r){if(r.contratable){var t=r.gadgetId;var q=r.availableApps;CatalogueFactory.getInstance().setAvailableApps(q);LayoutManagerFactory.getInstance().showWindowMenu("addGadgetToAppMenu",UIUtils.addResourceToApplication,function(){LayoutManagerFactory.getInstance().hideCover()},t)}else{UIUtils.repaintOrderedByCreationDate()}};var j=function(q){var t=URIs.GET_POST_RESOURCES+"/"+q.vendor+"/"+q.gadgetName+"/"+q.version;var r=function(x,v){var u=LogManagerFactory.getInstance();var w=u.formatError(gettext("Error deleting the Gadget: %(errorMsg)s."),x,v);u.log(w);LayoutManagerFactory.getInstance().hideCover()};PersistenceEngineFactory.getInstance().send_delete(t,this,function(){LayoutManagerFactory.getInstance().hideCover()},r)};var m={result:k,continueAdding:n,rollback:j};if(k.last_version!=k.version){var p=gettext("The resource you are adding to the catalogue is not the latest version. The current version, %(curr_version)s, is lower than the latest version in the catalogue: %(last_version)s. Do you really want to continue to add version %(curr_version)s ");p=interpolate(p,{curr_version:k.version,last_version:k.last_version},true);LayoutManagerFactory.getInstance().showYesNoDialog(p,function(){this.continueAdding(this.result)}.bind(m),function(){this.rollback(this.result)}.bind(m),Constants.Logging.WARN_MSG)}else{n(k)}};var a=function(o,m){var j=o.responseText;var l=JSON.parse(j)["message"];var k=LogManagerFactory.getInstance();var n=gettext("The resource could not be added to the catalogue: %(errorMsg)s.");n=interpolate(n,{errorMsg:l},true);LayoutManagerFactory.getInstance().hideCover();LayoutManagerFactory.getInstance().showMessageMenu(n,Constants.Logging.ERROR_MSG);k.log(n)};var d=PersistenceEngineFactory.getInstance();var g=new Hash();g[f]=h;d.send_post(b,g,this,c,a)};UIUtils.repaintOrderedByCreationDate=function(){UIUtils.orderby="-creation_date";UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),1,UIUtils.getNum_items())};UIUtils.getSelectedResource=function(){return UIUtils.selectedResource};UIUtils.lightUpConnectableResources=function(a){};UIUtils.showResourceInfo=function(a){UIUtils.selectedResource=a;$(UIUtils.selectedResource).addClassName("current");CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).showInfo()};UIUtils.updateGadgetXHTML=function(){var c=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var f={vendor:c.getVendor(),name:c.getName(),version:c.getVersion()};var b=URIs.GET_GADGET.evaluate(f)+"/xhtml";var a=function(k,h){var g=LogManagerFactory.getInstance();var j=g.formatError(gettext("Error updating the XHTML: %(errorMsg)s."),k,h);g.log(j);LayoutManagerFactory.getInstance().showMessageMenu(j,Constants.Logging.ERROR_MSG)};var d=function(g){LayoutManagerFactory.getInstance().showMessageMenu(gettext("The gadget code has been successfully updated"))};PersistenceEngineFactory.getInstance().send_update(b,"",this,d,a)};UIUtils.clearPreviousSearch=function(){UIUtils.search=false;UIUtils.searchValue=[];UIUtils.searchCriteria=""};UIUtils.toggle_elements=function(a){for(i=0;i<a.length;i++){UIUtils.toggle(a[i])}};UIUtils.toggle=function(b){var a=$(b);if(a.style.display!="none"){a.style.display="none"}else{a.style.display="block"}};UIUtils.show=function(b){var a=$(b);a.style.display="inline"};UIUtils.hidde=function(b){var a=$(b);a.style.display="none"};UIUtils.changeImage=function(b,c){var a=$(b);a.src=c};UIUtils.simpleSearch=function(a,b){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.searchValue=[];switch(b){case"simple_or":UIUtils.searchValue[0]=$("simple_search_text").value;break;case"and":UIUtils.searchValue[0]=$("advanced_search_text_and").value;break;case"or":UIUtils.searchValue[0]=$("advanced_search_text_or").value;break;case"not":UIUtils.searchValue[0]=$("advanced_search_text_not").value;break;case"tag":UIUtils.searchValue[0]=$("advanced_search_text_tag").value;break;case"event":UIUtils.searchValue[0]=$("advanced_search_text_event").value;break;case"slot":UIUtils.searchValue[0]=$("advanced_search_text_slot").value;break}UIUtils.searchValue[0]=UIUtils.filterString(UIUtils.searchValue[0]);if(UIUtils.searchValue[0]==""){$("header_always_error").style.display="none";UIUtils.page=1;UIUtils.off=10;UIUtils.search=false;UIUtils.searchCriteria="";CatalogueFactory.getInstance().repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())}else{$("header_always_error").style.display="none";UIUtils.setPage(1);UIUtils.search=true;UIUtils.searchCriteria=b;CatalogueFactory.getInstance().repaintCatalogue(a+"/"+b+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())}};UIUtils.viewAll=function(a,b){$("header_always_error").style.display="none";UIUtils.page=1;UIUtils.off=10;UIUtils.search=false;UIUtils.searchCriteria="";CatalogueFactory.getInstance().repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())};UIUtils.globalSearch=function(a){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.searchValue=[];UIUtils.searchValue[0]=UIUtils.filterString($("advanced_search_text_and").value);UIUtils.searchValue[1]=UIUtils.filterString($("advanced_search_text_or").value);UIUtils.searchValue[2]=UIUtils.filterString($("advanced_search_text_not").value);UIUtils.searchValue[3]=UIUtils.filterString($("advanced_search_text_tag").value);UIUtils.searchValue[4]=UIUtils.filterString($("advanced_search_text_event").value);UIUtils.searchValue[5]=UIUtils.filterString($("advanced_search_text_slot").value);if(UIUtils.searchValue[0]==""&&UIUtils.searchValue[1]==""&&UIUtils.searchValue[2]==""&&UIUtils.searchValue[3]==""&&UIUtils.searchValue[4]==""&&UIUtils.searchValue[5]==""){$("header_always_error").style.display="block";UIUtils.getError($("header_always_error"),gettext("Indicate a criteria in search formulary"))}else{$("header_always_error").style.display="none";UIUtils.setPage(1);UIUtils.search=true;UIUtils.searchCriteria="global";CatalogueFactory.getInstance().repaintCatalogue(a+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())}};UIUtils.clearSearchForm=function(){$("advanced_search_text_and").value="";$("advanced_search_text_or").value="";$("advanced_search_text_not").value="";$("advanced_search_text_tag").value="";$("advanced_search_text_event").value="";$("advanced_search_text_slot").value=""};UIUtils.searchByConnectivity=function(d,g,c){var f=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var b=f.getName();var a=f.getVersion();UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.searchValue=[];$("header_always_error").style.display="none";UIUtils.setPage(1);UIUtils.search=true;UIUtils.searchValue[0]=c;UIUtils.searchCriteria=g;CatalogueFactory.getInstance().repaintCatalogue(d+"/"+g+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset(),b,a)};UIUtils.searchByGlobalConnectivity=function(f,a,c){var g=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var d=g.getName();var b=g.getVersion();UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.searchValue=[];$("header_always_error").style.display="none";UIUtils.setPage(1);UIUtils.search=true;UIUtils.searchValue[0]=a;UIUtils.searchValue[1]=c;UIUtils.searchCriteria="connectEventSlot";CatalogueFactory.getInstance().repaintCatalogue(f+"/connectEventSlot/"+UIUtils.getPage()+"/"+UIUtils.getOffset(),d,b)};UIUtils.searchByTag=function(b,a,c){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.searchValue=[];if(a==""){$("header_always_error").style.display="block";UIUtils.getError($("header_always_error"),gettext("Indicate a criteria in search formulary"))}else{$("header_always_error").style.display="none";UIUtils.setPage(1);UIUtils.search=true;UIUtils.searchValue[0]=a;UIUtils.searchCriteria="tag";CatalogueFactory.getInstance().repaintCatalogue(b+"/tag/"+UIUtils.getPage()+"/"+UIUtils.getOffset(),null,null,c)}};UIUtils.cataloguePaginate=function(c,g,f,b){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();UIUtils.off=g;UIUtils.num_items=b;var d=OpManagerFactory.getInstance();var a=Math.ceil(UIUtils.getNum_items()/UIUtils.getOffset());if(!UIUtils.search){c=URIs.GET_POST_RESOURCES}else{if(UIUtils.searchCriteria=="global"){c=URIs.GET_RESOURCES_GLOBAL_SEARCH}else{c=URIs.GET_RESOURCES_SIMPLE_SEARCH+"/"+UIUtils.searchCriteria}}switch(f){case"first":f=1;break;case"prev":if(UIUtils.page==1){f=1}else{f=UIUtils.page-1}break;case"next":if(UIUtils.page==a){f=a}else{f=parseInt(UIUtils.page)+1}break;case"last":f=a;break}UIUtils.page=f;CatalogueFactory.getInstance().repaintCatalogue(c+"/"+f+"/"+UIUtils.getOffset(),null,null,true)};UIUtils.setOrderby=function(a){UIUtils.orderby=a.value};UIUtils.getPage=function(){return UIUtils.page};UIUtils.setPage=function(a){UIUtils.page=a};UIUtils.getOffset=function(){return UIUtils.off};UIUtils.setOffset=function(a){UIUtils.off=a};UIUtils.getNum_items=function(){return UIUtils.num_items};UIUtils.removeTag=function(a){var b=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();b.removeTag(a)};UIUtils.removeGlobalTag=function(b){var f;selectedResources=CatalogueFactory.getInstance().getSelectedResources();for(var c=0;c<selectedResources.length;c++){f=CatalogueFactory.getInstance().getResource(selectedResources[c]).getTagger();f.removeTag(b)}var d=$("my_global_tags");var a=$(b);d.removeChild(a)};UIUtils.removeAllTags=function(){var a=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();a.removeAll();$("tag_alert").style.display="none";$("new_tag_text_input").value="";$("new_tag_text_input").size=5;$("new_tag_text_input").focus()};UIUtils.removeAllGlobalTags=function(){if(UIUtils.tagmode){selectedResources=CatalogueFactory.getInstance().getSelectedResources();for(var a=0;a<selectedResources.length;a++){tagger=CatalogueFactory.getInstance().getResource(selectedResources[a]).getTagger();tagger.removeAll()}}var b=$("my_global_tags");while(b.childNodes.length>1){b.removeChild(b.childNodes[0])}$("global_tag_alert").style.display="none";$("new_global_tag_text_input").value="";$("new_global_tag_text_input").size=5;if($("new_global_tag_text").style.display!="none"&&$("new_global_tag_text_input").style.display!="none"&&$("advanced_tag").style.display!="none"){$("new_global_tag_text_input").focus()}};UIUtils.removeTagUser=function(a,k){var f=CatalogueFactory.getInstance().getResource(k);var c=f.getTags();var g=null;for(var b=0;b<c.length;b++){if(c[b].getValue()==a){g=c[b].getIdentifier();break}}var h=f.getTagger();var d="/"+f.getVendor()+"/"+f.getName()+"/"+f.getVersion()+"/"+g;h.removeTagUser(URIs.DELETE_TAG,d,k)};UIUtils.removeGlobalTagUser=function(l){var b=CatalogueFactory.getInstance().getSelectedResources();for(var f=0;f<b.length;f++){var c=CatalogueFactory.getInstance().getResource(b[f]);var k=c.getTags();for(var d=0;d<k.length;d++){if(l==k[d].getValue()){var a=k[d].getIdentifier();var g=c.getTagger();var h="/"+c.getVendor()+"/"+c.getName()+"/"+c.getVersion()+"/"+a;g.removeTagUser(URIs.DELETE_TAG,h,b[f])}}}};UIUtils.sendPendingTags=function(){UIUtils.sendingPendingTags=true;if(UIUtils.tagmode){UIUtils.sendGlobalTags()}else{if(UIUtils.selectedResource!=null){var a=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var b=a.getTagger();if(b.getTags().size()!=0){UIUtils.sendTags()}}}UIUtils.sendingPendingTags=false};UIUtils.sendTags=function(){var b=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var c=b.getTagger();var a="/"+b.getVendor()+"/"+b.getName()+"/"+b.getVersion();if((c.getTags().size()==0||$("new_tag_text_input").value.length!=0)&&!UIUtils.sendingPendingTags){UIUtils.addTag($("new_tag_text_input"))}c.sendTags(URIs.POST_RESOURCE_TAGS,a,b)};UIUtils.sendGlobalTags=function(){var f=CatalogueFactory.getInstance().getSelectedResources();var d;var g;var c;for(var a=0;a<f.length;a++){d=CatalogueFactory.getInstance().getResource(f[a]);g=d.getTagger();c="/"+d.getVendor()+"/"+d.getName()+"/"+d.getVersion();if((g.getTags().size()==0||$("new_global_tag_text_input").value.length!=0)&&!UIUtils.sendingPendingTags){UIUtils.addGlobalTag($("new_global_tag_text_input"))}g.sendTags(URIs.POST_RESOURCE_TAGS,c,d)}var b=$("my_global_tags");while(b.childNodes.length>1){b.removeChild(b.childNodes[0])}};UIUtils.deleteGadget=function(f){var d=CatalogueFactory.getInstance().getResource(f);if(UIUtils.selectedVersion==null){var c=URIs.GET_POST_RESOURCES+"/"+d.getVendor()+"/"+d.getName()}else{var c=URIs.GET_POST_RESOURCES+"/"+d.getVendor()+"/"+d.getName()+"/"+UIUtils.selectedVersion}UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();var b=function(k,h){var g=LogManagerFactory.getInstance();var j=g.formatError(gettext("Error deleting the Gadget: %(errorMsg)s."),k,h);g.log(j);LayoutManagerFactory.getInstance().hideCover()};var a=function(g){LayoutManagerFactory.getInstance().hideCover();CatalogueFactory.getInstance().repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())};PersistenceEngineFactory.getInstance().send_delete(c,this,a,b)};UIUtils.addTag=function(a){var b=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getTagger();b.addTag(a.value);a.value="";a.focus();a.size=5};UIUtils.addGlobalTag=function(b){if(b.value.length<3){$("global_tag_alert").style.display="inline";UIUtils.getError($("global_tag_alert"),gettext("Tags must have at least three characters."))}else{var d="new_global_tag_"+UIUtils.counter;UIUtils.counter++;var c;selectedResources=CatalogueFactory.getInstance().getSelectedResources();for(var a=0;a<selectedResources.length;a++){c=CatalogueFactory.getInstance().getResource(selectedResources[a]).getTagger();c.addGlobalTag(b.value)}UIUtils.paintGlobalTag(d,b.value);$("global_tag_alert").style.display="none";b.value="";b.focus();b.size=5}};UIUtils.paintGlobalTag=function(b,a){var c=UIUtils.createHTMLElement("div",$H({id:b,class_name:"new_global_tag"}));c.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:a})));var f=UIUtils.createHTMLElement("div",$H());c.appendChild(f);var d=UIUtils.createHTMLElement("a",$H({title:gettext("Delete gadget")}));d.observe("click",function(h){UIUtils.removeGlobalTag(b)});f.appendChild(d);var g=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("showcase-delete")}));g.observe("mouseover",function(h){this.src=_currentTheme.getIconURL("showcase-delete_highlighted")});g.observe("mouseout",function(h){this.src=_currentTheme.getIconURL("showcase-delete")});d.appendChild(g);$("my_global_tags").insertBefore(c,$("new_global_tag_text"))};UIUtils.setResourcesWidth=function(){var k=$("catalogue");var c=$("resources");var a=$("center");var f=$("left_bar");var j;j=document.defaultView.getComputedStyle(f,null);var b=j.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);b+=j.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);b+=j.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX);b+=j.getPropertyCSSValue("border-right-width").getFloatValue(CSSPrimitiveValue.CSS_PX);j=document.defaultView.getComputedStyle(a,null);var h=j.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX);h+=j.getPropertyCSSValue("border-right-width").getFloatValue(CSSPrimitiveValue.CSS_PX);var g=$("catalogue_content");j=document.defaultView.getComputedStyle(g,null);var d=j.getPropertyCSSValue("padding-left").getFloatValue(CSSPrimitiveValue.CSS_PX);g.style.width=(k.offsetWidth-f.offsetWidth-b-d)+"px";if(a){a.style.width=g.offsetWidth-d-h-(UIUtils.isInfoResourcesOpen?(UIUtils.infoResourcesWidth+20):0)+"px";c.style.width=a.style.width}};UIUtils.setInfoResourceHeight=function(){var a=$("resources_container").getHeight()-$("info_resource_content").getHeight();if(a>0){$("info_resource").style.height=$("info_resource_content").getHeight()+a-1+"px"}else{$("info_resource").style.height=$("info_resource_content").getHeight()+"px"}};UIUtils.openInfoResource=function(){if(!UIUtils.isInfoResourcesOpen){UIUtils.isInfoResourcesOpen=true;UIUtils.SlideInfoResourceIntoView("info_resource");UIUtils.setInfoResourceHeight()}};UIUtils.closeInfoResource=function(){if(UIUtils.isInfoResourcesOpen){UIUtils.isInfoResourcesOpen=false;$(UIUtils.selectedResource).removeClassName("current");UIUtils.SlideInfoResourceOutOfView("info_resource")}};UIUtils.SlideInfoResourceIntoView=function(a){$(a).style.overflow="hidden";$(a).firstChild.style.position="relative";UIUtils.setResourcesWidth();Element.show(a);UIUtils.resizeResourcesContainer();if(UIUtils.selectedResource!=null){UIUtils.lightUpConnectableResources(UIUtils.selectedResource)}};UIUtils.SlideInfoResourceOutOfView=function(a){UIUtils.selectedResource=null;$(a).style.overflow="hidden";$(a).firstChild.style.position="relative";Element.hide(a);UIUtils.setResourcesWidth();UIUtils.resizeResourcesContainer()};UIUtils.SlideAdvanced=function(d,b){var g=$(b);var c=g.childNodes;var a="";var f="";UIUtils.sendPendingTags();if(Element.visible(d)==false){for(i=0;i<c.length;i++){if(c.item(i).nodeName=="DIV"&&c.item(i).id!=d&&c.item(i).id!="header_always"){if(Element.visible(c.item(i))==true){Element.hide(c.item(i));UIUtils.resizeResourcesContainer();a=c.item(i).id.split("_");switch(a[1].toLowerCase()){case"tag":f=gettext("Advanced Tagging");break;case"search":f=gettext("Advanced Search");break;case"develop":f=gettext("Development Options");break;default:break}$(c.item(i).id+"_toggle").innerHTML=f;$(c.item(i).id+"_toggle").removeClassName("advanced_selected");if(c.item(i).id=="advanced_tag"){UIUtils.deactivateTagMode()}}}}Element.show(d);UIUtils.resizeResourcesContainer();a=d.split("_");switch(a[1].toLowerCase()){case"tag":f=gettext("Hide Tagging");break;case"search":f=gettext("Simple Search");break;case"develop":f=gettext("Hide Development Options");break;default:break}$(d+"_toggle").innerHTML=f;$(d+"_toggle").addClassName("advanced_selected");if(d=="advanced_tag"){UIUtils.activateTagMode()}}else{Element.hide(d);UIUtils.resizeResourcesContainer();a=d.split("_");switch(a[1].toLowerCase()){case"tag":f=gettext("Advanced Tagging");break;case"search":f=gettext("Advanced Search");break;case"develop":f=gettext("Development Options");break;default:break}$(d+"_toggle").innerHTML=f;$(d+"_toggle").removeClassName("advanced_selected");if(d=="advanced_tag"){UIUtils.deactivateTagMode()}}};UIUtils.activateTagMode=function(){UIUtils.tagmode=true;UIUtils.removeAllGlobalTags();UIUtils.closeInfoResource();$("global_tagcloud").innerHTML="";$("my_global_tags").childNodes[0].style.display="none";UIUtils.resizeResourcesContainer()};UIUtils.deactivateTagMode=function(){UIUtils.sendPendingTags();UIUtils.tagmode=false;var a=CatalogueFactory.getInstance().getSelectedResources();for(var b=0;b<a.length;b++){UIUtils.deselectResource(a[b])}CatalogueFactory.getInstance().clearSelectedResources();UIUtils.resizeResourcesContainer()};UIUtils.rgbConvert=function(a){var b="#"+parseInt(a.red.cssText,10).toString(16).toLowerCase();b+=parseInt(a.green.cssText,10).toString(16).toLowerCase();b+=parseInt(a.blue.cssText,10).toString(16).toLowerCase();return b};UIUtils.showResourceTagCloud=function(f){if(UIUtils.selectedResource){$(UIUtils.selectedResource).removeClassName("current")}UIUtils.showResourceInfo(f);UIUtils.openInfoResource();var c=$$("#info_resource .tagcloud .tags")[0];c.parentNode.parentNode.scrollIntoView(true);var d="#349ee8";var g=document.defaultView.getComputedStyle(c,null);var b=this.rgbConvert(g.getPropertyCSSValue("background-color").getRGBColorValue());var a=new BackgroundFadder(c,d,b,0,3000);a.fade()};UIUtils.clickOnResource=function(a){if(UIUtils.selectedResource){$(UIUtils.selectedResource).removeClassName("current")}if(UIUtils.tagmode){UIUtils.toggleSelectedResource(a)}else{UIUtils.showResourceInfo(a);UIUtils.openInfoResource()}};UIUtils._updateMyGlobalTags=function(){if(CatalogueFactory.getInstance().getSelectedResources().length==0){$("my_global_tags").childNodes[0].style.display="none"}else{$("my_global_tags").childNodes[0].style.display="inline"}};UIUtils._updateTagInfo=function(a){UIUtils._updateMyGlobalTags();UIUtils.removeAllGlobalTags();CatalogueFactory.getInstance().updateGlobalTags()};UIUtils.selectResource=function(a){$(a).addClassName("selected");CatalogueFactory.getInstance().addSelectedResource(a);UIUtils._updateTagInfo()};UIUtils.deselectResource=function(a){$(a).removeClassName("selected");CatalogueFactory.getInstance().removeSelectedResource(a);UIUtils._updateTagInfo()};UIUtils.toggleSelectedResource=function(a){if(CatalogueFactory.getInstance().isSelectedResource(a)){UIUtils.deselectResource(a)}else{UIUtils.selectResource(a)}};UIUtils.enlargeInput=function(a){if(a.value.length>5){a.size=a.value.length+1}};UIUtils.getError=function(b,a){var c='javascript:$("'+b.id+'").style.display="none"';b.innerHTML="";b.appendChild(UIUtils.createHTMLElement("img",$H({class_name:"warning",src:"/ezweb/images/ico_error_mini.gif"})));b.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:a})));var d=UIUtils.createHTMLElement("img",$H({class_name:"close",src:_currentTheme.getIconURL("delete")}));d.observe("mouseover",function(f){this.src=_currentTheme.getIconURL("delete_highlighted")});d.observe("mouseout",function(f){this.src=_currentTheme.getIconURL("delete")});d.observe("click",function(f){$(b.id).style.display="none"});b.appendChild(d);new Effect.Highlight(b,{duration:0.5,startcolor:"#FF0000",endcolor:"#FFFF00",restorecolor:"#FFFF00"})};UIUtils.splitString=function(b){var a=[""];b=b.replace(/^\s+|\s+$/g,"");a=b.split(/\s+/);return a};UIUtils.filterString=function(a){a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/\s+/g," ");return a};UIUtils.onReturn=function(b,a,c){if(!b){b=window.event}if(b&&b.keyCode&&b.keyCode==13){Event.stop(b);a(c,arguments[3])}};UIUtils.rating=function(a){var c=a.id.replace("_","");for(var b=1;b<=5;b++){if(b<=c){$("_"+b).className="on"}else{$("_"+b).className=""}}};UIUtils.off_rating=function(b){var a=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getUserVote();for(var c=1;c<=5;c++){if(c<=a){$("_"+c).className="on"}else{$("_"+c).className=""}}};UIUtils.sendVotes=function(a){var b=function(j){alert(gettext("Error POST"))};var g=function(l){var k=l.responseText;var j=JSON.parse(k);f.setVotes(j)};var f=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var d="/"+f.getVendor()+"/"+f.getName()+"/"+f.getVersion();var c=a.id.replace("_","");var h={vote:c};if(f.getUserVote()==0){PersistenceEngineFactory.getInstance().send_post(URIs.POST_RESOURCE_VOTES+d,h,this,g,b)}else{PersistenceEngineFactory.getInstance().send_update(URIs.POST_RESOURCE_VOTES+d,h,this,g,b)}};UIUtils.createHTMLElement=function(a,b){var c=document.createElement(a);Element.extend(c);if(b){b.each(function(f){var d=f.key;switch(d){case"innerHTML":c.innerHTML=f.value;break;case"class_name":c.className=f.value;break;case"style":if(BrowserUtilsFactory.getInstance().isIE()&&BrowserUtilsFactory.getInstance().getBrowser()!="IE8"){c.style.setAttribute("cssText",f.value)}else{c.setAttribute(d,f.value)}break;case"for_":d="for";default:c.setAttribute(d,f.value)}})}return c};UIUtils.setPreferredGadgetVersion=function(f){var a=function(l,j){var h=LogManagerFactory.getInstance();var k=h.formatError(gettext("Error updating the preferred version: %(errorMsg)s."),l,j);LogManagerFactory.getInstance().log(k)};var g=function(h){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();UIUtils.closeInfoResource();CatalogueFactory.getInstance().repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())};var d=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource);var c=URIs.GET_POST_RESOURCES+"/"+d.getVendor()+"/"+d.getName()+"/"+f;var b={preferred:true};PersistenceEngineFactory.getInstance().send_update(c,b,this,g,a)};UIUtils.resizeResourcesContainer=function(){var a=document.getElementById("showcase_container").offsetHeight-document.getElementById("head").offsetHeight-document.getElementById("resources_header").offsetHeight-18;document.getElementById("resources").style.height=a+"px";document.getElementById("resources_container").style.height=$("center").offsetHeight+"px";UIUtils.setInfoResourceHeight();UIUtils.uploadFile=function(){LayoutManagerFactory.getInstance()._startComplexTask(gettext("Uploading packaged gadget"),1);var b=document.getElementById("upload_form");var c=document.getElementById("upload");if(!c.onload){c.onload=function(){UIUtils.checkFile()}}b.submit()};UIUtils.checkFile=function(){var c=document.getElementById("upload");if(c.contentDocument){var h=c.contentDocument}else{if(c.contentWindow){var h=c.contentWindow.document}else{var h=window.frames.upload.document}}var b=LayoutManagerFactory.getInstance();if(h.location.href.search("error")>=0){var f=LogManagerFactory.getInstance();var g=gettext("The resource could not be added to the catalogue: %(errorMsg)s");g=interpolate(g,{errorMsg:h.body.textContent},true);b._notifyPlatformReady();b.showMessageMenu(g,Constants.Logging.ERROR_MSG);f.log(g);return}else{b.logSubTask(gettext("Gadget uploaded successfully"));b.logStep("");b._notifyPlatformReady()}this.viewAll()}};var lastOpenCategory=null;var _createCatElement=function(a,d,c){var b=new TagCategory(a,d.tags,new Hash(d.children),c);return b.getElement()};var CategoryManager=function(){this.categories;this.categorySection=document.createElement("ul");$$("#tag_categories .widget_content")[0].appendChild(this.categorySection);this.categories=new Hash(JSON.parse(tag_categories));this.createCategories()};CategoryManager.prototype.createCategories=function(){var c;var b=this.categories.keys().sort();for(var a=0;a<b.length;a++){c=_createCatElement(b[a],this.categories[b[a]]);this.categorySection.appendChild(c)}};CategoryManager.prototype.closeCategories=function(){if(lastOpenCategory){lastOpenCategory.catNameElement.removeClassName("selected_cat");var b=$$(".children_cats.open");for(var a=0;a<b.length;a++){b[a].removeClassName("open")}lastOpenCategory=null}};var TagCategory=function(b,a,c,d){this.name=b;this.tags=a;this.children=c;this.catNameElement;this.catChildrenElement;this.parent=d};TagCategory.prototype.getElement=function(){var d;d=document.createElement("li");d.id=this.name;d.className="category_element";this.catNameElement=document.createElement("span");Element.extend(this.catNameElement);this.catNameElement.className="category_name";this.catNameElement.onclick=function(){this.selectMyResources()}.bind(this);this.catNameElement.innerHTML=this.name;d.appendChild(this.catNameElement);this.catChildrenElement=document.createElement("ul");Element.extend(this.catChildrenElement);this.catChildrenElement.className="children_cats";var a;var c=this.children.keys().sort();for(var b=0;b<c.length;b++){a=_createCatElement(c[b],this.children[c[b]],this);this.catChildrenElement.appendChild(a)}d.appendChild(this.catChildrenElement);return d};TagCategory.prototype.selectMyResources=function(){var b=lastOpenCategory;if(lastOpenCategory&&lastOpenCategory!=this){lastOpenCategory.catNameElement.removeClassName("selected_cat")}while(b&&b!=this&&b!=this.parent){b.close();b=b.parent}if(lastOpenCategory!=this){this.open();var a=this.tags.join(" ");UIUtils.searchByTag(URIs.GET_RESOURCES_SIMPLE_SEARCH,a,true)}};TagCategory.prototype.open=function(){lastOpenCategory=this;this.catNameElement.addClassName("selected_cat");this.catChildrenElement.addClassName("open")};TagCategory.prototype.close=function(){this.catChildrenElement.removeClassName("open");lastOpenCategory=null};function CatalogueMosaicView(){var b=$H();var q=[];var t=[];var n=this;var g=40;var m=5;var h=10;var f="";var a="";var l=[];var c=[];this.catalogueElement=$("showcase_container");this.categoryManager=new CategoryManager();Event.observe($("catalogue_link"),"click",function(){OpManagerFactory.getInstance().showCatalogue()},false,"show_catalogue");Event.observe($("add_feed_link"),"click",function(){LayoutManagerFactory.getInstance().showWindowMenu("addFeed")},false,"show_feed_window");Event.observe($("add_site_link"),"click",function(){LayoutManagerFactory.getInstance().showWindowMenu("addSite")},false,"show_site_window");this.initCatalogue=function(){var x=function(A){var z=A.responseText;var y=JSON.parse(z);l=y.available_resources;this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();UIUtils.resizeResourcesContainer();$("simple_search_text").focus()};var v=function(){l=[];this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();$("simple_search_text").focus()};var u=PersistenceEngineFactory.getInstance();UIUtils.clearPreviousSearch();if(URIs.HOME_GATEWAY_DISPATCHER_URL){var w={method:"GET",url:URIs.HOME_GATEWAY_DISPATCHER_URL};u.send_post("/proxy",w,this,x,v)}else{this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();$("simple_search_text").focus()}};this.reloadCompleteCatalogue=function(){this.initCatalogue()};this.emptyResourceList=function(){$("resources").innerHTML="";n.clearSelectedResources();b=$H()};this.getResources=function(){return b};this.getResource=function(u){return b[u]};this.getResourceByData=function(w,y){var x=b.keys();for(var v=0;v<x.length;v++){var u=b.get(x[v]);if(u.getName()==w&&u.getVendor==y){return u}}return null};this.contractApplication=function(A,y){var v=function(D){var C=D.responseText;var B=JSON.parse(C);CatalogueFactory.getInstance().reloadCompleteCatalogue()};var x=function(){alert("Error contracting application")};var u=URIs.CONTRACT_APPLICATION.evaluate({application_id:y});var w={username:ezweb_user_name,free:true};var z={contract_info:Object.toJSON(w)};PersistenceEngineFactory.getInstance().send_post(u,z,this,v,x)};this.getVersionManager=function(u){return verManager};this.addSelectedResource=function(u){if(!n.isSelectedResource(u)){q.push(u)}};this.isSelectedResource=function(u){for(var v=0;v<q.length;v++){if(q[v]==u){return true}}return false};this.removeSelectedResource=function(u){for(var v=0;v<q.length;v++){if(q[v]==u){q=q.without(q[v])}}};this.clearSelectedResources=function(){q=[]};this.toggleSelectedResource=function(u){if(isSelectedResources(u)){removeSelectedResource(u)}else{addSelectedResource(u)}};this.getSelectedResources=function(){return q};this.addResource=function(u,w){var v="resource_"+b.keys().length;b[v]=new Resource(v,u,w)};this.addResourceToShowCase=function(v){var u=this.getResource(v);if(u.isContratable()){var w=u.getContract();if(w){ShowcaseFactory.getInstance().addGadget(u.getVendor(),u.getName(),u.getVersion(),u.getUriTemplate());return}LayoutManagerFactory.getInstance().showWindowMenu("purchaseAppMenu",CatalogueFactory.getInstance().contractApplication,function(){LayoutManagerFactory.getInstance().hideCover()},this.getResource(v));return}ShowcaseFactory.getInstance().addGadget(u.getVendor(),u.getName(),u.getVersion(),u.getUriTemplate())};this.addMashupResource=function(x){var v=function(C){var A=C.responseText;var B=JSON.parse(A);opManager=OpManagerFactory.getInstance();opManager.workSpaceInstances[B.workspace.id]=new WorkSpace(B.workspace);ShowcaseFactory.getInstance().reload(B.workspace.id);LayoutManagerFactory.getInstance().logStep("")};var y=function(D,B){var A=LogManagerFactory.getInstance();var C=A.formatError(gettext("Error merging workspace: %(errorMsg)s."),D,B);A.log(C);LayoutManagerFactory.getInstance().logStep("")};LayoutManagerFactory.getInstance()._startComplexTask(gettext("Adding the mashup"),1);LayoutManagerFactory.getInstance().logSubTask(gettext("Creating a new workspace"));var w=this.getResource(x);var u=w.getMashupId();var z=URIs.GET_ADD_WORKSPACE.evaluate({workspace_id:u});PersistenceEngineFactory.getInstance().send_get(z,this,v,y)};this.mergeMashupResource=function(x){var A=function(C){var B=C.responseText;B=JSON.parse(B);opManager=OpManagerFactory.getInstance();ShowcaseFactory.getInstance().reload(B.workspace_id);LayoutManagerFactory.getInstance().logStep("")};var v=function(E,C){var B=LogManagerFactory.getInstance();var D=B.formatError(gettext("Error cloning workspace: %(errorMsg)s."),E,C);B.log(D);LayoutManagerFactory.getInstance().logStep("")};LayoutManagerFactory.getInstance()._startComplexTask(gettext("Adding the mashup"),1);LayoutManagerFactory.getInstance().logSubTask(gettext("Merging with current workspace"));var w=this.getResource(x);var u=w.getMashupId();var z=OpManagerFactory.getInstance().getActiveWorkspaceId();var y=URIs.GET_MERGE_PUBLISHED_WORKSPACE.evaluate({published_ws:u,to_ws:z});PersistenceEngineFactory.getInstance().send_get(y,this,A,v)};this.paginate=function(u){p($("paginate_show"),u);r($("paginate"),u)};this.orderby=function(u){k($("orderby"),u)};this.setAvailableApps=function(u){this.availableApps=u};this.getAvailableApps=function(){return this.availableApps};this.changeGlobalTagcloud=function(w){$("view_global_tags_links").innerHTML="";var v=UIUtils.createHTMLElement((w=="all")?"span":"a",$H({innerHTML:gettext("All common tags")}));if(w!="all"){v.observe("click",function(y){n.changeGlobalTagcloud("all")})}var x=UIUtils.createHTMLElement((w=="mytags")?"span":"a",$H({innerHTML:gettext("My common tags")}));if(w!="mytags"){x.observe("click",function(y){n.changeGlobalTagcloud("mytags")})}var u=UIUtils.createHTMLElement((w=="others")?"span":"a",$H({innerHTML:gettext("Others common tags")}));if(w!="others"){u.observe("click",function(y){n.changeGlobalTagcloud("others")})}$("view_global_tags_links").appendChild(v);$("view_global_tags_links").appendChild(x);$("view_global_tags_links").appendChild(u);UIUtils.globalTags=w;this.updateGlobalTags()};this.updateGlobalTags=function(){if(UIUtils.tagmode){if(q.length==0){t=[];o($("global_tagcloud"));return}if(q.length==1){if(UIUtils.globalTags=="all"){t=t=CatalogueFactory.getInstance().getResource(q[0]).getTags()}else{if(UIUtils.globalTags=="mytags"){var z=[];var u=0;t=t=CatalogueFactory.getInstance().getResource(q[0]).getTags();for(var w=0;w<t.length;w++){if(t[w].getAdded_by()=="Yes"){z[u]=t[w];u++}}t=z}else{var z=[];var u=0;t=CatalogueFactory.getInstance().getResource(q[0]).getTags();for(var w=0;w<t.length;w++){if(t[w].getAdded_by()=="No"){z[u]=t[w];u++}}t=z}}o($("global_tagcloud"));return}if(UIUtils.globalTags=="all"){t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]){z[u]=t[w];u++}}t=z}}else{if(UIUtils.globalTags=="mytags"){t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]&&t[w].getAdded_by()=="Yes"){z[u]=t[w];u++}}t=z}}else{t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]&&t[w].getAdded_by()=="No"){z[u]=t[w];u++}}t=z}}}o($("global_tagcloud"))}};this.getGlobalTags=function(){return t};this.repaintCatalogue=function(u){f=arguments[1];a=arguments[2];keepCatSection=arguments[3];if(!keepCatSection){this.categoryManager.closeCategories()}this.emptyResourceList();this.loadCatalogue(u)};this.show=function(){LayoutManagerFactory.getInstance().showCatalogue();UIUtils.setResourcesWidth()};this.hide=function(){LayoutManagerFactory.getInstance().hideView(this.catalogueElement)};this.isContratableResource=function(w){for(var v=0;v<w.capabilities.length;v++){var u=w.capabilities[v];if(u.name=="Contratable"){return u.value.toLowerCase()=="true"}else{return false}}};this.isAvailableResource=function(v){for(var u=0;u<l.length;u++){if(v.uriTemplate==l[u].gadget){return true}}return false};this.loadCatalogue=function(H){var C=function(V,T){var S=LogManagerFactory.getInstance();var U=S.formatError(gettext("Error retrieving catalogue data: %(errorMsg)s."),V,T);S.log(U)};var B=function(X){var T=Try.these(function(){return new DOMParser().parseFromString(X.responseText,"text/xml")},function(){var Y=new ActiveXObject("Microsoft.XMLDOM");Y.loadXML(X.responseText);return Y});var W=X.responseText;var S=X.getResponseHeader("items");var V=JSON.parse(W);V=V.resourceList;for(var U=0;U<V.length;U++){if(this.isContratableResource(V[U])){if(this.isAvailableResource(V[U])){this.addResource(V[U],null)}else{continue}}else{this.addResource(V[U],null);continue}}this.paginate(S);this.orderby(S);$("global_tagcloud").innerHTML="";UIUtils.repaintCatalogue=false;UIUtils.resizeResourcesContainer()};if(UIUtils.searchValue!=""){var D={orderby:UIUtils.orderby,search_criteria:UIUtils.searchValue,search_boolean:$("global_search_boolean").value}}else{var D={orderby:UIUtils.orderby,search_boolean:$("global_search_boolean").value}}var Q=PersistenceEngineFactory.getInstance();var I="";switch(UIUtils.searchCriteria){case"and":I=gettext("Search")+": ";break;case"or":case"simple_or":I=gettext("Search")+": ";break;case"not":I=gettext("Search")+": ";break;case"tag":I=gettext("Search by Tag")+": ";break;case"event":I=gettext("Search by Event")+": ";break;case"slot":I=gettext("Search by Slot")+": ";break;case"connectSlot":I=gettext("Search by Slot connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"connectEvent":I=gettext("Search by Event connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"connectEventSlot":I=gettext("Search by Event and Slot connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"global":I=gettext("Global Search")+": ";break}var P="";switch(UIUtils.searchCriteria){case"global":var v=[""];var w=true;var O=[""];var R=true;var E=[""];var J=true;var x=[""];var F=true;var z=[""];var K=true;var u=[""];var N=true;if(UIUtils.searchValue[0]==""){w=false}if(UIUtils.searchValue[1]==""){R=false}if(UIUtils.searchValue[2]==""){J=false}if(UIUtils.searchValue[3]==""){F=false}if(UIUtils.searchValue[4]==""){K=false}if(UIUtils.searchValue[5]==""){N=false}if(w){v=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<v.length;L++){if(L==v.length-1){P+=v[L]+((R||J||F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==v.length-2){P+=v[L]+" "+gettext("and")+" "}else{P+=v[L]+" "+gettext("and")+" "}}}}if(R){O=UIUtils.splitString(UIUtils.searchValue[1]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]+((J||F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+" "+gettext("or")+" "}}}}if(J){E=UIUtils.splitString(UIUtils.searchValue[2]);for(var L=0;L<E.length;L++){if(L==0){if(E.length==1){P+=gettext("not")+" "+E[L]+((F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{P+=gettext("neither")+" "+E[L]+" "+gettext("nor")+" "}}else{if(L==E.length-1){P+=E[L]+((F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{P+=E[L]+" "+gettext("nor")+" "}}}}if(F){x=UIUtils.splitString(UIUtils.searchValue[3]);P+=gettext("Tags: ");for(var L=0;L<x.length;L++){if(L==x.length-1){P+=x[L]+((K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==x.length-2){P+=x[L]+" "+gettext("or")+" "}else{P+=x[L]+", "}}}}if(K){z=UIUtils.splitString(UIUtils.searchValue[4]);P+=gettext("Events: ");for(var L=0;L<z.length;L++){if(L==z.length-1){P+=z[L]+((N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==z.length-2){P+=z[L]+" "+gettext("or")+" "}else{P+=z[L]+", "}}}}if(N){u=UIUtils.splitString(UIUtils.searchValue[5]);P+=gettext("Slots: ");for(var L=0;L<u.length;L++){if(L==u.length-1){P+=u[L]+"."}else{if(L==u.length-2){P+=u[L]+" "+gettext("or")+" "}else{P+=u[L]+", "}}}}break;case"and":var v=[""];v=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<v.length;L++){if(L==v.length-1){P+=v[L]+"."}else{if(L==v.length-2){P+=v[L]+" "+gettext("and")+" "}else{P+=v[L]+" "+gettext("and")+" "}}}break;case"or":case"simple_or":var O=[""];O=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]+"."}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+" "+gettext("or")+" "}}}break;case"not":var E=[""];E=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<E.length;L++){if(L==0){if(E.length==1){P+=gettext("not")+" "+E[L]+"."}else{P+=gettext("neither")+" "+E[L]+" "+gettext("nor")+" "}}else{if(L==E.length-1){P+=E[L]+"."}else{P+=E[L]+" "+gettext("nor")+" "}}}break;case"tag":case"event":case"slot":case"connectEvent":case"connectSlot":var O=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+", "}}}break;case"connectEventSlot":var z=[""];var K=true;var u=[""];var N=true;if(UIUtils.searchValue[0]==""){K=false}if(UIUtils.searchValue[1]==""){N=false}if(K){z=UIUtils.splitString(UIUtils.searchValue[0]);P+=gettext("Events: ");for(var L=0;L<z.length;L++){if(L==z.length-1){P+=z[L]+((N)?" OR ":".")}else{if(L==z.length-2){P+=z[L]+" "+gettext("or")+" "}else{P+=z[L]+", "}}}}if(N){u=UIUtils.splitString(UIUtils.searchValue[1]);P+=gettext("Slots: ");for(var L=0;L<u.length;L++){if(L==u.length-1){P+=u[L]+"."}else{if(L==u.length-2){P+=u[L]+" "+gettext("or")+" "}else{P+=u[L]+", "}}}}break}var y=H.toString().split("/");for(var M=0;M<y.length;M++){if(y[M]=="resource"){break}else{if(y[M]=="search"||y[M]=="globalsearch"){var G=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("Reload")}));G.observe("click",function(S){CatalogueFactory.getInstance().emptyResourceList();CatalogueFactory.getInstance().loadCatalogue(H)});break}}}var A=UIUtils.createHTMLElement("a",$H({id:"reload_catalogue_link",innerHTML:gettext("Reload Catalogue")}));A.observe("click",function(S){CatalogueFactory.getInstance().reloadCompleteCatalogue();$("header_always_error").style.display="none"});Q.send_get(H,this,B,C,D)};var p=function(A,x){A.innerHTML="";A.appendChild(UIUtils.createHTMLElement("label",$H({for_:"combo_results_per_page",innerHTML:gettext("Gadgets per page: ")})));var w=UIUtils.createHTMLElement("select",$H({id:"combo_results_per_page",size:"1"}));w.observe("change",function(B){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,$("combo_results_per_page").options[$("combo_results_per_page").selectedIndex].value.toString(),"first",x)});A.appendChild(w);if(x<=0){w.setAttribute("disabled","disabled")}else{var v;if(x>g){v=g/h}else{v=Math.ceil(x/h)}var u=false;for(var y=1;y<=v;y++){var z=UIUtils.createHTMLElement("option",$H({value:""+(y*h),innerHTML:""+(y*h)}));if(UIUtils.getOffset()==y*h){z.setAttribute("selected","selected");u=true}if((y==v)&&(!u)){z.setAttribute("selected","selected");UIUtils.offset=v}w.appendChild(z)}}};var r=function(A,E){A.innerHTML="";var B=Math.ceil(E/UIUtils.getOffset());if(B==0){B=1}var M=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(M);var u=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(u);if(UIUtils.getPage()!=1){var C=UIUtils.createHTMLElement("a",$H({title:gettext("Go to first page")}));C.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"first",E)});M.appendChild(C);var P=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-first")}));C.appendChild(P);var H=UIUtils.createHTMLElement("a",$H({title:gettext("Go to previous page")}));H.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"prev",E)});u.appendChild(H);var L=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-previous")}));H.appendChild(L)}else{var P=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-first-disabled")}));M.appendChild(P);var L=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-previous-disabled")}));u.appendChild(L)}var v=(parseInt(UIUtils.getPage())-2>1)?parseInt(UIUtils.getPage())-2:1;var G=(parseInt(UIUtils.getPage())+2<B)?parseInt(UIUtils.getPage())+2:B;var N=G-v+1;var I=(m<B)?m:B;if(N<I){if(v<=2){G+=I-N}else{if(G>=B-2){v-=I-N}}}for(var J=v;J<=G;J++){if(parseInt(UIUtils.getPage())!=J){var y=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(y);var O=UIUtils.createHTMLElement("a",$H({title:gettext("Go to page ")+J,innerHTML:""+J}));O.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),this.innerHTML,E)});y.appendChild(O)}else{A.appendChild(UIUtils.createHTMLElement("span",$H({class_name:"pagination_button",innerHTML:""+J})))}}var x=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(x);var F=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(F);if(B==UIUtils.getPage()){var D=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-last-disabled")}));F.appendChild(D);var z=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-next-disabled")}));x.appendChild(z)}else{var w=UIUtils.createHTMLElement("a",$H({title:gettext("Go to last page")}));w.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"last",E)});F.appendChild(w);var D=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-last")}));w.appendChild(D);var K=UIUtils.createHTMLElement("a",$H({title:gettext("Go to next page")}));K.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"next",E)});x.appendChild(K);var z=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-next")}));K.appendChild(z)}};var k=function(z,w){z.innerHTML="";z.appendChild(UIUtils.createHTMLElement("label",$H({for_:"combo_order_by",innerHTML:gettext(" Order by")+":"})));var v=UIUtils.createHTMLElement("select",$H({id:"combo_order_by"}));v.observe("change",function(C){var D=BrowserUtilsFactory.getInstance().getTarget(C);UIUtils.setOrderby(D);UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,$("combo_results_per_page").options[$("combo_results_per_page").selectedIndex].value.toString(),"first",w)});z.appendChild(v);if(w==0){v.setAttribute("disabled","disabled")}else{var u=UIUtils.createHTMLElement("option",$H({value:"-creation_date",innerHTML:gettext("Creation date")}));if(UIUtils.orderby=="-creation_date"){u.setAttribute("selected","selected")}v.appendChild(u);var x=UIUtils.createHTMLElement("option",$H({value:"short_name",innerHTML:gettext("Name")}));if(UIUtils.orderby=="short_name"){x.setAttribute("selected","selected")}v.appendChild(x);var B=UIUtils.createHTMLElement("option",$H({value:"vendor",innerHTML:gettext("Vendor")}));if(UIUtils.orderby=="vendor"){B.setAttribute("selected","selected")}v.appendChild(B);var y=UIUtils.createHTMLElement("option",$H({value:"author",innerHTML:gettext("Author")}));if(UIUtils.orderby=="author"){y.setAttribute("selected","selected")}v.appendChild(y);var A=UIUtils.createHTMLElement("option",$H({value:"-popularity",innerHTML:gettext("Popularity")}));if(UIUtils.orderby=="-popularity"){A.setAttribute("selected","selected")}v.appendChild(A)}};var o=function(w){w.innerHTML="";for(var v=0;v<t.length;v++){var u=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));u.appendChild(t[v].tagToTypedHTML({tags:"multiple"}));if(UIUtils.globalTags=="mytags"){var y=UIUtils.createHTMLElement("button",$H({class_name:"delete button"}));y.observe("click",function(z){var A=BrowserUtilsFactory.getInstance().getTarget(z);UIUtils.removeGlobalTagUser(A.parentNode.firstChild.innerHTML)});u.appendChild(y)}var x=UIUtils.createHTMLElement("span",$H({innerHTML:((v<(t.length-1))?",":"")}));u.appendChild(x);w.appendChild(u)}};this.onLoadSuccess=function(w){var u=w.responseText;var v=JSON.parse(u);ShowcaseFactory.getInstance().setGadgetsState(v.gadgets);OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.CATALOGUE)};this.onLoadError=function(u){OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.CATALOGUE)};var j=ShowcaseFactory.getInstance().getGadgetsData();var d={gadgets:Object.toJSON(j)};PersistenceEngineFactory.getInstance().send_post(URIs.POST_CHECK_VERSIONS,d,this,this.onLoadSuccess,this.onLoadError)}function CatalogueListView(){var b=$H();var q=[];var t=[];var n=this;var g=40;var m=5;var h=10;var f="";var a="";var l=[];var c=[];this.catalogueElement=$("showcase_container");this.categoryManager=new CategoryManager();Event.observe($("catalogue_link"),"click",function(){OpManagerFactory.getInstance().showCatalogue()},false,"show_catalogue");Event.observe($("add_feed_link"),"click",function(){LayoutManagerFactory.getInstance().showWindowMenu("addFeed")},false,"show_feed_window");Event.observe($("add_site_link"),"click",function(){LayoutManagerFactory.getInstance().showWindowMenu("addSite")},false,"show_site_window");this.initCatalogue=function(){var x=function(A){var z=A.responseText;var y=JSON.parse(z);l=y.available_resources;this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();UIUtils.resizeResourcesContainer();$("simple_search_text").focus()};var v=function(){l=[];this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();$("simple_search_text").focus()};var u=PersistenceEngineFactory.getInstance();UIUtils.clearPreviousSearch();if(URIs.HOME_GATEWAY_DISPATCHER_URL){var w={method:"GET",url:URIs.HOME_GATEWAY_DISPATCHER_URL};u.send_post("/proxy",w,this,x,v)}else{this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset());UIUtils.setResourcesWidth();$("simple_search_text").focus()}};this.reloadCompleteCatalogue=function(){this.initCatalogue()};this.emptyResourceList=function(){$("resources").innerHTML="";n.clearSelectedResources();b=$H()};this.getResources=function(){return b};this.getResource=function(u){return b[u]};this.getResourceByData=function(w,y){var x=b.keys();for(var v=0;v<x.length;v++){var u=b.get(x[v]);if(u.getName()==w&&u.getVendor==y){return u}}return null};this.contractApplication=function(A,y){var v=function(D){var C=D.responseText;var B=JSON.parse(C);CatalogueFactory.getInstance().reloadCompleteCatalogue()};var x=function(){alert("Error contracting application")};var u=URIs.CONTRACT_APPLICATION.evaluate({application_id:y});var w={username:ezweb_user_name,free:true};var z={contract_info:Object.toJSON(w)};PersistenceEngineFactory.getInstance().send_post(u,z,this,v,x)};this.getVersionManager=function(u){return verManager};this.addSelectedResource=function(u){if(!n.isSelectedResource(u)){q.push(u)}};this.isSelectedResource=function(u){for(var v=0;v<q.length;v++){if(q[v]==u){return true}}return false};this.removeSelectedResource=function(u){for(var v=0;v<q.length;v++){if(q[v]==u){q=q.without(q[v])}}};this.clearSelectedResources=function(){q=[]};this.toggleSelectedResource=function(u){if(isSelectedResources(u)){removeSelectedResource(u)}else{addSelectedResource(u)}};this.getSelectedResources=function(){return q};this.addResource=function(u,w){var v="resource_"+b.keys().length;b[v]=new Resource(v,u,w)};this.addResourceToShowCase=function(v){var u=this.getResource(v);if(u.isContratable()){var w=u.getContract();if(w){ShowcaseFactory.getInstance().addGadget(u.getVendor(),u.getName(),u.getVersion(),u.getUriTemplate());return}LayoutManagerFactory.getInstance().showWindowMenu("purchaseAppMenu",CatalogueFactory.getInstance().contractApplication,function(){LayoutManagerFactory.getInstance().hideCover()},this.getResource(v));return}ShowcaseFactory.getInstance().addGadget(u.getVendor(),u.getName(),u.getVersion(),u.getUriTemplate())};this.addMashupResource=function(x){var v=function(C){var A=C.responseText;var B=JSON.parse(A);opManager=OpManagerFactory.getInstance();opManager.workSpaceInstances[B.workspace.id]=new WorkSpace(B.workspace);ShowcaseFactory.getInstance().reload(B.workspace.id);LayoutManagerFactory.getInstance().logStep("")};var y=function(D,B){var A=LogManagerFactory.getInstance();var C=A.formatError(gettext("Error merging workspace: %(errorMsg)s."),D,B);A.log(C);LayoutManagerFactory.getInstance().logStep("")};LayoutManagerFactory.getInstance()._startComplexTask(gettext("Adding the mashup"),1);LayoutManagerFactory.getInstance().logSubTask(gettext("Creating a new workspace"));var w=this.getResource(x);var u=w.getMashupId();var z=URIs.GET_ADD_WORKSPACE.evaluate({workspace_id:u});PersistenceEngineFactory.getInstance().send_get(z,this,v,y)};this.mergeMashupResource=function(x){var A=function(C){var B=C.responseText;B=JSON.parse(B);opManager=OpManagerFactory.getInstance();ShowcaseFactory.getInstance().reload(B.workspace_id);LayoutManagerFactory.getInstance().logStep("")};var v=function(E,C){var B=LogManagerFactory.getInstance();var D=B.formatError(gettext("Error cloning workspace: %(errorMsg)s."),E,C);B.log(D);LayoutManagerFactory.getInstance().logStep("")};LayoutManagerFactory.getInstance()._startComplexTask(gettext("Adding the mashup"),1);LayoutManagerFactory.getInstance().logSubTask(gettext("Merging with current workspace"));var w=this.getResource(x);var u=w.getMashupId();var z=OpManagerFactory.getInstance().getActiveWorkspaceId();var y=URIs.GET_MERGE_PUBLISHED_WORKSPACE.evaluate({published_ws:u,to_ws:z});PersistenceEngineFactory.getInstance().send_get(y,this,A,v)};this.paginate=function(u){p($("paginate_show"),u);r($("paginate"),u)};this.orderby=function(u){k($("orderby"),u)};this.setAvailableApps=function(u){this.availableApps=u};this.getAvailableApps=function(){return this.availableApps};this.changeGlobalTagcloud=function(w){$("view_global_tags_links").innerHTML="";var v=UIUtils.createHTMLElement((w=="all")?"span":"a",$H({innerHTML:gettext("All common tags")}));if(w!="all"){v.observe("click",function(y){n.changeGlobalTagcloud("all")})}var x=UIUtils.createHTMLElement((w=="mytags")?"span":"a",$H({innerHTML:gettext("My common tags")}));if(w!="mytags"){x.observe("click",function(y){n.changeGlobalTagcloud("mytags")})}var u=UIUtils.createHTMLElement((w=="others")?"span":"a",$H({innerHTML:gettext("Others common tags")}));if(w!="others"){u.observe("click",function(y){n.changeGlobalTagcloud("others")})}$("view_global_tags_links").appendChild(v);$("view_global_tags_links").appendChild(x);$("view_global_tags_links").appendChild(u);UIUtils.globalTags=w;this.updateGlobalTags()};this.updateGlobalTags=function(){if(UIUtils.tagmode){if(q.length==0){t=[];o($("global_tagcloud"));return}if(q.length==1){if(UIUtils.globalTags=="all"){t=t=CatalogueFactory.getInstance().getResource(q[0]).getTags()}else{if(UIUtils.globalTags=="mytags"){var z=[];var u=0;t=t=CatalogueFactory.getInstance().getResource(q[0]).getTags();for(var w=0;w<t.length;w++){if(t[w].getAdded_by()=="Yes"){z[u]=t[w];u++}}t=z}else{var z=[];var u=0;t=CatalogueFactory.getInstance().getResource(q[0]).getTags();for(var w=0;w<t.length;w++){if(t[w].getAdded_by()=="No"){z[u]=t[w];u++}}t=z}}o($("global_tagcloud"));return}if(UIUtils.globalTags=="all"){t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]){z[u]=t[w];u++}}t=z}}else{if(UIUtils.globalTags=="mytags"){t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]&&t[w].getAdded_by()=="Yes"){z[u]=t[w];u++}}t=z}}else{t=n.getResource(q[0]).getTags();var A=[];var v=[];for(var y=1;y<q.length;y++){A=n.getResource(q[y]).getTags();for(var w=0;w<t.length;w++){v[w]=false;for(var x=0;x<A.length;x++){if(A[x].getValue()==t[w].getValue()){v[w]=true;break}}}var z=[];var u=0;for(var w=0;w<t.length;w++){if(v[w]&&t[w].getAdded_by()=="No"){z[u]=t[w];u++}}t=z}}}o($("global_tagcloud"))}};this.getGlobalTags=function(){return t};this.repaintCatalogue=function(u){f=arguments[1];a=arguments[2];keepCatSection=arguments[3];if(!keepCatSection){this.categoryManager.closeCategories()}this.emptyResourceList();this.loadCatalogue(u)};this.show=function(){LayoutManagerFactory.getInstance().showCatalogue();UIUtils.setResourcesWidth()};this.hide=function(){LayoutManagerFactory.getInstance().hideView(this.catalogueElement)};this.isContratableResource=function(w){for(var v=0;v<w.capabilities.length;v++){var u=w.capabilities[v];if(u.name=="Contratable"){return u.value.toLowerCase()=="true"}else{return false}}};this.isAvailableResource=function(v){for(var u=0;u<l.length;u++){if(v.uriTemplate==l[u].gadget){return true}}return false};this.loadCatalogue=function(H){var C=function(V,T){var S=LogManagerFactory.getInstance();var U=S.formatError(gettext("Error retrieving catalogue data: %(errorMsg)s."),V,T);S.log(U)};var B=function(X){var T=Try.these(function(){return new DOMParser().parseFromString(X.responseText,"text/xml")},function(){var Y=new ActiveXObject("Microsoft.XMLDOM");Y.loadXML(X.responseText);return Y});var W=X.responseText;var S=X.getResponseHeader("items");var V=JSON.parse(W);V=V.resourceList;for(var U=0;U<V.length;U++){if(this.isContratableResource(V[U])){if(this.isAvailableResource(V[U])){this.addResource(V[U],null)}else{continue}}else{this.addResource(V[U],null);continue}}this.paginate(S);this.orderby(S);$("global_tagcloud").innerHTML="";UIUtils.repaintCatalogue=false;UIUtils.resizeResourcesContainer()};if(UIUtils.searchValue!=""){var D={orderby:UIUtils.orderby,search_criteria:UIUtils.searchValue,search_boolean:$("global_search_boolean").value}}else{var D={orderby:UIUtils.orderby,search_boolean:$("global_search_boolean").value}}var Q=PersistenceEngineFactory.getInstance();var I="";switch(UIUtils.searchCriteria){case"and":I=gettext("Search")+": ";break;case"or":case"simple_or":I=gettext("Search")+": ";break;case"not":I=gettext("Search")+": ";break;case"tag":I=gettext("Search by Tag")+": ";break;case"event":I=gettext("Search by Event")+": ";break;case"slot":I=gettext("Search by Slot")+": ";break;case"connectSlot":I=gettext("Search by Slot connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"connectEvent":I=gettext("Search by Event connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"connectEventSlot":I=gettext("Search by Event and Slot connectivity for %(resourceName)s %(resourceVersion)s");I=interpolate(I,{resourceName:f,resourceVersion:a},true);break;case"global":I=gettext("Global Search")+": ";break}var P="";switch(UIUtils.searchCriteria){case"global":var v=[""];var w=true;var O=[""];var R=true;var E=[""];var J=true;var x=[""];var F=true;var z=[""];var K=true;var u=[""];var N=true;if(UIUtils.searchValue[0]==""){w=false}if(UIUtils.searchValue[1]==""){R=false}if(UIUtils.searchValue[2]==""){J=false}if(UIUtils.searchValue[3]==""){F=false}if(UIUtils.searchValue[4]==""){K=false}if(UIUtils.searchValue[5]==""){N=false}if(w){v=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<v.length;L++){if(L==v.length-1){P+=v[L]+((R||J||F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==v.length-2){P+=v[L]+" "+gettext("and")+" "}else{P+=v[L]+" "+gettext("and")+" "}}}}if(R){O=UIUtils.splitString(UIUtils.searchValue[1]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]+((J||F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+" "+gettext("or")+" "}}}}if(J){E=UIUtils.splitString(UIUtils.searchValue[2]);for(var L=0;L<E.length;L++){if(L==0){if(E.length==1){P+=gettext("not")+" "+E[L]+((F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{P+=gettext("neither")+" "+E[L]+" "+gettext("nor")+" "}}else{if(L==E.length-1){P+=E[L]+((F||K||N)?" "+$("global_search_boolean").value+" ":".")}else{P+=E[L]+" "+gettext("nor")+" "}}}}if(F){x=UIUtils.splitString(UIUtils.searchValue[3]);P+=gettext("Tags: ");for(var L=0;L<x.length;L++){if(L==x.length-1){P+=x[L]+((K||N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==x.length-2){P+=x[L]+" "+gettext("or")+" "}else{P+=x[L]+", "}}}}if(K){z=UIUtils.splitString(UIUtils.searchValue[4]);P+=gettext("Events: ");for(var L=0;L<z.length;L++){if(L==z.length-1){P+=z[L]+((N)?" "+$("global_search_boolean").value+" ":".")}else{if(L==z.length-2){P+=z[L]+" "+gettext("or")+" "}else{P+=z[L]+", "}}}}if(N){u=UIUtils.splitString(UIUtils.searchValue[5]);P+=gettext("Slots: ");for(var L=0;L<u.length;L++){if(L==u.length-1){P+=u[L]+"."}else{if(L==u.length-2){P+=u[L]+" "+gettext("or")+" "}else{P+=u[L]+", "}}}}break;case"and":var v=[""];v=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<v.length;L++){if(L==v.length-1){P+=v[L]+"."}else{if(L==v.length-2){P+=v[L]+" "+gettext("and")+" "}else{P+=v[L]+" "+gettext("and")+" "}}}break;case"or":case"simple_or":var O=[""];O=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]+"."}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+" "+gettext("or")+" "}}}break;case"not":var E=[""];E=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<E.length;L++){if(L==0){if(E.length==1){P+=gettext("not")+" "+E[L]+"."}else{P+=gettext("neither")+" "+E[L]+" "+gettext("nor")+" "}}else{if(L==E.length-1){P+=E[L]+"."}else{P+=E[L]+" "+gettext("nor")+" "}}}break;case"tag":case"event":case"slot":case"connectEvent":case"connectSlot":var O=UIUtils.splitString(UIUtils.searchValue[0]);for(var L=0;L<O.length;L++){if(L==O.length-1){P+=O[L]}else{if(L==O.length-2){P+=O[L]+" "+gettext("or")+" "}else{P+=O[L]+", "}}}break;case"connectEventSlot":var z=[""];var K=true;var u=[""];var N=true;if(UIUtils.searchValue[0]==""){K=false}if(UIUtils.searchValue[1]==""){N=false}if(K){z=UIUtils.splitString(UIUtils.searchValue[0]);P+=gettext("Events: ");for(var L=0;L<z.length;L++){if(L==z.length-1){P+=z[L]+((N)?" OR ":".")}else{if(L==z.length-2){P+=z[L]+" "+gettext("or")+" "}else{P+=z[L]+", "}}}}if(N){u=UIUtils.splitString(UIUtils.searchValue[1]);P+=gettext("Slots: ");for(var L=0;L<u.length;L++){if(L==u.length-1){P+=u[L]+"."}else{if(L==u.length-2){P+=u[L]+" "+gettext("or")+" "}else{P+=u[L]+", "}}}}break}var y=H.toString().split("/");for(var M=0;M<y.length;M++){if(y[M]=="resource"){break}else{if(y[M]=="search"||y[M]=="globalsearch"){var G=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("Reload")}));G.observe("click",function(S){CatalogueFactory.getInstance().emptyResourceList();CatalogueFactory.getInstance().loadCatalogue(H)});break}}}var A=UIUtils.createHTMLElement("a",$H({id:"reload_catalogue_link",innerHTML:gettext("Reload Catalogue")}));A.observe("click",function(S){CatalogueFactory.getInstance().reloadCompleteCatalogue();$("header_always_error").style.display="none"});Q.send_get(H,this,B,C,D)};var p=function(A,x){A.innerHTML="";A.appendChild(UIUtils.createHTMLElement("label",$H({for_:"combo_results_per_page",innerHTML:gettext("Gadgets per page: ")})));var w=UIUtils.createHTMLElement("select",$H({id:"combo_results_per_page",size:"1"}));w.observe("change",function(B){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,$("combo_results_per_page").options[$("combo_results_per_page").selectedIndex].value.toString(),"first",x)});A.appendChild(w);if(x<=0){w.setAttribute("disabled","disabled")}else{var v;if(x>g){v=g/h}else{v=Math.ceil(x/h)}var u=false;for(var y=1;y<=v;y++){var z=UIUtils.createHTMLElement("option",$H({value:""+(y*h),innerHTML:""+(y*h)}));if(UIUtils.getOffset()==y*h){z.setAttribute("selected","selected");u=true}if((y==v)&&(!u)){z.setAttribute("selected","selected");UIUtils.offset=v}w.appendChild(z)}}};var r=function(A,E){A.innerHTML="";var B=Math.ceil(E/UIUtils.getOffset());if(B==0){B=1}var M=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(M);var u=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(u);if(UIUtils.getPage()!=1){var C=UIUtils.createHTMLElement("a",$H({title:gettext("Go to first page")}));C.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"first",E)});M.appendChild(C);var P=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-first")}));C.appendChild(P);var H=UIUtils.createHTMLElement("a",$H({title:gettext("Go to previous page")}));H.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"prev",E)});u.appendChild(H);var L=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-previous")}));H.appendChild(L)}else{var P=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-first-disabled")}));M.appendChild(P);var L=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-previous-disabled")}));u.appendChild(L)}var v=(parseInt(UIUtils.getPage())-2>1)?parseInt(UIUtils.getPage())-2:1;var G=(parseInt(UIUtils.getPage())+2<B)?parseInt(UIUtils.getPage())+2:B;var N=G-v+1;var I=(m<B)?m:B;if(N<I){if(v<=2){G+=I-N}else{if(G>=B-2){v-=I-N}}}for(var J=v;J<=G;J++){if(parseInt(UIUtils.getPage())!=J){var y=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(y);var O=UIUtils.createHTMLElement("a",$H({title:gettext("Go to page ")+J,innerHTML:""+J}));O.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),this.innerHTML,E)});y.appendChild(O)}else{A.appendChild(UIUtils.createHTMLElement("span",$H({class_name:"pagination_button",innerHTML:""+J})))}}var x=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(x);var F=UIUtils.createHTMLElement("span",$H({class_name:"pagination_button"}));A.appendChild(F);if(B==UIUtils.getPage()){var D=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-last-disabled")}));F.appendChild(D);var z=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-next-disabled")}));x.appendChild(z)}else{var w=UIUtils.createHTMLElement("a",$H({title:gettext("Go to last page")}));w.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"last",E)});F.appendChild(w);var D=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-last")}));w.appendChild(D);var K=UIUtils.createHTMLElement("a",$H({title:gettext("Go to next page")}));K.observe("click",function(Q){UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,UIUtils.getOffset(),"next",E)});x.appendChild(K);var z=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("go-next")}));K.appendChild(z)}};var k=function(z,w){z.innerHTML="";z.appendChild(UIUtils.createHTMLElement("label",$H({for_:"combo_order_by",innerHTML:gettext(" Order by")+":"})));var v=UIUtils.createHTMLElement("select",$H({id:"combo_order_by"}));v.observe("change",function(C){var D=BrowserUtilsFactory.getInstance().getTarget(C);UIUtils.setOrderby(D);UIUtils.cataloguePaginate(URIs.GET_POST_RESOURCES,$("combo_results_per_page").options[$("combo_results_per_page").selectedIndex].value.toString(),"first",w)});z.appendChild(v);if(w==0){v.setAttribute("disabled","disabled")}else{var u=UIUtils.createHTMLElement("option",$H({value:"-creation_date",innerHTML:gettext("Creation date")}));if(UIUtils.orderby=="-creation_date"){u.setAttribute("selected","selected")}v.appendChild(u);var x=UIUtils.createHTMLElement("option",$H({value:"short_name",innerHTML:gettext("Name")}));if(UIUtils.orderby=="short_name"){x.setAttribute("selected","selected")}v.appendChild(x);var B=UIUtils.createHTMLElement("option",$H({value:"vendor",innerHTML:gettext("Vendor")}));if(UIUtils.orderby=="vendor"){B.setAttribute("selected","selected")}v.appendChild(B);var y=UIUtils.createHTMLElement("option",$H({value:"author",innerHTML:gettext("Author")}));if(UIUtils.orderby=="author"){y.setAttribute("selected","selected")}v.appendChild(y);var A=UIUtils.createHTMLElement("option",$H({value:"-popularity",innerHTML:gettext("Popularity")}));if(UIUtils.orderby=="-popularity"){A.setAttribute("selected","selected")}v.appendChild(A)}};var o=function(w){w.innerHTML="";for(var v=0;v<t.length;v++){var u=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));u.appendChild(t[v].tagToTypedHTML({tags:"multiple"}));if(UIUtils.globalTags=="mytags"){var y=UIUtils.createHTMLElement("button",$H({class_name:"delete button"}));y.observe("click",function(z){var A=BrowserUtilsFactory.getInstance().getTarget(z);UIUtils.removeGlobalTagUser(A.parentNode.firstChild.innerHTML)});u.appendChild(y)}var x=UIUtils.createHTMLElement("span",$H({innerHTML:((v<(t.length-1))?",":"")}));u.appendChild(x);w.appendChild(u)}};this.onLoadSuccess=function(w){var u=w.responseText;var v=JSON.parse(u);ShowcaseFactory.getInstance().setGadgetsState(v.gadgets);OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.CATALOGUE)};this.onLoadError=function(u){OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.CATALOGUE)};var j=ShowcaseFactory.getInstance().getGadgetsData();var d={gadgets:Object.toJSON(j)};PersistenceEngineFactory.getInstance().send_post(URIs.POST_CHECK_VERSIONS,d,this,this.onLoadSuccess,this.onLoadError)}var CatalogueFactory=function(){var a=null;return new function(){this.getInstance=function(b){if(!b&&!a){a=new CatalogueMosaicView();return a}if(b&&!a){if(b=="list"){a=new CatalogueListView();return}a=new CatalogueMosaicView();return a}return a}}}();function Resource(c,a,b){this._state=null;this._id=c;this._tagger=new Tagger();this._versionSelected=null;if(b!=null){this._createResource(b)}else{this._state=new ResourceState(a);this.paint()}}Resource.prototype.getVendor=function(){return this._state.getVendor()};Resource.prototype.getName=function(){return this._state.getName()};Resource.prototype.getDisplayName=function(){return this._state.getDisplayName()};Resource.prototype.getVersion=function(){return this._state.getVersion()};Resource.prototype.getId=function(){return this._state.getId()};Resource.prototype.getAllVersions=function(){return this._state.getAllVersions()};Resource.prototype.getDescription=function(){return this._state.getDescription()};Resource.prototype.getUriImage=function(){return this._state.getUriImage()};Resource.prototype.getUriTemplate=function(){return this._state.getUriTemplate()};Resource.prototype.getUriWiki=function(){return this._state.getUriWiki()};Resource.prototype.getMashupId=function(){return this._state.getMashupId()};Resource.prototype.getAddedBy=function(){return this._state.getAddedBy()};Resource.prototype.getTags=function(){return this._state.getTags()};Resource.prototype.setTags=function(a){this._state.setTags(a)};Resource.prototype.addTag=function(a){this._state.addTag(a)};Resource.prototype.getSlots=function(){return this._state.getSlots()};Resource.prototype.setSlots=function(a){this._state.setSlots(a)};Resource.prototype.getEvents=function(){return this._state.getEvents()};Resource.prototype.setEvents=function(a){this._state.setEvents(a)};Resource.prototype.getTagger=function(){return this._tagger};Resource.prototype.getVotes=function(){return this._state.getVotes()};Resource.prototype.getUserVote=function(){return this._state.getUserVote()};Resource.prototype.getPopularity=function(){return this._state.getPopularity()};Resource.prototype.getSelectedVersion=function(){return this._versionSelected};Resource.prototype.setSelectedVersion=function(a){this._versionSelected=a};Resource.prototype.getContract=function(){return this._state.getContract()};Resource.prototype.setVotes=function(a){this._state.setVotes(a);this._rateResource()};Resource.prototype.getGadgetApps=function(){return this._state.getGadgetApps()};Resource.prototype._setDefaultImage=function(a){this.image.stopObserving("error",this._setDefaultImage);this.image.stopObserving("abort",this._setDefaultImage);this.image.src=_currentTheme.getIconURL("showcase-resource_image_not_available")};Resource.prototype.paint=function(){var d=UIUtils.createHTMLElement("div",$H({id:this._id,class_name:"resource"}));$("resources").appendChild(d);d.appendChild(UIUtils.createHTMLElement("div",$H({class_name:"top"})));var m=UIUtils.createHTMLElement("div",$H({class_name:"toolbar"}));d.appendChild(m);displayName=this._state.getDisplayName();m.appendChild(UIUtils.createHTMLElement("div",$H({class_name:"title",title:displayName,innerHTML:(displayName.length>18)?displayName.substring(0,18)+"&#8230;":displayName})));var f=document.createElement("div");m.appendChild(f);var n=gettext("Add");if(this._state.getMashupId()==null){var b="";if(this.isContratable()&&(!this.hasContract())){n=gettext("Buy");b="contratable"}var g=UIUtils.createHTMLElement("button",$H({innerHTML:n,class_name:b}));g.observe("click",function(p){CatalogueFactory.getInstance().addResourceToShowCase(this._id)}.bind(this),false,"instance_gadget")}else{var b="add_mashup";if(this.isContratable()&&(!this.hasContract())){n=gettext("Buy");b="contratable"}var g=UIUtils.createHTMLElement("button",$H({innerHTML:n,class_name:b}));g.observe("click",function(p){LayoutManagerFactory.getInstance().showWindowMenu("addMashup",function(){CatalogueFactory.getInstance().addMashupResource(this._id)}.bind(this),function(){CatalogueFactory.getInstance().mergeMashupResource(this._id)}.bind(this))}.bind(this),false,"instance_mashup")}f.appendChild(g);var l=UIUtils.createHTMLElement("div",$H({class_name:"content"}));d.appendChild(l);var k=UIUtils.createHTMLElement("div",$H({class_name:"image"}));l.appendChild(k);var c=UIUtils.createHTMLElement("a",$H({title:gettext("Show resource details")}));c.observe("click",function(p){UIUtils.sendPendingTags();UIUtils.clickOnResource(this._id)}.bind(this));k.appendChild(c);this.image=UIUtils.createHTMLElement("img",$H({src:this._state.getUriImage()}));this._setDefaultImage=this._setDefaultImage.bind(this);this.image.observe("error",this._setDefaultImage);this.image.observe("abort",this._setDefaultImage);c.appendChild(this.image);var o=UIUtils.createHTMLElement("div",$H({class_name:"tags"}));l.appendChild(o);var j=UIUtils.createHTMLElement("div",$H({id:this._id+"_important_tags",class_name:"important_tags"}));o.appendChild(j);var h=this._tagsToMoreImportantTags(j,3);if(h>0){var g=UIUtils.createHTMLElement("a",$H({class_name:"go_to_tagCloud",innerHTML:gettext("More")}));g.observe("click",function(p){UIUtils.sendPendingTags();UIUtils.showResourceTagCloud(this._id)}.bind(this));o.appendChild(g)}var a=UIUtils.createHTMLElement("div",$H({class_name:"bottom"}));d.appendChild(a)};Resource.prototype.isContratable=function(){var a=this._state.getCapabilities();for(var c=0;c<a.length;c++){var b=a[c];if(b.name.toLowerCase()=="contratable"){return b.value.toLowerCase()=="true"}else{return false}}};Resource.prototype.hasContract=function(){return this._state.getContract()};Resource.prototype.showInfo=function(){UIUtils.selectedVersion=this._state.getVersion();$("info_resource_content").innerHTML="";if(this._state.getMashupId()==null){$("info_resource_content").appendChild(UIUtils.createHTMLElement("div",$H({class_name:"title_fieldset",innerHTML:gettext("Gadget details")})))}else{$("info_resource_content").appendChild(UIUtils.createHTMLElement("div",$H({class_name:"title_fieldset",innerHTML:gettext("Mashup details")})))}var v=UIUtils.createHTMLElement("div",$H({class_name:"fieldset"}));$("info_resource_content").appendChild(v);var K=UIUtils.createHTMLElement("div",$H({class_name:"title"}));v.appendChild(K);K.appendChild(UIUtils.createHTMLElement("span",$H({class_name:"name",innerHTML:this._state.getDisplayName()})));var h=UIUtils.createHTMLElement("a",$H({class_name:"wiki",href:this._state.getUriWiki(),target:"_blank",title:gettext("More info"),alt:gettext("More info")}));var l=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("catalogue-wiki")}));h.appendChild(l);K.appendChild(h);v.appendChild(UIUtils.createHTMLElement("div",$H({class_name:"vendor",innerHTML:this._state.getVendor()})));var P=UIUtils.createHTMLElement("div",$H({class_name:"rating"}));v.appendChild(P);P.appendChild(UIUtils.createHTMLElement("span",$H({id:"rateStatus",innerHTML:gettext("Vote Me... ")})));P.appendChild(UIUtils.createHTMLElement("span",$H({id:"ratingSaved",innerHTML:gettext("Vote Saved ")})));P.appendChild(UIUtils.createHTMLElement("span",$H({id:"votes"})));var A=UIUtils.createHTMLElement("span",$H({id:"rateMe"}));P.appendChild(A);var m=[];m[0]=UIUtils.createHTMLElement("a",$H({id:"_1",title:gettext("Ehh...")}));m[1]=UIUtils.createHTMLElement("a",$H({id:"_2",title:gettext("Not Bad")}));m[2]=UIUtils.createHTMLElement("a",$H({id:"_3",title:gettext("Pretty Good")}));m[3]=UIUtils.createHTMLElement("a",$H({id:"_4",title:gettext("Out Standing")}));m[4]=UIUtils.createHTMLElement("a",$H({id:"_5",title:gettext("Awesome!")}));var T=$A(m);T.each(function(Y){Y.observe("click",function(Z){var aa=BrowserUtilsFactory.getInstance().getTarget(Z);UIUtils.sendVotes(aa)});Y.observe("mouseover",function(Z){var aa=BrowserUtilsFactory.getInstance().getTarget(Z);UIUtils.rating(aa)});Y.observe("mouseout",function(Z){var aa=BrowserUtilsFactory.getInstance().getTarget(Z);UIUtils.off_rating(aa)});A.appendChild(Y)});P.appendChild(UIUtils.createHTMLElement("span",$H({id:"rateResultStatus",innerHTML:gettext("Vote Result:")})));var S=UIUtils.createHTMLElement("span",$H({id:"rateResult"}));P.appendChild(S);S.appendChild(UIUtils.createHTMLElement("a",$H({id:"res_1",title:gettext("Ehh...")})));S.appendChild(UIUtils.createHTMLElement("a",$H({id:"res_2",title:gettext("Not Bad")})));S.appendChild(UIUtils.createHTMLElement("a",$H({id:"res_3",title:gettext("Pretty Good")})));S.appendChild(UIUtils.createHTMLElement("a",$H({id:"res_4",title:gettext("Out Standing")})));S.appendChild(UIUtils.createHTMLElement("a",$H({id:"res_5",title:gettext("Awesome!")})));var j=UIUtils.createHTMLElement("div",$H({class_name:"image"}));v.appendChild(j);j.appendChild(UIUtils.createHTMLElement("img",$H({src:this._state.getUriImage(),alt:this._state.getName()+" "+this._state.getVersion()})));var L=UIUtils.createHTMLElement("div",$H({class_name:"tagcloud"}));v.appendChild(L);L.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Tagcloud")+":"})));var W=UIUtils.createHTMLElement("div",$H({class_name:"link",id:"view_tags_links"}));L.appendChild(W);W.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("All tags")})));var q=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("My tags")}));q.observe("click",function(Y){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("mytags");UIUtils.setInfoResourceHeight()});W.appendChild(q);var X=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("Others tags")}));X.observe("click",function(Y){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("others");UIUtils.setInfoResourceHeight()});W.appendChild(X);var F=UIUtils.createHTMLElement("div",$H({class_name:"tags",id:this._id+"_tagcloud"}));L.appendChild(F);this._tagsToTagcloud(F,"description");var u=UIUtils.createHTMLElement("div",$H({id:"add_tags_panel",class_name:"new_tags",style:"display:none;"}));v.appendChild(u);u.appendChild(UIUtils.createHTMLElement("div",$H({class_name:"title",innerHTML:gettext("New tags")})));q=UIUtils.createHTMLElement("div",$H({id:"my_tags",class_name:"my_tags"}));u.appendChild(q);var G=UIUtils.createHTMLElement("div",$H({id:"new_tag_text",class_name:"new_tag_text"}));q.appendChild(G);q.appendChild(G);var N=UIUtils.createHTMLElement("input",$H({id:"new_tag_text_input",type:"text",maxlength:"20"}));N.observe("keyup",function(Y){var Z=BrowserUtilsFactory.getInstance().getTarget(Y);UIUtils.enlargeInput(Z)});N.observe("keypress",function(Y){var Z=BrowserUtilsFactory.getInstance().getTarget(Y);UIUtils.onReturn(Y,UIUtils.sendTags,Z)});G.appendChild(N);u.appendChild(UIUtils.createHTMLElement("div",$H({id:"tag_alert",class_name:"message_error"})));var E=UIUtils.createHTMLElement("div",$H({class_name:"buttons"}));u.appendChild(E);var b=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",innerHTML:gettext("Tag")}));b.observe("click",function(Y){UIUtils.sendTags()});E.appendChild(b);var c=UIUtils.createHTMLElement("div",$H({id:"add_tags_link",class_name:"link",style:"text-align:right;"}));v.appendChild(c);var y=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",innerHTML:gettext("Tag the resource")}));y.observe("click",function(Y){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("mytags");UIUtils.setInfoResourceHeight()});c.appendChild(y);var t=UIUtils.createHTMLElement("div",$H({class_name:"description"}));v.appendChild(t);t.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Description")+":"})));var o=UIUtils.createHTMLElement("div",$H({id:"access_wiki_link",class_name:"link",style:"text-align:right;"}));var D=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",href:this._state.getUriWiki(),target:"_blank",innerHTML:gettext("Show More..."),style:"display:block"}));o.appendChild(D);t.appendChild(UIUtils.createHTMLElement("div",$H({class_name:"text",innerHTML:this._state.getDescription()+o.innerHTML})));var w=UIUtils.createHTMLElement("div",$H({class_name:"connect"}));v.appendChild(w);w.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Resource connectivity")+":"})));var f=UIUtils.createHTMLElement("div",$H({id:"events_slots",class_name:"text",style:"display:none"}));w.appendChild(f);var B=UIUtils.createHTMLElement("div",$H({class_name:"events"}));f.appendChild(B);B.appendChild(UIUtils.createHTMLElement("img",$H({title:gettext("All compatible gadgets by events are highlighted in this color"),src:_currentTheme.getIconURL("catalogue-resource_compatible_event")})));if(this._state.getEvents().length!=0){var d=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",title:gettext("Search by all compatible events"),innerHTML:gettext("Events")+":"}));d.observe("click",function(Y){UIUtils.searchByConnectivity(URIs.GET_RESOURCES_SIMPLE_SEARCH,"connectEvent",this._state.getEvents().join(" "))}.bind(this));B.appendChild(d)}else{B.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Events")+": "})))}this._events(B);var V=UIUtils.createHTMLElement("div",$H({class_name:"slots"}));f.appendChild(V);V.appendChild(UIUtils.createHTMLElement("img",$H({title:gettext("All compatible gadgets by slots are highlighted in this color"),src:_currentTheme.getIconURL("catalogue-resource_compatible_slot")})));if(this._state.getSlots().length!=0){var x=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",title:gettext("Search by all compatible slots"),innerHTML:gettext("Slots")+":"}));x.observe("click",function(Y){UIUtils.searchByConnectivity(URIs.GET_RESOURCES_SIMPLE_SEARCH,"connectSlot",this._state.getSlots().join(" "))}.bind(this));V.appendChild(x)}else{V.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Slots")+": "})))}this._slots(B);if(this._state.getSlots().length!=0||this._state.getEvents().length!=0){var k=UIUtils.createHTMLElement("div",$H({id:"search_events_slots_div",class_name:"link",style:"text-align:right;"}));v.appendChild(k);var r=UIUtils.createHTMLElement("a",$H({id:"search_events_slots_link",class_name:"submit_link",innerHTML:gettext("Search all connectable gadgets")}));r.observe("click",function(Y){UIUtils.searchByGlobalConnectivity(URIs.GET_RESOURCES_SIMPLE_SEARCH,this._state.getEvents().join(" "),this._state.getSlots().join(" "))}.bind(this));k.appendChild(r)}var I=UIUtils.createHTMLElement("div",$H({id:"search_advanced_events_slots_div",class_name:"link",style:"text-align:right;"}));v.appendChild(I);var M=UIUtils.createHTMLElement("a",$H({id:"search_advanced_events_slots_link",class_name:"submit_link",innerHTML:gettext("Advanced Search by connectivity")}));M.observe("click",function(Y){if(document.getElementById("events_slots").style.display=="block"){document.getElementById("events_slots").style.display="none";document.getElementById("search_advanced_events_slots_link").innerHTML=gettext("Advanced Search by connectivity")}else{document.getElementById("events_slots").style.display="block";document.getElementById("search_advanced_events_slots_link").innerHTML=gettext("Hide Advanced Search by connectivity")}UIUtils.setInfoResourceHeight()});I.appendChild(M);var a=UIUtils.createHTMLElement("div",$H({class_name:"versions"}));v.appendChild(a);a.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Selected version")+": "})));a.appendChild(UIUtils.createHTMLElement("span",$H({id:"version_link",style:"color:#0000ff;",innerHTML:"v"+this.getVersion()})));var R=UIUtils.createHTMLElement("div",$H({id:"version_panel",class_name:"version_panel",style:"display:none;"}));a.appendChild(R);var z=UIUtils.createHTMLElement("div",$H({class_name:"version_title"}));z.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Choose the version you want to view")+": "})));R.appendChild(z);this._addVersionsToPanel(R);var U=UIUtils.createHTMLElement("div",$H({id:"view_versions_div",class_name:"link",style:"text-align:right;"}));v.appendChild(U);var g=UIUtils.createHTMLElement("a",$H({id:"view_versions_link",class_name:"submit_link",innerHTML:gettext("Show all versions")}));g.observe("click",function(Y){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).showVersionPanel();UIUtils.setInfoResourceHeight()});U.appendChild(g);var n=UIUtils.createHTMLElement("div",$H({id:"access_template_link",class_name:"link"}));v.appendChild(n);var Q=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",href:this._state.getUriTemplate(),target:"_blank",innerHTML:gettext("Access to the Template")}));n.appendChild(Q);if(this._state.getMashupId()==null){var H=UIUtils.createHTMLElement("div",$H({id:"update_code_link",class_name:"link"}));v.appendChild(H);if(this._state.getAddedBy()=="Yes"){var C=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",innerHTML:gettext("Update code")}));C.observe("click",function(Y){UIUtils.updateGadgetXHTML()});H.appendChild(C)}}var J=UIUtils.createHTMLElement("div",$H({id:"delete_gadget_link",class_name:"link"}));v.appendChild(J);this._deleteGadget(J);if(this._state.getMashupId()==null){var p=UIUtils.createHTMLElement("button",$H({id:"add_gadget_button",class_name:"add_gadget",style:"text-align:center;",innerHTML:gettext("Add Gadget")}));p.observe("click",function(Y){CatalogueFactory.getInstance().addResourceToShowCase(UIUtils.getSelectedResource())},false,"instance_gadget");$("info_resource_content").appendChild(p)}else{var p=UIUtils.createHTMLElement("button",$H({id:"add_gadget_button",class_name:"add_mashup",style:"text-align:center;",innerHTML:gettext("Add Mashup")}));p.observe("click",function(Y){CatalogueFactory.getInstance().addMashupResource(UIUtils.getSelectedResource())},false,"instance_mashup");var O=UIUtils.createHTMLElement("button",$H({id:"merge_mashup_button",class_name:"add_mashup",style:"text-align:center;",innerHTML:gettext("Merge Mashup")}));O.observe("click",function(Y){CatalogueFactory.getInstance().mergeMashupResource(UIUtils.getSelectedResource())},false,"instance_mashup");$("info_resource_content").appendChild(p);$("info_resource_content").appendChild(O)}this._rateResource();UIUtils.setInfoResourceHeight()};Resource.prototype.updateTags=function(){var c=this._tagsToMoreImportantTags($(this._id+"_important_tags"),3);var a=$$("#"+this._id+" .tags")[0];var d=$$("#"+this._id+" .tags .go_to_tagCloud")[0];if(c>0&&!d){var b=UIUtils.createHTMLElement("a",$H({class_name:"go_to_tagCloud",innerHTML:gettext("More")}));b.observe("click",function(f){UIUtils.sendPendingTags();UIUtils.showResourceTagCloud(this._id)}.bind(this));a.appendChild(b)}if((this._id==UIUtils.selectedResource)&&($(this._id+"_tagcloud")!=null)){this._tagsToTagcloud($(this._id+"_tagcloud"),"description",{tags:"mytags"})}};Resource.prototype.changeTagcloud=function(d){var c={};$("view_tags_links").innerHTML="";c={tags:d};switch(d){case"mytags":var f=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("All tags")}));f.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("all");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(f);$("view_tags_links").appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("My tags")})));var b=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("Others tags")}));b.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("others");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(b);UIUtils.hidde("add_tags_link");UIUtils.show("add_tags_panel");$("new_tag_text_input").value="";$("new_tag_text_input").size=5;$("new_tag_text_input").focus();break;case"others":var f=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("All tags")}));f.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("all");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(f);var a=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("My tags")}));a.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("mytags");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(a);$("view_tags_links").appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("Others tags")})));UIUtils.show("add_tags_link");UIUtils.hidde("add_tags_panel");break;case"all":default:$("view_tags_links").appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:gettext("All tags")})));var a=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("My tags")}));a.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("mytags");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(a);var b=UIUtils.createHTMLElement("a",$H({innerHTML:gettext("Others tags")}));b.observe("click",function(g){CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).changeTagcloud("others");UIUtils.setInfoResourceHeight()});$("view_tags_links").appendChild(b);UIUtils.show("add_tags_link");UIUtils.hidde("add_tags_panel")}if($(this._id+"_tagcloud")){this._tagsToTagcloud($(this._id+"_tagcloud"),"description",c)}};Resource.prototype.showVersionPanel=function(){if($("version_panel").style.display=="none"){$("version_panel").style.display="block";$("view_versions_link").innerHTML=gettext("Hide all versions")}else{$("version_panel").style.display="none";$("view_versions_link").innerHTML=gettext("Show all versions")}};var _getFirstTagNonRepeat=function(a,c){for(var b=0;b<a.length;b++){if(!_containsTag(a[b],c)){return a[b]}}return};var _containsTag=function(b,c){for(var a=0;a<c.length;a++){if(b.equals(c[a])){return true}}return false};Resource.prototype._tagsToMoreImportantTags=function(k,g){var h="";var l=this._state.getTags();var f=[];var a=Math.min(g,l.length);for(var d=0;d<a;d++){var b=_getFirstTagNonRepeat(l,f);if(b){f[d]=b;for(var c=0;c<l.length;c++){if((!_containsTag(l[c],f))&&(f[d].compareTo(l[c])<0)){f[d]=l[c]}}}else{break}}k.innerHTML="";for(var d=0;d<f.length;d++){k.appendChild(f[d].tagToHTML());if(d<(((f.length>g)?g:f.length)-1)){k.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:", "})))}}return f.length};Resource.prototype._events=function(f){f.innerHMTL="";var d=this._state.getEvents();for(var c=0;c<d.length;c++){var a=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));f.appendChild(a);var b=UIUtils.createHTMLElement("a",$H({title:gettext("Search by ")+d[c],innerHTML:d[c]}));b.observe("click",function(g){UIUtils.searchByConnectivity(URIs.GET_RESOURCES_SIMPLE_SEARCH,"connectEvent",this.innerHTML)});a.appendChild(b);a.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((c<(d.length-1))?",":"")})))}};Resource.prototype._addVersionsToPanel=function(g){var h=function(l,k){var j=parseFloat(l);var m=parseFloat(k);return((j<m)?-1:((j>m)?1:0))};g.innerHMTL="";var a=this._state.getAllVersions().sort(h);for(var f=0;f<a.length;f++){var c=UIUtils.createHTMLElement("span",$H({}));g.appendChild(c);if(a[f]==this._state.getVersion()){c.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:"v"+a[f]})))}else{var b=UIUtils.createHTMLElement("a",$H({title:gettext("Select this version as preferred version"),innerHTML:"v"+a[f]}));b.observe("click",function(j){UIUtils.selectedVersion=j.currentTarget.innerHTML.substring(1);UIUtils.setPreferredGadgetVersion(UIUtils.selectedVersion)});c.appendChild(b)}if(this._state.getAddedBy()=="Yes"){c.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:" "})));var d=UIUtils.createHTMLElement("button",$H({title:gettext("Delete this version of the gadget"),class_name:"delete_icon",name:a[f],innerHTML:gettext("delete")}));d.observe("click",function(j){UIUtils.selectedVersion=j.currentTarget.getAttribute("name");LayoutManagerFactory.getInstance().showWindowMenu("deleteAllResourceVersions")});c.appendChild(d);c.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:" "})))}else{c.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((f<(a.length-1))?", ":"")})))}}};Resource.prototype._deleteGadget=function(a){var b=this._state.getAddedBy();a.innerHTML="";if(b=="Yes"){var c=UIUtils.createHTMLElement("a",$H({class_name:"submit_link",innerHTML:gettext("Delete")}));c.observe("click",function(d){UIUtils.deleteGadget(this._id)}.bind(this));a.appendChild(c)}};Resource.prototype._slots=function(f){f.innerHMTL="";var d=this._state.getSlots();for(var c=0;c<d.length;c++){var a=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));f.appendChild(a);var g=gettext("Search by %(slotName)s");g=interpolate(g,{slotName:d[c]});var b=UIUtils.createHTMLElement("a",$H({title:g,innerHTML:d[c]}));b.observe("click",function(h){UIUtils.searchByConnectivity(URIs.GET_RESOURCES_SIMPLE_SEARCH,"connectSlot",this.innerHTML)});a.appendChild(b);a.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((c<(d.length-1))?",":"")})))}};Resource.prototype._tagsToTagcloud=function(g,d){g.innerHTML="";var h=this._state.getTags();var c=arguments[2]||{tags:"all"};switch(c.tags){case"all":for(var b=0;b<h.length;b++){var l=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));l.appendChild(h[b].tagToTypedHTML());l.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((b<(h.length-1))?",":"")})));g.appendChild(l)}break;case"mytags":var k=[];var a=0;for(var b=0;b<h.length;b++){if(h[b].getAdded_by()=="Yes"){k[a]=h[b];a++}}for(var b=0;b<k.length;b++){var l=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));l.appendChild(k[b].tagToTypedHTML(c));var f=UIUtils.createHTMLElement("button",$H({title:gettext("Delete tag"),class_name:"delete button"}));f.observe("click",function(j){var m=BrowserUtilsFactory.getInstance().getTarget(j);UIUtils.removeTagUser(m.parentNode.firstChild.innerHTML,this._id)}.bind(this));l.appendChild(f);l.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((b<(k.length-1))?",":"")})));g.appendChild(l)}break;case"others":default:var k=[];var a=0;for(var b=0;b<h.length;b++){if(h[b].getAdded_by()=="No"||h[b].getAppearances()>1){k[a]=h[b];a++}}for(var b=0;b<k.length;b++){var l=UIUtils.createHTMLElement("span",$H({class_name:"multiple_size_tag"}));l.appendChild(k[b].tagToTypedHTML());l.appendChild(UIUtils.createHTMLElement("span",$H({innerHTML:((b<(k.length-1))?",":"")})));g.appendChild(l)}}};Resource.prototype._rateResource=function(){var a=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getUserVote();var d=CatalogueFactory.getInstance().getResource(UIUtils.selectedResource).getPopularity();if(a!=0){$("rateStatus").innerHTML=$("ratingSaved").innerHTML;for(var b=1;b<=a;b++){$("_"+b).className="on"}}if(d!=null){var b=1;for(b;b<=d;b++){$("res_"+b).className="on"}if((d%1)!=0){$("res_"+b).className="md";b++}for(b;b<=5;b++){$("res_"+b).className=""}}var c=this._state.getVotes();var f=ngettext("%(voteCount)s vote","%(voteCount)s votes",c);$("votes").innerHTML=interpolate(f,{voteCount:c},true)};Resource.prototype._createResource=function(c){var b=function(j,g){var f=LogManagerFactory.getInstance();var h=f.formatError(gettext("Error creating the resource: %(errorMsg)s."),j,g);f.log(h);LayoutManagerFactory.getInstance().showMessageMenu(h,Constants.Logging.ERROR_MSG)};var d=function(g){var f=g.responseXML;this._state=new ResourceState(f);this.paint()};var a=PersistenceEngineFactory.getInstance();a.send_post(url_Server,url_,this,d,b)};function ResourceState(k){var u=null;var w=null;var g=null;var f=null;var p=null;var q=null;var h=null;var m=null;var o=null;var a=null;var v=null;var t=[];var n=[];var l=[];var b=[];var j=null;var c=null;var r=null;var d=[];this.getVendor=function(){return u};this.getName=function(){return w};this.getDisplayName=function(){return g};this.getVersion=function(){return f};this.getId=function(){return p};this.getAllVersions=function(){return t};this.getDescription=function(){return q};this.getUriImage=function(){return h};this.getUriTemplate=function(){return a};this.getUriWiki=function(){return m};this.getMashupId=function(){return o};this.getAddedBy=function(){return v};this.setTags=function(x){n.clear();for(var y=0;y<x.length;y++){n.push(new Tag(x[y]))}};this.addTag=function(x){n.push(new Tag(x))};this.setSlots=function(x){l.clear();for(var y=0;y<x.length;y++){l.push(x[y].friendcode)}};this.setEvents=function(x){b.clear();for(var y=0;y<x.length;y++){b.push(x[y].friendcode)}};this.setVotes=function(x){j=x.voteData[0].votes_number;r=x.voteData[0].user_vote;c=x.voteData[0].popularity};this.getContract=function(){for(i=0;i<d.length;i++){var x=d[i];if(x.name.toLowerCase()=="contratable"){return x.contract}}return null};this.getGadgetApps=function(){for(i=0;i<d.length;i++){var x=d[i];if(x.name.toLowerCase()=="contratable"){return x.applications}}return[]};this.getTags=function(){return n};this.getSlots=function(){return l};this.getEvents=function(){return b};this.getVotes=function(){return j};this.getUserVote=function(){return r};this.getPopularity=function(){return c};this.getCapabilities=function(){return d};u=k.vendor;w=k.name;g=k.displayName;f=k.version;p=k.id;t=k.versions;q=k.description;h=k.uriImage;m=k.uriWiki;if(k.mashupId&&k.mashupId!=""){o=k.mashupId}v=k.added_by_user;a=k.uriTemplate;this.setEvents(k.events);this.setSlots(k.slots);this.setTags(k.tags);j=k.votes[0].votes_number;r=k.votes[0].user_vote;c=k.votes[0].popularity;d=k.capabilities}function Tagger(){var h=this;var d=$H();var a=0;this.addTag=function(j){if(j.length<3){$("tag_alert").style.display="block";UIUtils.getError($("tag_alert"),gettext("Tags must have at least three characters."));UIUtils.setInfoResourceHeight()}else{if(!c(j)){var k="new_tag_"+a;a++;d[k]=j;$("tag_alert").style.display="none"}}};this.addGlobalTag=function(j){if(!c(j)){var k="new_tag_"+d.keys().length;d[k]=j}};this.getTags=function(){return d};this.removeTag=function(j){d.remove(j);b(j)};this.removeAll=function(){d=$H();a=0;if(!UIUtils.tagmode){f()}};this.sendTags=function(k,r,o){if(d.keys().length>0){var q=function(y,w){var v=LogManagerFactory.getInstance();var x=v.formatError(gettext("Error sending tags: %(errorMsg)s."),y,w);v.log(x);LayoutManagerFactory.getInstance().showMessageMenu(x,Constants.Logging.ERROR_MSG);h.removeAll()};var l=function(x){var w=x.responseText;var v=JSON.parse(w);o.setTags(v.tagList);if(!UIUtils.repaintCatalogue){o.updateTags()}if(UIUtils.tagmode){CatalogueFactory.getInstance().updateGlobalTags()}h.removeAll()};var j=d.values();var u;if(window.ActiveXObject){u=new ActiveXObject("Microsoft.XMLDOM")}else{if(document.implementation){u=document.implementation.createDocument("","",null)}}var t=u.createElement("Tags");u.appendChild(t);for(var p=0;p<j.length;p++){var n=u.createElement("Tag");n.appendChild(u.createTextNode(j[p]));t.appendChild(n)}var m;if(typeof XMLSerializer!="undefined"){m={tags_xml:(new XMLSerializer()).serializeToString(u)}}else{if(u.xml){m={tags_xml:u.xml}}}PersistenceEngineFactory.getInstance().send_post(k+r,m,this,l,q)}};this.removeTagUser=function(j,n,o){var m=CatalogueFactory.getInstance().getResource(o);var k=function(r){var p=LogManagerFactory.getInstance();var q=p.formatError(gettext("Error removing tag: %(errorMsg)s."),r,e);p.log(q)};var l=function(r){var q=r.responseText;var p=JSON.parse(q);m.setTags(p.tagList);m.updateTags();if(UIUtils.tagmode){CatalogueFactory.getInstance().updateGlobalTags()}};PersistenceEngineFactory.getInstance().send_delete(j+n,this,l,k)};var c=function(j){var k=d.values();for(var l=0;l<k.length;l++){if(k[l]==j){return true}}return false};var g=function(q,p){var r=UIUtils.createHTMLElement("div",$H({id:q,class_name:"new_tag"}));r.observe("mouseover",function(t){$("button_disable_"+q).hide();$("button_enable_"+q).show()});r.observe("mouseout",function(t){$("button_enable_"+q).hide();$("button_disable_"+q).show()});var o=UIUtils.createHTMLElement("span",$H({innerHTML:p}));var k=UIUtils.createHTMLElement("span",$H({id:"button_disable_"+q}));var j=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("delete")}));k.appendChild(j);var m=UIUtils.createHTMLElement("span",$H({id:"button_enable_"+q}));m.hide();m.observe("click",function(t){UIUtils.removeTag(q)});var n=UIUtils.createHTMLElement("img",$H({src:_currentTheme.getIconURL("delete")}));m.appendChild(n);var l=UIUtils.createHTMLElement("span",$H({innerHTML:","}));r.appendChild(o);r.appendChild(k);r.appendChild(m);r.appendChild(l);$("my_tags").insertBefore(r,$("new_tag_text"))};var b=function(k){if(!UIUtils.tagmode){var l=$("my_tags");var j=$(k);l.removeChild(j)}};var f=function(){var j=$("my_tags");while(j.childNodes.length>1){j.removeChild(j.childNodes[0])}}}function Tag(a){var b=new StateTag(a);this.getIdentifier=function(){return b.getIdentifier()};this.getValue=function(){return b.getValue()};this.getAdded_by=function(){return b.getAdded_by()};this.getAppearances=function(){return b.getAppearances()};this.tagToHTML=function(){var c=UIUtils.createHTMLElement("a",$H({title:gettext("Search by ")+b.getValue(),innerHTML:b.getValue()}));c.observe("click",function(d){UIUtils.searchByTag(URIs.GET_RESOURCES_SIMPLE_SEARCH,b.getValue())});return c};this.tagToTypedHTML=function(){var d=arguments[0]||{tags:"undefined"};var h;if(b.getAppearances()<5){h="tag_type_1"}else{if(b.getAppearances()<15){h="tag_type_2"}else{if(b.getAppearances()<25){h="tag_type_3"}else{h="tag_type_4"}}}var g=gettext("Search by ")+b.getValue();var c=b.getValue()+((d.tags=="undefined")?" ("+b.getAppearances()+")":"");var f=UIUtils.createHTMLElement("a",$H({class_name:h,title:g,innerHTML:c}));f.observe("click",function(j){UIUtils.searchByTag(URIs.GET_RESOURCES_SIMPLE_SEARCH,b.getValue())});return f};this.equals=function(c){return((c.getValue()==b.getValue())&&(c.getAppearances()==b.getAppearances()))};this.compareTo=function(c){if(b.getAppearances()<(c.getAppearances())){return -1}else{if(b.getAppearances()>(c.getAppearances())){return 1}else{return 0}}}}function StateTag(a){var b=a.id;var f=a.value;var d=a.appearances;var c=a.added_by;this.getIdentifier=function(){return b};this.getValue=function(){return f};this.getAppearances=function(){return d};this.getAdded_by=function(){return c}}var BackgroundFadder=function(d,f,c,b,a){this.interval=50;this.initialTime=b;this.elements=(d instanceof Array)?d:[d];this.numSteps=Math.round(parseInt(a,10)/this.interval);this.startingRed=this._hex2Dec(f.substr(1,2));this.startingGreen=this._hex2Dec(f.substr(3,2));this.startingBlue=this._hex2Dec(f.substr(5,2));this.endingRed=this._hex2Dec(c.substr(1,2));this.endingGreen=this._hex2Dec(c.substr(3,2));this.endingBlue=this._hex2Dec(c.substr(5,2));this.deltaRed=(this.endingGreen-this.startingRed)/this.numSteps;this.deltaGreen=(this.endingGreen-this.startingGreen)/this.numSteps;this.deltaBlue=(this.endingBlue-this.startingBlue)/this.numSteps;this.currentRed=this.startingRed;this.currentGreen=this.startingGreen;this.currentBlue=this.startingBlue;this.currentStep=0;this.timer1ID=0;this.timer2ID=0;this.fade=this.fade.bind(this)};BackgroundFadder.prototype.reset=function(){try{clearTimeout(this.timer1ID)}catch(a){}try{clearTimeout(this.timer2ID)}catch(a){}this.currentRed=this.startingRed;this.currentGreen=this.startingGreen;this.currentBlue=this.startingBlue;this.currentStep=0;this.timer1ID=0;this.timer2ID=0};BackgroundFadder.prototype.fade=function(){this._setBackgrounds();if(this.currentStep<=this.numSteps){if(this.currentStep==this.numSteps){this.currentRed=this.endingRed;this.currentGreen=this.endingGreen;this.currentBlue=this.endingBlue}else{this.currentRed+=this.deltaRed;this.currentGreen+=this.deltaGreen;this.currentBlue+=this.deltaBlue}if(this.currentStep==0){this.timer1ID=setTimeout(function(){this.timer2ID=setTimeout(this.fade,this.interval)}.bind(this),this.initialTime)}else{this.timer2ID=setTimeout(this.fade,this.interval)}}else{for(var a=0;a<this.elements.length;a++){if(typeof this.elements[a].getHTMLElement==="function"){this.elements[a].getHTMLElement().style.backgroundColor=""}else{this.elements[a].style.backgroundColor=""}}}this.currentStep++};BackgroundFadder.prototype._setBackgrounds=function(){var a=this._getCurrentColor();for(var b=0;b<this.elements.length;b++){if(typeof this.elements[b].getHTMLElement==="function"){this.elements[b].getHTMLElement().style.backgroundColor=a}else{this.elements[b].style.backgroundColor=a}}};BackgroundFadder.prototype._getCurrentColor=function(){var a=this._dec2Hex(this.currentRed);var b=this._dec2Hex(this.currentGreen);var c=this._dec2Hex(this.currentBlue);return"#"+a+""+b+""+c+""};BackgroundFadder.prototype.HEX_CHARS="0123456789ABCDEF";BackgroundFadder.prototype._hex2Dec=function(b){b=b.toUpperCase();var c=0;var a=b.substring(0,1);c=(this.HEX_CHARS.indexOf(a)*16);a=b.substring(1);return c+this.HEX_CHARS.indexOf(a)};BackgroundFadder.prototype._dec2Hex=function(b){b=parseInt(b);if(b>255||b<0){b=255}var c=b%16;var a=(b-c)/16;return this.HEX_CHARS.charAt(a)+this.HEX_CHARS.charAt(c)};function DropDownMenu(a,b){if(arguments.length==0){return}this.idMenu=a;this.menu=$(this.idMenu);this.position;this.x;this.y;this.submenu=$$("#"+this.idMenu+" .submenu")[0];this.parentMenu=b;this.option_id=0;this.margin=5;if(this.parentMenu!=null){if((this.parentMenu.menu.style.zIndex=="")||isNaN(this.parentMenu.menu.style.zIndex)){this.menu.style.zIndex=5}else{this.menu.style.zIndex=parseInt(this.parentMenu.menu.style.zIndex)+1}}}DropDownMenu.prototype.calculatePosition=function(){if(this.position.indexOf("left")!=-1){var c=this.menu.getWidth();this.x-=c}this.menu.setStyle({"max-height":"none"});var b=this.menu.getHeight();if(this.position.indexOf("top")!=-1){if(this.y<b){this.menu.setStyle({"max-height":this.y+"px"});this.y=0}else{this.y-=b}}else{var a=BrowserUtilsFactory.getInstance().getHeight()-this.y;if(a<b){this.menu.setStyle({"max-height":a+"px"})}}if(this.position.indexOf("center")!=-1){var c=this.menu.getWidth();this.x-=c/2}this.menu.setStyle({top:this.y+"px",left:this.x+"px"})};DropDownMenu.prototype.addOption=function(n,d,a,f,o,m){var k=o;if(!o){k=""}var c="option underlined";var j=$$("#"+this.idMenu+">.option");if(f==j.length&&f!=0){j[j.length-1].className="option underlined";c="option"}else{if(f==j.length&&f==0){c="option"}}c=c+" "+k;var l="op_"+this.idMenu+"_"+this.option_id;var b='<div id="'+l+'" class = "'+c+'">';if(n){b+='<img src="'+n+'"/>'}b+="<span>"+d+"</span></div>";try{if(j.length>0){if(f==0){new Insertion.Before(j[f],b)}else{new Insertion.After(j[f-1],b)}}else{new Insertion.Bottom(this.menu,b)}var h=$(l);Event.observe(h,"click",a,false,m);this.option_id++}catch(g){return null}return l};DropDownMenu.prototype.removeOption=function(b){var c=$(b).remove();if(!c.hasClassName("underlined")){var a=$$("#"+this.idMenu+" .option:last-child")[0];if(a){a.removeClassName("underlined")}}};DropDownMenu.prototype.updateOption=function(h,j,c,l,k,g){var b=$(h);var f=k;if(!k){f=""}var a='<div id="'+h+'" class = "option '+f+'">';if(j){a+='<img src="'+j+'"/>'}a+="<span>"+c+"</span>";new Insertion.Before(b,a);b=b.remove();var d=$(h);if(b.hasClassName("underlined")){d.toggleClassName("underlined")}Event.observe(d,"click",l,g)};DropDownMenu.prototype.addOptionToSubmenu=function(g,d,f){var b=$$("#"+this.idMenu+" .submenu div:last-child")[0];if(b){b.toggleClassName("underlined")}var a="secondary_op_"+this.idMenu+"_"+this.option_id;var c='<div id="'+a+'" class = "option">';if(g){c+='<img src="'+g+'"/>'}c+="<span>"+d+"</span></div>";new Insertion.Bottom(this.submenu,c);b=$(a);Event.observe(b,"click",f);this.option_id++;return a};DropDownMenu.prototype.removeSecondaryOption=function(b){var c=$(b).remove();if(!c.hasClassName("underlined")){var a=$$("#"+this.idMenu+" .submenu div:last-child")[0];if(a){a.toggleClassName("underlined")}}};DropDownMenu.prototype.hide=function(){this.menu.style.display="none";if(this.parentMenu){this.parentMenu.hide()}};DropDownMenu.prototype.remove=function(){Element.remove(this.menu)};DropDownMenu.prototype.show=function(b,a,c){this.position=b.split("-");this.x=a;this.y=c;this.calculatePosition();this.menu.style.display="block"};DropDownMenu.prototype.clearOptions=function(){this.menu.update()};DropDownMenu.prototype.clearSubmenuOptions=function(){this.submenu.update()};function FilterDropDownMenu(a,b){DropDownMenu.call(this,a,b);this.optionHelps=new Hash()}FilterDropDownMenu.prototype=new DropDownMenu();FilterDropDownMenu.prototype.addOptionWithHelp=function(p,j,q,b,k){var f="option underlined";var n=$$("#"+this.idMenu+">.option");if(k==n.length&&k!=0){n[n.length-1].className="option underlined";f="option"}else{if(k==n.length&&k==0){f="option"}}var o="op_"+this.idMenu+"_"+this.option_id;var c='<div id="'+o+'" class = "'+f+'">';if(p){c+='<img src="'+p+'"/>'}c+="<span>"+j+"</span>";c+='<a class="help_button" type="button"></a></div>';try{if(n.length>0){if(k==0){new Insertion.Before(n[k],c)}else{new Insertion.After(n[k-1],c)}}else{new Insertion.Bottom(this.menu,c)}var m=$(o);m.style.paddingRight="25px";Event.observe(m,"click",b);var a="helpFor_"+o;var r='<div id="'+a+'" class="drop_down_menu"></div></div>';new Insertion.After($("menu_layer"),r);helpMenu=new DropDownMenu(a,this);var h=helpMenu.addOption(null,q,function(){},0);var d=helpMenu.menu.getElementsBySelector("#"+h)[0];Element.extend(d);d.addClassName("help_text");var g=m.getElementsBySelector(".help_button")[0];Event.observe(g,"click",function(v){Event.stop(v);var t=$$("div[id^=helpFor_]");var w=null;var u=0;while((u<t.length)&&(w==null)){if(t[u].style.display=="block"){t[u].style.display="none";w=t[u]}u++}if((w==null)||w!=this.menu){LayoutManagerFactory.getInstance().showDropDownMenu("filterHelp",this,Event.pointerX(v),Event.pointerY(v))}}.bind(helpMenu));this.optionHelps[a]=helpMenu;this.option_id++}catch(l){return null}return o};FilterDropDownMenu.prototype.removeOption=function(b){DropDownMenu.prototype.removeOption.call(this,b);var a="helpFor_"+b;this.optionHelps[a].remove()};FilterDropDownMenu.prototype.remove=function(){var a=this.optionHelps.keys();for(var b=0;b<a.length;b++){this.optionHelps[a[b]].remove()}DropDownMenu.prototype.remove.call(this)};function ColorDropDownMenu(g,d,h,c){c=c!=undefined?c:{};var b='<div id="'+g+'" class="drop_down_menu"></div>';new Insertion.After($("menu_layer"),b);DropDownMenu.call(this,g,d);this.menu.addClassName("color_menu");this.currentRow=document.createElement("div");Element.extend(this.currentRow);this.currentRow.className="row";this.menu.appendChild(this.currentRow);this.clearer=document.createElement("div");this.clearer.className="floatclearer";this.currentRow.appendChild(this.clearer);var f=c.onMouseOver!=undefined?c.onMouseOver:function(){};this._onMouseOver=function(l){var k=document.defaultView.getComputedStyle(BrowserUtilsFactory.getInstance().getTarget(l),null);var j=k.getPropertyCSSValue("background-color").getRGBColorValue();f(j)};var a=c.onMouseOut!=undefined?c.onMouseOut:function(){};this._onMouseOut=function(j){a()};this._onClick=function(l){var k=document.defaultView.getComputedStyle(BrowserUtilsFactory.getInstance().getTarget(l),null);var j=k.getPropertyCSSValue("background-color").getRGBColorValue();h(j);LayoutManagerFactory.getInstance().hideCover()}}ColorDropDownMenu.prototype=new DropDownMenu();ColorDropDownMenu.prototype.appendColor=function(b){var a=document.createElement("div");Element.extend(a);a.className="color_button";a.style.background="#"+b;this.currentRow.insertBefore(a,this.clearer);a.observe("mouseover",this._onMouseOver,true);a.observe("mouseout",this._onMouseOut,true);a.observe("click",this._onClick,true)};ColorDropDownMenu.prototype.show=function(b,a,c){DropDownMenu.prototype.show.apply(this,arguments);this.menu.style.height=this.currentRow.offsetHeight+"px"};ColorDropDownMenu.prototype.addOption=function(){};ColorDropDownMenu.prototype.removeOption=function(){};function RemoteChannelOperationsDropDownMenu(b,c){var a='<div id="remote_channel_operations" class="drop_down_menu">';new Insertion.After($("menu_layer"),a);DropDownMenu.call(this,b,c)}RemoteChannelOperationsDropDownMenu.prototype=new DropDownMenu();RemoteChannelOperationsDropDownMenu.prototype.getTextFromOp=function(g){var c=this.menu.childElements();for(var b=0;b<c.length;b++){var d=c[b].id;var a=d.length;var f=parseInt(d.charAt(a-1));if(f==g){return c[b].getTextContent()}}};function WindowMenu(b){if(arguments.length==0){return}this.htmlElement=document.createElement("div");Element.extend(this.htmlElement);this.htmlElement.className="window_menu";var a=document.createElement("div");a.className="window_top";this.htmlElement.appendChild(a);this._closeListener=this._closeListener.bind(this);this.closeButton=document.createElement("a");Element.extend(this.closeButton);this.closeButton.type="button";this.closeButton.className="closebutton";a.appendChild(this.closeButton);this.closeButton.observe("click",this._closeListener);this.titleElement=document.createElement("div");Element.extend(this.titleElement);this.titleElement.className="window_title";a.appendChild(this.titleElement);var c=document.createElement("div");Element.extend(c);c.addClassName("floatclearer");a.appendChild(c);this.windowContent=document.createElement("div");Element.extend(this.windowContent);this.windowContent.className="window_content";this.htmlElement.appendChild(this.windowContent);this.msgElement=document.createElement("div");Element.extend(this.msgElement);this.msgElement.className="msg";this.windowContent.appendChild(this.msgElement);this.windowBottom=document.createElement("div");Element.extend(this.windowBottom);this.windowBottom.className="window_bottom";this.htmlElement.appendChild(this.windowBottom);this.titleElement.update(b)}WindowMenu.prototype._closeListener=function(a){LayoutManagerFactory.getInstance().hideCover()};WindowMenu.prototype.setMsg=function(a){this.msgElement.update(a);if(this.htmlElement.parentNode!==null){this.calculatePosition()}};WindowMenu.prototype.calculatePosition=function(){var a=[];var h=BrowserUtilsFactory.getInstance().getHeight();var c=BrowserUtilsFactory.getInstance().getWidth();this.htmlElement.setStyle({"max-height":"none"});var g=this.htmlElement.getHeight();var d=this.htmlElement.getWidth();if(d>c/2){d=c/2;this.htmlElement.setStyle({width:d+"px"})}a[1]=h/2-g/2;a[0]=c/2-d/2;if(h<g){var b=document.defaultView.getComputedStyle(this.htmlElement,null);var f;f=b.getPropertyCSSValue("padding-top").getFloatValue(CSSPrimitiveValue.CSS_PX);f+=b.getPropertyCSSValue("padding-bottom").getFloatValue(CSSPrimitiveValue.CSS_PX);this.htmlElement.setStyle({"max-height":h-f+"px",top:"0px"})}else{this.htmlElement.style.top=a[1]+"px"}this.htmlElement.style.left=a[0]+"px"};WindowMenu.prototype.setHandler=function(a){this.operationHandler=a};WindowMenu.prototype.show=function(){document.body.insertBefore(this.htmlElement,$("header"));this.calculatePosition();this.htmlElement.style.display="block";this.setFocus()};WindowMenu.prototype.hide=function(){document.body.removeChild(this.htmlElement);this.msgElement.update()};WindowMenu.prototype.setFocus=function(){};function ContratationWindow(){WindowMenu.call(this,gettext("Contratation Information"));this.iframe=document.createElement("iframe");this.iframe.setAttribute("src","");this.iframe.setAttribute("width",480);this.iframe.setAttribute("height",550);this.windowContent.appendChild(this.iframe);this.acceptButton=document.createElement("button");this.acceptButton.appendChild(document.createTextNode(gettext("Finish")));this._acceptListener=this._acceptListener.bind(this);this.acceptButton.observe("click",this._acceptListener);this.windowBottom.appendChild(this.acceptButton)}ContratationWindow.prototype=new WindowMenu();ContratationWindow.prototype.setSrc=function(a){this.iframe.src=a};ContratationWindow.prototype.setCloseListener=function(a){this._closeListener=a};ContratationWindow.prototype.setHandler=function(a){this.acceptHandler=a};ContratationWindow.prototype._acceptListener=function(a){this.acceptHandler();LayoutManagerFactory.getInstance().hideCover()};function AddingGadgetToApplicationWindow(){WindowMenu.call(this,gettext("Assign Gadget to Application"));this.content=document.createElement("div");this.content.innerHTML='<b>Application:</b> <select id="app_appList"></select><br /><hr /><div id="app_name_vendor"><b>Name:</b><div class="inline_field" id="app_name"></div><br /><b>Vendor:</b><div class="inline_field" id="app_vendor"></div><br /><b>Business model:</b><div class="inline_field" id="app_business">App Business Model</div><br /><b>List of Gadgets:</b><div class="inline_field" id="app_gadgets"></div><br /><b>Description:</b><div class="inline_field" id="app_desc"></div><br /><br /></div><div id="app_img_container"><img class="app_image" id="app_img" src="" /></div><div id="app_gadgets_desc"></div>';document.body.insertBefore(this.htmlElement,$("header"));this.windowContent.appendChild(this.content);this.link=document.createElement("div");this.link.innerHTML='<a style="float: right; padding-top: 5px;" target="_blank" href="http://emarketplace1.hi.inet:3980/BOCL/BMPS_BOCL.html">View business model description</a>';this.windowContent.appendChild(this.link);this.app_select=document.getElementById("app_appList");this.app_name=document.getElementById("app_name");this.app_vendor=document.getElementById("app_vendor");this.app_image=document.getElementById("app_img");this.app_desc=document.getElementById("app_desc");this.app_gadgets=document.getElementById("app_gadgets");var f="";var c=CatalogueFactory.getInstance().getAvailableApps();for(var b=0;b<c.length;b++){var d=c[b];var a='<option value="'+d.app_code+'">'+d.short_name+"</option>";f+=a;this.app_select.innerHTML=f}Event.observe(this.app_select,"change",function(){this.update_window()}.bind(this));this.acceptButton=document.createElement("button");this.acceptButton.appendChild(document.createTextNode(gettext("Assign")));this._acceptListener=this._acceptListener.bind(this);this.acceptButton.observe("click",this._acceptListener);this.windowBottom.appendChild(this.acceptButton)}AddingGadgetToApplicationWindow.prototype=new WindowMenu();AddingGadgetToApplicationWindow.prototype.setCloseListener=function(a){this._closeListener=a};AddingGadgetToApplicationWindow.prototype.setHandler=function(a){this.acceptHandler=function(){a(this._gadgetId,this._appId)}.bind(this)};AddingGadgetToApplicationWindow.prototype._acceptListener=function(a){this.acceptHandler();LayoutManagerFactory.getInstance().hideCover()};AddingGadgetToApplicationWindow.prototype.setExtraData=function(a){this._gadgetId=a;this.update_window()};AddingGadgetToApplicationWindow.prototype.update_window=function(){var a=this.app_select.selectedIndex;if(a!=-1){this._appId=this.app_select[a].value;var b=CatalogueFactory.getInstance().getAvailableApps();var c=b[a];this.app_name.innerHTML=c.name;this.app_vendor.innerHTML=c.vendor;this.app_gadgets.innerHTML=c.gadget_list;this.app_desc.innerHTML=c.description;this.app_image.setAttribute("src",c.image_uri)}};function BuyingApplicationWindow(){WindowMenu.call(this,gettext("Purchase Application"));this.content=document.createElement("div");this.content.innerHTML='<b>Application:</b><div class="inline_field" id="buy_app_shortname"></div><br /><hr /><div id="buy_name_vendor"><b>Name:</b><div class="inline_field" id="buy_name"></div><br /><b>Vendor:</b><div class="inline_field" id="buy_vendor"></div><br /><b>List of Gadgets:</b><div class="inline_field" id="buy_gadgets"></div><br /><b>Description:</b><div class="inline_field" id="buy_desc"></div></div><div id="app_img_container"><img class="app_image" id="buy_img" src="" /></div><div id="buy_gadgets_desc"></div>';document.body.insertBefore(this.htmlElement,$("header"));this.windowContent.appendChild(this.content);this.link=document.createElement("div");this.link.innerHTML='<a id="buy_link" style="float: right; padding-top: 5px;" target="_blank" href="">View pricing</a>';this.windowContent.appendChild(this.link);this.app_shortname=document.getElementById("buy_app_shortname");this.app_name=document.getElementById("buy_name");this.app_vendor=document.getElementById("buy_vendor");this.app_image=document.getElementById("buy_img");this.app_desc=document.getElementById("buy_desc");this.app_gadgets=document.getElementById("buy_gadgets");this.app_link=document.getElementById("buy_link");this.acceptButton=document.createElement("button");this.acceptButton.appendChild(document.createTextNode(gettext("Contract")));this._acceptListener=this._acceptListener.bind(this);this.acceptButton.observe("click",this._acceptListener);this.windowBottom.appendChild(this.acceptButton)}BuyingApplicationWindow.prototype=new WindowMenu();BuyingApplicationWindow.prototype.setCloseListener=function(a){this._closeListener=a};BuyingApplicationWindow.prototype.setHandler=function(a){this.acceptHandler=function(){a(this._gadgetId,this._appId)}.bind(this)};BuyingApplicationWindow.prototype._acceptListener=function(a){this.acceptHandler();LayoutManagerFactory.getInstance().hideCover()};BuyingApplicationWindow.prototype.setExtraData=function(a){this._resource=a;var b=this._resource.getGadgetApps();var c=null;if(b.length>0){c=b[0]}else{this.app_shortname.innerHTML="Gadget not linked to any Application! Can't continue!";return}this._gadgetId=this._resource.getId();this._appId=c.app_code;this.app_shortname.innerHTML=c.short_name;this.app_name.innerHTML=c.name;this.app_vendor.innerHTML=c.vendor;this.app_gadgets.innerHTML=c.gadget_list;this.app_desc.innerHTML=c.description;this.app_image.setAttribute("src",c.image_uri);this.app_link.setAttribute("href",c.template_uri)};function CreateWindowMenu(b){var d;this.element=b;switch(b){case"workSpace":d=gettext("Create workSpace");break}WindowMenu.call(this,d);this.button=document.createElement("button");Element.extend(this.button);this.button.appendChild(document.createTextNode(gettext("Create")));this.windowBottom.appendChild(this.button);var c=document.createElement("button");Element.extend(c);c.appendChild(document.createTextNode(gettext("Cancel")));c.observe("click",this._closeListener);this.windowBottom.appendChild(c);var a=document.createElement("label");a.appendChild(document.createTextNode(gettext("Nombre: ")));this.nameInput=document.createElement("input");Element.extend(this.nameInput);this.nameInput.setAttribute("type","text");this.nameInput.setAttribute("value","");a.appendChild(this.nameInput);this.windowContent.insertBefore(a,this.msgElement);this.operationHandler=function(g){var f=BrowserUtilsFactory.getInstance().getTarget(g);if(f==this.nameInput&&g.keyCode==Event.KEY_RETURN||f==this.button){Event.stop(g);this.executeOperation()}}.bind(this);this.button.observe("click",this.operationHandler);this.nameInput.observe("keypress",this.operationHandler)}CreateWindowMenu.prototype=new WindowMenu();CreateWindowMenu.prototype.setFocus=function(){this.nameInput.focus()};CreateWindowMenu.prototype.executeOperation=function(){var a=this.nameInput.value;switch(this.element){case"workSpace":if(!OpManagerFactory.getInstance().workSpaceExists(a)){OpManagerFactory.getInstance().addWorkSpace(a)}else{var b=gettext('Invalid name: the name "%(newName)s" is already in use');b=interpolate(b,{newName:a},true);this.setMsg(b)}break;default:break}};CreateWindowMenu.prototype.show=function(){this.nameInput.value="";WindowMenu.prototype.show.call(this)};function AlertWindowMenu(){WindowMenu.call(this,gettext("Warning"));var a=document.createElement("img");Element.extend(a);a.setAttribute("src",_currentTheme.getIconURL("warning"));a.setAttribute("alt",gettext("Info:"));this.windowContent.insertBefore(a,this.msgElement);this.acceptButton=document.createElement("button");Element.extend(this.acceptButton);this.acceptButton.appendChild(document.createTextNode(gettext("Yes")));this._acceptListener=this._acceptListener.bind(this);this.acceptButton.observe("click",this._acceptListener);this.windowBottom.appendChild(this.acceptButton);this.cancelButton=document.createElement("button");Element.extend(this.cancelButton);this.cancelButton.appendChild(document.createTextNode(gettext("No")));this.cancelButton.observe("click",this._closeListener);this.windowBottom.appendChild(this.cancelButton);this.acceptHandler=null;this.cancelHandler=null}AlertWindowMenu.prototype=new WindowMenu();AlertWindowMenu.prototype._acceptListener=function(a){LayoutManagerFactory.getInstance().hideCover();this.acceptHandler()};AlertWindowMenu.prototype._closeListener=function(a){WindowMenu.prototype._closeListener(a);if(this.cancelHandler){this.cancelHandler()}};AlertWindowMenu.prototype.setHandler=function(a,b){this.acceptHandler=a;this.cancelHandler=b};AlertWindowMenu.prototype.setFocus=function(){this.acceptButton.focus()};function AddMashupWindowMenu(b){WindowMenu.call(this,gettext("Add Mashup"));var a=document.createElement("img");a.setAttribute("src",_currentTheme.getIconURL("warning"));a.setAttribute("alt",gettext("Info:"));this.windowContent.insertBefore(a,this.msgElement);this.acceptButton=document.createElement("button");Element.extend(this.acceptButton);this.acceptButton.appendChild(document.createTextNode(gettext("New Workspace")));this.acceptButton.observe("click",this._newWorkspaceListener.bind(this));this.windowBottom.appendChild(this.acceptButton);this.cancelButton=document.createElement("button");Element.extend(this.cancelButton);this.cancelButton.appendChild(document.createTextNode(gettext("Current Workspace")));this.cancelButton.observe("click",this._currentWorkspaceListener.bind(this));this.windowBottom.appendChild(this.cancelButton);this.acceptHandler=null;this.cancelHandler=null}AddMashupWindowMenu.prototype=new WindowMenu();AddMashupWindowMenu.prototype._newWorkspaceListener=function(a){this.acceptHandler();LayoutManagerFactory.getInstance().hideCover()};AddMashupWindowMenu.prototype._currentWorkspaceListener=function(a){this.cancelHandler();LayoutManagerFactory.getInstance().hideCover()};AddMashupWindowMenu.prototype.setHandler=function(a,b){this.acceptHandler=a;this.cancelHandler=b};AddMashupWindowMenu.prototype.setFocus=function(){this.acceptButton.focus()};function MessageWindowMenu(a){WindowMenu.call(this,"");this.icon=document.createElement("img");this.windowContent.insertBefore(this.icon,this.msgElement);this.button=document.createElement("button");Element.extend(this.button);this.button.appendChild(document.createTextNode(gettext("Accept")));this.windowBottom.appendChild(this.button);this.button.observe("click",this._closeListener)}MessageWindowMenu.prototype=new WindowMenu();MessageWindowMenu.prototype.setFocus=function(){this.button.focus()};MessageWindowMenu.prototype.setType=function(c){var d=["",gettext("Error"),gettext("Warning"),gettext("Info")];var a=["","error","warning","info"];var b=["",gettext("Error:"),gettext("Warning:"),gettext("Info:")];this.titleElement.update(d[c]);this.icon.setAttribute("src",_currentTheme.getIconURL(a[c]));this.icon.setAttribute("alt",gettext(b[c]))};function InfoWindowMenu(b){if(arguments.length==0){return}WindowMenu.call(this,b);var a=document.createElement("img");a.setAttribute("src",_currentTheme.getIconURL("info"));a.setAttribute("alt",gettext("Info:"));this.windowContent.insertBefore(a,this.msgElement);this.checkbox=document.createElement("input");Element.extend(this.checkbox);this.checkbox.setAttribute("type","checkbox");this.windowBottom.appendChild(this.checkbox);this.windowBottom.appendChild(document.createTextNode(gettext("Don't show me anymore")));this._dontShowAnymore=this._dontShowAnymore.bind(this);this.checkbox.observe("click",this._dontShowAnymore)}InfoWindowMenu.prototype=new WindowMenu();InfoWindowMenu.prototype._dontShowAnymore=function(c){var a=LayoutManagerFactory.getInstance();var b={};b["tip-"+this.type]={value:false};PreferencesManagerFactory.getInstance().getPlatformPreferences().set(b);a.hideCover()};InfoWindowMenu.prototype.show=function(a){this.type=a;this.checkbox.checked=false;WindowMenu.prototype.show.call(this)};function TipWindowMenu(){InfoWindowMenu.call(this,gettext("Do you know what ... ?"))}TipWindowMenu.prototype=new InfoWindowMenu();function FormWindowMenu(g,l){if(arguments.length==0){return}WindowMenu.call(this,l);this.fields=g;var n=document.createElement("table");n.setAttribute("cellspacing","0");n.setAttribute("cellpadding","0");var q=document.createElement("tbody");n.appendChild(q);for(var j in this.fields){var m=this.fields[j];var r=q.insertRow(-1);if(m.type==="separator"){var f=r.insertCell(-1);f.setAttribute("colSpan","2");var p=document.createElement("hr");f.appendChild(p);delete this.fields[j];continue}var c=r.insertCell(-1);Element.extend(c);c.addClassName("label");var k=document.createElement("label");k.appendChild(document.createTextNode(m.label));c.appendChild(k);if(m.required){var h=document.createElement("span");h.appendChild(document.createTextNode("*"));h.className="required_mark";c.appendChild(h)}var d=document.createElement("td");if(m.type=="radio"){r.insertBefore(d,c)}else{r.appendChild(d)}var a=InterfaceFactory.createInterface(j,m);a._insertInto(d);m.inputInterface=a}this.windowContent.insertBefore(n,this.msgElement);var o=document.createElement("div");o.className="legend";var h=document.createElement("span");h.appendChild(document.createTextNode("*"));h.className="required_mark";o.appendChild(h);o.appendChild(document.createTextNode(gettext("required field")));this.windowContent.insertBefore(o,this.msgElement);this.msgElement.addClassName("error");this.button=document.createElement("button");Element.extend(this.button);this.button.appendChild(document.createTextNode(gettext("Accept")));this.windowBottom.appendChild(this.button);this._acceptHandler=this._acceptHandler.bind(this);this.button.observe("click",this._acceptHandler);var b=document.createElement("button");Element.extend(b);b.appendChild(document.createTextNode(gettext("Cancel")));b.observe("click",this._closeListener);this.windowBottom.appendChild(b)}FormWindowMenu.prototype=new WindowMenu();FormWindowMenu.prototype.extraValidation=function(a){return""};FormWindowMenu.prototype._acceptHandler=function(h){var b=new ValidationErrorManager();for(var a in this.fields){b.validate(this.fields[a].inputInterface)}var j=this.extraValidation(this.fields);var d=b.toHTML();if(j!==null&&j!=""){d+="<p>"+j+"</p>"}if(d!=""){this.setMsg(d);return}else{var f;var c=new Object();for(var a in this.fields){var g=this.fields[a];var f=g.inputInterface.getValue();if(g.required||f!==""){c[a]=f}}this.executeOperation(c);LayoutManagerFactory.getInstance().hideCover()}};FormWindowMenu.prototype.show=function(){for(var a in this.fields){var b=this.fields[a];b.inputInterface.reset()}WindowMenu.prototype.show.call(this)};function PublishWindowMenu(c){var f=JSON.parse(ezweb_organizations);this.organizations=new Array();this.organizations.push({label:"------",value:""});for(var b=0;b<f.length;b++){name=f[b].split("__")[1];this.organizations.push({label:name,value:f[b]})}var a={name:{label:gettext("Mashup Name"),type:"id",required:true},vendor:{label:gettext("Vendor"),type:"id",required:true},version:{label:gettext("Version"),type:"version",required:true},author:{label:gettext("Author"),type:"text",defaultValue:ezweb_user_name},email:{label:gettext("Email"),type:"email",required:true},description:{label:gettext("Description"),type:"longtext"},imageURI:{label:gettext("Image URL"),type:"url"},wikiURI:{label:gettext("Wiki URL"),type:"url"},organization:{label:gettext("Organization"),type:"select",options:this.organizations}};FormWindowMenu.call(this,a,gettext("Publish Workspace"));var d=document.createElement("div");Element.extend(d);d.addClassName("msg warning");d.update(gettext("WARNING: configured and stored data in your workspace (properties and preferences except passwords) will be shared!"));this.windowContent.appendChild(d)}PublishWindowMenu.prototype=new FormWindowMenu();PublishWindowMenu.prototype.setFocus=function(){this.fields.name.inputInterface.focus()};PublishWindowMenu.prototype.executeOperation=function(a){OpManagerFactory.getInstance().activeWorkSpace.publish(a)};function ShareWindowMenu(b){wsName=OpManagerFactory.getInstance().activeWorkSpace.workSpaceState.name;var f=interpolate(gettext('Share "%(workspace)s" workspace with everybody through either a public URL or an embed object'),{workspace:wsName},true);var d=interpolate(gettext('Share "%(workspace)s" workspace only with the following groups'),{workspace:wsName},true);var a={public_sharing:{label:f,type:"radio",defaultValue:true,name:"share",onclick:this.hideGroups.bind(this)},group_sharing:{label:d,type:"radio",defaultValue:false,name:"share",onclick:this.showGroups.bind(this)},groups:{label:"",type:"multiple",options:[]}};FormWindowMenu.call(this,a,gettext("Share Workspace"));this.fields.groups.inputInterface.inputElement.parentNode.parentNode.style.display="none";this.fields.groups.inputInterface.inputElement.addClassName("window_multiple_select");var c=document.createElement("div");Element.extend(c);c.addClassName("msg warning");c.update(gettext("WARNING: configured and stored data in your workspace (properties and preferences except passwords) will be shared!"));this.windowContent.appendChild(c)}ShareWindowMenu.prototype=new FormWindowMenu();ShareWindowMenu.prototype.showGroups=function(){function b(f,d){errorMsg=gettext("The available groups cannot be displayed");this.setMsg(errorMsg);this.calculatePosition()}function c(l){var g=l.responseText;var f=JSON.parse(g);var d=this.fields.groups.inputInterface.inputElement;d.update();var j;for(var h=0;h<f.length;h++){j=new Option(f[h]["name"],f[h]["id"]);if(f[h]["sharing"]=="true"){j.disabled="disabled"}try{d.add(j,null)}catch(k){d.add(j)}}this.fields.groups.inputInterface.inputElement.parentNode.parentNode.style.display="table-row";this.calculatePosition()}var a=URIs.GET_SHARE_GROUPS.evaluate({workspace_id:OpManagerFactory.getInstance().activeWorkSpace.workSpaceState.id});PersistenceEngineFactory.getInstance().send_get(a,this,c,b)};ShareWindowMenu.prototype.hideGroups=function(){this.fields.groups.inputInterface.inputElement.parentNode.parentNode.style.display="none";this.calculatePosition()};ShareWindowMenu.prototype.setFocus=function(){this.fields.public_sharing.inputInterface.focus()};ShareWindowMenu.prototype.extraValidation=function(a){if(this.fields.group_sharing.inputInterface.getValue()&&this.fields.groups.inputInterface.inputElement.selectedIndex==-1){return gettext("You must select a group")}return null};ShareWindowMenu.prototype.executeOperation=function(b){var a=this.fields.groups.inputInterface.getValue();OpManagerFactory.getInstance().activeWorkSpace.shareWorkspace(true,a)};ShareWindowMenu.prototype.show=function(){FormWindowMenu.prototype.show.call(this);this.hideGroups()};function AddFeedMenu(c){var d=JSON.parse(ezweb_organizations);this.organizations=new Array();this.organizations.push({label:"------",value:""});for(var b=0;b<d.length;b++){name=d[b].split("__")[1];this.organizations.push({label:name,value:d[b]})}var a={name:{label:gettext("Name"),type:"id",required:true},URL:{label:gettext("URL"),type:"url",required:true},separator1:{type:"separator",required:true},imageURI:{label:gettext("Image URL"),type:"url"},iPhoneImageURI:{label:gettext("iPhone Image URL"),type:"url"},feed_color:{label:gettext("Template color"),type:"select",options:[{value:"blue",label:gettext("blue")},{value:"orange",label:gettext("orange")},{value:"red",label:gettext("red")},{value:"green",label:gettext("green")}]},menu_color:{label:gettext("Menu Color"),type:"color"},organization:{label:gettext("Organization"),type:"select",options:this.organizations}};FormWindowMenu.call(this,a,gettext("Add new feed"))}AddFeedMenu.prototype=new FormWindowMenu();AddFeedMenu.prototype.setFocus=function(){this.fields.name.inputInterface.focus()};AddFeedMenu.prototype.executeOperation=function(b){function a(g,f){alert("error generando el template");this.hide()}function d(h){var f=h.responseText;var g=JSON.parse(f);UIUtils.addResource(URIs.GET_POST_RESOURCES,"template_uri",g.URL)}var c={template_data:Object.toJSON(b)};PersistenceEngineFactory.getInstance().send_post(URIs.GADGET_TEMPLATE_GENERATOR.evaluate({gadget_type:"feed_reader"}),c,this,d,a)};function AddSiteMenu(c){var d=JSON.parse(ezweb_organizations);this.organizations=new Array();this.organizations.push({label:"------",value:""});for(var b=0;b<d.length;b++){name=d[b].split("__")[1];this.organizations.push({label:name,value:d[b]})}var a={name:{label:gettext("Name"),type:"id",required:true},URL:{label:gettext("URL"),type:"url",required:true},method:{label:gettext("Method"),type:"select",options:[{value:"GET",label:"GET"},{value:"POST",label:"POST"}]},separator1:{type:"separator",required:true},parse_parameters:{label:gettext("Parse URL Parameters"),type:"boolean"},fixed_params:{label:gettext("Fixed Params"),type:"text"},default_params:{label:gettext("Default Param Values"),type:"text"},events:{label:gettext("Events"),type:"text"},separator2:{type:"separator",required:true},home_URL:{label:gettext("Home URL"),type:"url"},imageURI:{label:gettext("Image URL"),type:"url"},iPhoneImageURI:{label:gettext("iPhone Image URL"),type:"url"},menu_color:{label:gettext("Menu Color (Hex.)"),type:"color"},organization:{label:gettext("Organization"),type:"select",options:this.organizations},source:{label:gettext("Source"),type:"text"},source_URL:{label:gettext("Source URL"),type:"url"}};FormWindowMenu.call(this,a,gettext("Add new site"))}AddSiteMenu.prototype=new FormWindowMenu();AddSiteMenu.prototype.setFocus=function(){this.fields.name.inputInterface.focus()};AddSiteMenu.prototype.executeOperation=function(b){function a(g,f){alert("error generando el template");this.hide()}function d(h){var f=h.responseText;var g=JSON.parse(f);UIUtils.addResource(URIs.GET_POST_RESOURCES,"template_uri",g.URL)}var c={template_data:Object.toJSON(b)};PersistenceEngineFactory.getInstance().send_post(URIs.GADGET_TEMPLATE_GENERATOR.evaluate({gadget_type:"web_browser"}),c,this,d,a)};function SharedWorkSpaceMenu(){WindowMenu.call(this,gettext("Shared WorkSpace Info"));var a=document.createElement("img");a.setAttribute("src",_currentTheme.getIconURL("info"));a.setAttribute("alt",gettext("Info:"));this.windowContent.insertBefore(a,this.msgElement);this.addElement("mainTable","table","windowContent");this.addElement("tableElement","tbody","mainTable");this.addElement("tr1Element","tr","tableElement");this.tr1Element.style.display="none";this.addElement("td11Element","td","tr1Element");this.addElement("label1","label","td11Element");this.label1.innerHTML=gettext("URL:");this.addElement("td12Element","td","tr1Element");this.addElement("urlElement","input","td12Element");this.addElement("tr2Element","tr","tableElement");this.tr2Element.style.display="none";this.addElement("td21Element","td","tr2Element");this.addElement("label2","label","td21Element");this.label2.innerHTML=gettext("HTML code:");this.addElement("td22Element","td","tr2Element");this.addElement("html_codeElement","textarea","td22Element");this.html_codeElement.setAttribute("cols",30);this.html_codeElement.setAttribute("rows",3)}SharedWorkSpaceMenu.prototype=new WindowMenu();SharedWorkSpaceMenu.prototype.addElement=function(c,b,a){this[c]=document.createElement(b);Element.extend(this[c]);this[a].appendChild(this[c])};SharedWorkSpaceMenu.prototype.setURL=function(a){this.urlElement.value=a;this.tr1Element.style.display="table-row"};SharedWorkSpaceMenu.prototype.setHTML=function(a){var b='<object width="" height="" data="'+a+'"></object>';this.html_codeElement.value=b;this.tr2Element.style.display="table-row"};SharedWorkSpaceMenu.prototype.hide=function(a){this.urlElement.value="";this.html_codeElement.value="";this.tr1Element.style.display="none";this.tr2Element.style.display="none";WindowMenu.prototype.hide.call(this)};function PreferencesWindowMenu(a){WindowMenu.call(this,"");var b=PreferencesManagerFactory.getInstance().getPreferencesDef(a).getInterface();this.windowContent.insertBefore(b,this.msgElement);this.acceptButton=document.createElement("button");Element.extend(this.acceptButton);this.acceptButton.appendChild(document.createTextNode(gettext("Save")));this._executeOperation=this._executeOperation.bind(this);this.acceptButton.observe("click",this._executeOperation);this.windowBottom.appendChild(this.acceptButton);this.cancelButton=document.createElement("button");Element.extend(this.cancelButton);this.cancelButton.appendChild(document.createTextNode(gettext("Cancel")));this.cancelButton.observe("click",this._closeListener);this.windowBottom.appendChild(this.cancelButton)}PreferencesWindowMenu.prototype=new WindowMenu();PreferencesWindowMenu.prototype.setManager=function(a){this.manager=a};PreferencesWindowMenu.prototype._executeOperation=function(){var b=new ValidationErrorManager();for(var a in this.fields){b.validate(this.fields[a].inputInterface)}var c=b.toHTML();if(c!=""){this.setMsg(c)}else{this.manager.save();LayoutManagerFactory.getInstance().hideCover()}};PreferencesWindowMenu.prototype.show=function(){this.titleElement.setTextContent(this.manager.buildTitle());this.manager.resetInterface("platform");WindowMenu.prototype.show.call(this)};var LayoutManagerFactory=function(){var a=null;var b=1;var g=2;var f={zIndex:b,height:0,visibility:"hidden"};var c={zIndex:g,display:"block",visibility:"visible"};function d(){this.currentViewType=null;this.currentView=null;this.catalogueLink=$("catalogue_link");this.wiringLink=$("wiring_link");this.dragboardLink=$("dragboard_link");this.catalogue=null;this.logs=LogManagerFactory.getInstance();this.logsLink=$("logs_link");this.currentMenu=null;this.coverLayerElement=$("menu_layer");this.coverLayerEvent=function(){this.hideCover()}.bind(this);this.tabBarStep=20;this.tabImgSize=null;this.extraGap=15;this.rightSlider=$("right_slider");this.leftSlider=$("left_slider");this.leftTimeOut;this.rightTimeOut;this.fixedTabBar=$("fixed_bar");if($("lite_toolbar_section")){this.fixedTabBarMaxWidth=$("bar").offsetWidth-$("add_tab_link").offsetWidth-$("lite_toolbar_section").offsetWidth-this.leftSlider.getWidth()-this.rightSlider.getWidth()-$("floating_gadgets_launcher").offsetWidth-30}else{this.fixedTabBarMaxWidth=$("bar").offsetWidth-$("add_tab_link").offsetWidth-this.leftSlider.getWidth()-this.rightSlider.getWidth()-$("floating_gadgets_launcher").offsetWidth-30}this.tabMarker=$("tab_marker");this.scrollTabBar=$("scroll_bar");this.scrollTabBarWidth=null;this.menus=new Array();d.prototype.resizeTabBar=function(){this.showTabs();if($("lite_toolbar_section")){this.fixedTabBarMaxWidth=$("bar").offsetWidth-$("add_tab_link").offsetWidth-$("lite_toolbar_section").offsetWidth-this.leftSlider.getWidth()-this.rightSlider.getWidth()-$("floating_gadgets_launcher").offsetWidth-30}else{this.fixedTabBarMaxWidth=$("bar").offsetWidth-$("add_tab_link").offsetWidth-this.leftSlider.getWidth()-this.rightSlider.getWidth()-$("floating_gadgets_launcher").offsetWidth-30}this.changeTabBarSize(0)};d.prototype._updateTaskProgress=function(){var h,k,j;k=Math.round((this.currentStep*100)/this.totalSteps);if(k<0){k=0}else{if(k>100){k=100}}j=(this.currentSubTask*100)/this.totalSubTasks;j+=k*(1/this.totalSubTasks);j=Math.round(j);if(j<0){j=0}else{if(j>100){k=100}}h=gettext("%(task)s %(percentage)s%");h=interpolate(h,{task:this.task,percentage:j},true);$("loading-task-title").setTextContent(h);if(this.subTask!=""){h=gettext("%(subTask)s: %(percentage)s%")}else{h="%(subTask)s"}h=interpolate(h,{subTask:this.subTask,percentage:k},true);$("loading-subtask-title").setTextContent(h)};d.prototype._startComplexTask=function(h,j){this.task=h?h:"";this.currentSubTask=-2;this.totalSubTasks=j!=undefined?j:1;this.logSubTask("");$("loading-window").removeClassName("disabled")};d.prototype.logSubTask=function(j,h){this.subTask=j?j:"";this.currentSubTask++;if(this.currentSubTask>=this.totalSubTasks){this.totalSubTasks=this.currentSubTask+1}this.currentStep=0;if(arguments.length==2){this.totalSteps=h}else{this.totalSteps=1}this._updateTaskProgress()};d.prototype.logStep=function(j,h){this.currentStep++;if(this.currentStep>this.totalSteps){this.totalSteps=this.currentStep+1}if(arguments.length==2){this.totalSteps=h}this._updateTaskProgress()};d.prototype._notifyPlatformReady=function(m){var j=$("loading-window");j.addClassName("fadding");if(m){Event.observe(window,"resize",this.resizeWrapper.bind(this))}var l=$("loading-message");var k=0;function h(){++k;if(k<80){l.setStyle({opacity:1-(k*0.025)});setTimeout(h,50)}else{j.addClassName("disabled");j.removeClassName("fadding");l.setStyle({opacity:"1"})}}setTimeout(h,50)};d.prototype.changeCurrentTheme=function(k){if(_currentTheme.name==k){return}this._startComplexTask(gettext("Changing current theme"));this.menus.clear();function h(n,m){var l=LayoutManagerFactory.getInstance();if(m.length>0){var o=gettext('There were errors while loading some of the images for the "%(theme)s" theme. Do you really want to use it?.');o=interpolate(o,{theme:n.name},true);l.showYesNoDialog(o,function(){h(n,[])},function(){l._notifyPlatformReady(false)},Constants.Logging.WARN_MSG);return}_currentTheme.deapplyStyle();_currentTheme=n;_currentTheme.applyStyle();setTimeout(OpManagerFactory.getInstance()._themeLoaded.bind(OpManagerFactory.getInstance()),500);l._notifyPlatformReady(false)}function j(n,m){var l=LayoutManagerFactory.getInstance();if(m!==null){var o=gettext('Error loading "%(theme)s" theme. Current theme has not been changed.');o=interpolate(o,{theme:n.name},true);l.showMessageMenu(o,Constants.Logging.WARN_MSG);l._notifyPlatformReady(false);return}n.preloadImages(h)}if(k!="default"){new Theme(k,_defaultTheme,j)}else{j(_defaultTheme,null)}};d.prototype.getCurrentViewType=function(){return this.currentViewType};d.prototype.resizeContainer=function(k){var h=$("wrapper");var j=BrowserUtilsFactory.getInstance().getHeight();var l=document.defaultView.getComputedStyle(h,null);var m=j-$("header").offsetHeight-l.getPropertyCSSValue("margin-bottom").getFloatValue(CSSPrimitiveValue.CSS_PX)-l.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX)-l.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);h.setStyle({height:m+"px"});k.setStyle({height:m+"px"});return m};d.prototype.resizeWrapper=function(){var h=BrowserUtilsFactory.getInstance().getHeight();var j=OpManagerFactory.getInstance();if(j.loadCompleted){var k=BrowserUtilsFactory.getInstance().getWidth();this.coverLayerElement.setStyle({height:h+"px",width:k+"px"});switch(this.currentViewType){case"catalogue":this.resizeContainer(this.currentView.catalogueElement);UIUtils.setResourcesWidth();UIUtils.resizeResourcesContainer();break;case"wiring":this.resizeContainer(this.currentView.wiringContainer);var l=j.activeWorkSpace.getWiringInterface();l.wiringTable.setStyle({width:(l.wiringContainer.getWidth()-20)+"px"});if(l.currentChannel){l.uncheckChannel(l.currentChannel);l.highlightChannel(l.currentChannel)}break;case"logs":this.resizeContainer(this.currentView.logContainer);break;case"dragboard":this.resizeContainer(this.currentView.dragboardElement);j.activeWorkSpace.getActiveDragboard()._notifyWindowResizeEvent();this.resizeTabBar();break}if(this.currentMenu){this.currentMenu.calculatePosition()}}};d.prototype.unloadCurrentView=function(){if(this.currentView){this.currentView.hide();this.currentView=null}};d.prototype.unMarkGlobalTabs=function(){if(!this.catalogue){this.catalogueLink=$("catalogue_link");this.logsLink=$("logs_link");this.wiringLink=$("wiring_link");this.dragboardLink=$("dragboard_link")}this.catalogueLink.removeClassName("toolbar_marked");this.catalogueLink.addClassName("toolbar_unmarked");this.wiringLink.removeClassName("toolbar_marked");this.wiringLink.addClassName("toolbar_unmarked");this.dragboardLink.removeClassName("toolbar_marked");this.dragboardLink.addClassName("toolbar_unmarked")};d.prototype.hideView=function(h){h.setStyle(f)};d.prototype.notifyError=function(h){this.logsLink.addClassName("highlighted");setTimeout("LayoutManagerFactory.getInstance().clearErrors()",1000)};d.prototype.clearErrors=function(h){this.logsLink.removeClassName("highlighted")};d.prototype.unmarkTab=function(h){var l=h.tabHTMLElement;var o=h.tabOpsLauncher;var n=h.renameTabHandler;var k=h.changeTabHandler;var m=h.dragger;l.className="tab";var j=$(o);j.setStyle({display:"none"});$(m).setStyle({display:"none"});if(!h.workSpace.isShared()){Event.stopObserving(l,"click",n)}Event.observe(l,"click",k);l.setStyle({display:"block"})};d.prototype.markTab=function(h){var l=h.tabHTMLElement;var o=h.tabOpsLauncher;var n=h.renameTabHandler;var k=h.changeTabHandler;var m=h.dragger;if(l.className!="tab current"){l.className="tab current";var j=$(o);if(!h.workSpace.isShared()){j.setStyle({display:"inline"})}$(m).setStyle({display:"inline"});l.setStyle({display:"block"})}if(this.currentViewType=="dragboard"){Event.stopObserving(l,"click",k);if(!h.workSpace.isShared()){Event.observe(l,"click",n)}}else{if(!h.workSpace.isShared()){Event.stopObserving(l,"click",n)}Event.observe(l,"click",k)}};d.prototype.showDragboard=function(h){this.unMarkGlobalTabs();if(this.currentView!=null){this.currentView.hide()}this.currentView=h.tab;this.currentViewType="dragboard";this.dragboardLink.removeClassName("toolbar_unmarked");this.dragboardLink.addClassName("toolbar_marked");this.showTabs();this.dragboardLink.blur();$("ws_operations_link").blur();$("ws_operations_link").removeClassName("hidden");$("dragboard_link").title="";this.resizeContainer(h.dragboardElement);h.dragboardElement.setStyle(c);if(h.getNumberOfIGadgets()==0){var k="<a target='_blank' href='http://forge.morfeo-project.org/wiki/index.php/FAQ#Managing_My_Workspace'>"+gettext("Video Tutorials")+"</a>";var j=gettext("In the Dragborad you can move and resize all your gadgets in order to perform and use your own application. Check the gadget preferences for further personalization %(settingsIcon)s. Go to the Catalogue to add more gadgets %(catalogueIcon)s. Go to the Wiring interface to make connections among them %(wiringIcon)s. If you need more help visit the %(helpLink)s.");j=interpolate(j,{settingsIcon:"<img src='"+_currentTheme.getIconURL("igadget-settings")+"'/>",catalogueIcon:"<img src='"+_currentTheme.getIconURL("catalogue")+"'/>",wiringIcon:"<img src='"+_currentTheme.getIconURL("wiring")+"'/>",helpLink:k},true);this.showTipMessage(j,2)}};d.prototype.showCatalogue=function(){this.unMarkGlobalTabs();if(this.currentView!=null){this.currentView.hide()}if(!this.catalogue){this.catalogue=CatalogueFactory.getInstance()}this.currentView=this.catalogue;this.currentViewType="catalogue";this.catalogueLink.removeClassName("toolbar_unmarked");this.catalogueLink.addClassName("toolbar_marked");$("ws_operations_link").addClassName("hidden");$("dragboard_link").title=gettext("Show active workspace");this.hideTabs();this.catalogueLink.blur();this.resizeContainer(this.currentView.catalogueElement);this.catalogue.catalogueElement.setStyle(c);var j="<a target='_blank' href='http://forge.morfeo-project.org/wiki/index.php/FAQ#Discovering_Gadgets'>"+gettext("Video Tutorials")+"</a>";var h=gettext("Discover new gadgets, look for descriptions, tag them, make your rating, select the ones that best suit your needs and add them to the Dragboard %(dragboardIcon)s. Don't forget to connect them with other gadgets in the Wiring interface %(wiringIcon)s in order to improve your experience. If you need more help visit the %(helpLink)s.");h=interpolate(h,{dragboardIcon:"<img src='"+_currentTheme.getIconURL("dragboard")+"'/>",wiringIcon:"<img src='"+_currentTheme.getIconURL("wiring")+"'/>",helpLink:j},true);this.showTipMessage(h,0)};d.prototype.showLogs=function(){this.unMarkGlobalTabs();if(this.currentView!=null){this.currentView.hide()}this.currentView=this.logs;this.currentViewType="logs";$("ws_operations_link").addClassName("hidden");$("dragboard_link").title=gettext("Show active workspace");this.hideTabs();this.logsLink.blur();this.resizeContainer(this.currentView.logContainer);this.logs.logContainer.setStyle(c)};d.prototype.showWiring=function(k){this.unMarkGlobalTabs();if(this.currentView!=null){this.currentView.hide()}this.currentView=k;this.currentViewType="wiring";this.wiringLink.removeClassName("toolbar_unmarked");this.wiringLink.addClassName("toolbar_marked");$("ws_operations_link").addClassName("hidden");$("dragboard_link").title=gettext("Show active workspace");this.hideTabs();this.wiringLink.blur();this.resizeContainer(this.currentView.wiringContainer);k.wiringContainer.setStyle(c);k.wiringTable.setStyle({width:(k.wiringContainer.getWidth()-20)+"px"});var j="<a target='_blank' href='http://forge.morfeo-project.org/wiki/index.php/FAQ#Connecting_Gadgets'>"+gettext("Video Tutorials")+"</a>";var h=gettext("In the Wiring interface you can connect your gadgets among them. Create or select channels and link (by clicking) Events with Slots. Pay attention to the colours trying to help you, you can create some great wires following it. You can see the results of your wires at the Dragboard interface %(dragboardIcon)s. If you need more help visit the %(helpLink)s.");h=interpolate(h,{dragboardIcon:"<img src='"+_currentTheme.getIconURL("wiring")+"'/>",helpLink:j},true);this.showTipMessage(h,1)};d.prototype.hideTabs=function(){$("tab_section").addClassName("hidden")};d.prototype.showTabs=function(){var h=$("tab_section");if(h.hasClassName("hidden")){h.removeClassName("hidden")}};d.prototype.showClickableCover=function(){this.coverLayerElement.style.display="block";Event.observe(this.coverLayerElement,"click",this.coverLayerEvent)};d.prototype.showUnclickableCover=function(){this.coverLayerElement.addClassName("disabled_background");this.coverLayerElement.style.display="block"};d.prototype.refreshChangeWorkSpaceMenu=function(j,k){j.menu.clearSubmenuOptions();if(k.length>=1){j.menu.submenu.className="submenu border_bottom"}else{j.menu.submenu.className="submenu"}for(var h=0;h<k.length;h++){j.menu.addOptionToSubmenu(null,k[h].workSpaceState.name,function(){LayoutManagerFactory.getInstance().hideCover();OpManagerFactory.getInstance().changeActiveWorkSpace(this)}.bind(k[h]))}};d.prototype.refreshMergeWorkSpaceMenu=function(k,l){k.mergeMenu.clearOptions();for(var j=0;j<l.length;j++){var h={firstWK:k,scndWK:l[j]};k.mergeMenu.addOption(null,l[j].workSpaceState.name,function(){this.firstWK.mergeWith(this.scndWK.workSpaceState.id)}.bind(h),j)}};d.prototype.showDropDownMenu=function(j,l,m,k){switch(j){case"igadgetOps":this.currentMenu=l;var h;if(l.parentMenu){m=l.parentMenu.menu.offsetLeft+l.parentMenu.menu.offsetWidth-10}if(m+l.menu.getWidth()<=BrowserUtilsFactory.getInstance().getWidth()){this.currentMenu.show("right",m,k)}else{if(l.parentMenu){m=l.parentMenu.menu.offsetLeft+10}this.currentMenu.show("left",m,k)}this.showClickableCover();break;case"workSpaceOps":this.currentMenu=l;this.currentMenu.show("center",m,k);this.showClickableCover();break;case"tabOps":this.currentMenu=l;if((m-l.menu.getWidth())<=0){this.currentMenu.show("right",m,k)}else{this.currentMenu.show("left",m,k)}this.showClickableCover();break;case"workSpaceOpsSubMenu":this.currentMenu=l;this.currentMenu.show("right",m,k);break;case"TabOpsSubMenu":this.currentMenu=l;this.currentMenu.show("right",m,k);break;case"remoteChannelOperationsMenu":this.currentMenu=l;var h;if(k+l.menu.getHeight()<=BrowserUtilsFactory.getInstance().getHeight()){this.currentMenu.show("left-bottom",m,k)}else{this.currentMenu.show("left-top",m,k)}this.showClickableCover();break;case"filterMenu":this.currentMenu=l;var h;if(k+l.menu.getHeight()<=BrowserUtilsFactory.getInstance().getHeight()){this.currentMenu.show("left-bottom",m,k)}else{this.currentMenu.show("left-top",m,k)}this.showClickableCover();break;case"filterHelp":this.currentMenu=l;var h;if(k+l.menu.getHeight()<=BrowserUtilsFactory.getInstance().getHeight()){this.currentMenu.show("right-bottom",m,k)}else{this.currentMenu.show("right-top",m,k)}break;case"floatingGadgets":this.currentMenu=l;this.currentMenu.show("left",m,k);this.showClickableCover();break;default:break}};d.prototype.showYesNoDialog=function(l,h,k,j){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();if(!this.menus.alertMenu){this.menus.alertMenu=new AlertWindowMenu()}this.currentMenu=this.menus.alertMenu;this.currentMenu.setMsg(l);this.currentMenu.setHandler(h,k);this.currentMenu.show()};d.prototype.showWindowMenu=function(j,l,k,h){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();switch(j){case"createWorkSpace":if(!this.menus.createWorkSpaceMenu){this.menus.createWorkSpaceMenu=new CreateWindowMenu("workSpace")}this.currentMenu=this.menus.createWorkSpaceMenu;break;case"useBrokenTheme":if(!this.menus.alertMenu){this.menus.alertMenu=new AlertWindowMenu()}this.currentMenu=this.menus.alertMenu;this.currentMenu.setMsg(gettext("Do you really want to remove this tab?"));this.currentMenu.setHandler(function(){OpManagerFactory.getInstance().activeWorkSpace.getVisibleTab().deleteTab()},k);break;case"cancelService":if(!this.menus.alertMenu){this.menus.alertMenu=new AlertWindowMenu(null)}this.currentMenu=this.menus.alertMenu;this.currentMenu.setMsg(gettext("Do you want to cancel the subscription to the service?"));this.currentMenu.setHandler(l,k);break;case"publishWorkSpace":if(!this.menus.publishWorkSpaceMenu){this.menus.publishWorkSpaceMenu=new PublishWindowMenu(null)}this.currentMenu=this.menus.publishWorkSpaceMenu;break;case"shareWorkSpace":if(!this.menus.shareWorkSpaceMenu){this.menus.shareWorkSpaceMenu=new ShareWindowMenu(null)}this.currentMenu=this.menus.shareWorkSpaceMenu;break;case"deleteAllResourceVersions":if(!this.menus.alertMenu){this.menus.alertMenu=new AlertWindowMenu(null)}this.currentMenu=this.menus.alertMenu;if(UIUtils.selectedVersion!=null){this.currentMenu.setMsg(gettext("Do you really want to remove this version of the gadget?"))}else{this.currentMenu.setMsg(gettext("WARNING! All versions of this gadget will be removed too! Do you really want to remove this gadget?"))}this.currentMenu.setHandler(function(){UIUtils.deleteGadget(UIUtils.selectedResource)},k);break;case"addFeed":if(!this.menus.addFeedMenu){this.menus.addFeedMenu=new AddFeedMenu()}this.currentMenu=this.menus.addFeedMenu;break;case"addSite":if(!this.menus.addSiteMenu){this.menus.addSiteMenu=new AddSiteMenu()}this.currentMenu=this.menus.addSiteMenu;break;case"addMashup":if(!this.menus.addMashupMenu){this.menus.addMashupMenu=new AddMashupWindowMenu(null)}this.currentMenu=this.menus.addMashupMenu;this.currentMenu.setMsg(gettext("You are going to add a Mashup that could be composed by more than one gadget. Do you want to add it to a new Workspace or to the current one?"));this.currentMenu.setHandler(l,k);break;case"contratableAddInstanceMenu":if(!this.menus.contratableAddInstanceMenu){this.menus.contratableAddInstanceMenu=new ContratationWindow()}this.currentMenu=this.menus.contratableAddInstanceMenu;this.currentMenu.setHandler(l);this.currentMenu.setSrc(h);break;case"addGadgetToAppMenu":if(!this.menus.addGadgetToAppMenu){this.menus.addGadgetToAppMenu=new AddingGadgetToApplicationWindow()}this.currentMenu=this.menus.addGadgetToAppMenu;this.currentMenu.setHandler(UIUtils.addResourceToApplication);this.currentMenu.setExtraData(h);break;case"purchaseAppMenu":if(!this.menus.purchaseAppMenu){this.menus.purchaseAppMenu=new BuyingApplicationWindow()}this.currentMenu=this.menus.purchaseAppMenu;this.currentMenu.setHandler(l);this.currentMenu.setExtraData(h);break;default:return}this.currentMenu.show()};d.prototype.showTransparentBackground=function(){this.coverLayerElement.addClassName("disabled_background");this.coverLayerElement.style.display="block";Event.observe(this.coverLayerElement,"click",this.coverLayerEvent)};d.prototype.showTipMessage=function(k,h){var j=PreferencesManagerFactory.getInstance().getPlatformPreferences();if(!j.get("tip-"+h)){return}if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();if(!this.menus.tipMenu){this.menus.tipMenu=new TipWindowMenu()}this.currentMenu=this.menus.tipMenu;this.currentMenu.setMsg(k);this.currentMenu.show(h)};d.prototype.showInfoMessage=function(l,h,k){var j=PreferencesManagerFactory.getInstance().getPlatformPreferences();if(!j.get("tip-"+h)){return}if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();this.currentMenu=new InfoWindowMenu(k);this.currentMenu.setMsg(l);this.currentMenu.show(h)};d.prototype.showAlertMessage=function(h){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();this.currentMenu=new AlertWindowMenu();this.currentMenu.setMsg(h);this.currentMenu.show()};d.prototype.showSharingWorkspaceResults=function(j,h){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();if(!this.menus.sharingWorksSpaceMenu){this.menus.sharingWorksSpaceMenu=new SharedWorkSpaceMenu()}this.currentMenu=this.menus.sharingWorksSpaceMenu;if(h!=[]){if(h.url){this.currentMenu.setURL(h.url);this.currentMenu.setHTML(h.url)}}this.currentMenu.setMsg(j);this.currentMenu.show()};d.prototype.showMessageMenu=function(j,h){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();if(!this.menus.messageMenu){this.menus.messageMenu=new MessageWindowMenu(null)}h=h?h:Constants.Logging.INFO_MSG;this.currentMenu=this.menus.messageMenu;this.currentMenu.setMsg(j);this.currentMenu.setType(h);this.currentMenu.show()};d.prototype.showPreferencesWindow=function(k,j){if(this.currentMenu!=null){this.hideCover()}this.showUnclickableCover();var l="preferences/"+k;if(!(l in this.menus)){this.menus[l]=new PreferencesWindowMenu(k)}var h=this.menus[l];h.setManager(j);this.currentMenu=h;this.currentMenu.show()};d.prototype.hideCover=function(){if(this.currentMenu){this.currentMenu.hide()}this.currentMenu=null;this.coverLayerElement.style.display="none";this.coverLayerElement.removeClassName("disabled_background");Event.stopObserving(this.coverLayerElement,"click",this.coverLayerEvent)};d.prototype.FADE_TAB_INI="#F0E68C";d.prototype.FADE_TAB_CUR_END="#E0E0E0";d.prototype.FADE_TAB_END="#97A0A8";d.prototype.goTab=function(h){var k=h.tabHTMLElement;var j=new BackgroundFadder(k,this.FADE_TAB_INI,((k.hasClassName("current"))?this.FADE_TAB_CUR_END:this.FADE_TAB_END),0,1000);j.fade()}}d.prototype.getTabImgSize=function(){if(!this.tabImgSize){var m=null;var n=$$("#scrollTabBar .tabOps_launcher");var h=(n.length>0)?n[0]:null;if(h){m=h.getWidth()}n=$$("#scrollTabBar .tab_dragger");var j=(n.length>0)?n[0]:null;if(j){m+=j.getWidth()}if(!m){var l=document.createElement("div");Element.extend(l);l.addClassName("tabOps_launcher");document.body.appendChild(l);m=l.getWidth();l.remove();var k=document.createElement("div");Element.extend(k);k.addClassName("tab_dragger");document.body.appendChild(k);m+=k.getWidth();k.remove()}this.tabImgSize=m}return this.tabImgSize};d.prototype.getScrollTabBarWidth=function(h){if(!this.scrollTabBarWidth||h){this.scrollTabBarWidth=this.getTabImgSize()+this.extraGap+$(this.tabMarker).getWidth()}return this.scrollTabBarWidth};d.prototype.recalculateScrollTabBarWidth=function(){var l=this.scrollTabBar.childNodes;var k;var p,h,j,o,m;this.scrollTabBarWidth=0;for(var n=0;n<l.length;n++){this.scrollTabBarWidth+=l[n].getWidth();if(l[n].hasClassName("current")){p=l[n].getElementsByTagName("span")[0];k=document.defaultView.getComputedStyle(p,null);nameMarginRight=k.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);m=k.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);this.scrollTabBarWidth-=nameMarginRight+m}k=document.defaultView.getComputedStyle(l[n],null);h=k.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);j=k.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);this.scrollTabBarWidth+=h+j}this.scrollTabBarWidth+=this.extraGap;return this.scrollTabBarWidht};d.prototype.addToTabBar=function(l){var n=document.createElement("div");Element.extend(n);n.setAttribute("id",l);n.addClassName("tab");n.setStyle({display:"none"});this.scrollTabBar.insertBefore(n,this.scrollTabBar.firstChild);var k=document.defaultView.getComputedStyle(n,null);var m=k.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX);var h=k.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);var j=k.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);this.changeTabBarSize(2*m+h+j);this.scrollTabBar.setStyle({right:0,left:""});return n};d.prototype.moveTab=function(l,o){if(o){if(o==l){return}this.scrollTabBar.insertBefore(l.tabHTMLElement,o.tabHTMLElement.nextSibling)}else{this.scrollTabBar.insertBefore(l.tabHTMLElement,this.scrollTabBar.firstChild)}var h=[];var j;var k;for(var p=this.scrollTabBar.childNodes.length-1;p>=0;p--){k=this.scrollTabBar.childNodes[p].id.split("_");j=parseInt(k[k.length-1]);h.push(j)}var t=function(u){};var r=function(w){var u=LogManagerFactory.getInstance();var v=u.formatError(gettext("Error updating order: %(errorMsg)s."),w,e);u.log(v)};var n=URIs.GET_POST_TABS.evaluate({workspace_id:l.workSpace.workSpaceState.id});var q=Object.toJSON(h);var m={order:q};PersistenceEngineFactory.getInstance().send_update(n,m,this,t,r)};d.prototype.insertMarker=function(j,h){this.scrollTabBar.insertBefore(j,h.tabHTMLElement.nextSibling)};d.prototype.moveIndicator=function(h){$("tab_marker").setStyle({display:"block","float":"right"});if(h){this.scrollTabBar.insertBefore($("tab_marker"),h.tabHTMLElement.nextSibling)}else{this.scrollTabBar.insertBefore($("tab_marker"),this.scrollTabBar.firstChild)}};d.prototype.removeFromTabBar=function(n){var l=document.defaultView.getComputedStyle(n.tabHTMLElement,null);var h=l.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);var k=l.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);l=document.defaultView.getComputedStyle(n.tabNameHTMLElement,null);var o=l.getPropertyCSSValue("margin-right").getFloatValue(CSSPrimitiveValue.CSS_PX);var m=l.getPropertyCSSValue("margin-left").getFloatValue(CSSPrimitiveValue.CSS_PX);var j=-1*(n.tabHTMLElement.getWidth()-(this.getTabImgSize()+m+o)+h+k);Element.remove(n.tabHTMLElement);this.changeTabBarSize(j);this.scrollTabBar.setStyle({right:(this.fixedTabBar.getWidth()-this.getScrollTabBarWidth())+"px",left:""})};d.prototype.changeTabBarSize=function(h){if(h==0){this.recalculateScrollTabBarWidth()}else{this.scrollTabBarWidth=this.getScrollTabBarWidth()+h}var j;if(this.getScrollTabBarWidth()<=this.fixedTabBarMaxWidth){j=this.getScrollTabBarWidth();this.scrollTabBar.setStyle({right:0+"px"});this.rightSlider.style.display="none";this.leftSlider.style.display="none"}else{j=this.fixedTabBarMaxWidth;this.rightSlider.style.display="inline";this.leftSlider.style.display="inline"}this.fixedTabBar.setStyle({width:j+"px"});this.scrollTabBar.setStyle({width:this.getScrollTabBarWidth()+"px"})};d.prototype.changeScrollBarRightPosition=function(k){var j=parseInt(this.scrollTabBar.getStyle("right"))+k;var h=this.fixedTabBarMaxWidth-this.getScrollTabBarWidth();if(j>0){j=0}else{if(j<h){j=h}}this.scrollTabBar.setStyle({right:j+"px"})};d.prototype.getFixedBarLeftPosition=function(){return Position.cumulativeOffset(this.fixedTabBar)[0]};d.prototype.getFixedBarWidth=function(){return parseInt(this.fixedTabBar.getWidth())};d.prototype.goLeft=function(){this.rightSlider.blur();var h=this.fixedTabBarMaxWidth-this.getScrollTabBarWidth();if(parseInt(this.scrollTabBar.offsetLeft)>h){this.changeScrollBarRightPosition(this.tabBarStep);var j=function(){this.goLeft()}.bind(this);this.leftTimeOut=setTimeout(j,50)}};d.prototype.goRight=function(){this.leftSlider.blur();if(parseInt(this.scrollTabBar.offsetLeft)<0){this.changeScrollBarRightPosition(-1*this.tabBarStep);var h=function(){this.goRight()}.bind(this);this.rightTimeOut=setTimeout(h,50)}};return new function(){this.getInstance=function(){if(a==null){a=new d()}return a}}}();