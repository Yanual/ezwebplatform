if(typeof MYMW=="undefined"||!MYMW){var MYMW={};MYMW.ui={}}String.prototype.supplant=function(a){return this.replace(/{([^{}]*)}/g,function(d,c){var f=a[c];return typeof f==="string"?f:d})};var ua=navigator.userAgent;var isOpera=ua.indexOf("Opera")>0;var isGecko=ua.indexOf("Gecko")>0;var isWmobile=!isOpera&&!isGecko&&(ua.indexOf("PPC")>0||ua.indexOf("IEMobile")>0);function id(a){return isWmobile?document.all[a]:document.getElementById(a)}function hasClass(b,a){return(" "+id(node).className+" ").indexOf(" "+a+" ")>=0}function update(b,a){id(b).innerHTML=a}function after(c,b){var a=id(c);a.innerHTML=a.innerHTML+b}function before(c,b){var a=id(c);a.innerHTML=b+a.innerHTML}function updateClass(b,a){id(b).className=a}(function(){var a=5;MYMW.ui.TabView=function(h,c){this._tabs=[];this._attr=c||{};this._slots=[null,null,null,null,null];var g="";var f="";for(var d=0;d<a;d++){g+="<li id='mymw-nav-"+d+"' class='mymw-inactive'></li>";f+="<div id='mymw-slot-"+d+"' class='mymw-inactive'></div> "}update("mymw-nav",g);update("mymw-content",f);for(var d in c){this.set(d,c[d])}};var b=MYMW.ui.TabView.prototype;b.addTab=function(d){if(this._tabs.length===this.get("maxTabs")){this.removeTab(this._LRU())}this._tabs[this._tabs.length]=d;for(var c=0;c<this._slots.length;c++){if(this._slots[c]===null){this._slots[c]=d;d.assignSlot(c);break}}if(this._tabs.length===1){this.set("activeIndex",0)}};b.removeTab=function(c){var d=this._tabs[c];this._slots[d._slot]=null;d.assignSlot();this._tabs.splice(c,1);if(this.get("activeIndex")===c&&this._tabs.length>0){this.set("activeIndex",0)}};b.getTab=function(c){return this._tabs[c]};b.set=function(c,f){this._attr[c]=f;switch(c){case"activeId":this.set("activeIndex",this.getTabIndexById(f));break;case"activeTab":for(var d=0;d<this._tabs.length;d++){if(this._tabs[d]===f){this.set("activeIndex",d);break}}break;case"activeIndex":for(var d=0;d<this._tabs.length;d++){if(this._tabs[d].get("active")===true){if(d!==f){this._tabs[d].set("active",false)}}else{if(d===f){this._tabs[d].set("active",true)}}}break;case"maxTabs":while(this._tabs.length>f){this.removeTab(this._LRU())}break}};b.get=function(c){return this._attr[c]};b.clear=function(f){var d=this._tabs.length;for(var c=0;c<d;c++){this.removeTab(0)}};b.removeTabById=function(d){var c=this.getTabIndexById(d);if(c>=0){this.removeTab(c)}};b.getTabIndexById=function(f){var c;for(var d=0;d<this._tabs.length;d++){if(this._tabs[d].get("id")===f){c=d;break}}return c};b._renderHead=function(){var d="";for(var c=0;c<this._tabs.length;c++){this._tabs[c]._renderHead()}};b._renderBody=function(){for(var c=0;c<this._tabs.length;c++){this._tabs[c]._renderBody()}};b._LRU=function(){var c;var d=Number.MAX_VALUE;for(var f=0;f<this._tabs.length;f++){if(this._tabs[f]._dateActivation<d){d=this._tabs[f]._dateActivation;c=f}}return c};MYMW.ui.Tab=function(c){this._loaded=false;this._disposed=false;this._slot=undefined;this._dateActivation=undefined;this._attr=c||{};for(var d in c){this.set(d,c[d])}};var b=MYMW.ui.Tab.prototype;b.assignSlot=function(c){if(c!=undefined){this._slot=c;this._renderBody();this._renderHead()}else{this._disposed=true;this._renderBody();this._renderHead();this._slot=c}};b.set=function(c,d){this._attr[c]=d;switch(c){case"active":if(d===true){this._dateActivation=new Date();this.__show()}else{this.__hide()}break;case"highlight":if(this._attr.active===true){this._attr.highlight=false}case"onclick":case"label":this._renderHead();break;case"content":this._renderBody();break}};b.get=function(d){switch(d){case"content":var c=this.get("dataSrc");if(c&&this.get("active")&&(!this._loaded||!this.get("cacheData"))){var g=function(h){this._loaded=true;this.set("content",h)};var f="_mymw_rnd="+Math.random();ajax.apply(this,[c,g,null,f,true])}break}return this._attr[d]};b.__show=function(){if(this._slot!=undefined){if(!this._loaded){this.get("content")}updateClass("mymw-slot-"+this._slot,"");updateClass("mymw-nav-"+this._slot,"mymw-selected")}};b.__hide=function(){if(this._slot!=undefined){updateClass("mymw-slot-"+this._slot,"mymw-inactive");updateClass("mymw-nav-"+this._slot,"")}};b._renderHead=function(){if(this._disposed===false){if(this._slot!=undefined){this.__updateHead();update("mymw-nav-"+this._slot,this._head);updateClass("mymw-nav-"+this._slot,this.get("active")?"mymw-selected":this.get("highlight")?"mymw-highlight":"")}try{var d=this.get("onclick");var c=this.get("id");var f=function(){if(d){d()}tabview.set("activeId",c)};id("mymw-link-"+this._slot).onclick=f}catch(g){}}else{update("mymw-nav-"+this._slot,"");updateClass("mymw-nav-"+this._slot,"mymw-inactive")}};b._renderBody=function(){if(this._disposed===false){if(this._slot!=undefined){this.__updateBody();update("mymw-slot-"+this._slot,this._body)}}else{update("mymw-slot-"+this._slot,"")}};b.__updateHead=function(){var d='javascript:tabview.set("activeId","'+this.get("id")+'");';var c=this.get("label");this._head="<a id='mymw-link-"+this._slot+"' href='#' onclick='"+d+"'>"+c+"</a>"};b.__updateBody=function(){this._body=this.get("content")}})();var Constants={Logging:{ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3}};Array.prototype.elementExists=function(a){if(this.indexOf(a)!=-1){return true}return false};Array.prototype.getElementById=function(b){for(var a=0;a<this.length;a++){if(this[a].getId()==b){return this[a]}}return null};Array.prototype.getElementByName=function(a){for(var b=0;b<this.length;b++){if(this[b].getName()==a){return this[b]}}return null};Array.prototype.remove=function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}};Array.prototype.removeById=function(c){var b;for(var a=0;a<this.length;a++){if(this[a].getId()==c){b=this[a];this.splice(a,1);return b}}return null};var percent=100;var slideSpeed=20;var timer;var percent;function slide(a,b){percent-=slideSpeed;if(this.percent<=0){this.percent=0}b.style.left=(a?-percent:percent)+"%";if(this.percent!=0){setTimeout(function(){slide(a,b)},0)}else{percent=100}}function setLanguage(f){var d=function(){window.location.reload()};var b=function(){};var a=PersistenceEngineFactory.getInstance();var c={language:f};a.send_post("/i18n/setlang/",c,this,d,b);return false}function updateLayout(){var a=(window.orientation==0||window.orientation==180)?"portrait":"landscape";if(!loaded){document.body.setAttribute("orient",a);document.body.className=a;if(OpManagerFactory.getInstance().loadCompleted){loaded=true;clearInterval(updateInterval);OpManagerFactory.getInstance().activeWorkSpace.updateLayout(a)}else{loaded=false}}else{document.body.setAttribute("orient",a);document.body.className=a;OpManagerFactory.getInstance().activeWorkSpace.updateLayout(a)}}function checkTab(){if(OpManagerFactory.getInstance().visibleLayer=="tabs_container"){var j=window.pageXOffset;var f=window.innerWidth;var d=f/2;var a=j<d?-j:-(j-d)%f+d;if(a!=0){var c=f/52;var b=Math.abs(a/c);var h=a<0?-c:c;for(var g=0;g<b;g++){window.scrollBy(h,0)}window.scrollTo(j+a,1);OpManagerFactory.getInstance().activeWorkSpace.updateVisibleTab(Math.round(window.pageXOffset/f))}}else{if(OpManagerFactory.getInstance().visibleLayer=="dragboard"){window.scrollTo(0,1)}}}function Modules(){}Modules.prototype.THEME_MANAGER=3;Modules.prototype.PLATFORM_PREFERENCES=4;Modules.prototype.SHOWCASE=0;Modules.prototype.CATALOGUE=1;Modules.prototype.ACTIVE_WORKSPACE=2;Object.extend(Event,{KEY_SHIFT:16,KEY_CONTROL:17,KEY_CAPSLOCK:20,KEY_SPACE:32,keyPressed:function(a){return Browser.isMSIE()?window.event.keyCode:a.which}});if(window.EzSteroidsAPI.is_activated()){var _observe=Event.observe;Object.extend(Event,{_observe:_observe,observe:function(d,c,b,a,f){if(f&&!EzSteroidsAPI.evaluePolicy(f)){b=function(g){var g=gettext("You are not allowed to perform this operation");LogManagerFactory.getInstance().showMessage(g)}}this._observe(d,c,b,a)}})}var Browser={inspect:function(a){if(a){alert(navigator.userAgent)}else{return navigator.userAgent}},isMSIE:function(){return(navigator.userAgent.toLowerCase().indexOf("msie")>-1)&&!this.isOpera()},isOpera:function(){return navigator.userAgent.toLowerCase().indexOf("opera")>-1},isMozilla:function(){return(navigator.userAgent.toLowerCase().indexOf("mozilla")>-1)&&!this.isOpera()&&!this.isMSIE()}};Object.genGUID=function(){var a=8;if(!isNaN(parseInt(arguments[0]))){a=parseInt(arguments[0])}var d="abcdef0123456789";var b="";while(b.length<a){var c=Math.floor(Math.random()*(d.length-1));b+=d.charAt(c)}return b};Hash.prototype.clone=function(){var a=new Hash();this.each(function(b){a[b.key]=b.value});return a};if(document.documentElement.textContent!=undefined){Element.prototype.setTextContent=function(a){this.textContent=a};Element.prototype.getTextContent=function(){return this.textContent}}else{if(document.documentElement.innerText!=undefined){Element.Methods.setTextContent=function(a,b){a.innerText=b};Element.Methods.getTextContent=function(a){return a.innerText}}}if(Prototype.BrowserFeatures.ElementExtensions){var isElement=function(a){return a instanceof Element}}else{var isElement=function(a){return a&&("nodeType" in a)&&(a.nodeType===1)}}if(document.documentElement.getBoundingClientRect!=undefined){Element.getRelativeBoundingClientRect=function(d,c){var b=d.getBoundingClientRect();var a=c.getBoundingClientRect();return{top:b.top-a.top,left:b.left-a.left,right:b.right-a.left,bottom:b.bottom-a.top}}}else{if(document.getBoxObjectFor!=undefined){Element.getRelativeBoundingClientRect=function(d,c){var b=document.getBoxObjectFor(d);var a=document.getBoxObjectFor(c);return{top:b.screenY-a.screenY,left:b.screenX-a.screenX,right:b.screenX+b.width-a.screenX,bottom:b.screenY+b.height-a.screenY}}}else{}}Ajax.Request.prototype.request=function(a){this.url=a;this.method=this.options.method;var c=Object.clone(this.options.parameters);this.parameters=c;if(c=Hash.toQueryString(c)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+c}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){c+="&_="}}}try{if(this.options.onCreate){this.options.onCreate(this.transport)}Ajax.Responders.dispatch("onCreate",this,this.transport);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=["put","post"].include(this.method)?(this.options.postBody||c):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(b){this.dispatchException(b)}};Array.prototype.elementExists=function(a){return this.indexOf(a)!==-1};Array.prototype.getElementById=function(b){for(var a=0;a<this.length;a++){if(this[a].getId()==b){return this[a]}}return null};Array.prototype.getElementByName=function(a){for(var b=0;b<this.length;b++){if(this[b].getName()==a){return this[b]}}return null};Array.prototype.remove=function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}};Array.prototype.removeById=function(d){var c;var a;for(var b=0;b<this.length;b++){if(typeof this[b].getId=="function"){a=this[b].getId()}else{a=this[b].id}if(a==d){c=this[b];this.splice(b,1);return c}}return null};var CookieManager=new Object();CookieManager.createCookie=function(c,d,f){if(f){var b=new Date();b.setTime(b.getTime()+(f*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}if(typeof d==="object"){d=d.toJSON()}document.cookie=c+"="+d+a+"; path=/"};CookieManager.readCookie=function(b,f){var j=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var k=a[d];while(k.charAt(0)==" "){k=k.substring(1,k.length)}if(k.indexOf(j)==0){var g=k.substring(j.length,k.length);if(f){try{return g.evalJSON()}catch(h){return null}}else{return g}}}return null};CookieManager.eraseCookie=function(a){createCookie(a,"",-1)};CookieManager.renewCookie=function(a,c){var b=this.readCookie(a);if(b!==null){this.createCookie(a,b,c)}};var useInternalComputedStyle=window.getComputedStyle===undefined;if(!useInternalComputedStyle){var computedStyle=document.defaultView.getComputedStyle(document.body,null);try{var width=computedStyle.getPropertyCSSValue("width");width=width.getFloatValue(CSSPrimitiveValue.CSS_PX)}catch(e){useInternalComputedStyle=true;var _nativeGetComputedStyle=document.defaultView.getComputedStyle;var _internalGetCurrentStyle=function(c,d,b){var a=_nativeGetComputedStyle.call(document.defaultView,c,null);return a.getPropertyValue(d)}}}else{var _internalGetCurrentStyle=function(b,d,a){var c=b.currentStyle[a];if(c=="auto"){c=b.runtimeStyle[a]}return c}}if(useInternalComputedStyle){function CSSPrimitiveValue(b,c,a){if(arguments.length==0){return}this._element=b;this._property=c;this._ieProperty=a;this.cssText=_internalGetCurrentStyle(this._element,this._property,this._ieProperty)}CSSPrimitiveValue.CSS_PX=1;CSSPrimitiveValue._ValueRegExp=new RegExp("(\\d+|\\d+.\\d+)(\\w+)");CSSPrimitiveValue.prototype.getFloatValue=function(k){switch(k){case CSSPrimitiveValue.CSS_PX:if(this.cssText==""){return 0}var f=this._element.parentNode;var b=this._element.ownerDocument.createElement("div");b.style.visibility="hidden";b.style.padding="0";b.style.margin="0";b.style.border="0";var a=/border-(top|right|bottom|left)-width/.exec(this._property);var h=a!==null?a[1]:null;a=CSSPrimitiveValue._ValueRegExp.exec(this.cssText);if(a!=null){var j=a[1];var g=a[2];if(g=="px"){return parseInt(j)}else{b.style.height=this.cssText}}else{if((a==null)&&(h!=null)){var l="border-"+h+"-style";var c=ComputedCSSStyleDeclaration.prototype._getIEProperty(l);var n=_internalGetCurrentStyle(this._element,l,c);if(n=="none"){return 0}var d=this._element.ownerDocument.createElement("div");b.style.fontSize="0";b.style.lineHeight="0";d.style.padding="0";d.style.margin="0";d.style.border="0";d.style.width="1px";d.style.borderTopWidth=this.cssText;d.style.borderTopStyle=n;b.appendChild(d)}else{throw new Error()}}f.appendChild(b);if(b.offsetHeight!=null){var m=b.offsetHeight}else{throw new Error()}f.removeChild(b);return m;break;default:throw new Error()}};CSSPrimitiveValue._rgbaColorParser=new RegExp("rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\,\\s*(\\d+)\\s*\\)");CSSPrimitiveValue._rgbColorParser=new RegExp("rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)");CSSPrimitiveValue._hexColorParser=new RegExp("#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})","i");CSSPrimitiveValue.prototype.getRGBColorValue=function(){switch(this._property){case"background-color":case"color":var c,f,j,d="1";var a=CSSPrimitiveValue._rgbColorParser.exec(this.cssText);if(a!==null){c=a[1];f=a[2];j=a[3]}else{a=CSSPrimitiveValue._rgbaColorParser.exec(this.cssText);if(a!==null){c=a[1];f=a[2];j=a[3];d=a[4]}else{a=CSSPrimitiveValue._hexColorParser.exec(this.cssText);if(a===null){var g=this._element.parentNode;var b=this._element.ownerDocument.createElement("table");b.setAttribute("bgcolor",this.cssText);b.style.visibility="hidden";g.appendChild(b);var h=b.bgColor;a=CSSPrimitiveValue._hexColorParser.exec(h);if(a===null){throw new Error("Error on getRGBColorValue")}g.removeChild(b)}function l(m){m=m.toUpperCase();return("0123456789ABCDEF".indexOf(m.substr(0,1))*16)+"0123456789ABCDEF".indexOf(m.substr(1,1))}var c=l(a[1]);var f=l(a[2]);var j=l(a[3])}}var k=new Object();k.red=new CSSColorComponentValue(c);k.green=new CSSColorComponentValue(f);k.blue=new CSSColorComponentValue(j);k.alpha=new CSSColorComponentValue(d);return k;break;default:throw new Error()}};function CSSColorComponentValue(a){this.cssText=""+a}CSSColorComponentValue.prototype=new CSSPrimitiveValue();CSSColorComponentValue.prototype.getFloatValue=function(a){return parseInt(this.cssText)};function ComputedCSSStyleDeclaration(a){this._element=a}ComputedCSSStyleDeclaration.prototype._getIEProperty=function(a){switch(a){case"float":return"cssFloat";default:return a.replace(/-\w/g,function(b){return b.substr(1,1).toUpperCase()})}};ComputedCSSStyleDeclaration.prototype.getPropertyCSSValue=function(a){return new CSSPrimitiveValue(this._element,a,this._getIEProperty(a))};ComputedCSSStyleDeclaration.prototype.getPropertyValue=function(a){return _internalGetCurrentStyle(this._element,a,this._getIEProperty(a))};window.getComputedStyle=function(b,a){return new ComputedCSSStyleDeclaration(b)};if(document.defaultView===undefined){document.defaultView=window}}var PersistenceEngineFactory=function(){var a=null;function b(){b.prototype.send_get=function(f,g,d,c,j,h){var k=f.split("?");var l=k[1];if(l){if(l!=""){f+="&"}}else{f+="?"}f+="stamp="+new Date().getTime();new Ajax.Request(f,{method:"get",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_post=function(f,j,g,d,c,h){new Ajax.Request(f,{method:"post",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_delete=function(f,g,d,c,h){new Ajax.Request(f,{method:"delete",onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send_update=function(f,j,g,d,c,h){new Ajax.Request(f,{method:"put",parameters:j,onSuccess:d.bind(g),onFailure:c.bind(g),onException:c.bind(g),requestHeaders:h})};b.prototype.send=function(d,c){new Ajax.Request(d,c)}}return new function(){this.getInstance=function(){if(a==null){a=new b()}return a}}}();var CatalogueFactory=function(){var instance=null;function Catalogue(){this.catalogueElement=$("mashup_catalogue_content");this.catalogueParentElement=$("mashup_catalogue");this.infoElement=$("mashup_info_content");this.infoParentElement=$("mashup_info");this.resourceList=null;this.reloadCompleteCatalogue=function(){UIUtils.repaintCatalogue=true;UIUtils.sendPendingTags();if(UIUtils.isInfoResourcesOpen){UIUtils.isInfoResourcesOpen=false;UIUtils.SlideInfoResourceOutOfView("info_resource")}UIUtils.search=false;this.repaintCatalogue(URIs.GET_POST_RESOURCES+"/"+UIUtils.getPage()+"/"+UIUtils.getOffset())};this.emptyResourceList=function(){$("resources").innerHTML="";_this.clearSelectedResources();resources=$H()};this.getResources=function(){return resources};this.getResource=function(id_){return resources[id_]};this.addMashupResource=function(mashupId){var cloneOk=function(transport){window.location.reload()};var cloneError=function(transport,e){};var cloneURL=URIs.GET_ADD_WORKSPACE.evaluate({workspace_id:mashupId});PersistenceEngineFactory.getInstance().send_get(cloneURL,this,cloneOk,cloneError)};this.hide=function(){this.catalogueParentElement.setStyle({display:"none"});OpManagerFactory.getInstance().showWorkspaceMenu()};this.show=function(){this.catalogueParentElement.setStyle({display:"block"});this.infoParentElement.setStyle({display:"none"})};this.loadCatalogue=function(){var onError=function(transport,e){};var loadResources=function(transport){var responseJSON=transport.responseText;var jsonResourceList=eval("("+responseJSON+")");this.resourceList=jsonResourceList.resourceList;var html="";for(var i=0;i<this.resourceList.length;i++){var resource=this.resourceList[i];var visibleName=resource.name;if(resource.name.length>13){var visibleName=visibleName.substring(0,11)+"..."}html+='<div class="igadget_item">';html+='<a href="javascript:CatalogueFactory.getInstance().showResourceInfo('+resource.mashupId+');">';html+='<img class="igadget_icon" src="'+resource.uriImage+'" />';html+="</a>";html+='<a href="javascript:CatalogueFactory.getInstance().showResourceInfo('+resource.mashupId+');">'+visibleName+"</a>";html+="</div>"}this.catalogueElement.update(html);this.catalogueParentElement.setStyle({display:"block"});$("workspace_menu").setStyle({display:"none"})};var param={orderby:"-creation_date",search_criteria:"mashup, mobileok",search_boolean:"AND"};var persistenceEngine=PersistenceEngineFactory.getInstance();var search_url=URIs.GET_RESOURCES_SIMPLE_SEARCH+"/tag/1/10";persistenceEngine.send_get(search_url,this,loadResources,onError,param)};this.showResourceInfo=function(id){var html="";for(var i=0;i<this.resourceList.length;i++){var resource=this.resourceList[i];if(id==resource.mashupId){html+="<h2>"+resource.name+"</h2>";html+="<img src='"+resource.uriImage+"' id='resource_img'>";html+="<div id='resource_description'>"+resource.description+"</div>";html+="<div id='resource_popularity'>";var i=0;for(i;i<resource.votes[0].popularity;i++){html+="<img src='/ezweb/images/ico_vot_ok.gif'/>"}if((resource.votes[0].popularity%1)!=0){html+="<img src='/ezweb/images/ico_vot_md.gif'/>";i++}for(i;i<5;i++){html+="<img src='/ezweb/images/ico_vot_no.gif'/>"}html+="<span class='x-small'> ("+resource.votes[0].votes_number+" votes)</span></div>";html+="<div id='resource_vendor'><span class='title_info_resource'>Vendor: </span>"+resource.vendor+"</div>";html+="<div id='resource_version'><span class='title_info_resource'>Version: </span>"+resource.version+"</div>";html+="<div id='resource_tags'><span class='title_info_resource'>Tags: </span>";for(var i=0;i<resource.tags.length;i++){html+="<span class='small'>"+resource.tags[i].value+"<span class='x-small'> ("+resource.tags[i].appearances+")</span> </span>"}html+="</div>";break}}html+="<div id='add_resource'><a href='javascript:CatalogueFactory.getInstance().addMashupResource("+resource.mashupId+");'>Add Mashup</a></div>";this.infoElement.update(html);this.catalogueParentElement.setStyle({display:"none"});this.infoParentElement.setStyle({display:"block"})}}return new function(){this.getInstance=function(){if(instance==null){instance=new Catalogue()}return instance}}}();function XHtml(b){var a=null;a=b.uri;this.getURICode=function(){return a}}function GadgetTemplate(f,c){var b=f;var d=c.width;var a=c.height;this.getWidth=function(){return d};this.getHeight=function(){return a};this.getVariables=function(n){var m=n.getId();var h=n.dragboard.workSpace.getVarManager();var j=[];var g=b;var k=null;for(var l=0;l<g.length;l++){k=g[l];switch(k.aspect){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:j[k.name]=new RWVariable(null,m,k.name,k.aspect,h,null);break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:j[k.name]=new RVariable(null,m,k.name,k.aspect,h,null);break;case Variable.prototype.USER_PREF:j[k.name]=new RVariable(null,m,k.name,k.aspect,h,k.default_value);break}}return j};this.getUserPrefs=function(){if(this.prefs==null){this.prefs=new Array();var g=null;for(var h=0;h<b.length;h++){g=b[h];if(g.aspect==Variable.prototype.USER_PREF){switch(g.type){case UserPref.prototype.TEXT:this.prefs.push(new TextUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.INTEGER:this.prefs.push(new IntUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.BOOLEAN:this.prefs.push(new BoolUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.DATE:this.prefs.push(new DateUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.PASSWORD:this.prefs.push(new PasswordUserPref(g.name,g.label,g.description,g.default_value));break;case UserPref.prototype.LIST:this.prefs.push(new ListUserPref(g.name,g.label,g.description,g.default_value,g.value_options));break}}}}return this.prefs};this.getExternalContextVars=function(m){var h=[];var g=b;var j=null;var l=null;for(var k=0;k<g.length;k++){j=g[k];switch(j.aspect){case Variable.prototype.EXTERNAL_CONTEXT:l=new ContextVar(m,j.name,j.concept);h.push(l);break;default:break}}return h};this.getGadgetContextVars=function(m){var h=[];var g=b;var j=null;var l=null;for(var k=0;k<g.length;k++){j=g[k];switch(j.aspect){case Variable.prototype.GADGET_CONTEXT:l=new ContextVar(m,j.name,j.concept);h.push(l);break;default:break}}return h};this.getUserPrefsId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.USER_PREF){h.push(j.name)}}return h};this.getEventsId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.EVENT){h.push(j.name)}}return h};this.getSlots=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.SLOT){h.push(j)}}return h};this.getEvents=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.EVENT){h.push(j)}}return h};this.getPropertiesId=function(){var h=[];var g=b;var j=null;for(var k=0;k<g.length;k++){j=g[k];if(j.aspect==Variable.prototype.PROPERTY){h.push(j.name)}}return h}}function Gadget(gadget_,url_){var _this=this;this.getVendor=function(){return state.getVendor()};this.getName=function(){return state.getName()};this.getVersion=function(){return state.getVersion()};this.getTemplate=function(){return state.getTemplate()};this.getXHtml=function(){return state.getXHtml()};this.getInfoString=function(){return state.getInfoString()};this.getImage=function(){return state.getImage()};this.setImage=function(image_){state.setImage(image_)};this.getImageURI=function(){return state.getImageURI()};this.getIPhoneImageURI=function(){return state.getIPhoneImageURI()};var _solicitarGadget=function(url_){var onError=function(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}}msg=interpolate(gettext("The gadget could not be added to the showcase: %(errorMsg)s."),{errorMsg:msg},true);LogManagerFactory.getInstance().log(msg)};var loadGadget=function(transport){var response=transport.responseText;var objRes=eval("("+response+")");state=new GadgetState(objRes);ShowcaseFactory.getInstance().gadgetToShowcaseGadgetModel(_this)};var persistenceEngine=PersistenceEngineFactory.getInstance();var param={url:url_};persistenceEngine.send_post(URIs.GET_GADGETS,param,this,loadGadget,onError)};this.getId=function(){return this.getVendor()+"_"+this.getName()+"_"+this.getVersion()};var state=null;if(url_!=null){_solicitarGadget(url_)}else{state=new GadgetState(gadget_)}}function GadgetState(f){var j=null;var b=null;var h=null;var k=null;var a=null;var c=null;var g=null;var d=null;j=f.vendor;b=f.name;h=f.version;k=new GadgetTemplate(f.variables,f.size);a=new XHtml(f.xhtml);c=f.image;g=f.imageURI;d=f.iPhoneImageURI;this.getVendor=function(){return j};this.getName=function(){return b};this.getVersion=function(){return h};this.getTemplate=function(){return k};this.getXHtml=function(){return a};this.getInfoString=function(){var l={vendor:j,name:b,version:h};var m=gettext("[GadgetVendor: %(vendor)s, GadgetName: %(name)s, GadgetVersion: %(version)s]");return interpolate(m,l,true)};this.getImage=function(){return c};this.setImage=function(l){c=l};this.getImageURI=function(){return g};this.getIPhoneImageURI=function(){return(d!="")?d:g}}function WorkSpace(workSpaceState){var loadWorkSpace=function(transport){var response=transport.responseText;this.workSpaceGlobalInfo=eval("("+response+")");var tabs=this.workSpaceGlobalInfo.workspace["tabList"];var visibleTabId=null;if(tabs.length>0){for(var i=0;i<tabs.length;i++){var tab=tabs[i];this.tabInstances.push(new Tab(tab,this,i));if(tab.visible){this.visibleTabIndex=i}}}this.varManager=new VarManager(this);this.contextManager=new ContextManager(this,this.workSpaceGlobalInfo);this.wiring=new Wiring(this,this.workSpaceGlobalInfo);this.loaded=true;this.visibleTab=this.tabInstances[this.visibleTabIndex];OpManagerFactory.getInstance().continueLoadingGlobalModules(Modules.prototype.ACTIVE_WORKSPACE)};var onError=function(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{msg=transport.status+" "+transport.statusText}alert(msg)};WorkSpace.prototype.igadgetLoaded=function(igadgetId){if(!this.igadgetIdsLoaded.elementExists(igadgetId)){this.igadgetIdsLoaded.push(igadgetId);var igadget=this.getIgadget(igadgetId);igadget._notifyLoaded();this.wiring.iGadgetLoaded(igadget);this.contextManager.iGadgetLoaded(igadget);this.varManager.dispatchPendingVariables(igadgetId)}};WorkSpace.prototype.igadgetUnloaded=function(igadgetId){var igadget=this.getIgadget(igadgetId);if(igadget==null){return}this.wiring.iGadgetUnloaded(igadget);this.contextManager.iGadgetUnloaded(igadget);igadget._notifyUnloaded()};WorkSpace.prototype.unload=function(){for(var i=0;i<this.tabInstances.length;i++){this.unloadTab(i)}this.tabInstances.length=0;this.wiring.unload();this.contextManager.unload()};WorkSpace.prototype.unloadTab=function(tabId){var tab=this.tabInstances[tabId];this.varManager.removeWorkspaceVariable(tab.connectable.variable.id);tab.connectable.destroy();tab.destroy();this.visibleTab=null};WorkSpace.prototype.removeIGadgetData=function(iGadgetId){this.varManager.removeInstance(iGadgetId);this.wiring.removeInstance(iGadgetId);this.contextManager.removeInstance(iGadgetId)};WorkSpace.prototype.sendBufferedVars=function(){this.varManager.sendBufferedVars()};WorkSpace.prototype.getTabInstance=function(tabId){for(var i=0;i<this.tabInstances.length;i++){if(this.tabInstances[i].getId()==tabId){return this.tabInstances[i]}}return null};WorkSpace.prototype.getName=function(){return this.workSpaceState.name};WorkSpace.prototype.getId=function(){return this.workSpaceState.id};WorkSpace.prototype.getWiring=function(){return this.wiring};WorkSpace.prototype.getVarManager=function(){return this.varManager};WorkSpace.prototype.getActiveDragboard=function(){return this.visibleTab.getDragboard()};WorkSpace.prototype.downloadWorkSpaceInfo=function(){var workSpaceUrl=URIs.GET_POST_WORKSPACE.evaluate({id:this.workSpaceState.id,last_user:last_logged_user});PersistenceEngineFactory.getInstance().send_get(workSpaceUrl,this,loadWorkSpace,onError)};WorkSpace.prototype.getIgadget=function(igadgetId){for(var i=0;i<this.tabInstances.length;i++){var igadget=this.tabInstances[i].getDragboard().getIGadget(igadgetId);if(igadget){return igadget}}};WorkSpace.prototype.getIGadgets=function(){if(!this.loaded){return}var iGadgets=new Array();for(var i=0;i<this.tabInstances.length;i++){iGadgets=iGadgets.concat(this.tabInstances[i].getDragboard().getIGadgets())}return iGadgets};WorkSpace.prototype.getRelatedIGadgets=function(iGadgetId){var iGadgets=new Array();var dragboard=null;var igadget=null;var id=null;var iGadgetIds=this.wiring.getRelatedIgadgets(iGadgetId);for(var j=0;j<iGadgetIds.length;j++){id=iGadgetIds[j];for(var i=0;i<this.tabInstances.length;i++){dragboard=this.tabInstances[i].getDragboard();igadget=dragboard.getIGadget(id);if(igadget){iGadgets.push(igadget)}}}return iGadgets};WorkSpace.prototype.paint=function(){this.tabsContainerElement.update();this.igadgetIdsLoaded=new Array();var scrolling=0;var step=0;if(document.body.getAttribute("orient")=="portrait"){step=this.scrollPortrait}else{step=this.scrollLandscape}for(var i=0;i<this.tabInstances.length;i++){this.tabInstances[i].show(scrolling,i);scrolling+=step}this.tabsContainerElement.setStyle({display:"block"});window.scrollTo(this.visibleTabIndex*step,1)};WorkSpace.prototype.hide=function(){this.tabsContainerElement.setStyle({display:"none"})};WorkSpace.prototype.show=function(){delete this.igadgetIdsLoaded;this.igadgetIdsLoaded=new Array();this.visibleTab.getDragboard().hide();this.tabsContainerElement.setStyle({display:"block"});var step=0;if(document.body.getAttribute("orient")=="portrait"){step=this.scrollPortrait}else{step=this.scrollLandscape}window.scrollTo(this.visibleTabIndex*step,1)};WorkSpace.prototype.getTab=function(tabId){return this.tabInstances.getElementById(tabId)};WorkSpace.prototype.setTab=function(tab){if(!this.loaded){return}this.visibleTab=tab;this.visibleTab.show()};WorkSpace.prototype.getVisibleTab=function(){if(!this.loaded){return}return this.visibleTab};WorkSpace.prototype.getNumberOfTabs=function(){return this.tabInstances.length};WorkSpace.prototype.updateVisibleTab=function(index){if(this.visibleTabIndex!=index){this.visibleTabIndex=index;this.visibleTab=this.tabInstances[this.visibleTabIndex]}};WorkSpace.prototype.updateLayout=function(orient){this.contextManager.notifyModifiedConcept(Concept.prototype.ORIENTATION,orient);var step=0;var scrolling=0;if(orient=="portrait"){step=this.scrollPortrait;this.tabView.set("maxTabs",3)}else{step=this.scrollLandscape;this.tabView.set("maxTabs",4)}for(var i=0;i<this.tabInstances.length;i++){this.tabInstances[i].updateLayout(scrolling);scrolling+=step}if(OpManagerFactory.getInstance().visibleLayer=="tabs_container"){window.scrollTo(this.visibleTabIndex*step,1)}else{window.scrollTo(0,1)}};WorkSpace.prototype.goTab=function(tab){};WorkSpace.prototype.tabExists=function(tabName){for(var i=0;i<this.tabInstances.length;i++){if(this.tabInstances[i].tabInfo.name==tabName){return true}}return false};WorkSpace.prototype.showRelatedIgadget=function(iGadgetId,tabId){this.visibleTab=this.getTab(tabId);this.visibleTabIndex=this.tabInstances.indexOf(this.visibleTab);this.visibleTab.getDragboard().paintRelatedIGadget(iGadgetId)};this.workSpaceState=workSpaceState;this.workSpaceGlobal=null;this.varManager=null;this.tabInstances=new Array();this.wiring=null;this.varManager=null;this.loaded=false;this.visibleTab=null;this.visibleTabIndex=0;this.tabView=new MYMW.ui.TabView("dragboard",{maxTabs:3});this.igadgetIdsLoaded=null;this.tabsContainerElement=$("tabs_container");this.scrollPortrait=320;this.scrollLandscape=480}function Tab(a,c,b){Tab.prototype.destroy=function(){this.dragboard.destroy();delete this};Tab.prototype.show=function(k,h){var g=this.dragboard.getIGadgets();var j="";var f=(this.tabInfo.name.length>15)?this.tabInfo.name.substring(0,15)+"...":this.tabInfo.name;j+='<div class="container tab" id="'+this.tabName+'" style="left:'+k+'px">';j+='<div class="toolbar anchorTop"><a href="javascript:OpManagerFactory.getInstance().showWorkspaceMenu()" class="back_button"><span class="menu_text">Menu</span></a><h1>'+f+"</h1>";if(isAnonymousUser){j+='<a href="/accounts/login/?next=/" class="logout">Sign-in</a></div>'}else{j+='<a href="/logout" class="logout">Exit</a></div>'}j+='<div class="tab_content">';for(i=0;i<g.length;i++){j+='<div class="igadget_item">';j+='<a href="javascript:OpManagerFactory.getInstance().showDragboard('+g[i].id+');">';j+='<img class="igadget_icon" src="'+g[i].getGadget().getIPhoneImageURI()+'" />';j+="</a>";j+='<a href="javascript:OpManagerFactory.getInstance().showDragboard('+g[i].id+');">'+g[i].getVisibleName()+"</a>";j+="</div>"}j+="</div>";var d=this.workSpace.getNumberOfTabs();if(d>1){j+='<div class="navbar">';for(i=0;i<d;i++){if(i!=h){j+='<img src="/ezweb/images/iphone/greyball.png"></img>'}else{j+='<img src="/ezweb/images/iphone/whiteball.png"></img>'}}j+="</div>"}j+="</div>";new Insertion.Bottom(this.tabsContainer,j);this.tabElement=$(this.tabName)};Tab.prototype.updateLayout=function(d){if(this.tabElement){this.tabElement.setStyle({left:d+"px"})}};Tab.prototype.getDragboard=function(){return this.dragboard};Tab.prototype.getId=function(){return this.tabInfo.id};Tab.prototype.is_painted=function(){return true};this.workSpace=c;this.tabInfo=a;this.index=b;this.tabName="tab_"+this.workSpace.workSpaceState.id+"_"+this.tabInfo.id;this.dragboard=new Dragboard(this,this.workSpace,this.dragboardElement);this.tabsContainer=$("tabs_container");this.tabElement=null}var OpManagerFactory=function(){var instance=null;function OpManager(){var loadEnvironment=function(transport){var response=transport.responseText;var workSpacesStructure=eval("("+response+")");var workSpaces=workSpacesStructure.workspaces;for(var i=0;i<workSpaces.length;i++){var workSpace=workSpaces[i];this.workSpaceInstances[workSpace.id]=new WorkSpace(workSpace);if(workSpace.active){this.activeWorkSpace=this.workSpaceInstances[workSpace.id]}}this.activeWorkSpace.downloadWorkSpaceInfo()};var onError=function(transport,e){alert("error en loadEnvironment")};this.persistenceEngine=PersistenceEngineFactory.getInstance();this.loadCompleted=false;this.visibleLayer=null;this.workSpaceInstances=new Hash();this.activeWorkSpace=null;this.workspaceMenuElement=$("workspace_menu");this.workspaceListElement=$("workspace_list");OpManager.prototype.logIGadgetError=function(igadget,msg,type){console.log(msg)};OpManager.prototype.sendBufferedVars=function(){this.activeWorkSpace.sendBufferedVars()};OpManager.prototype.changeActiveWorkSpace=function(workSpace){if(this.activeWorkSpace!=null){this.activeWorkSpace.unload()}this.activeWorkSpace=workSpace;this.activeWorkSpace.downloadWorkSpaceInfo()};OpManager.prototype.sendEvent=function(gadget,event,value){this.activeWorkSpace.getWiring().sendEvent(gadget,event,value)};OpManager.prototype.loadEnviroment=function(){LayoutManagerFactory.getInstance().resizeWrapper();this.showcaseModule=ShowcaseFactory.getInstance();this.showcaseModule.init();this.logs=LogManagerFactory.getInstance()};OpManager.prototype.igadgetLoaded=function(igadgetId){this.activeWorkSpace.igadgetLoaded(igadgetId)};OpManager.prototype.igadgetUnloaded=function(igadgetId){this.activeWorkSpace.igadgetUnloaded(igadgetId)};OpManager.prototype.showActiveWorkSpace=function(){var workSpaceIds=this.workSpaceInstances.keys();var disabledWorkSpaces=[];var j=0;for(var i=0;i<workSpaceIds.length;i++){var workSpace=this.workSpaceInstances[workSpaceIds[i]];if(workSpace!=this.activeWorkSpace){disabledWorkSpaces[j]=workSpace;j++}}this.activeWorkSpace.paint()};OpManager.prototype.continueLoadingGlobalModules=function(module){if(module==Modules.prototype.SHOWCASE){this.loadActiveWorkSpace();return}if(module==Modules.prototype.ACTIVE_WORKSPACE){this.loadCompleted=true;if(!this.visibleLayer){this.showActiveWorkSpace(this.activeWorkSpace);this.visibleLayer="tabs_container"}tabview=this.activeWorkSpace.tabView;return}};OpManager.prototype.loadActiveWorkSpace=function(){this.persistenceEngine.send_get(URIs.GET_POST_WORKSPACES,this,loadEnvironment,onError)};OpManager.prototype.workSpaceExists=function(newName){var workSpaceValues=this.workSpaceInstances.values();for(var i=0;i<workSpaceValues.length;i++){if(workSpaceValues[i].workSpaceState.name==newName){return true}}return false};OpManager.prototype.showDragboard=function(iGadgetId){this.activeWorkSpace.getActiveDragboard().paint(iGadgetId);this.visibleLayer="dragboard"};OpManager.prototype.showGadgetsMenu=function(){if(this.visibleLayer=="workspace_menu"){this.workspaceMenuElement.setStyle({display:"none"})}this.visibleLayer="tabs_container";this.activeWorkSpace.show()};OpManager.prototype.showGadgetsMenuFromWorskspaceMenu=function(){if(!this.loadCompleted){setTimeout(function(){OpManagerFactory.getInstance().showGadgetsMenuFromWorskspaceMenu()},100)}this.workspaceMenuElement.setStyle({display:"none"});this.showActiveWorkSpace(this.activeWorkSpace);this.visibleLayer="tabs_container"};OpManager.prototype.showRelatedIgadget=function(iGadgetId,tabId){this.activeWorkSpace.showRelatedIgadget(iGadgetId,tabId)};OpManager.prototype.markRelatedIgadget=function(iGadgetId){this.activeWorkSpace.getActiveDragboard().markRelatedIgadget(iGadgetId)};OpManager.prototype.showWorkspaceMenu=function(){if(this.visibleLayer=="tabs_container"){this.activeWorkSpace.hide()}this.visibleLayer="workspace_menu";this.workspaceMenuElement.setStyle({display:"block"});var wkeys=this.workSpaceInstances.keys();var html="<ul>";for(i=0;i<wkeys.length;i++){wname=this.workSpaceInstances[wkeys[i]].getName();if(this.workSpaceInstances[wkeys[i]]==this.activeWorkSpace){html+="<li id='"+this.workSpaceInstances[wkeys[i]].getId()+"_item' class='selected'>"+wname+"<small>★</small></li>"}else{html+="<li id='"+this.workSpaceInstances[wkeys[i]].getId()+"_item'><a href='javascript:OpManagerFactory.getInstance().selectActiveWorkspace("+wkeys[i]+");'>"+wname+"</a></li>"}}html+="<li class='bold'><a href='javascript:CatalogueFactory.getInstance().loadCatalogue()' class='arrow'>Add Mobile Mashup</a></li>";this.workspaceListElement.update(html)};OpManager.prototype.selectActiveWorkspace=function(workspaceKey){var newWorkspace=this.workSpaceInstances[workspaceKey];var newElement=$(newWorkspace.getId()+"_item");var oldElement=$(this.activeWorkSpace.getId()+"_item");newElement.update(newWorkspace.getName()+"<small>★</small>");newElement.className="selected";oldElement.update("<a href='javascript:OpManagerFactory.getInstance().selectActiveWorkspace("+this.activeWorkSpace.workSpaceGlobalInfo.workspace.id+");'>"+this.activeWorkSpace.getName()+"</a>");oldElement.className="";this.loadCompleted=false;this.changeActiveWorkSpace(newWorkspace)}}return new function(){this.getInstance=function(){if(instance==null){instance=new OpManager()}return instance}}}();function GadgetVariable(b,a){this.varManager=null;this.iGadgetId=null;this.name=null}GadgetVariable.prototype.GadgetVariable=function(a,b){this.varManager=OpManagerFactory.getInstance().activeWorkSpace.getVarManager();this.iGadgetId=a;this.name=b};GadgetVariable.prototype.get=function(){return this.varManager.getVariable(this.iGadgetId,this.name)};GadgetVariable.prototype.set=function(a){};GadgetVariable.prototype.register=function(a){};function RGadgetVariable(b,c,a){GadgetVariable.prototype.GadgetVariable.call(this,b,c);this.handler=a;this.register(a)}RGadgetVariable.prototype=new GadgetVariable;RGadgetVariable.prototype.register=function(a){this.varManager.registerVariable(this.iGadgetId,this.name,a)};function RWGadgetVariable(a,b){GadgetVariable.prototype.GadgetVariable.call(this,a,b)}RWGadgetVariable.prototype=new GadgetVariable;RWGadgetVariable.prototype.set=function(a){this.varManager.setVariable(this.iGadgetId,this.name,a)};function Variable(d,c,b,a){this.annotated=false;this.varManager=null;this.id=null;this.iGadget=null;this.name=null;this.label=null;this.aspect=null;this.value=null;this.tab=null}Variable.prototype.Variable=function(j,b,g,f,d,a,h,c){this.varManager=d;this.id=j;this.iGadget=b;this.name=g;this.label=h;this.aspect=f;this.value=a;this.tab=c};Variable.prototype.get=function(){return this.value};Variable.prototype.setHandler=function(){};Variable.prototype.set=function(a){};Variable.prototype.annotate=function(a){this.annotated=true;this.value=a};Variable.prototype.assignConnectable=function(a){this.connectable=a};Variable.prototype.getConnectable=function(){return this.connectable};Variable.prototype.getWorkspace=function(){return this.varManager.getWorkspace()};Variable.prototype.EVENT="EVEN";Variable.prototype.SLOT="SLOT";Variable.prototype.USER_PREF="PREF";Variable.prototype.PROPERTY="PROP";Variable.prototype.EXTERNAL_CONTEXT="ECTX";Variable.prototype.GADGET_CONTEXT="GCTX";Variable.prototype.INOUT="CHANNEL";Variable.prototype.TAB="TAB";function RVariable(j,b,g,f,d,a,h,c){Variable.prototype.Variable.call(this,j,b,g,f,d,a,h,c);this.handler=null}RVariable.prototype=new Variable;RVariable.prototype.setHandler=function(a){this.handler=a};RVariable.prototype.set=function(g){if(this.annotated){var b=[{id:this.id,value:g,aspect:this.aspect}];switch(this.aspect){case Variable.prototype.SLOT:if(!this.tab.is_painted()){this.varManager.addPendingVariable(this.iGadget,this.name,g);this.tab.paint();return}var a=OpManagerFactory.getInstance();var c=a.activeWorkSpace.getIgadget(this.iGadget);if(!c.loaded){this.varManager.addPendingVariable(this.iGadget,this.name,g);return}c.notifyEvent();case Variable.prototype.USER_PREF:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:this.varManager.markVariablesAsModified(b);this.value=g;if(this.handler){try{this.handler(g)}catch(f){var d={iGadgetId:this.iGadget,varName:this.name,exceptionMsg:f};var h=interpolate(gettext('Error in the handler of the "%(varName)s" RVariable in iGadget %(iGadgetId)s: %(exceptionMsg)s.'),d,true);OpManagerFactory.getInstance().logIGadgetError(this.iGadget,h,Constants.Logging.ERROR_MSG)}}else{var a=OpManagerFactory.getInstance();var c=a.activeWorkSpace.getIgadget(this.iGadget);if(c.loaded){var d={iGadgetId:this.iGadget,varName:this.name};var h=interpolate(gettext('IGadget %(iGadgetId)s does not provide a handler for the "%(varName)s" RVariable.'),d,true);a.logIGadgetError(this.iGadget,h,Constants.Logging.WARN_MSG)}}break;case Variable.prototype.TAB:this.varManager.markVariablesAsModified(b);OpManagerFactory.getInstance().activeWorkSpace.goTab(this.connectable.tab);break;default:break}this.annotated=false}};RVariable.prototype.refresh=function(){switch(this.aspect){case Variable.prototype.USER_PREF:case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:if(this.handler){try{this.handler(this.value)}catch(d){var c={iGadgetId:this.iGadget,varName:this.name,exceptionMsg:d};var f=interpolate(gettext('Error in the handler of the "%(varName)s" RVariable in iGadget %(iGadgetId)s: %(exceptionMsg)s.'),c,true);OpManagerFactory.getInstance().logIGadgetError(this.iGadget,f,Constants.Logging.ERROR_MSG)}}else{var a=OpManagerFactory.getInstance();var b=a.activeWorkSpace.getIgadget(this.iGadget);if(b.loaded){var c={iGadgetId:this.iGadget,varName:this.name};var f=interpolate(gettext('IGadget %(iGadgetId)s does not provide a handler for the "%(varName)s" RVariable.'),c,true);a.logIGadgetError(this.iGadget,f,Constants.Logging.WARN_MSG)}}break;case Variable.prototype.TAB:default:break}};function RWVariable(j,b,g,f,d,a,h,c){Variable.prototype.Variable.call(this,j,b,g,f,d,a,h,c)}RWVariable.prototype=new Variable;RWVariable.prototype.set=function(a){this.varManager.incNestingLevel();if(this.value!=a){this.value=a;this.varManager.markVariablesAsModified([this])}switch(this.aspect){case Variable.prototype.EVENT:if(this.connectable!=null){this.connectable.propagate(this.value,false);break}default:break}this.varManager.decNestingLevel()};function VarManager(a){VarManager.prototype.MAX_BUFFERED_REQUESTS=10;VarManager.prototype.parseVariables=function(f){var d=f.workspace["tabList"];for(var c=0;c<d.length;c++){var g=d[c]["igadgetList"];for(var b=0;b<g.length;b++){this.parseIGadgetVariables(g[b],this.workSpace.getTabInstance(d[c].id))}}var h=f.workspace["workSpaceVariableList"];this.parseWorkspaceVariables(h)};VarManager.prototype.parseWorkspaceVariables=function(c){for(var b=0;b<c.length;b++){this.parseWorkspaceVariable(c[b])}};VarManager.prototype.sendBufferedVars=function(){function f(h){}function c(l,j){var h=LogManagerFactory.getInstance();var k=h.formatError(gettext("Error saving variables to persistence: %(errorMsg)s."),l,j);h.log(k)}if(this.igadgetModifiedVars.length>0||this.workspaceModifiedVars.length>0){var g={};g.igadgetVars=this.igadgetModifiedVars;g.workspaceVars=this.workspaceModifiedVars;var d={variables:Object.toJSON(g)};var b=URIs.PUT_VARIABLES.evaluate({workspaceId:this.workSpace.getId()});PersistenceEngineFactory.getInstance().send_update(b,d,this,f,c);this.resetModifiedVariables()}};VarManager.prototype.parseWorkspaceVariable=function(d){var g=d.id;var c=d.name;var b=d.aspect;var f=d.value;switch(b){case Variable.prototype.INOUT:this.workspaceVariables[g]=new RWVariable(g,null,c,b,this,f);break;case Variable.prototype.TAB:this.workspaceVariables[g]=new RVariable(g,null,c,b,this,f);break}};VarManager.prototype.removeWorkspaceVariable=function(b){delete this.workspaceVariables[b];this.workspaceModifiedVars.removeById(b)};VarManager.prototype.parseIGadgetVariables=function(g,h){var l=g.variables;var f=[];for(var k=0;k<l.length;k++){var d=l[k].id;var j=l[k].igadgetId;var c=l[k].name;var m=l[k].label;var b=l[k].aspect;var n=l[k].value;switch(b){case Variable.prototype.PROPERTY:case Variable.prototype.EVENT:f[c]=new RWVariable(d,j,c,b,this,n,m,h);this.variables[d]=f[c];break;case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:case Variable.prototype.SLOT:case Variable.prototype.USER_PREF:f[c]=new RVariable(d,j,c,b,this,n,m,h);this.variables[d]=f[c];break}}this.iGadgets[g.id]=f};VarManager.prototype.registerVariable=function(d,g,c){var b=this.findVariable(d,g);if(b){b.setHandler(c)}else{var f={iGadgetId:d,varName:g};var h=interpolate(gettext('IGadget %(iGadgetId)s does not have any variable named "%(varName)s".\nIf you need it, please insert it into the gadget\'s template.'),f,true);OpManagerFactory.getInstance().logIGadgetError(d,h,Constants.Logging.ERROR_MSG)}};VarManager.prototype.assignEventConnectable=function(d,f,c){var b=this.findVariable(d,f);b.assignEvent(c)};VarManager.prototype.getVariable=function(c,d){var b=this.findVariable(c,d);return b.get()};VarManager.prototype.setVariable=function(c,f,d){var b=this.findVariable(c,f);b.set(d)};VarManager.prototype.addPendingVariable=function(b,d,c){var f=this.pendingVariables[b];if(!f){this.pendingVariables[b]=new Array();f=this.pendingVariables[b]}f.push({name:d,value:c})};VarManager.prototype.dispatchPendingVariables=function(c){var d=this.pendingVariables.remove(c);if(d){for(var b=0;b<d.length;b++){this.setVariable(c,d[b]["name"],d[b]["value"])}}};VarManager.prototype.addInstance=function(d,b,c){this.parseIGadgetVariables(b,c)};VarManager.prototype.removeInstance=function(b){delete this.iGadgets[b];this.removeIGadgetVariables(b)};VarManager.prototype.removeIGadgetVariables=function(d){var c=this.variables.keys();for(var b=0;b<c.length;b++){if(this.variables[c[b]].iGadget==d){this.igadgetModifiedVars.removeById(c[b]);delete this.variables[c[b]]}}};VarManager.prototype.unload=function(){};VarManager.prototype.commitModifiedVariables=function(){if(this.buffered_requests<VarManager.prototype.MAX_BUFFERED_REQUESTS){this.buffered_requests++;return}this.sendBufferedVars()};VarManager.prototype.createWorkspaceVariable=function(b){var c=new Date().getTime();return new RWVariable(c,null,b,Variable.prototype.INOUT,this,"")};VarManager.prototype.addWorkspaceVariable=function(c,b){this.workspaceVariables[c]=b};VarManager.prototype.getWorkspaceVariableById=function(b){return this.workspaceVariables[b]};VarManager.prototype.initializeInterface=function(){var c;var g;var d;var b;for(b in this.iGadgets){g=this.iGadgets[b];for(d in g){c=g[d];if(c.aspect=="SLOT"&&c.handler){try{c.handler(c.value)}catch(f){}}}}};VarManager.prototype.markVariablesAsModified=function(k){var g;for(var c=0;c<k.length;c++){var b=k[c];if(b.aspect==Variable.prototype.INOUT||b.aspect==Variable.prototype.TAB){g=this.workspaceModifiedVars}else{g=this.igadgetModifiedVars}for(var f=0;f<g.length;f++){var h=g[f];if(h.id==b.id){h.value=b.value;return}}var d={};d.id=b.id;d.value=b.value;g.push(d)}};VarManager.prototype.incNestingLevel=function(){this.nestingLevel++};VarManager.prototype.decNestingLevel=function(){this.nestingLevel--;if(this.nestingLevel==0){this.commitModifiedVariables()}};VarManager.prototype.resetModifiedVariables=function(){this.nestingLevel=0;this.buffered_requests=0;this.igadgetModifiedVars=[];this.workspaceModifiedVars=[]};VarManager.prototype.getVariableById=function(b){return this.variables[b]};VarManager.prototype.getVariableByName=function(b,c){return this.findVariable(b,c)};VarManager.prototype.getWorkspace=function(){return this.workSpace};VarManager.prototype.findVariable=function(d,c){var f=this.iGadgets[d];var b=f[c];return b};this.workSpace=a;this.iGadgets=new Hash();this.variables=new Hash();this.workspaceVariables=new Hash();this.igadgetModifiedVars=[];this.workspaceModifiedVars=[];this.nestingLevel=0;this.buffered_requests=0;this.pendingVariables=new Hash();this.parseVariables(this.workSpace.workSpaceGlobalInfo)}var ShowcaseFactory=function(){var instance=null;function Showcase(){Showcase.prototype.MODULE_HTML_ID="showcase";loadGadgets=function(receivedData_){var response=receivedData_.responseText;var jsonGadgetList=eval("("+response+")");for(var i=0;i<jsonGadgetList.length;i++){var jsonGadget=jsonGadgetList[i];var gadget=new Gadget(jsonGadget,null);var gadgetId=gadget.getVendor()+"_"+gadget.getName()+"_"+gadget.getVersion();_gadgets[gadgetId]=gadget}_loaded=true;_opManager.continueLoadingGlobalModules(Modules.prototype.SHOWCASE)};onErrorCallback=function(receivedData_){_loaded=true;_opManager.continueLoadingGlobalModules(Modules.prototype.SHOWCASE)};var _gadgets=new Hash();var _loaded=false;var _opManager=OpManagerFactory.getInstance();var _persistenceEngine=PersistenceEngineFactory.getInstance();Showcase.prototype.getGadget=function(gadgetId_){return _gadgets[gadgetId_]};Showcase.prototype.init=function(){_persistenceEngine.send_get(URIs.GET_GADGETS,this,loadGadgets,onErrorCallback)}}return new function(){this.getInstance=function(){if(instance==null){instance=new Showcase()}return instance}}}();function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function append(a){this.buffer.push(a);return this};StringBuffer.prototype.toString=function toString(){return this.buffer.join("")};function ContextManager(b,a){this._addContextVarsFromTemplate=function(h,g,l){var m=this._workspace.getVarManager();for(var j=0;j<g.size();j++){var d=g[j];d.setVarManager(m);var c=d.getConceptName();var k=this._name2Concept[c];if(k!=null&&k._type!=l){k=null}if(k==null){var f=gettext('There is not any concept of type "%(type)s" called "%(concept)s", the value of the iGadget variable "%(varName)s" will be empty.');f=interpolate(f,{concept:c,type:l,varName:d.getName()},true);OpManagerFactory.getInstance().logIGadgetError(h.getId(),f,Constants.Logging.ERROR_MSG);continue}k.addIGadgetVar(d)}};this._loadConceptsFromWorkspace=function(d){this._concepts=new Hash();this._name2Concept=new Hash();var c=d.workspace["concepts"];for(var l=0;l<c.length;l++){var n=c[l];var g=new Concept(n.concept,n.type,n.adaptor);this._concepts[n.concept]=g;if(n.value!=undefined){g._setInitialValue(n.value)}for(var k=0;k<n.names.length;k++){var m=n.names[k];var h=this._name2Concept[m];if(h!=null){var f=gettext("WARNING: concept name '%(cname)s' is already related to '%(concept)s'. New related concept is '%(newConcept)s'.");f=interpolate(f,{cname:m,concept:h,newConcept:n.concept},true);LogManagerFactory.getInstance().log(f)}this._name2Concept[m]=g}}};this._loadIGadgetContextVarsFromWorkspace=function(o){var p=o.workspace["tabList"];for(var l=0;l<p.length;l++){var c=p[l];var s=c.igadgetList;for(var h=0;h<s.length;h++){var n=s[h];var r=n.variables;for(var g=0;g<r.length;g++){var q=r[g];switch(q.aspect){case Variable.prototype.EXTERNAL_CONTEXT:case Variable.prototype.GADGET_CONTEXT:var f=new ContextVar(n.id,q.name,q.concept);f.setVarManager(this._workspace.getVarManager());var m=this._name2Concept[q.concept];if(m){if(q.aspect!==m._type){var d=gettext('There is not any concept of type "%(type)s" called "%(concept)s", the value of the iGadget variable "%(varName)s" will be empty.');d=interpolate(d,{concept:q.concept,type:m._type,varName:q.name},true);OpManagerFactory.getInstance().logIGadgetError(n.id,d,Constants.Logging.ERROR_MSG)}else{m.addIGadgetVar(f)}}break;default:break}}}}this._loaded=true};ContextManager.prototype.addInstance=function(d,c){if(!this._loaded){return}if(c==null){return}this._addContextVarsFromTemplate(d,c.getExternalContextVars(d.getId()),Concept.prototype.EXTERNAL);this._addContextVarsFromTemplate(d,c.getGadgetContextVars(d.getId()),Concept.prototype.IGADGET)};ContextManager.prototype.iGadgetLoaded=function(h){if(!this._loaded){return}var g=h.getId();var f=this._concepts.keys();for(var c=0;c<f.length;c++){var d=this._concepts[f[c]];d.propagateIGadgetVarValues(h)}};ContextManager.prototype.iGadgetUnloaded=function(g){if(!this._loaded){return}var f=this._concepts.keys();for(var c=0;c<f.length;c++){var d=this._concepts[f[c]];if(d._type!==Concept.prototype.IGADGET){continue}var h=d.getIGadgetVar(g.getId());if(h!=null){h._clearHandler()}}};ContextManager.prototype.removeInstance=function(c){if(!this._loaded){return}var g=this._concepts.keys();for(var f=0;f<g.length;f++){var d=g[f];this._concepts[d].deleteIGadgetVars(c)}};ContextManager.prototype.notifyModifiedConcept=function(c,d){if(!this._loaded){return}if(!this._concepts[c]){return}this._concepts[c].setValue(d)};ContextManager.prototype.notifyModifiedGadgetConcept=function(d,c,g){if(!this._loaded){return}if(this._concepts[c]==null){return}var f=this._concepts[c].getIGadgetVar(d.getId());if(f==null){return}f.setValue(g)};ContextManager.prototype.getWorkspace=function(){return this._workspace};ContextManager.prototype.unload=function(){var c=this._name2Concept.keys();for(var f=0;f<c.length;f++){delete this._name2Concept[c[f]]}delete this._name2Concept;var g=this._concepts.keys();for(var d=0;f<g.length;d++){this._concepts[g[d]].unload();delete this._concepts[g[d]]}delete this._concepts;delete this._loaded;delete this._workspace};this._loaded=false;this._concepts=new Hash();this._name2Concept=new Hash();this._workspace=b;this._loadConceptsFromWorkspace(a);this._loadIGadgetContextVarsFromWorkspace(a)}function ContextVar(a,c,b){this._igadgetId=a;this._varName=c;this._conceptName=b;this._varManager=null;this._value=null}ContextVar.prototype.getName=function(){return this._varName};ContextVar.prototype.getIGadgetId=function(){return this._igadgetId};ContextVar.prototype.getConceptName=function(){return this._conceptName};ContextVar.prototype.getValue=function(){return this._value};ContextVar.prototype.propagateValue=function(){this.setValue(this._value)};ContextVar.prototype.setValue=function(a){this._value=a;if(this._varManager!=null){var b=this._varManager.getVariableByName(this._igadgetId,this._varName);b.annotate(a);b.set(a)}};ContextVar.prototype._clearHandler=function(){if(this._varManager!=null){var a=this._varManager.getVariableByName(this._igadgetId,this._varName);a.setHandler(null)}};ContextVar.prototype.setVarManager=function(a){this._varManager=a};ContextVar.prototype.unload=function(){delete this._igadgetId;delete this._varName;delete this._conceptName;delete this._varManager;delete this._value};function Concept(a,b,c){this._semanticConcept=a;this._type=b;this._adaptor=c;this._value=null;this._initialValue=null;this._igadgetVars=new Object()}Concept.prototype.EXTERNAL="ECTX";Concept.prototype.IGADGET="GCTX";Concept.prototype.USERNAME="username";Concept.prototype.LANGUAGE="language";Concept.prototype.WIDTH="width";Concept.prototype.WIDTHINPIXELS="widthInPixels";Concept.prototype.HEIGHT="height";Concept.prototype.HEIGHTINPIXELS="heightInPixels";Concept.prototype.XPOSITION="xPosition";Concept.prototype.YPOSITION="yPosition";Concept.prototype.LOCKSTATUS="lockStatus";Concept.prototype.ORIENTATION="orientation";Concept.prototype._initAdaptor=function(ivar_){if(ivar_==null){eval("new "+this._adaptor+"()")}else{eval("new "+this._adaptor+"("+ivar_.getIGadgetId()+")")}};Concept.prototype.getSemanticConcept=function(){return this._semanticConcept};Concept.prototype.getAdaptor=function(){return this._adaptor};Concept.prototype.getValue=function(){if(this._type==Concept.prototype.EXTERNAL){return this._value}throw gettext("Concept does not have value, this is a Gadget Concept.")};Concept.prototype.setValue=function(a){switch(this._type){case Concept.prototype.IGADGET:throw gettext("Concept does not have value, this is a Gadget Concept.");break;default:this._value=a;for(var b=0;b<this._igadgetVars.length;b++){var c=this._igadgetVars[b];c.setValue(a)}break}};Concept.prototype._setInitialValue=function(a){this._value=a};Concept.prototype.propagateIGadgetVarValues=function(a){var b=this._igadgetVars[a.getId()];if(b!=null){b.propagateValue()}};Concept.prototype.addIGadgetVar=function(b){switch(this._type){case Concept.prototype.EXTERNAL:var a=b.getIGadgetId();this._igadgetVars[a]=b;if(this._value!=null){b.setValue(this._value)}else{if(this._adaptor){this._initAdaptor(null)}}break;case Concept.prototype.IGADGET:var a=b.getIGadgetId();this._igadgetVars[a]=b;if(this._adaptor){this._initAdaptor(b)}break;default:throw gettext("Unexpected igadget variables. Concept does not have type yet.");break}};Concept.prototype.deleteIGadgetVars=function(a){delete this._igadgetVars[a]};Concept.prototype.getIGadgetVar=function(a){switch(this._type){case Concept.prototype.EXTERNAL:case Concept.prototype.IGADGET:var b=this._igadgetVars[a];return b;default:throw gettext("Concept does not have type yet.")}};Concept.prototype.unload=function(){for(var a in this._igadgetVars){this._igadgetVars[keys[i]].unload()}};function UserAdaptor(){function a(g){var f=JSON.parse(g.responseText);var d=f.value;OpManagerFactory.getInstance().activeWorkSpace.getContextManager().notifyModifiedConcept(UserAdaptor.prototype.CONCEPT,d)}function b(h,f){var d=LogManagerFactory.getInstance();var g=interpolate(gettext("Error getting concept %(concept)s: %(errorMsg)s."),{concept:UserAdaptor.prototype.CONCEPT},true);g=d.formatError(gettext("Error getting concept %(concept)s: %(errorMsg)s."),h,f);d.log(g)}var c=URIs.GET_CONTEXT_VALUE.evaluate({concept:UserAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(c,this,a,b)}UserAdaptor.prototype.CONCEPT="username";function LanguageAdaptor(){function a(g){var d=JSON.parse(g.responseText);var f=d.value;OpManagerFactory.getInstance().activeWorkSpace.getContextManager().notifyModifiedConcept(LanguageAdaptor.prototype.CONCEPT,f)}function b(h,f){var d=LogManagerFactory.getInstance();var g=interpolate(gettext("Error getting concept %(concept)s: %(errorMsg)s."),{concept:UserAdaptor.prototype.CONCEPT},true);g=d.formatError(g,h,f);d.log(g)}var c=URIs.GET_CONTEXT_VALUE.evaluate({concept:LanguageAdaptor.prototype.CONCEPT});PersistenceEngineFactory.getInstance().send_get(c,this,a,b)}LanguageAdaptor.prototype.CONCEPT="language";function IGadget(f,c,d,b,a){this.id=c;this.code=d;this.name=b;this.gadget=f;this.dragboard=a;this.iGadgetElement=$("mymw-content");this.iGadgetTabBar=$("mymw-nav");this.loaded=false}IGadget.prototype.getGadget=function(){return this.gadget};IGadget.prototype.getTab=function(){return this.dragboard.tab};IGadget.prototype.getId=function(){return this.id};IGadget.prototype.getVisibleName=function(){var a=this.name;if(a.length>13){a=a.substring(0,11)+"..."}return a};IGadget.prototype.paint=function(){var b="";var c=this.dragboard.workSpace.getRelatedIGadgets(this.id);if(c.length>0){b+='<div id="related_gadgets" class="related_gadgets">';for(i=0;i<c.length;i++){b+='<div class="related_gadget_div" onclick="OpManagerFactory.getInstance().showRelatedIgadget('+c[i].id+","+c[i].dragboard.tab.tabInfo.id+')" >';b+='<img id="related_'+c[i].getId()+'" class="related_gadget" src="'+c[i].getGadget().getIPhoneImageURI()+'" />';b+="</div>"}b+="</div>"}var a='<div id="gadget_'+this.id+'" class="';if(c.length>0){a+='gadget_content">'}else{a+='gadget_content_full">'}a+='<object id="object_'+this.id+"\" onload='OpManagerFactory.getInstance().igadgetLoaded("+this.id+');\' class="gadget_object" type="text/html" data="'+this.gadget.getXHtml().getURICode()+"?id="+this.id+'" standby="Loading...">';a+='"Loading...."';a+="</object></div>";tab=new MYMW.ui.Tab({id:this.getTabId(),label:this.getVisibleName(),content:a+b,onclick:function(){this.dragboard.unmarkRelatedIgadget(this.id);this.dragboard.updateTab()}.bind(this)});this.dragboard.workSpace.tabView.addTab(tab);this.dragboard.workSpace.tabView.set("activeTab",tab)};IGadget.prototype._notifyLoaded=function(){if(this.loaded){return}this.loaded=true;var a=$("object_"+this.id).contentDocument.defaultView;Event.observe(a,"unload",function(){OpManagerFactory.getInstance().igadgetUnloaded(this.id)}.bind(this),true)};IGadget.prototype._notifyUnloaded=function(){if(!this.loaded){return}this.loaded=false};IGadget.prototype.getTabId=function(){return"mymwtab_"+this.id};IGadget.prototype.save=function(){function onSuccess(transport){var igadgetInfo=eval("("+transport.responseText+")");this.id=igadgetInfo.id;this.dragboard.addIGadget(this,igadgetInfo)}function onError(transport,e){var msg;if(e){msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),{errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e},true)}else{if(transport.responseXML){msg=transport.responseXML.documentElement.textContent}else{msg="HTTP Error "+transport.status+" - "+transport.statusText}}msg=interpolate(gettext("Error adding igadget to persistence: %(errorMsg)s."),{errorMsg:msg},true);LogManagerFactory.getInstance().log(msg)}if(this.dragboard.isLocked()){LayoutManagerFactory.getInstance().showMessageMenu(interpolate(gettext("The destination tab (%(tabName)s) is locked. Try to unlock it or select an unlocked tab."),{tabName:this.dragboard.tab.tabInfo.name},true));return}var persistenceEngine=PersistenceEngineFactory.getInstance();var data=new Hash();data.left=this.position.x;data.top=this.position.y;data.width=this.contentWidth;data.height=this.contentHeight;data.code=this.code;data.name=this.name;var uri=URIs.POST_IGADGET.evaluate({tabId:this.dragboard.tabId,workspaceId:this.dragboard.workSpaceId});data.uri=uri;data.gadget=URIs.GET_GADGET.evaluate({vendor:this.gadget.getVendor(),name:this.gadget.getName(),version:this.gadget.getVersion()});data={igadget:data.toJSON()};persistenceEngine.send_post(uri,data,this,onSuccess,onError)};function Dragboard(b,c,a){this.loaded=false;this.currentCode=1;this.dragboardElement=$("dragboard");this.tabNameElement=$("tab_name");this.barElement=$("bar");this.iGadgets=new Hash();this.tab=b;this.tabId=b.tabInfo.id;this.workSpace=c;this.workSpaceId=c.workSpaceState.id;this.visibleIGadget=null;Dragboard.prototype.updateTab=function(){this.tabNameElement.update(this.tab.tabInfo.name);this.workSpace.updateVisibleTab(this.tab.index)};Dragboard.prototype.paint=function(d){this.setVisibleIGadget(d);this.updateTab();if(this.visibleIGadget){this.visibleIGadget.paint()}if(OpManagerFactory.getInstance().visibleLayer!="dragboard"){this.workSpace.hide();this.dragboardElement.setStyle({display:"block"});this.barElement.setStyle({display:"block"})}};Dragboard.prototype.paintRelatedIGadget=function(g){var f=this.getIGadget(g).getTabId();var d=this.workSpace.tabView.getTabIndexById(f);if(d!=null){this.setVisibleIGadget(g);this.workSpace.tabView.set("activeTab",this.workSpace.tabView.getTab(d))}else{this.paint(g)}};Dragboard.prototype.hide=function(){this.dragboardElement.setStyle({display:"none"});if(this.visibleIGadget){this.visibleIGadget=null}this.workSpace.tabView.clear();this.barElement.setStyle({display:"none"})};Dragboard.prototype.markRelatedIgadget=function(g){$("related_"+g).addClassName("active");var h=this.getIGadget(g);if(h){var f=h.getTabId();var d=this.workSpace.tabView.getTabIndexById(f);if(d!=null){this.workSpace.tabView.getTab(d).set("highlight",true)}}};Dragboard.prototype.unmarkRelatedIgadget=function(f){var d=$("related_"+f);if(d){d.removeClassName("active")}};Dragboard.prototype.parseTab=function(l){var p,k,d,n,f,g,o,h;var m=OpManagerFactory.getInstance();this.currentCode=1;this.iGadgets=new Hash();this.igadgets=l.igadgetList;for(var j=0;j<this.igadgets.length;j++){p=this.igadgets[j];o=p.gadget.split("/");o=o[2]+"_"+o[3]+"_"+o[4];g=ShowcaseFactory.getInstance().getGadget(o);f=new IGadget(g,p.id,p.code,p.name,this);this.iGadgets[p.id]=f;if(p.code>=this.currentCode){this.currentCode=p.code+1}}this.loaded=true};Dragboard.prototype.igadgetLoaded=function(d){};Dragboard.prototype.destroy=function(){var f=this.iGadgets.keys();for(var d=0;d<f.length;d++){this.workSpace.removeIGadgetData(f[d]);delete this.iGadgets[f[d]]}};Dragboard.prototype.saveConfig=function(d){var f=this.iGadgets[d];try{f.saveConfig();this.setConfigurationVisible(f.getId(),false)}catch(g){}};Dragboard.prototype.showInstance=function(d){d.paint(this.dragboardElement,this.dragboardStyle)};Dragboard.prototype.getIGadgets=function(){return this.iGadgets.values()};Dragboard.prototype.getIGadget=function(d){return this.iGadgets[d]};Dragboard.prototype.getWorkspace=function(){return this.workSpace};Dragboard.prototype.getVisibleIGadget=function(){return this.visibleIGadget};Dragboard.prototype.setVisibleIGadget=function(d){this.visibleIGadget=this.getIGadget(d);this.unmarkRelatedIgadget(d);this.updateTab()};this.parseTab(b.tabInfo)}function DontPropagateException(b){var a=new Error();a.message=b;a.name="DONT_PROPAGATE";return a}function Param(c,g,b,f,a,d){this._name=c;this._label=g;this._type=b;this._index=f;this._required=a;this._defaultValue=d}Param.prototype.Param=function(c,g,b,f,a,d){this._name=c;this._label=g;this._type=b;this._index=f;this._required=a;this._defaultValue=d};Param.prototype.getName=function(){return this._name};Param.prototype.getType=function(){return this._type};Param.prototype.getLabel=function(){return this._label};Param.prototype.getIndex=function(){return this._index};Param.prototype.getRequired=function(){return this._required};Param.prototype.getDefaultValue=function(){return this._defaultValue};Param.prototype.createHtmlLabel=function(){var c=document.createElement("div");Element.extend(c);c.addClassName("paramName");var b=document.createElement("img");b.setAttribute("src",_currentTheme.getIconURL("wiring-filter_param"));c.appendChild(b);var a=document.createElement("label");a.innerHTML=this._label+":";c.appendChild(a);return c};Param.prototype.createHtmlValue=function(f,d,h){var c={wiringGUI:f,channel:d,filter:d.getFilter(),param:this,valueElement:h};var g=document.createElement("div");Element.extend(g);var b=document.createElement("input");Element.extend(b);b.addClassName("paramValueInput");b.setAttribute("value",d.getFilterParams()[this._index]["value"]);Event.observe(b,"click",function(j){Event.stop(j)});var a=function(k){var l;var j=BrowserUtilsFactory.getInstance().getTarget(k);this.channel.setFilterParam(this.param._index,j.value);this.valueElement.update(d.getValue());if(this.channel.getFilter().getlastExecError()!=null){LayoutManagerFactory.getInstance().showMessageMenu(this.channel.getFilter().getlastExecError(),Constants.Logging.WARN_MSG);this.valueElement.nodeValue=gettext("undefined")}};Event.observe(b,"change",a.bind(c));g.appendChild(b);return g};function Filter(id_,name_,label_,nature_,code_,category_,params_,helpText_){this._id=id_;this._name=name_;this._label=label_;this._nature=nature_;this._params=new Array();this._lastExecError=null;this._category=category_;this._helpText=helpText_;this.processParams(params_);try{eval("this._code = "+code_);if((typeof this._code)!="function"){this._code=null}}catch(e){this._code=null;var msg=interpolate(gettext("Error loading code of the filter '%(filterName)s'."),{filterName:this._label},true);LogManagerFactory.getInstance().log(msg,Constants.ERROR_MSG)}}Filter.prototype.getNature=function(){return this._nature};Filter.prototype.getId=function(){return this._id};Filter.prototype.getName=function(){return this._name};Filter.prototype.getLabel=function(){return this._label};Filter.prototype.getParams=function(){return this._params};Filter.prototype.getlastExecError=function(){return this._lastExecError};Filter.prototype.setParam=function(a){this._params[a.getIndex()]=a};Filter.prototype.hasParams=function(){return this._params.length!=0};Filter.prototype.getCategory=function(){return this._category};Filter.prototype.getHelpText=function(){return this._helpText};Filter.prototype.processParams=function(c){this._params=new Array();if(c!=null&&c!=""){var a,d;var f=c.evalJSON();for(var b=0;b<f.length;b++){a=f[b];if(a.type=="jpath"){d=new JPathParam(a.name,a.label,a.index,a.required,a.defaultValue)}else{d=new Param(a.name,a.label,a.type,a.index,a.required,a.defaultValue)}this.setParam(d)}}};Filter.prototype.getInitialValues=function(){var b=[];for(var a=0;a<this._params.length;a++){b.push({index:this._params[a]._index,value:this._params[a]._defaultValue})}return b};Filter.prototype.fillFilterParamValues=function(a,f){var b=f.childElements();for(var d=0;d<b.length;d++){var c=b[d].childElements()[0];if(a[d]["value"]){c.value=a[d]["value"]}else{c.value=null}}};Filter.prototype.run=function(o,a,n){var h,b,g={};this._lastExecError=null;try{for(h=0;h<this._params.length;++h){var d=a[h]["value"];if(!d){if(this._params[h].getRequired()){b=interpolate(gettext("Look out! '%(paramName)s' of '%(filterName)s' is required"),{paramName:this._params[h].getLabel(),filterName:this._label},true);this._lastExecError=b;return gettext("undefined")}else{g[this._params[h].getName()]=null;continue}}switch(this._params[h].getType()){case"N":var m=parseInt(d);if(isNaN(m)){b=interpolate(gettext("Error loading parameter '%(paramName)s' of the filter '%(filterName)s'. It must be a number"),{paramName:this._params[h].getLabel(),filterName:this._label},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);this._lastExecError=b;return gettext("undefined")}g[this._params[h].getName()]=d;break;case"regexp":if((d.indexOf("/")==0)&&(d.lastIndexOf("/")>0)){var l=d.substring(1,d.lastIndexOf("/"));var c=d.substring(d.lastIndexOf("/")+1,d.length);g[this._params[h].getName()]=new RegExp(l,c)}else{g[this._params[h].getName()]=new RegExp(d)}break;case"jpath":var j=this._params[h].parse(d);g[this._params[h].getName()]=this._params[h].parse(d);break;default:g[this._params[h].getName()]=d.replace(/"/g,"'");break}}}catch(k){b=interpolate(gettext("Error loading param '%(paramName)s' of the filter '%(filterName)s': %(error)s."),{paramName:this._params[h].getLabel(),filterName:this._label,error:k},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);this._lastExecError=b;return gettext("undefined")}try{return this._code(o,n,g)}catch(f){if(f.name=="DONT_PROPAGATE"){throw new DontPropagateException(f)}else{var b=interpolate(gettext("Error executing code of the filter '%(filterName)s'."),{filterName:this._Label},true);LogManagerFactory.getInstance().log(b,Constants.ERROR_MSG);if(this._params.length==0){this._lastExecError=b}else{this._lastExecError=interpolate(gettext("Error executing code of the filter '%(filterName)s'. Check the parametres."),{filterName:this._label},true)}return gettext("undefined")}}};function RemoteSubscription(){this._op_code=null;this._id=null;this._url=null;this._has_changed=false;this._channel_GUI=null;this._initializing=false}function RemoteSubscription(a){if(a){this._op_code=a.op_code;this._url=a.url;this._id=a.remote_channel_id}else{this._op_code=RemoteSubscription.prototype.DISABLED;this._url=null;this._id=null}this._has_changed=false;this._channel_GUI=null;this._initializing=false}RemoteSubscription.prototype.DISABLED=0;RemoteSubscription.prototype.READ=1;RemoteSubscription.prototype.WRITE=2;RemoteSubscription.prototype.setChannelGUI=function(a){this._channel_GUI=a};RemoteSubscription.prototype.is_reading=function(){return this._op_code==RemoteSubscription.prototype.READ};RemoteSubscription.prototype.is_writing=function(){return this._op_code==RemoteSubscription.prototype.WRITE};RemoteSubscription.prototype.setID=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._id=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.setURL=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._url=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.setOpCode=function(a){if(!this._channel_GUI.wiringGUI){return}this._has_changed=true;this._op_code=a;this._channel_GUI.wiringGUI.notifyRemoteSubscriptionChange()};RemoteSubscription.prototype.hasChanged=function(){return this._has_changed};RemoteSubscription.prototype.markAsChanged=function(){return this._has_changed=true};RemoteSubscription.prototype.getOpCode=function(){return this._op_code};RemoteSubscription.prototype.getURL=function(){return this._url};RemoteSubscription.prototype.getID=function(){return this._id};RemoteSubscription.prototype.getData=function(){var a=new Hash();this._url=this._channel_GUI.remote_url_input.value;a.url=this._url;a.op_code=this._op_code;a.id=this._id;return a};RemoteSubscription.prototype.createURL=function(){var b=function(f){var d=JSON.parse(f.responseText);this.setURL(d.url);this.setID(d.id);this._channel_GUI.updateRemoteSubscription()};var c=function(d){alert("error en create_url")};var a=URIs.POST_CREATE_EXTERNAL_CHANNEL;PersistenceEngineFactory.getInstance().send_post(a,null,this,b,c)};function wConnectable(a,b,d,c){this.id=c;this._name=a;this._type=b;this._friendCode=d}wConnectable.prototype._annotate=function(){var a="_annotate";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.getType=function(){return this.type};wConnectable.prototype.getValue=function(){var a="getValue";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.getName=function(){return this._name};wConnectable.prototype.getId=function(){return this.id};wConnectable.prototype.getFriendCode=function(){return this._friendCode};wConnectable.prototype.fullDisconnect=function(){var a="fullDisconnect";var b=gettext("Unimplemented function: %(funcName)s");b=interpolate(b,{funcName:a},yes);LogManagerFactory.getInstance().log(b);return};wConnectable.prototype.destroy=function(){this.fullDisconnect()};function wOut(a,b,d,c){wConnectable.call(this,a,b,d,c);this.inouts=new Array()}wOut.prototype=new wConnectable();wOut.prototype._annotate=function(c,b,a){if(!a){this.variable.annotate(c,this)}};wOut.prototype._addInput=function(a){this.inouts.push(a)};wOut.prototype._removeInput=function(a){a._removeOutput(this);this.inouts.remove(a)};wOut.prototype.fullDisconnect=function(){var b=this.inouts.clone();for(var a=0;a<b.length;++a){b[a].disconnect(this)}};wOut.prototype.refresh=function(){};function wIn(a,b,d,c){wConnectable.call(this,a,b,d,c);this.outputs=new Array();this.changed=false}wIn.prototype=new wConnectable();wIn.prototype.connect=function(a){this.outputs.push(a);a._addInput(this)};wIn.prototype.disconnect=function(a){if(this.outputs.getElementById(a.getId())==a){if(a instanceof wInOut){a._removeInput(this)}this.outputs.remove(a)}};wIn.prototype.fullDisconnect=function(){var b=this.outputs.clone();for(var a=0;a<b.length;++a){this.disconnect(b[a])}};wIn.prototype.propagate=function(b){for(var a=0;a<this.outputs.length;++a){this.outputs[a]._annotate(b,this,false)}for(var a=0;a<this.outputs.length;++a){this.outputs[a].propagate(b)}};wIn.prototype.refresh=function(){};function wInOut(a,b,d,c){wIn.call(this,a,b,d,c);this.inputs=new Array();this.modified_inputs_state=new Array()}wInOut.prototype=new wIn();wInOut.prototype.isConnectable=function(a){return a!=this&&!a._checkLoop(this,100)};wInOut.prototype._checkLoop=function(c,d){if(d<=0){return false}if(this.outputs.indexOf(c)==-1){for(var b=0;b<this.outputs.length;b++){var a=this.outputs[b];if(!(a instanceof wInOut)){continue}if(a._checkLoop(c,d-1)){return true}}return false}else{return true}};wInOut.prototype._annotate=function(d,c,a){for(var b=0;b<this.outputs.length;++b){this.outputs[b]._annotate(d,c,a)}};wInOut.prototype.propagate=function(b){for(var a=0;a<this.outputs.length;++a){this.outputs[a].propagate(b)}};wInOut.prototype.connect=function(a){wIn.prototype.connect.call(this,a)};wInOut.prototype._addInput=function(a){this.inputs.push(a);this.modified_inputs_state.push(false)};wInOut.prototype._removeInput=function(b){if(this.inputs.getElementById(b.getId())==b){var a=this.inputs.indexOf(b);this.inputs.remove(b);this.modified_inputs_state.splice(a,1)}};wInOut.prototype._removeOutput=function(a){if(this.outputs.getElementById(a.getId())==a){this.outputs.remove(a)}};wInOut.prototype.fullDisconnect=function(){var a=this.inputs.clone();for(var b=0;b<a.length;++b){a[b].disconnect(this)}var c=this.outputs.clone();for(var b=0;b<c.length;++b){this.disconnect(c[b])}};function wEvent(a,b,d,c){this.variable=a;wIn.call(this,this.variable.name,b,d,c);this.variable.assignConnectable(this)}wEvent.prototype=new wIn();wEvent.prototype.getQualifiedName=function(){return"event_"+this.variable.id};wEvent.prototype.getLabel=function(){return this.variable.label};wEvent.prototype.getValue=function(){return this.variable.get()};function wChannel(b,a,f,c,d){this.variable=b;this.provisional_id=c;wInOut.call(this,a,null,null,f);this.variable.assignConnectable(this);this.filter=null;this.filterParams=new Array();this.remoteSubscription=null;this.readOnly=d;this.annotated=true}wChannel.prototype=new wInOut();wChannel.prototype.getValue=function(c){if(this.filter==null){return this.variable.get()}else{try{var a=this.filter.run(this.variable.get(),this.filterParams,this);if(!c&&(this.getFilter().getlastExecError()!=null)){LayoutManagerFactory.getInstance().showMessageMenu(this.getFilter().getlastExecError(),Constants.Logging.WARN_MSG)}return a}catch(b){if(b.name=="DONT_PROPAGATE"){if(c){throw new DontPropagateException(b)}else{return gettext(b.message.message)}}}}};wChannel.prototype.getValueWithoutFilter=function(){return this.variable.get()};wChannel.prototype.getFilter=function(){return this.filter};wChannel.prototype.getRemoteSubscription=function(){return this.remoteSubscription};wChannel.prototype.setRemoteSubscription=function(a){this.remoteSubscription=a};wChannel.prototype.is_remote_reading_channel=function(){return this.remoteSubscription.is_reading()};wChannel.prototype.is_remote_writing_channel=function(){return this.remoteSubscription.is_writing()};wChannel.prototype.is_remote_channel=function(){return this.is_remote_writing_channel()||this.is_remote_reading_channel()};wChannel.prototype.is_read_only=function(){return this.readOnly};wChannel.prototype.setFilter=function(a){this.filter=a;this.filterParams=new Array()};wChannel.prototype._annotate=function(g,f,c){var b=this.variable.get();this.variable.set(g);try{if(!c){this._markInputAsModified(f)}else{this._markAllInputsAsModified(f)}var a=this.getValue(true);this.variable.set(a);this.annotated=true}catch(d){if(d.name=="DONT_PROPAGATE"){this.variable.set(b);this.annotated=false;return}var h=interpolate(gettext("Error committing dragboard changes to persistence: %(errorMsg)s."),{errorMsg:d.msg},true);LogManagerFactory.getInstance().log(h);return}if(this.annotated){wInOut.prototype._annotate.call(this,a,this,c)}};wChannel.prototype.setFilterParams=function(a){this.filterParams=a};wChannel.prototype.setFilterParam=function(a,b){this.filterParams[a]["value"]=b};wChannel.prototype.getFilterParams=function(){return this.filterParams};wChannel.prototype._getJSONInput=function(){var b=new Hash();for(var a=0;a<this.inputs.length;a++){b[this.inputs[a].getName()]=this.inputs[a].getValue()}return b};wChannel.prototype.notifyRemoteChannel=function(c){if(!this.remoteSubscription.is_writing()){return}var a=this.variable.getWorkspace();var b=this.remoteSubscription.getID();a.remoteChannelManager.publish_channel_value(b,c)};wChannel.prototype.propagate=function(a){value=this.variable.get();if(this.annotated){this.notifyRemoteChannel(value);wInOut.prototype.propagate.call(this,value)}this.annotated=true};wChannel.prototype.getQualifiedName=function(){return"channel_"+this.id};wChannel.prototype._markInputAsModified=function(a){var b=this.inputs.indexOf(a);this.modified_inputs_state[b]=true};wChannel.prototype._unmarkAllInputsAsModified=function(){for(var a=0;a<this.modified_inputs_state.length;a++){this.modified_inputs_state[a]=false}};wChannel.prototype._markAllInputsAsModified=function(){for(var a=0;a<this.modified_inputs_state.length;a++){this.modified_inputs_state[a]=true}};wChannel.prototype._allInputsModified=function(){if(this.modified_inputs_state.length==0){return false}for(var a=0;a<this.modified_inputs_state.length;a++){if(!this.modified_inputs_state[a]){return false}}return true};function wTab(b,a,c,d){this.variable=b;this.tab=c;this.variable.assignConnectable(this);wOut.call(this,a,null,null,d)}wTab.prototype=new wOut();wTab.prototype.propagate=function(a){this.variable.set(a)};wTab.prototype.getQualifiedName=function(){return"tab_"+this.id};function wSlot(a,b,d,c){this.variable=a;this.variable.assignConnectable(this);wOut.call(this,this.variable.name,b,d,c)}wSlot.prototype=new wOut();wSlot.prototype.propagate=function(a){this.variable.set(a)};wSlot.prototype.getQualifiedName=function(){return"slot_"+this.variable.id};wSlot.prototype.getLabel=function(){return this.variable.label};wSlot.prototype.refresh=function(){this.variable.refresh()};function Wiring(a,b){Wiring.prototype.processFilter=function(d){var c=new Filter(d.id,d.name,d.label,d.nature,d.code,d.category,d.params,d.help_text);this.filters[d.id]=c};Wiring.prototype.processTab=function(d){var g=d.igadgetList;var c=this.workspace.getTab(d.id).getDragboard();for(var f=0;f<g.length;f++){this.addInstance(c.getIGadget(g[f].id),g[f].variables)}};Wiring.prototype.processVar=function(h){var n=this.workspace.getVarManager();var p=n.getWorkspaceVariableById(h.id);if(h.aspect=="TAB"&&h.connectable){var r=h.connectable.id;var w=h.tab_id;var d=this.workspace.getTab(w);var v=new wTab(p,h.name,d,r);d.connectable=v}if(h.aspect=="CHANNEL"&&h.connectable){var r=h.connectable.id;var t=h.connectable.readOnly;var y=new wChannel(p,h.name,r,false,t);y.setFilter(this.filters[h.connectable.filter]);var l=new RemoteSubscription(h.connectable.remote_subscription);y.setRemoteSubscription(l);var g=h.connectable.filter_params;if(g){g=JSON.parse(g)}else{g=[]}y.setFilterParams(g);var c=h.connectable.ins;for(var s=0;s<c.length;s++){var f=c[s];var x=null;if(f.connectable_type=="in"){var o=f.ig_var_id;x=n.getVariableById(o).getConnectable()}else{var k=gettext("Error in processVar: Channel input connectables can only be events.");LogManagerFactory.getInstance().log(k)}x.connect(y)}var u=h.connectable.outs;for(var s=0;s<u.length;s++){var q=u[s];var m=null;if(q.connectable_type=="out"){if(q.ig_var_id){var o=q.ig_var_id;m=n.getVariableById(o).getConnectable()}else{var o=q.ws_var_id;m=n.getWorkspaceVariableById(o).getConnectable()}}else{var k=gettext("Error in processVar: Channel output connectables can only be slots or tabs.");LogManagerFactory.getInstance().log(k)}y.connect(m)}this.channels.push(y);this.channelsById[y.getId()]=y}};Wiring.prototype._connectInouts=function(g){var h=this.channelsById[g.connectable.id];var c=this.workspace.getVarManager();var f=g.connectable.out_inouts;for(var d=0;d<f.length;d++){var l=this.channelsById[f[d]];if(!h.isConnectable(l)){var k=gettext('Wiring: Loop detected while recovering wiring status from persistence.\nOutput connection to channel "%(targetChannel)s" from channel "%(sourceChannel)s" will be ignored.');k=interpolate(k,{sourceChannel:h.getName(),targetChannel:l.getName()},true);LogManagerFactory.getInstance().log(k,Constants.Logging.WARN_MSG);continue}h.connect(l)}};Wiring.prototype._loadWiring=function(c){var j=c.workspace;var g=j.workSpaceVariableList;var f=j.tabList;var h=j.filters;for(var d=0;d<f.length;d++){this.processTab(f[d])}for(var d=0;d<h.length;d++){this.processFilter(h[d])}for(var d=0;d<g.length;d++){this.processVar(g[d])}for(var d=0;d<g.length;d++){if(g[d].aspect=="CHANNEL"){this._connectInouts(g[d])}}this.loaded=true};Wiring.prototype._newProvisionalChannelId=function(){return this.currentProvisionalId++};Wiring.prototype.get_remote_channels_for_reading_ids=function(){var c=new Array();for(var d=0;d<this.channels.length;d++){if(this.channels[d].is_remote_reading_channel()){c.push(this.channels[d])}}return c};Wiring.prototype.getConnectableId=function(h,d,g){for(var f=0;f<h.length;f++){var c=h[f];if((c.name==d)&&(c.igadgetId==g)){return c.connectable.id}}};Wiring.prototype.iGadgetLoaded=function(d){var c=this.iGadgets[d.getId()]};Wiring.prototype.iGadgetUnloaded=function(f){var d=this.iGadgets[f.getId()];for(var c=0;c<d.slots.length;c++){d.slots[c].variable.setHandler(null)}};Wiring.prototype.addInstance=function(f,n){var o=this.workspace.getVarManager();var m=new Object();var c=f.getId();if(this.iGadgets[c]){var g=gettext("Error adding iGadget into the wiring module of the workspace: Gadget instance already exists.");LogManagerFactory.getInstance().log(g)}m.events=new Array();m.slots=new Array();m.connectables=new Array();for(var j=0;j<n.length;j++){var d=n[j];var h=o.getVariableByName(d.igadgetId,d.name);if(h.aspect=="EVEN"&&d.connectable){var l=d.connectable.id;var k=new wEvent(h,d.type,d.friend_code,l);m.events.push(k);m.connectables.push(k)}if(h.aspect=="SLOT"&&d.connectable){var l=d.connectable.id;var k=new wSlot(h,d.type,d.friend_code,l);m.slots.push(k);m.connectables.push(k)}}this.iGadgets[c]=m};Wiring.prototype.removeInstance=function(f){var d=this.iGadgets[f];if(!d){var g=gettext("Wiring error: Trying to remove an inexistent igadget.");LogManagerFactory.getInstance().log(g);return}for(var c=0;c<d.events.length;c++){d.events[c].destroy()}d.events.clear();for(var c=0;c<d.slots.length;c++){d.slots[c].destroy()}d.slots.clear();this.iGadgets.remove(f)};Wiring.prototype.getIGadgetConnectables=function(c){var f=this.iGadgets[c.id];if(f==null){var d=gettext("Wiring error: Trying to retreive the connectables of an inexistent igadget.");LogManagerFactory.getInstance().log(d);return}return f.connectables};Wiring.prototype.getChannels=function(){return this.channels};Wiring.prototype.getFiltersSort=function(){var c=function(g,f){var d=g.getName();var h=f.getName();return((d<h)?-1:((d>h)?1:0))};return this.filters.values().sort(c)};Wiring.prototype.channelExists=function(c){return this.channels.getElementByName(c)?true:false};Wiring.prototype.createChannel=function(c){if(this.channelExists(c)){var h=gettext("Error creating channel %(channelName)s: Channel already exists");h=interpolate(h,{channelName:c},true);LogManagerFactory.getInstance().log(h);return}var g=this.workspace.getVarManager().createWorkspaceVariable(c);var f=this._newProvisionalChannelId();var d=new wChannel(g,c,f,true);this.channels.push(d);this.provisionalChannels[f]=d;return d};Wiring.prototype.removeChannel=function(c){this.workspace.getVarManager().removeWorkspaceVariable(c.variable.id);this.channelsForRemoving.push(c.getId());this.channels.remove(c);c.destroy()};Wiring.prototype.unload=function(){var c=this.workspace.getVarManager();for(var d=0;d<this.channels.length;d++){var f=this.channels[d];c.removeWorkspaceVariable(f.variable.id);f.destroy()}loaded=false};Wiring.prototype.serializationSuccess=function(f){var g=f.responseText;var m=JSON.parse(g);var j=m.ids;for(var l in j){var c=j[l];var d=this.provisionalChannels[l];delete this.provisionalChannels[l];d.id=c.new_id;d.provisional_id=false;d.variable.id=c.new_wv_id;this.workspace.getVarManager().addWorkspaceVariable(c.new_wv_id,d.variable)}var j=m.urls;for(var h=0;h<j.length;h++){var c=j[h];for(var h=0;h<this.channels.length;h++){var k=this.channels[h];if(k.is_remote_channel()&&k.getRemoteSubscription().getURL()==c.url){k.getRemoteSubscription().setID(c.id)}}}this.workspace.subscribe_to_channels();this.channelsForRemoving=[]};Wiring.prototype.serializationError=function(g,d){var c=LogManagerFactory.getInstance();var f=c.formatError(gettext("Error saving wiring status: %(errorMsg)s."),g,d);c.log(f)};Wiring.prototype.serialize=function(){var l=this.iGadgets.keys();var c=[];for(var k=0;k<this.channels.length;k++){var n=this.channels[k];var o=new Object();o.id=n.id;o.name=n._name;o.type=n._type;o.friend_code=n._friendCode;o.var_id=n.variable.id;o.provisional_id=n.provisional_id;if(n.getFilter()==null){o.filter=null}else{o.filter=n.getFilter().getId()}o.filter_params=n.getFilterParams();if(n.getRemoteSubscription().hasChanged()){o.remote_subscription=n.getRemoteSubscription().getData()}else{o.remote_subscription=null}o.ins=[];for(var h=0;h<n.inputs.length;h++){var q=n.inputs[h];if(q instanceof wInOut){continue}o.ins.push(q.id)}o.outs=[];var p=[];for(var h=0;h<n.outputs.length;h++){var f=n.outputs[h];if(f instanceof wInOut){p.push(f);continue}o.outs.push(f.id)}o.inouts=[];for(var h=0;h<p.length;h++){var m=p[h];o.inouts.push({id:m.id,provisional_id:m.provisional_id})}c.push(o)}var r={inOutList:c,channelsForRemoving:this.channelsForRemoving};var g={json:Object.toJSON(r)};var d=URIs.GET_POST_WIRING.evaluate({id:this.workspace.workSpaceState.id});PersistenceEngineFactory.getInstance().send_post(d,g,this,this.serializationSuccess,this.serializationError)};this.workspace=a;this.loaded=false;this.persistenceEngine=PersistenceEngineFactory.getInstance();this.iGadgets=new Hash();this.channels=new Array();this.channelsById=new Hash();this.filters=new Hash();this.channelsForRemoving=[];this.provisionalChannels=[];this.currentProvisionalId=1;this._loadWiring(b);delete this["channelsById"]}function JPathToken(b,a){this._type=b;this._value=a}function JPathParam(b,f,d,a,c){Param.prototype.Param.call(this,b,f,"jpath",d,a,c)}JPathParam.prototype=new Param;JPathParam.prototype.isChar=function(a){switch(a){case"[":case"]":case".":case":":case"\\":case"=":case'"':return false;break;default:return true;break}};JPathParam.prototype.parse=function(c){var f=new Array();var a=c.length;var b=0;var d=1;do{if((c.charAt(b)=="")&&(d!=1)){throw"Unexpected end of expression"}switch(d){case 1:switch(c.charAt(b)){case"\\":c=c.substring(0,b)+c.substring(b+1);d=2;break;case"[":if(b!=0){f.push(new JPathToken("text",c.substring(0,b)))}c=c.substring(b+1);b=0;d=3;break;case"":if(b!=0){f.push(new JPathToken("text",c.substring(0,b)))}return f;break;default:b++;d=1}break;case 2:b++;d=1;break;case 3:case 5:if(this.isChar(c.charAt(b))){b++;d=4}else{throw"Unexpected character "+d}break;case 4:switch(c.charAt(b)){case"]":f.push(new JPathToken("element",c.substring(0,b)));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1;break;case".":f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=5;break;case":":f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=6;break;case"[":case"\\":case"=":throw"Unexpected character "+d;break;default:b++;d=4}break;case 6:if(c.indexOf("index=")==0){f.push(new JPathToken("index_cond",""));c=c.substring(b+6);b=0;d=7}else{if(c.indexOf("first:")==0){f.push(new JPathToken("first_cond",""));c=c.substring(b+6);b=0;d=16}else{if(c.indexOf("last:")==0){f.push(new JPathToken("last_cond",""));c=c.substring(b+5);b=0;d=16}else{if(this.isChar(c.charAt(b))){b++;d=9}else{throw"Unexpected character "+d}}}}break;case 7:if(c.indexOf("first")==0){f.push(new JPathToken("first_index",""));c=c.substring(b+5);b=0;d=18}else{if(c.indexOf("last")==0){f.push(new JPathToken("last_index",""));c=c.substring(b+4);b=0;d=18}else{if(!isNaN(parseInt(c.charAt(b)))){b++;d=8}else{throw"Unexpected character "+d}}}break;case 8:if(!isNaN(parseInt(c.charAt(b)))){b++;d=8}else{if(c.charAt(b)==":"){f.push(new JPathToken("value",parseInt(c.substring(0,b))));c=c.substring(b+1);b=0;d=12}else{if(c.charAt(b)=="]"){f.push(new JPathToken("value",parseInt(c.substring(0,b))));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1}else{throw"Unexpected character "+d}}}break;case 9:switch(c.charAt(b)){case".":f.push(new JPathToken("condition",c.substring(0,b)));c=c.substring(b+1);b=0;d=15;break;case"=":f.push(new JPathToken("condition",c.substring(0,b)));f.push(new JPathToken("op","="));c=c.substring(b+1);b=0;d=10;break;case":":case"[":case"]":case"\\":throw"Unexpected character "+d;break;default:b++;d=9}break;case 10:if(c.charAt(b)=='"'){c=c.substring(b+1);b=0;d=17}else{if(this.isChar(c.charAt(b))){b++;d=11}else{throw"Unexpected character "+d}}break;case 11:if(c.charAt(b)==":"){f.push(new JPathToken("value",c.substring(0,b)));c=c.substring(b+1);b=0;d=12}else{if(this.isChar(c.charAt(b))){b++;d=11}else{throw"Unexpected character "+d}}break;case 12:if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}break;case 13:if(c.charAt(b)=="]"){f.push(new JPathToken("element",c.substring(0,b)));f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1}else{if(c.charAt(b)=="."){f.push(new JPathToken("element",c.substring(0,b)));c=c.substring(b+1);b=0;d=14}else{if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}}}break;case 14:if(this.isChar(c.charAt(b))){b++;d=13}else{throw"Unexpected character "+d}break;case 15:case 16:if(this.isChar(c.charAt(b))){b++;d=9}else{throw"Unexpected character "+d}break;case 17:switch(c.charAt(b)){case'"':f.push(new JPathToken("value",c.substring(0,b)));c=c.substring(b+1);b=0;d=18;break;default:b++;d=17;break}break;case 18:switch(c.charAt(b)){case"]":f.push(new JPathToken("separator",""));c=c.substring(b+1);b=0;d=1;break;case":":c=c.substring(b+1);b=0;d=12;break;default:throw"Unexpected character "+d}break;default:throw"Lex parser error. Unexpected state "+d}a--}while(a>=0);if(a<0){throw"Lex parser error. Too many iterations"}};JSONParser=new Object();JSONParser.findConditionalElement=function(n,f,a,d){if((typeof n!="object")||(n.length==undefined)){throw"JSON must be a list"}var g=new Array();var h,k;var l,m;for(var c=0;c<n.length;c++){k=d;l=f[k];do{h=this.findJSONElement(l._value,n[c]);l=f[++k]}while(l._type!="op");m=f[++k];for(var b=0;b<n.length;b++){switch(l._value){case"=":if(h[b]==m._value){if(a=="first"){return n[c]}else{g.push(n[c]);break}}break;default:throw"Unexpected operator";break}}}if(g.length==0){return undefined}if(a=="last"){return g[g.length-1]}return g};JSONParser.findJSONElement=function(d,c){if(typeof c!="object"){return undefined}if(c[d]!=undefined){return c[d]}if(c.length!=undefined){var b=new Array();for(var a=0;a<c.length;a++){var g=this.findJSONElement(d,c[a]);if(g!=undefined){b.push(g)}}if(b.length==0){b=undefined}return b}for(var f in c){var b=this.findJSONElement(d,c[f]);if(b!=undefined){return b}}return undefined};JSONParser.parse=function(l,m){var n=new Array();var h=null;var o=null;var f=null;if(l==""){h={}}else{var g=0;while(g<l.length){switch(l[g]){case"\n":l=l.substring(0,g)+l.substring(g+1);break;default:g++;break}}h=JSON.parse(l)}for(var j=0;j<m.length;j++){var d=m[j];switch(d._type){case"text":n.push(d._value);break;case"element":h=this.findJSONElement(d._value,h);break;case"index_cond":var c=m[++j];var b=null;switch(c._type){case"first_index":b=0;break;case"last_index":b=h.length-1;break;default:b=c._value;break}h=h[b];break;case"first_cond":f="first";break;case"last_cond":f="last";break;case"condition":h=this.findConditionalElement(h,m,f,j);while(m[j]._type!="value"){j++}break;case"separator":switch(typeof h){case"object":n.push(Object.toJSON(h));break;case"string":var a=h.indexOf('"');var p=h.lastIndexOf('"');if((a==0)&&(p>0)&&(p==(h.length-1))){h=h.substring(1,p)}default:n.push(h);break}h=JSON.parse(l);break;default:throw"Unexpected token"}}return n.join("")};Wiring.prototype.getRelatedIgadgets=function(c){var b=this.iGadgets[c].events;var d=new Array();var f=null;for(var a=0;a<b.length;a++){var f=b[a].outputs;this.getRelatedOutputs(f,d)}return d};Wiring.prototype.getRelatedOutputs=function(g,c){var f=null;var h=null;var d=null;for(var b=0;b<g.length;b++){f=g[b];if(f.outputs){d=f.outputs;for(var a=0;a<d.length;a++){if(d[a].outputs){this.getRelatedOutputs([d[a]],c)}else{h=d[a].variable.iGadget;if(!c.elementExists(h)){c.push(h)}}}}}};wSlot.prototype.propagate=function(b,a){this.variable.set(b);if(!a){OpManagerFactory.getInstance().markRelatedIgadget(this.variable.iGadget)}};